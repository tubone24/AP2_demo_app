ap2_jaeger  | 2025/11/01 11:40:36 maxprocs: Leaving GOMAXPROCS=8: CPU quota undefined
ap2_jaeger  |
ap2_jaeger  | *******************************************************************************
ap2_jaeger  |
ap2_jaeger  | 🛑  WARNING: End-of-life Notice for Jaeger v1
ap2_jaeger  |
ap2_jaeger  | You are currently running a v1 version of Jaeger, which is deprecated and will
ap2_jaeger  | reach end-of-life on December 31st, 2025. This means there will be no further
ap2_jaeger  | development, bug fixes, or security patches for v1 after this date.
ap2_jaeger  |
ap2_jaeger  | We strongly recommend migrating to Jaeger v2 for continued support and access
ap2_jaeger  | to new features.
ap2_jaeger  |
ap2_jaeger  | For detailed migration instructions, please refer to the official Jaeger
ap2_jaeger  | documentation:  https://www.jaegertracing.io/docs/latest/migration/
ap2_jaeger  |
ap2_jaeger  | Tracking issue: https://github.com/jaegertracing/jaeger/issues/6321
ap2_jaeger  |
ap2_jaeger  | 🛑  WARNING: End-of-life Notice for Jaeger v1
ap2_jaeger  |
ap2_jaeger  | *******************************************************************************
ap2_jaeger  | 2025/11/01 11:40:36 application version: git-commit=a204929483c734da6c54eaa75f3f7c322b3e886b, git-version=v1.74.0, build-date=2025-10-03T02:41:46Z
ap2_jaeger  | {"level":"info","ts":1761997236.4309971,"caller":"flags/service.go:124","msg":"Mounting metrics handler on admin server","route":"/metrics"}
ap2_jaeger  | {"level":"info","ts":1761997236.4311,"caller":"flags/service.go:130","msg":"Mounting expvar handler on admin server","route":"/debug/vars"}
ap2_redis   | 1:C 01 Nov 2025 11:40:36.478 * oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
ap2_redis   | 1:C 01 Nov 2025 11:40:36.478 * Redis version=7.4.6, bits=64, commit=00000000, modified=0, pid=1, just started
ap2_redis   | 1:C 01 Nov 2025 11:40:36.478 * Configuration loaded
ap2_redis   | 1:M 01 Nov 2025 11:40:36.478 * monotonic clock: POSIX clock_gettime
ap2_jaeger  | {"level":"info","ts":1761997236.491053,"caller":"flags/admin.go:106","msg":"Mounting health check on admin server","route":"/"}
ap2_jaeger  | {"level":"info","ts":1761997236.4920506,"caller":"flags/admin.go:123","msg":"Starting admin HTTP server"}
ap2_jaeger  | {"level":"info","ts":1761997236.493124,"caller":"flags/admin.go:137","msg":"Admin server started","http.host-port":"[::]:14269","health-status":"unavailable"}
ap2_jaeger  | {"level":"info","ts":1761997236.4935768,"caller":"grpc@v1.75.0/clientconn.go:176","msg":"[core] original dial target is: \"localhost:4317\""}
ap2_jaeger  | {"level":"info","ts":1761997236.493775,"caller":"grpc@v1.75.0/clientconn.go:459","msg":"[core] [Channel #1]Channel created"}
ap2_jaeger  | {"level":"info","ts":1761997236.4938524,"caller":"grpc@v1.75.0/clientconn.go:207","msg":"[core] [Channel #1]parsed dial target is: resolver.Target{URL:url.URL{Scheme:\"dns\", Opaque:\"\", User:(*url.Userinfo)(nil), Host:\"\", Path:\"/localhost:4317\", RawPath:\"\", OmitHost:false, ForceQuery:false, RawQuery:\"\", Fragment:\"\", RawFragment:\"\"}}"}
ap2_jaeger  | {"level":"info","ts":1761997236.4938738,"caller":"grpc@v1.75.0/clientconn.go:208","msg":"[core] [Channel #1]Channel authority set to \"localhost:4317\""}
ap2_redis   | 1:M 01 Nov 2025 11:40:36.494 * Running mode=standalone, port=6379.
ap2_jaeger  | {"level":"info","ts":1761997236.5151098,"caller":"memory/factory.go:75","msg":"Memory storage initialized","configuration":{"MaxTraces":0}}
ap2_redis   | 1:M 01 Nov 2025 11:40:36.629 * Server initialized
ap2_redis   | 1:M 01 Nov 2025 11:40:36.637 * Reading RDB base file on AOF loading...
ap2_redis   | 1:M 01 Nov 2025 11:40:36.638 * Loading RDB produced by version 7.4.6
ap2_redis   | 1:M 01 Nov 2025 11:40:36.638 * RDB age 128183 seconds
ap2_redis   | 1:M 01 Nov 2025 11:40:36.638 * RDB memory usage when created 0.94 Mb
ap2_redis   | 1:M 01 Nov 2025 11:40:36.638 * RDB is base AOF
ap2_redis   | 1:M 01 Nov 2025 11:40:36.638 * Done loading RDB, keys loaded: 0, keys expired: 0.
ap2_redis   | 1:M 01 Nov 2025 11:40:36.652 * DB loaded from base file appendonly.aof.1.base.rdb: 0.015 seconds
ap2_redis   | 1:M 01 Nov 2025 11:40:36.655 * DB loaded from incr file appendonly.aof.1.incr.aof: 0.003 seconds
ap2_redis   | 1:M 01 Nov 2025 11:40:36.655 * DB loaded from append only file: 0.021 seconds
ap2_redis   | 1:M 01 Nov 2025 11:40:36.656 * Opening AOF incr file appendonly.aof.1.incr.aof on server start
ap2_redis   | 1:M 01 Nov 2025 11:40:36.656 * Ready to accept connections tcp


ap2_meilisearch  |
ap2_jaeger       | {"level":"info","ts":1761997236.6610672,"caller":"grpc@v1.75.0/server.go:715","msg":"[core] [Server #2]Server created"}




ap2_meilisearch  | 888b     d888          d8b 888 d8b                                            888


ap2_jaeger       | {"level":"info","ts":1761997236.6613343,"caller":"server/grpc.go:75","msg":"Starting jaeger-collector gRPC server","grpc.host-port":"[::]:14250"}
ap2_meilisearch  | 8888b   d8888          Y8P 888 Y8P                                            888

ap2_jaeger       | {"level":"info","ts":1761997236.6614656,"caller":"server/http.go:37","msg":"Starting jaeger-collector HTTP server","host-port":":14268"}



ap2_meilisearch  | 88888b.d88888              888                                                888t listening for Zipkin HTTP traffic, port not configured"}


ap2_jaeger       | {"level":"info","ts":1761997236.6619387,"caller":"handler/otlp_receiver.go:75","msg":"OTLP receiver status change","status":"StatusStarting"}


ap2_jaeger       | {"level":"info","ts":1761997236.6621263,"caller":"grpc@v1.75.0/server.go:715","msg":"[core] [Server #3]Server created"}


ap2_meilisearch  | 888  Y8P  888 88888888 888 888 888 "Y8888b. 88888888 .d888888 888    888      888  888




ap2_jaeger       | {"level":"info","ts":1761997236.6621487,"caller":"otlpreceiver@v0.132.0/otlp.go:117","msg":"Starting GRPC serv
ap2_meilisearch  | 888   "   888 Y8b.     888 888 888      X88 Y8b.     888  888 888    Y88b.    888  888


ap2_meilisearch  | 888       888  "Y8888  888 888 888  88888P'  "Y8888  "Y888888 888     "Y8888P 888  888

ap2_jaeger       | {"level":"info","ts":1761997236.6673682,"caller":"otlpreceiver@v0.132.0/otlp.go:175","msg":"Starting HTTP server","endpoint":":4318"}
ap2_jaeger       | {"level":"info","ts":1761997236.6674094,"caller":"app/flags.go:168","msg":"Archive storage not initialized"}
ap2_jaeger       | {"level":"info","ts":1761997236.66748,"caller":"grpc@v1.75.0/server.go:715","msg":"[core] [Server #4]Server created"}
ap2_jaeger       | {"level":"info","ts":1761997236.699529,"caller":"grpc@v1.75.0/server.go:911","msg":"[core] [Server #2 ListenSocket #5]ListenSocket created"}


ap2_jaeger       | {"level":"info","ts":1761997236.6996267,"caller":"grpc@v1.75.0/server.go:911","msg":"[core] [Server #3 ListenSocket #6]ListenSocket created"}


ap2_jaeger       | {"level":"info","ts":1761997236.6997137,"caller":"app/static_handler.go:92","msg":"Using UI configuration","pa
ap2_meilisearch  |
ap2_meilisearch  | Config file path:    "none"
ap2_meilisearch  | Database path:               "./data.ms"
ap2_meilisearch  | Server listening on: "http://0.0.0.0:7700"

ap2_jaeger       | {"level":"info","ts":1761997236.6998632,"caller":"app/server.go:258","msg":"Query server started","http_addr":"[::]:16686","grpc_addr":"[::]:16685"}
ap2_jaeger       | {"level":"info","ts":1761997236.6998773,"caller":"healthcheck/handler.go:117","msg":"Health Check state change","status":"ready"}
ap2_meilisearch  | Commit SHA:nfo","ts":"cfaac6f7ca55e91ec3cf40f8682f528cd8743562"300","msg":"Starting GRPC server","port":16685,"addr":":16685"}
ap2_meilisearch  | Commit date:         "2024-11-14T15:55:14Z"

ap2_meilisearch  | Package version:     "1.11.3"

ap2_jaeger       | {"level":"info","ts":1761997236.6999176,"caller":"grpc@v1.75.0/server.go:911","msg":"[core] [Server #4 ListenSocket #7]ListenSocket created"}
ap2_meilisearch  | Anonymous telemetry: "Disabled"


ap2_jaeger       | {"level":"info","ts":1761997236.6999564,"caller":"app/server.go:286","msg":"Starting HTTP server","port":16686,"addr":":16686"}


ap2_meilisearch  |
ap2_meilisearch  | A master key has been set. Requests to Meilisearch won't be authorized unless you provide an authentication key.
ap2_meilisearch  |
ap2_meilisearch  |
ap2_meilisearch  |  Meilisearch started with a master key considered unsafe for use in a production environment.
ap2_meilisearch  |
ap2_meilisearch  |  A master key of at least 16 bytes will be required when switching to a production environment.
ap2_meilisearch  |
ap2_meilisearch  |
ap2_meilisearch  | We generated a new secure master key for you (you can safely use this token):
ap2_meilisearch  |
ap2_meilisearch  | >> --master-key IADjCL7WAd2yxQkTFud0a1QAaoTrgmLUmz_V-rlyttQ <<
ap2_meilisearch  |
ap2_meilisearch  | Restart Meilisearch with the argument above to use this new and secure master key.
ap2_meilisearch  |
ap2_meilisearch  | Check out Meilisearch Cloud! https://www.meilisearch.com/cloud?utm_campaign=oss&utm_source=engine&utm_medium=cli
ap2_meilisearch  | Documentation:                       https://www.meilisearch.com/docs
ap2_meilisearch  | Source code:                 https://github.com/meilisearch/meilisearch
ap2_meilisearch  | Discord:                     https://discord.meilisearch.com
ap2_meilisearch  |
ap2_meilisearch  | 2025-11-01T11:40:36.672541Z  INFO actix_server::builder: starting 8 workers
ap2_meilisearch  | 2025-11-01T11:40:36.672588Z  INFO actix_server::server: Actix runtime found; starting in Actix runtime
ap2_init_keys    | ================================================================================
ap2_init_keys    | AP2 エージェント キーペア初期化
ap2_init_keys    | ================================================================================
ap2_init_keys    |
ap2_init_keys    | キー保存先: /app/v2/keys
ap2_init_keys    | DID Document保存先: /app/v2/data/did_documents
ap2_init_keys    |
ap2_init_keys    | [Shopping Agent]
ap2_init_keys    |   ℹ️  既存の鍵とDID Documentが見つかりました（スキップ）
ap2_init_keys    |      DID: did:ap2:agent:shopping_agent
ap2_init_keys    |
ap2_init_keys    | [Merchant Agent]
ap2_init_keys    |   ℹ️  既存の鍵とDID Documentが見つかりました（スキップ）
ap2_init_keys    |      DID: did:ap2:agent:merchant_agent
ap2_init_keys    |
ap2_init_keys    | [Merchant]
ap2_init_keys    |   ℹ️  既存の鍵とDID Documentが見つかりました（スキップ）
ap2_init_keys    |      DID: did:ap2:merchant:mugibo_merchant
ap2_init_keys    |
ap2_init_keys    | [Credential Provider]
ap2_init_keys    |   ℹ️  既存の鍵とDID Documentが見つかりました（スキップ）
ap2_init_keys    |      DID: did:ap2:cp:demo_cp
ap2_init_keys    |
ap2_init_keys    | [Credential Provider 2]
ap2_init_keys    |   ℹ️  既存の鍵とDID Documentが見つかりました（スキップ）
ap2_init_keys    |      DID: did:ap2:cp:demo_cp_2
ap2_init_keys    |
ap2_init_keys    | [Payment Processor]
ap2_init_keys    |   ℹ️  既存の鍵とDID Documentが見つかりました（スキップ）
ap2_init_keys    |      DID: did:ap2:agent:payment_processor
ap2_init_keys    |
ap2_init_keys    | ================================================================================
ap2_init_keys    | ✅ 全エージェントの初期化が完了しました
ap2_init_keys    | ================================================================================
ap2_init_keys    |
ap2_init_keys    | 次のステップ:
ap2_init_keys    |   1. docker-compose up -d でサービスを起動
ap2_init_keys    |   2. 各エージェントはキーを永続化ストレージから読み込みます
ap2_init_keys    |   3. DIDは再起動後も一貫して維持されます
ap2_init_keys    |
ap2_init_keys exited with code 0
ap2_init_seeds   | ================================================================================
ap2_init_seeds   | AP2 シードデータ投入 (AP2完全準拠)
ap2_init_seeds   | ================================================================================
ap2_init_seeds   |
ap2_init_seeds   | データ保存先: /app/v2/data
ap2_init_seeds   |
ap2_init_seeds   | AP2完全準拠のため、以下のデータのみ投入します：
ap2_init_seeds   |   ✅ 商品データ: Merchantが管理
ap2_init_seeds   |   ⚠️  ユーザーデータ: Passkey登録時に自動作成（フロントエンド）
ap2_init_seeds   |   ⚠️  支払い方法: Passkey登録後、ユーザーが登録（セキュリティ要件）
ap2_init_seeds   |
ap2_init_seeds   | [商品データ投入]
ap2_init_seeds   | データベース: sqlite+aiosqlite:////app/v2/data/merchant_agent.db
ap2_init_seeds   |   ℹ️  既存の商品データが見つかりました（28件、スキップ）
ap2_init_seeds   |
ap2_init_seeds   | ================================================================================
ap2_init_seeds   | ✅ 商品データの投入が完了しました (AP2完全準拠)
ap2_init_seeds   | ================================================================================
ap2_init_seeds   |
ap2_init_seeds   | 投入データサマリ:
ap2_init_seeds   |   - 商品: 28件 (merchant_agent.db)
ap2_init_seeds   |
ap2_init_seeds   | 次のステップ:
ap2_init_seeds   |   1. フロントエンド (http://localhost:3000) にアクセス
ap2_init_seeds   |   2. ユーザー登録 (/auth/register)
ap2_init_seeds   |   3. Passkey登録 (/auth/register-passkey)
ap2_init_seeds   |   4. 支払い方法登録（Passkey登録後に自動表示）
ap2_init_seeds   |
ap2_init_seeds exited with code 0
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.402516Z", "level": "INFO", "logger": "common.search_engine", "message": "[MeilisearchClient] Initialized: http://meilisearch:7700, index=products", "module": "search_engine", "function": "__init__", "line": 38}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.403205Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Initialized: merchant_agent_mcp v1.0.0", "module": "mcp_server", "function": "__init__", "line": 90}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.403665Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: search_products", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.403839Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: check_inventory", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.403885Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_cart_mandates", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.519623Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Initialized: shopping_agent_mcp v1.0.0", "module": "mcp_server", "function": "__init__", "line": 90}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.519738Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_intent_mandate", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.519775Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: request_cart_candidates", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.519805Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: select_and_sign_cart", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.519835Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: assess_payment_risk", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.519865Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_payment_mandate", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.519900Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: execute_payment", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.567531Z", "level": "INFO", "logger": "common.search_engine", "message": "[MeilisearchClient] Initialized: http://meilisearch:7700, index=products", "module": "search_engine", "function": "__init__", "line": 38}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.567903Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Initialized: merchant_agent_mcp v1.0.0", "module": "mcp_server", "function": "__init__", "line": 90}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.567984Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: search_products", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.568039Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: check_inventory", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.568153Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_cart_mandates", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | INFO:     Started server process [1]
ap2_merchant_agent_mcp  | INFO:     Waiting for application startup.
ap2_merchant_agent_mcp  | INFO:     Application startup complete.
ap2_merchant_agent_mcp  | INFO:     Uvicorn running on http://0.0.0.0:8011 (Press CTRL+C to quit)
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.704470Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Initialized: shopping_agent_mcp v1.0.0", "module": "mcp_server", "function": "__init__", "line": 90}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.704538Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_intent_mandate", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.704566Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: request_cart_candidates", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.704585Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: select_and_sign_cart", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.704617Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: assess_payment_risk", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.704631Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_payment_mandate", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.704647Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: execute_payment", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | INFO:     Started server process [1]
ap2_shopping_agent_mcp  | INFO:     Waiting for application startup.
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.706019Z", "level": "INFO", "logger": "main", "message": "[Shopping Agent MCP] Starting up...", "module": "main", "function": "lifespan", "line": 404}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.730219Z", "level": "INFO", "logger": "main", "message": "[Shopping Agent MCP] Database initialized", "module": "main", "function": "lifespan", "line": 408}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.742248Z", "level": "INFO", "logger": "main", "message": "[Startup] KeyManager initialized with keys_directory=/app/v2/keys", "module": "main", "function": "lifespan", "line": 415}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.742303Z", "level": "INFO", "logger": "main", "message": "[Startup] Extracted key_id=shopping_agent from AGENT_ID=did:ap2:agent:shopping_agent", "module": "main", "function": "lifespan", "line": 419}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.742327Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.749194Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.749245Z", "level": "INFO", "logger": "main", "message": "[Startup] ED25519 private key loaded for shopping_agent", "module": "main", "function": "lifespan", "line": 425}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.749269Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.751469Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.751514Z", "level": "INFO", "logger": "main", "message": "[Startup] ECDSA private key loaded for shopping_agent", "module": "main", "function": "lifespan", "line": 433}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.751549Z", "level": "INFO", "logger": "main", "message": "[Startup] SignatureManager initialized", "module": "main", "function": "lifespan", "line": 443}
ap2_shopping_agent_mcp  | INFO:     Application startup complete.
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.756661Z", "level": "INFO", "logger": "main", "message": "[Startup] A2AMessageHandler initialized with key_id: shopping_agent", "module": "main", "function": "lifespan", "line": 451}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.756761Z", "level": "INFO", "logger": "main", "message": "[Startup] RiskAssessmentEngine initialized", "module": "main", "function": "lifespan", "line": 455}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T11:40:40.756775Z", "level": "INFO", "logger": "main", "message": "[Shopping Agent MCP] Startup complete", "module": "main", "function": "lifespan", "line": 457}
ap2_shopping_agent_mcp  | INFO:     Uvicorn running on http://0.0.0.0:8010 (Press CTRL+C to quit)
ap2_merchant            | [2025-11-01 11:40:41,615] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_merchant            | [2025-11-01 11:40:41,615] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_merchant            |   Service Name: merchant
ap2_merchant            |   OTLP Endpoint: http://jaeger:4317
ap2_merchant            |   Insecure: True
ap2_merchant            | [2025-11-01 11:40:41,637] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: merchant
ap2_merchant            | [2025-11-01 11:40:41,637] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant            | [2025-11-01 11:40:41,637] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant'. Adding OTLP exporter to existing provider.
ap2_merchant            | [2025-11-01 11:40:41,637] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant            | [2025-11-01 11:40:41,637] INFO in v2.common.base_agent: [Merchant] OpenTelemetry distributed tracing enabled (service: merchant, manual instrumentation only)
ap2_merchant            | {"timestamp": "2025-11-01T11:40:41.650932Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_merchant            | [2025-11-01 11:40:41,655] INFO in v2.common.base_agent: [Merchant] ✓ ECDSA鍵を読み込みました: merchant
ap2_merchant            | {"timestamp": "2025-11-01T11:40:41.655579Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_merchant            | {"timestamp": "2025-11-01T11:40:41.655662Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_merchant            | {"timestamp": "2025-11-01T11:40:41.656910Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_merchant            | [2025-11-01 11:40:41,656] INFO in v2.common.base_agent: [Merchant] ✓ Ed25519鍵を読み込みました: merchant
ap2_merchant            | [2025-11-01 11:40:41,657] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_merchant            | [2025-11-01 11:40:41,657] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_merchant            | [2025-11-01 11:40:41,657] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant            | [2025-11-01 11:40:41,657] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_merchant            | [2025-11-01 11:40:41,657] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_did.json
ap2_merchant            | [2025-11-01 11:40:41,658] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_merchant            | [2025-11-01 11:40:41,658] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_merchant            | [2025-11-01 11:40:41,658] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_merchant            | [2025-11-01 11:40:41,658] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_merchant            | [2025-11-01 11:40:41,658] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_merchant            | [2025-11-01 11:40:41,658] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant            | [2025-11-01 11:40:41,659] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_merchant            | {"timestamp": "2025-11-01T11:40:41.659183Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.CartMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant            | [2025-11-01 11:40:41,663] INFO in v2.common.base_agent: [Merchant] Initialized: did:ap2:merchant
ap2_payment_processor   | [2025-11-01 11:40:41,699] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_payment_processor   | [2025-11-01 11:40:41,699] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_payment_processor   |   Service Name: payment_processor
ap2_payment_processor   |   OTLP Endpoint: http://jaeger:4317
ap2_payment_processor   |   Insecure: True
ap2_shopping_agent      | [2025-11-01 11:40:41,718] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_shopping_agent      | [2025-11-01 11:40:41,718] INFO in v2.common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_shopping_agent      |   Service Name: shopping_agent
ap2_shopping_agent      |   OTLP Endpoint: http://jaeger:4317
ap2_shopping_agent      |   Insecure: True
ap2_payment_processor   | [2025-11-01 11:40:41,723] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: payment_processor
ap2_payment_processor   | [2025-11-01 11:40:41,724] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_payment_processor   | [2025-11-01 11:40:41,724] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='payment_processor'. Adding OTLP exporter to existing provider.
ap2_payment_processor   | [2025-11-01 11:40:41,726] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_payment_processor   | [2025-11-01 11:40:41,726] INFO in v2.common.base_agent: [Payment Processor] OpenTelemetry distributed tracing enabled (service: payment_processor, manual instrumentation only)
ap2_payment_processor   | {"timestamp": "2025-11-01T11:40:41.737501Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: payment_processor (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_merchant            | {"timestamp": "2025-11-01T11:40:41.741559Z", "level": "INFO", "logger": "service", "message": "[Merchant] Initialized", "module": "service", "function": "__init__", "line": 118}
ap2_merchant            | [2025-11-01 11:40:41,741] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_payment_processor   | [2025-11-01 11:40:41,752] INFO in v2.common.base_agent: [Payment Processor] ✓ ECDSA鍵を読み込みました: payment_processor
ap2_payment_processor   | {"timestamp": "2025-11-01T11:40:41.752909Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_payment_processor   | {"timestamp": "2025-11-01T11:40:41.753038Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: payment_processor (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_payment_processor   | [2025-11-01 11:40:41,754] INFO in v2.common.base_agent: [Payment Processor] ✓ Ed25519鍵を読み込みました: payment_processor
ap2_payment_processor   | [2025-11-01 11:40:41,754] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_payment_processor   | {"timestamp": "2025-11-01T11:40:41.754512Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_payment_processor   | [2025-11-01 11:40:41,755] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_payment_processor   | [2025-11-01 11:40:41,755] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_payment_processor   | [2025-11-01 11:40:41,756] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_payment_processor   | [2025-11-01 11:40:41,756] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_did.json
ap2_payment_processor   | [2025-11-01 11:40:41,757] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_payment_processor   | [2025-11-01 11:40:41,757] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_payment_processor   | [2025-11-01 11:40:41,758] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_payment_processor   | [2025-11-01 11:40:41,758] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_shopping_agent      | [2025-11-01 11:40:41,753] INFO in v2.common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: shopping_agent
ap2_shopping_agent      | [2025-11-01 11:40:41,753] INFO in v2.common.base_agent: [Shopping Agent] OpenTelemetry distributed tracing enabled (service: shopping_agent, manual instrumentation only)
ap2_payment_processor   | [2025-11-01 11:40:41,762] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_payment_processor   | [2025-11-01 11:40:41,762] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_payment_processor   | [2025-11-01 11:40:41,762] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_payment_processor   | {"timestamp": "2025-11-01T11:40:41.763034Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_payment_processor   | [2025-11-01 11:40:41,765] INFO in v2.common.base_agent: [Payment Processor] Initialized: did:ap2:agent:payment_processor
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:41.769566Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_shopping_agent      | [2025-11-01 11:40:41,775] INFO in v2.common.base_agent: [Shopping Agent] ✓ ECDSA鍵を読み込みました: shopping_agent
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:41.774983Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:41.775104Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:41.781944Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_shopping_agent      | [2025-11-01 11:40:41,782] INFO in v2.common.base_agent: [Shopping Agent] ✓ Ed25519鍵を読み込みました: shopping_agent
ap2_shopping_agent      | [2025-11-01 11:40:41,782] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_shopping_agent      | [2025-11-01 11:40:41,784] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_shopping_agent      | [2025-11-01 11:40:41,785] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_shopping_agent      | [2025-11-01 11:40:41,787] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_shopping_agent      | [2025-11-01 11:40:41,787] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_did.json
ap2_shopping_agent      | [2025-11-01 11:40:41,788] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_shopping_agent      | [2025-11-01 11:40:41,788] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_shopping_agent      | [2025-11-01 11:40:41,789] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_shopping_agent      | [2025-11-01 11:40:41,789] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_shopping_agent      | [2025-11-01 11:40:41,791] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_shopping_agent      | [2025-11-01 11:40:41,791] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_shopping_agent      | [2025-11-01 11:40:41,793] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:41.793203Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.CartMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:41.793403Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.responses.ProductList", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:41.793451Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.responses.SignatureResponse", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | [2025-11-01 11:40:41,804] INFO in v2.common.base_agent: [Shopping Agent] Initialized: did:ap2:agent:shopping_agent
ap2_merchant            | [2025-11-01 11:40:41,837] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant            | [2025-11-01 11:40:41,837] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant'. Adding OTLP exporter to existing provider.
ap2_merchant            | [2025-11-01 11:40:41,838] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant            | [2025-11-01 11:40:41,838] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant            | [2025-11-01 11:40:41,838] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant'. Adding OTLP exporter to existing provider.
ap2_merchant            | [2025-11-01 11:40:41,839] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant            | [2025-11-01 11:40:41,840] INFO in v2.common.base_agent: [Merchant] OpenTelemetry distributed tracing enabled (service: merchant, manual instrumentation only)
ap2_merchant            | {"timestamp": "2025-11-01T11:40:41.840824Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_merchant            | {"timestamp": "2025-11-01T11:40:41.842930Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_merchant            | {"timestamp": "2025-11-01T11:40:41.843356Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_merchant            | [2025-11-01 11:40:41,843] INFO in v2.common.base_agent: [Merchant] ✓ ECDSA鍵を読み込みました: merchant
ap2_merchant            | [2025-11-01 11:40:41,847] INFO in v2.common.base_agent: [Merchant] ✓ Ed25519鍵を読み込みました: merchant
ap2_merchant            | {"timestamp": "2025-11-01T11:40:41.847652Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_merchant            | [2025-11-01 11:40:41,847] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_merchant            | [2025-11-01 11:40:41,849] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_merchant            | [2025-11-01 11:40:41,849] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant            | [2025-11-01 11:40:41,851] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_merchant            | [2025-11-01 11:40:41,851] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_did.json
ap2_merchant            | [2025-11-01 11:40:41,852] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_merchant            | [2025-11-01 11:40:41,852] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_merchant            | [2025-11-01 11:40:41,853] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_merchant            | [2025-11-01 11:40:41,853] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_merchant            | [2025-11-01 11:40:41,858] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_merchant            | [2025-11-01 11:40:41,859] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant            | [2025-11-01 11:40:41,860] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_merchant            | {"timestamp": "2025-11-01T11:40:41.860650Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.CartMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant            | [2025-11-01 11:40:41,868] INFO in v2.common.base_agent: [Merchant] Initialized: did:ap2:merchant
ap2_merchant            | [2025-11-01 11:40:41,870] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_merchant            | INFO:     Started server process [1]
ap2_merchant            | INFO:     Waiting for application startup.
ap2_merchant            | {"timestamp": "2025-11-01T11:40:41.869392Z", "level": "INFO", "logger": "service", "message": "[Merchant] Initialized", "module": "service", "function": "__init__", "line": 118}
ap2_merchant            | {"timestamp": "2025-11-01T11:40:41.871510Z", "level": "INFO", "logger": "service", "message": "[Merchant] Running startup tasks...", "module": "service", "function": "startup_event", "line": 102}
ap2_merchant            | {"timestamp": "2025-11-01T11:40:41.885939Z", "level": "INFO", "logger": "service", "message": "[Merchant] Database initialized", "module": "service", "function": "startup_event", "line": 106}
ap2_merchant            |
ap2_merchant            | ============================================================
ap2_merchant            | 商品データ投入中...
ap2_merchant            | ============================================================
ap2_shopping_agent      | [2025-11-01 11:40:41,908] INFO in v2.common.risk_assessment: [RiskAssessmentEngine] Initialized (database_mode=enabled)
ap2_merchant            |   ⏭️  スキップ: むぎぼーアクリルキーホルダー (既存)
ap2_payment_processor   | {"timestamp": "2025-11-01T11:40:41.916915Z", "level": "INFO", "logger": "processor", "message": "[Payment Processor] Initialized", "module": "processor", "function": "__init__", "line": 102}
ap2_payment_processor   | [2025-11-01 11:40:41,917] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_merchant            |   ⏭️  スキップ: むぎぼー時計 (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーカレンダー (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーマグカップ (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーステッカー (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーTシャツ (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼートートバッグ (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーポーチ (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーぬいぐるみ（S） (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーぬいぐるみ（L） (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーキャップ (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼークッション (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーノート (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーボールペン (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーウォーターボトル (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼー靴下 (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーマウスパッド (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼースマホケース (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼー折りたたみ傘 (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーエコバッグ (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーブランケット (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼープレート皿 (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーパーカー (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーフェイスタオル (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーアロマキャンドル (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼー抱き枕 (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーポスター (既存)
ap2_merchant            |   ⏭️  スキップ: むぎぼーニット帽 (既存)
ap2_merchant            |
ap2_merchant            | ✅ 商品データ投入完了 (28件)
ap2_merchant            |
ap2_merchant            | ============================================================
ap2_merchant            | ユーザーデータ投入中...
ap2_merchant            | ============================================================
ap2_merchant            |   ⏭️  スキップ: 山田太郎 (既存)
ap2_merchant            |   ⏭️  スキップ: 佐藤花子 (既存)
ap2_merchant            |
ap2_merchant            | ✅ ユーザーデータ投入完了 (2件)
ap2_merchant            | {"timestamp": "2025-11-01T11:40:41.951253Z", "level": "INFO", "logger": "service", "message": "[Merchant] Sample data seeded successfully", "module": "service", "function": "startup_event", "line": 114}
ap2_merchant            | INFO:     Application startup complete.
ap2_merchant            | INFO:     Uvicorn running on http://0.0.0.0:8002 (Press CTRL+C to quit)
ap2_payment_processor   | [2025-11-01 11:40:41,988] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_payment_processor   | [2025-11-01 11:40:41,988] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='payment_processor'. Adding OTLP exporter to existing provider.
ap2_payment_processor   | [2025-11-01 11:40:41,989] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_payment_processor   | [2025-11-01 11:40:41,989] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_payment_processor   | [2025-11-01 11:40:41,989] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='payment_processor'. Adding OTLP exporter to existing provider.
ap2_payment_processor   | [2025-11-01 11:40:41,990] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_payment_processor   | [2025-11-01 11:40:41,990] INFO in v2.common.base_agent: [Payment Processor] OpenTelemetry distributed tracing enabled (service: payment_processor, manual instrumentation only)
ap2_payment_processor   | {"timestamp": "2025-11-01T11:40:41.990124Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: payment_processor (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_payment_processor   | {"timestamp": "2025-11-01T11:40:41.994060Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_payment_processor   | {"timestamp": "2025-11-01T11:40:41.994132Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: payment_processor (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_payment_processor   | [2025-11-01 11:40:41,994] INFO in v2.common.base_agent: [Payment Processor] ✓ ECDSA鍵を読み込みました: payment_processor
ap2_payment_processor   | [2025-11-01 11:40:41,994] INFO in v2.common.base_agent: [Payment Processor] ✓ Ed25519鍵を読み込みました
: payment_processor
ap2_payment_processor   | [2025-11-01 11:40:41,994] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_payment_processor   | {"timestamp": "2025-11-01T11:40:41.994705Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_payment_processor   | [2025-11-01 11:40:41,996] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_payment_processor   | [2025-11-01 11:40:41,996] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_payment_processor   | [2025-11-01 11:40:41,999] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_payment_processor   | [2025-11-01 11:40:41,999] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_did.json
ap2_payment_processor   | [2025-11-01 11:40:41,999] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_payment_processor   | [2025-11-01 11:40:41,999] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_payment_processor   | [2025-11-01 11:40:41,999] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_payment_processor   | [2025-11-01 11:40:42,000] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_payment_processor   | [2025-11-01 11:40:42,000] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_payment_processor   | [2025-11-01 11:40:42,000] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_payment_processor   | [2025-11-01 11:40:42,000] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_payment_processor   | {"timestamp": "2025-11-01T11:40:42.000671Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_payment_processor   | [2025-11-01 11:40:42,002] INFO in v2.common.base_agent: [Payment Processor] Initialized: did:ap2:agent:payment_processor
ap2_payment_processor   | {"timestamp": "2025-11-01T11:40:42.007620Z", "level": "INFO", "logger": "processor", "message": "[Payment Processor] Initialized", "module": "processor", "function": "__init__", "line": 102}
ap2_payment_processor   | [2025-11-01 11:40:42,007] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_payment_processor   | INFO:     Started server process [1]
ap2_payment_processor   | INFO:     Waiting for application startup.
ap2_payment_processor   | {"timestamp": "2025-11-01T11:40:42.008268Z", "level": "INFO", "logger": "processor", "message": "[Payment Processor] Running startup tasks...", "module": "processor", "function": "startup_event", "line": 96}
ap2_payment_processor   | INFO:     Application startup complete.
ap2_payment_processor   | {"timestamp": "2025-11-01T11:40:42.017684Z", "level": "INFO", "logger": "processor", "message": "[Payment Processor] Database initialized", "module": "processor", "function": "startup_event", "line": 100}
ap2_payment_processor   | INFO:     Uvicorn running on http://0.0.0.0:8004 (Press CTRL+C to quit)
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:42.837694Z", "level": "INFO", "logger": "langgraph_merchant", "message": "[Langfuse] Tracing enabled", "module": "langgraph_merchant", "function": "<module>", "line": 83}
ap2_merchant_agent      | [2025-11-01 11:40:42,845] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant_agent      | [2025-11-01 11:40:42,845] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant_agent'. Adding OTLP exporter to existing provider.
ap2_merchant_agent      | [2025-11-01 11:40:42,913] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant_agent      | [2025-11-01 11:40:42,913] INFO in v2.common.base_agent: [Merchant Agent] OpenTelemetry distributed tracing enabled (service: merchant_agent, manual instrumentation only)
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:42.918050Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:42.929717Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:42.929856Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_merchant_agent      | [2025-11-01 11:40:42,929] INFO in v2.common.base_agent: [Merchant Agent] ✓ ECDSA鍵を読み込みました: merchant_agent
ap2_merchant_agent      | [2025-11-01 11:40:42,931] INFO in v2.common.base_agent: [Merchant Agent] ✓ Ed25519鍵を読み込みました: merchant_agent
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:42.931855Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_merchant_agent      | [2025-11-01 11:40:42,931] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_merchant_agent      | [2025-11-01 11:40:42,932] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_merchant_agent      | [2025-11-01 11:40:42,932] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant_agent      | [2025-11-01 11:40:42,933] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_merchant_agent      | [2025-11-01 11:40:42,933] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_did.json
ap2_merchant_agent      | [2025-11-01 11:40:42,933] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_merchant_agent      | [2025-11-01 11:40:42,933] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_merchant_agent      | [2025-11-01 11:40:42,933] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_merchant_agent      | [2025-11-01 11:40:42,933] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_merchant_agent      | [2025-11-01 11:40:42,933] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_merchant_agent      | [2025-11-01 11:40:42,934] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant_agent      | [2025-11-01 11:40:42,934] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:42.934343Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.IntentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:42.934375Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.ProductSearch", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:42.934396Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.CartRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:42.934414Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.CartSelection", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:42.934424Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | [2025-11-01 11:40:42,937] INFO in v2.common.base_agent: [Merchant Agent] Initialized: did:ap2:agent:merchant_agent
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:42.970185Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Initialized (AI Mode: True)", "module": "agent", "function": "__init__", "line": 163}
ap2_shopping_agent      | [2025-11-01 11:40:43,019] INFO in services.shopping_agent.langgraph_shopping_flow: [Langfuse] Shopping Agent tracing enabled
ap2_merchant_agent      | [2025-11-01 11:40:43,022] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant_agent      | [2025-11-01 11:40:43,023] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant_agent'. Adding OTLP exporter to existing provider.
ap2_merchant_agent      | [2025-11-01 11:40:43,023] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant_agent      | [2025-11-01 11:40:43,023] INFO in v2.common.base_agent: [Merchant Agent] OpenTelemetry distributed tracing enabled (service: merchant_agent, manual instrumentation only)
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.023689Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_merchant_agent      | [2025-11-01 11:40:43,024] INFO in v2.common.base_agent: [Merchant Agent] ✓ ECDSA鍵を読み込みました: merchant_agent
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.024329Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.024362Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_merchant_agent      | [2025-11-01 11:40:43,025] INFO in v2.common.base_agent: [Merchant Agent] ✓ Ed25519鍵を読み込みました: merchant_agent
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.025051Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_merchant_agent      | [2025-11-01 11:40:43,025] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_merchant_agent      | [2025-11-01 11:40:43,025] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_merchant_agent      | [2025-11-01 11:40:43,025] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant_agent      | [2025-11-01 11:40:43,025] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_merchant_agent      | [2025-11-01 11:40:43,025] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_did.json
ap2_merchant_agent      | [2025-11-01 11:40:43,026] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_merchant_agent      | [2025-11-01 11:40:43,026] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_merchant_agent      | [2025-11-01 11:40:43,026] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_merchant_agent      | [2025-11-01 11:40:43,026] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_merchant_agent      | [2025-11-01 11:40:43,027] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_merchant_agent      | [2025-11-01 11:40:43,027] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.027908Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.IntentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.027931Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.ProductSearch", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.027941Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.CartRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.027953Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.CartSelection", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.027965Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | [2025-11-01 11:40:43,027] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_merchant_agent      | [2025-11-01 11:40:43,030] INFO in v2.common.base_agent: [Merchant Agent] Initialized: did:ap2:agent:merchant_agent
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.035732Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Initialized (AI Mode: True)", "module": "agent", "function": "__init__", "line": 163}
ap2_merchant_agent      | INFO:     Started server process [1]
ap2_merchant_agent      | INFO:     Waiting for application startup.
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.036027Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Running startup tasks...", "module": "agent", "function": "startup_event", "line": 111}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.049765Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Database initialized", "module": "agent", "function": "startup_event", "line": 115}
ap2_merchant_agent      |
ap2_merchant_agent      | ============================================================
ap2_merchant_agent      | 商品データ投入中...
ap2_merchant_agent      | ============================================================
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーアクリルキーホルダー (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼー時計 (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーカレンダー (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーマグカップ (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーステッカー (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーTシャツ (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼートートバッグ (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーポーチ (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーぬいぐるみ（S） (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーぬいぐるみ（L） (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーキャップ (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼークッション (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーノート (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーボールペン (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーウォーターボトル (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼー靴下 (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーマウスパッド (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼースマホケース (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼー折りたたみ傘 (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーエコバッグ (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーブランケット (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼープレート皿 (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーパーカー (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーフェイスタオル (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーアロマキャンドル (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼー抱き枕 (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーポスター (既存)
ap2_merchant_agent      |   ⏭️  スキップ: むぎぼーニット帽 (既存)
ap2_merchant_agent      |
ap2_merchant_agent      | ✅ 商品データ投入完了 (28件)
ap2_merchant_agent      |
ap2_merchant_agent      | ============================================================
ap2_merchant_agent      | ユーザーデータ投入中...
ap2_merchant_agent      | ============================================================
ap2_merchant_agent      |   ⏭️  スキップ: 山田太郎 (既存)
ap2_merchant_agent      |   ⏭️  スキップ: 佐藤花子 (既存)
ap2_merchant_agent      |
ap2_merchant_agent      | ✅ ユーザーデータ投入完了 (2件)
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.078274Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Sample data seeded successfully", "module": "agent", "function": "startup_event", "line": 121}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.078328Z", "level": "INFO", "logger": "v2.common.search_engine", "message": "[MeilisearchClient] Initialized: http://meilisearch:7700, index=products", "module": "search_engine", "function": "__init__", "line": 38}
ap2_meilisearch         | 2025-11-01T11:40:43.118703Z  INFO HTTP request{method=POST host="meilisearch:7700" route=/indexes query_parameters= user_agent=python-httpx/0.28.1 status_code=202}: meilisearch: close time.busy=5.44ms time.idle=2.73ms
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.120268Z", "level": "INFO", "logger": "v2.common.search_engine", "message": "[MeilisearchClient] Index already exists: products", "module": "search_engine", "function": "create_index", "line": 65}
ap2_meilisearch         | 2025-11-01T11:40:43.122109Z ERROR index_scheduler: Batch failed Index `products` already exists.
ap2_meilisearch         | 2025-11-01T11:40:43.128558Z  INFO HTTP request{method=PATCH host="meilisearch:7700" route=/indexes/products/settings query_parameters= user_agent=python-httpx/0.28.1 status_code=202}: meilisearch: close time.busy=588µs time.idle=1.13ms
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.129394Z", "level": "INFO", "logger": "v2.common.search_engine", "message": "[MeilisearchClient] Index configured: products", "module": "search_engine", "function": "configure_index", "line": 115}
ap2_meilisearch         | 2025-11-01T11:40:43.132120Z  INFO index_scheduler: A batch of tasks was successfully completed with 1 successful tasks and 0 failed tasks.
ap2_meilisearch         | 2025-11-01T11:40:43.138307Z  INFO HTTP request{method=DELETE host="meilisearch:7700" route=/indexes/products/documents query_parameters= user_agent=python-httpx/0.28.1 status_code=202}: meilisearch: close time.busy=262µs time.idle=892µs
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.139022Z", "level": "INFO", "logger": "v2.common.search_engine", "message": "[MeilisearchClient] Cleared index: products", "module": "search_engine", "function": "clear_index", "line": 239}
ap2_meilisearch         | 2025-11-01T11:40:43.140815Z  INFO index_scheduler: A batch of tasks was successfully completed with 1 successful tasks and 0 failed tasks.
ap2_meilisearch         | 2025-11-01T11:40:43.153397Z  INFO HTTP request{method=POST host="meilisearch:7700" route=/indexes/products/documents query_parameters= user_agent=python-httpx/0.28.1 status_code=202}: meilisearch: close time.busy=1.53ms time.idle=1.79ms
ap2_merchant_agent      | [2025-11-01 11:40:43,154] INFO in utils.product_helpers: [_sync_products_to_meilisearch] Synced 28 products to Meilisearch
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.154400Z", "level": "INFO", "logger": "v2.common.search_engine", "message": "[MeilisearchClient] Added 28 documents, taskUid=107", "module": "search_engine", "function": "add_documents", "line": 144}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.155130Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Meilisearch synchronized", "module": "agent", "function": "startup_event", "line": 129}
ap2_shopping_agent      | [2025-11-01 11:40:43,256] INFO in services.shopping_agent.langgraph_shopping_flow: [LangGraph Shopping Flow] LLM initialized: ai/qwen3 at http://host.docker.internal:12434/engines/llama.cpp/v1
ap2_shopping_agent      | [2025-11-01 11:40:43,262] INFO in services.shopping_agent.langgraph_shopping_flow: [create_shopping_flow_graph] LangGraph shopping flow compiled successfully (14 nodes, AP2 compliant, with checkpointer for trace continuity)
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:43.262259Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] LangGraph shopping flow graph initialized successfully (12 nodes)", "module": "agent", "function": "__init__", "line": 241}
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:43.262385Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] Initialized with database-backed risk assessment", "module": "agent", "function": "__init__", "line": 268}
ap2_shopping_agent      | [2025-11-01 11:40:43,326] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_shopping_agent      | [2025-11-01 11:40:43,326] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='shopping_agent'. Adding OTLP exporter to existing provider.
ap2_shopping_agent      | [2025-11-01 11:40:43,327] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_shopping_agent      | [2025-11-01 11:40:43,327] INFO in v2.common.base_agent: [Shopping Agent] OpenTelemetry distributed tracing enabled (service: shopping_agent, manual instrumentation only)
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:43.327578Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_shopping_agent      | [2025-11-01 11:40:43,328] INFO in v2.common.base_agent: [Shopping Agent] ✓ ECDSA鍵を読み込みました: shopping_agent
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:43.328763Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:43.328815Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:43.329584Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_shopping_agent      | [2025-11-01 11:40:43,329] INFO in v2.common.base_agent: [Shopping Agent] ✓ Ed25519鍵を読み込みました: shopping_agent
ap2_shopping_agent      | [2025-11-01 11:40:43,329] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_shopping_agent      | [2025-11-01 11:40:43,330] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_shopping_agent      | [2025-11-01 11:40:43,330] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_shopping_agent      | [2025-11-01 11:40:43,330] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_shopping_agent      | [2025-11-01 11:40:43,330] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_did.json
ap2_shopping_agent      | [2025-11-01 11:40:43,331] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_shopping_agent      | [2025-11-01 11:40:43,331] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_shopping_agent      | [2025-11-01 11:40:43,331] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_shopping_agent      | [2025-11-01 11:40:43,331] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_shopping_agent      | [2025-11-01 11:40:43,332] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_shopping_agent      | [2025-11-01 11:40:43,332] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_shopping_agent      | [2025-11-01 11:40:43,332] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:43.332805Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.CartMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:43.332847Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.responses.ProductList", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:43.332859Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.responses.SignatureResponse", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | [2025-11-01 11:40:43,338] INFO in v2.common.base_agent: [Shopping Agent] Initialized: did:ap2:agent:shopping_agent
ap2_shopping_agent      | [2025-11-01 11:40:43,342] INFO in v2.common.risk_assessment: [RiskAssessmentEngine] Initialized (database_mode=enabled)
ap2_shopping_agent      | [2025-11-01 11:40:43,343] INFO in services.shopping_agent.langgraph_shopping_flow: [LangGraph Shopping Flow] LLM initialized: ai/qwen3 at http://host.docker.internal:12434/engines/llama.cpp/v1
ap2_shopping_agent      | [2025-11-01 11:40:43,345] INFO in services.shopping_agent.langgraph_shopping_flow: [create_shopping_flow_graph] LangGraph shopping flow compiled successfully (14 nodes, AP2 compliant, with checkpointer for trace continuity)
ap2_shopping_agent      | INFO:     Started server process [1]
ap2_shopping_agent      | INFO:     Waiting for application startup.
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:43.345772Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] LangGraph shopping flow graph initialized successfully (12 nodes)", "module": "agent", "function": "__init__", "line": 241}
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:43.345859Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] Initialized with database-backed risk assessment", "module": "agent", "function": "__init__", "line": 268}
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:43.346152Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] Running startup tasks...", "module": "agent", "function": "startup_event", "line": 262}
ap2_shopping_agent      | INFO:     Application startup complete.
ap2_shopping_agent      | {"timestamp": "2025-11-01T11:40:43.355747Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] Database initialized", "module": "agent", "function": "startup_event", "line": 266}
ap2_shopping_agent      | INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.404509Z", "level": "INFO", "logger": "langgraph_merchant", "message": "[MerchantLangGraphAgent] LLM initialized with DMR: http://host.docker.internal:12434/engines/llama.cpp/v1, model: ai/qwen3", "module": "langgraph_merchant", "function": "__init__", "line": 178}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.405702Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Initialized: http://merchant_agent_mcp:8011", "module": "mcp_client", "function": "__init__", "line": 65}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.407538Z", "level": "INFO", "logger": "langgraph_merchant", "message": "[MerchantLangGraphAgent] Initialized with LLM: ai/qwen3, MCP: http://merchant_agent_mcp:8011", "module": "langgraph_merchant", "function": "__init__", "line": 196}
ap2_merchant_agent      | {"timestamp": "2025-11-01T11:40:43.407571Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] LangGraph AI engine initialized", "module": "agent", "function": "startup_event", "line": 143}
ap2_merchant_agent      | INFO:     Application startup complete.
ap2_merchant_agent      | INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
ap2_meilisearch         | 2025-11-01T11:40:44.256623Z  INFO index_scheduler::batch: document indexing done indexing_result=DocumentAdditionResult { indexed_documents: 28, number_of_documents: 28 } processed_in=1.103139792s
ap2_meilisearch         | 2025-11-01T11:40:44.257980Z  INFO index_scheduler: A batch of tasks was successfully completed with 1 successful tasks and 0 failed tasks.
ap2_payment_network     | [2025-11-01 11:40:48,465] INFO in network: [DemoPaymentNetwork] Payment Network Service initialized
ap2_payment_network     |   Redis URL: redis://redis:6379/2
ap2_payment_network     |   Token Store: RedisベースのKVストア（TTL管理対応）
ap2_payment_network     | [2025-11-01 11:40:48,542] INFO in network: [DemoPaymentNetwork] Payment Network Service initialized
ap2_payment_network     |   Redis URL: redis://redis:6379/2
ap2_payment_network     |   Token Store: RedisベースのKVストア（TTL管理対応）
ap2_payment_network     | INFO:     Started server process [1]
ap2_payment_network     | INFO:     Waiting for application startup.
ap2_payment_network     | INFO:     Application startup complete.
ap2_payment_network     | INFO:     Uvicorn running on http://0.0.0.0:8005 (Press CTRL+C to quit)
ap2_frontend            |    ▲ Next.js 15.5.5
ap2_frontend            |    - Local:        http://localhost:3000
ap2_frontend            |    - Network:      http://0.0.0.0:3000
ap2_frontend            |
ap2_frontend            |  ✓ Starting...
ap2_frontend            |  ✓ Ready in 89ms
ap2_credential_provider_2  | [2025-11-01 11:40:49,955] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_credential_provider_2  | [2025-11-01 11:40:49,955] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_credential_provider_2  |   Service Name: credential_provider_2
ap2_credential_provider_2  |   OTLP Endpoint: http://jaeger:4317
ap2_credential_provider_2  |   Insecure: True
ap2_credential_provider    | [2025-11-01 11:40:49,958] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_credential_provider    | [2025-11-01 11:40:49,958] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_credential_provider    |   Service Name: credential_provider
ap2_credential_provider    |   OTLP Endpoint: http://jaeger:4317
ap2_credential_provider    |   Insecure: True
ap2_credential_provider_2  | [2025-11-01 11:40:49,974] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: credential_provider_2
ap2_credential_provider_2  | [2025-11-01 11:40:49,975] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider_2  | [2025-11-01 11:40:49,975] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider_2'. Adding OTLP exporter to existing provider.
ap2_credential_provider_2  | [2025-11-01 11:40:49,975] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider_2  | [2025-11-01 11:40:49,975] INFO in v2.common.base_agent: [Credential Provider] OpenTelemetry distributed tracing enabled (service: credential_provider_2, manual instrumentation only)
ap2_credential_provider    | [2025-11-01 11:40:49,974] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: credential_provider
ap2_credential_provider    | [2025-11-01 11:40:49,975] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider    | [2025-11-01 11:40:49,975] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider'. Adding OTLP exporter to existing provider.
ap2_credential_provider    | [2025-11-01 11:40:49,975] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider    | [2025-11-01 11:40:49,975] INFO in v2.common.base_agent: [Credential Provider] OpenTelemetry distributed tracing enabled (service: credential_provider, manual instrumentation only)
ap2_credential_provider    | {"timestamp": "2025-11-01T11:40:49.982249Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_credential_provider_2  | {"timestamp": "2025-11-01T11:40:49.982494Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}


ap2_credential_provider    | {"timestamp": "2025-11-01T11:40:49.989229Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_credential_provider_2  | {"timestamp": "2025-11-01T11:40:49.989228Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}


ap2_credential_provider    | {"timestamp": "2025-11-01T11:40:49.989522Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}


ap2_credential_provider    | [2025-11-01 11:40:49,989] INFO in v2.common.base_agent: [Credential Provider] ✓ ECDSA鍵を読み込みまし
た: credential_provider
ap2_credential_provider_2  | [2025-11-01 11:40:49,989] INFO in v2.common.base_agent: [Credential Provider] ✓ ECDSA鍵を読み込みまし
た: credential_provider
ap2_credential_provider_2  | {"timestamp": "2025-11-01T11:40:49.989328Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:40:49.993813Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_credential_provider    | [2025-11-01 11:40:49,993] INFO in v2.common.base_agent: [Credential Provider] ✓ Ed25519鍵を読み込みま
した: credential_provider
ap2_credential_provider    | [2025-11-01 11:40:49,994] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_credential_provider_2  | [2025-11-01 11:40:49,994] INFO in v2.common.base_agent: [Credential Provider] ✓ Ed25519鍵を読み込みま
した: credential_provider
ap2_credential_provider_2  | [2025-11-01 11:40:49,994] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_credential_provider_2  | {"timestamp": "2025-11-01T11:40:49.993961Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_credential_provider_2  | [2025-11-01 11:40:49,995] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_credential_provider_2  | [2025-11-01 11:40:49,996] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_credential_provider_2  | [2025-11-01 11:40:49,996] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_credential_provider_2  | [2025-11-01 11:40:49,997] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_credential_provider_2  | [2025-11-01 11:40:49,997] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_credential_provider_2  | [2025-11-01 11:40:49,998] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_credential_provider_2  | [2025-11-01 11:40:49,998] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_credential_provider_2  | [2025-11-01 11:40:49,998] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_credential_provider_2  | [2025-11-01 11:40:49,999] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_credential_provider_2  | [2025-11-01 11:40:49,999] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_credential_provider_2  | [2025-11-01 11:40:50,000] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_credential_provider_2  | {"timestamp": "2025-11-01T11:40:50.000749Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider_2  | {"timestamp": "2025-11-01T11:40:50.000785Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.AttestationRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider    | [2025-11-01 11:40:49,995] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_credential_provider    | [2025-11-01 11:40:49,996] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_credential_provider    | [2025-11-01 11:40:49,997] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_credential_provider    | [2025-11-01 11:40:49,997] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_credential_provider    | [2025-11-01 11:40:49,998] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_credential_provider    | [2025-11-01 11:40:49,998] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_credential_provider    | [2025-11-01 11:40:49,999] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_credential_provider    | [2025-11-01 11:40:49,999] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_credential_provider    | [2025-11-01 11:40:49,999] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_credential_provider    | [2025-11-01 11:40:50,000] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_credential_provider    | [2025-11-01 11:40:50,001] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_credential_provider    | {"timestamp": "2025-11-01T11:40:50.002128Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:40:50.002269Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.AttestationRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}


ap2_credential_provider    | [2025-11-01 11:40:50,007] INFO in v2.common.base_agent: [Credential Provider] Initialized: did:ap2:agent:credential_provider
ap2_credential_provider_2  | [2025-11-01 11:40:50,006] INFO in v2.common.base_agent: [Credential Provider] Initialized: did:ap2:agent:credential_provider
ap2_credential_provider    | {"timestamp": "2025-11-01T11:40:50.101864Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Initialized", "module": "provider", "function": "__init__", "line": 151}
ap2_credential_provider_2  | [2025-11-01 11:40:50,102] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_credential_provider_2  | {"timestamp": "2025-11-01T11:40:50.102300Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Initialized", "module": "provider", "function": "__init__", "line": 151}
ap2_credential_provider    | [2025-11-01 11:40:50,102] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_credential_provider    | [2025-11-01 11:40:50,204] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider    | [2025-11-01 11:40:50,204] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider'. Adding OTLP exporter to existing provider.
ap2_credential_provider    | [2025-11-01 11:40:50,204] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider    | [2025-11-01 11:40:50,205] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider    | [2025-11-01 11:40:50,205] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider'. Adding OTLP exporter to existing provider.
ap2_credential_provider    | [2025-11-01 11:40:50,205] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider    | [2025-11-01 11:40:50,205] INFO in v2.common.base_agent: [Credential Provider] OpenTelemetry distributed tracing enabled (service: credential_provider, manual instrumentation only)
ap2_credential_provider    | {"timestamp": "2025-11-01T11:40:50.206050Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:40:50.207409Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:40:50.207468Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_credential_provider    | [2025-11-01 11:40:50,207] INFO in v2.common.base_agent: [Credential Provider] ✓ ECDSA鍵を読み込みました: credential_provider
ap2_credential_provider    | {"timestamp": "2025-11-01T11:40:50.208698Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_credential_provider    | [2025-11-01 11:40:50,208] INFO in v2.common.base_agent: [Credential Provider] ✓ Ed25519鍵を読み込みま
した: credential_provider
ap2_credential_provider    | [2025-11-01 11:40:50,208] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/shopping_agent_did.json


ap2_credential_provider    | [2025-11-01 11:40:50,209] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_credential_provider_2  | [2025-11-01 11:40:50,204] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider


ap2_credential_provider_2  | [2025-11-01 11:40:50,204] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider_2'. Adding OTLP exporter to existing provider.
ap2_credential_provider    | [2025-11-01 11:40:50,209] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_agent_did.json


ap2_credential_provider_2  | [2025-11-01 11:40:50,204] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider    | [2025-11-01 11:40:50,210] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_credential_provider_2  | [2025-11-01 11:40:50,204] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider_2  | [2025-11-01 11:40:50,204] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (Tr
ap2_credential_provider    | [2025-11-01 11:40:50,210] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_did.json


ap2_credential_provider_2  | [2025-11-01 11:40:50,205] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider_2  | [2025-11-01 11:40:50,205] INFO in v2.common.base_agent: [Credential Provider] OpenTelemetry distributed tracing enabled (service: credential_provider_2, manual instrumentation only)
ap2_credential_provider    | [2025-11-01 11:40:50,211] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant



ap2_credential_provider    | [2025-11-01 11:40:50,211] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_credential_provider_2  | {"timestamp": "2025-11-01T11:40:50.205241Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_credential_provider    | [2025-11-01 11:40:50,211] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_credential_provider_2  | {"timestamp": "2025-11-01T11:40:50.206740Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}


ap2_credential_provider    | [2025-11-01 11:40:50,211] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_2_did.json


ap2_credential_provider    | [2025-11-01 11:40:50,213] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_credential_provider_2  | {"timestamp": "2025-11-01T11:40:50.206795Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 354}
ap2_credential_provider    | [2025-11-01 11:40:50,213] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/payment_processor_did.json


ap2_credential_provider_2  | [2025-11-01 11:40:50,206] INFO in v2.common.base_agent: [Credential Provider] ✓ ECDSA鍵を読み込みまし
た: credential_provider
ap2_credential_provider    | [2025-11-01 11:40:50,214] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録:  did:ap2:agent:payment_processor


ap2_credential_provider    | {"timestamp": "2025-11-01T11:40:50.214913Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}


ap2_credential_provider_2  | [2025-11-01 11:40:50,208] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/shopping_agent_did.json

ap2_credential_provider    | {"timestamp": "2025-11-01T11:40:50.214947Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.AttestationRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}



ap2_credential_provider    | [2025-11-01 11:40:50,227] INFO in v2.common.base_agent: [Credential Provider] Initialized: did:ap2:agent:credential_provider
ap2_credential_provider_2  | {"timestamp": "2025-11-01T11:40:50.207930Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 376}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:40:50.232517Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Initialized", "module": "provider", "function": "__init__", "line": 151}


ap2_credential_provider    | [2025-11-01 11:40:50,232] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_credential_provider_2  | [2025-11-01 11:40:50,208] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_credential_provider    | INFO:     Started server process [1]



ap2_credential_provider    | INFO:     Waiting for application startup.

ap2_credential_provider_2  | [2025-11-01 11:40:50,209] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent


v View in Docker Desktop   o View Config   w Enable Watch

ap2_credential_provider_2  | [2025-11-01 11:40:50,209] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_credential_provider    | {"timestamp": "2025-11-01T11:40:50.234510Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Running startup tasks...", "module": "provider", "function": "startup_event", "line": 145}
ap2_credential_provider_2  | [2025-11-01 11:40:50,210] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_credential_provider    | {"timestamp": "2025-11-01T11:40:50.250292Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Database initialized", "module": "provider", "function": "startup_event", "line": 149}
ap2_credential_provider_2  | [2025-11-01 11:40:50,211] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_credential_provider_2  | [2025-11-01 11:40:50,211] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_2_did.json


ap2_credential_provider    | INFO:     Application startup complete.

ap2_credential_provider_2  | [2025-11-01 11:40:50,211] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2


ap2_credential_provider    | INFO:     Uvicorn running on http://0.0.0.0:8003 (Press CTRL+C to quit)
ap2_credential_provider_2  | [2025-11-01 11:40:50,211] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_credential_provider_2  | [2025-11-01 11:40:50,213] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor


ap2_credential_provider_2  | {"timestamp": "2025-11-01T11:40:50.213241Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider_2  | {"timestamp": "2025-11-01T11:40:50.213278Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.AttestationRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider_2  | [2025-11-01 11:40:50,225] INFO in v2.common.base_agent: [Credential Provider] Initialized: did:ap2:agent:credential_provider
ap2_credential_provider_2  | {"timestamp": "2025-11-01T11:40:50.233104Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Initialized", "module": "provider", "function": "__init__", "line": 151}
ap2_credential_provider_2  | {"timestamp": "2025-11-01T11:40:50.233738Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Running startup tasks...", "module": "provider", "function": "startup_event", "line": 145}
ap2_credential_provider_2  | [2025-11-01 11:40:50,233] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_credential_provider_2  | INFO:     Started server process [1]
ap2_credential_provider_2  | INFO:     Waiting for application startup.
ap2_credential_provider_2  | {"timestamp": "2025-11-01T11:40:50.251668Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Database initialized", "module": "provider", "function": "startup_event", "line": 149}
ap2_credential_provider_2  | INFO:     Application startup complete.
ap2_credential_provider_2  | INFO:     Uvicorn running on http://0.0.0.0:8003 (Press CTRL+C to quit)
ap2_shopping_agent         | INFO:     172.67.69.85:28406 - "OPTIONS /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:41:34.616185Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:41:34.617336Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1761997291639_abefr\n  user_id: usr_ee3014bbc51f4156\n  user_input: k\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1058}
ap2_shopping_agent         | INFO:     172.67.69.85:28406 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:41:34.676882Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Created new session in DB: session_1761997291639_abefr", "module": "agent", "function": "_get_or_create_session", "line": 1965}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:41:34.677151Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1761997291639_abefr)", "module": "agent", "function": "event_generator", "line": 1073}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:41:34.677702Z", "level": "INFO", "logger": "agent", "message": "[Langfuse] Created new handler for session: session_1761997291639_abefr", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1643}
ap2_shopping_agent         | [2025-11-01 11:41:34,685] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: initial
ap2_shopping_agent         |   user_input: k
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:41:37.262230Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=ask_intent", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:41:37.269920Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=ask_intent", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:41:44.766189Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:41:44.766601Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1761997291639_abefr\n  user_id: usr_ee3014bbc51f4156\n  user_input: かわいいグッズがほしい。5000円以内\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1058}
ap2_shopping_agent         | INFO:     172.67.69.85:26857 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:41:44.775982Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761997291639_abefr, step=ask_intent", "module": "agent", "function": "_get_or_create_session", "line": 1943}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:41:44.776692Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1761997291639_abefr)", "module": "agent", "function": "event_generator", "line": 1073}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:41:44.776788Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1761997291639_abefr", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1646}
ap2_shopping_agent         | [2025-11-01 11:41:44,780] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: ask_intent
ap2_shopping_agent         |   user_input: かわいいグッズがほしい。5000円以内
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-01 11:42:11,402] INFO in services.shopping_agent.langgraph_shopping_flow: [collect_intent_node] LLM result: {'intent': 'かわいいグッズを購入したい', 'max_amount': 5000, 'keywords': ['かわいい', 'グッズ', '可愛いグッズ']}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:11.403258Z", "level": "INFO", "logger": "agent", "message": "[_create_intent_mandate] Reconstructed intent: かわいいグッズを購入したい。5000円以内", "module": "agent", "function": "_create_intent_mandate", "line": 1733}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:11.403536Z", "level": "INFO", "logger": "agent", "message": "[_build_intent_mandate_from_session] Constructed natural_language_description: かわいいグッズを購入したい。5000円以内", "module": "agent", "function": "_build_intent_mandate_from_session", "line": 1812}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:11.404396Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] IntentMandate created (AP2-compliant): intent='かわいいグッズを購入したい...', expiry=2025-11-01T12:42:11.403084Z", "module": "agent", "function": "_build_intent_mandate_from_session", "line": 1824}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:18.082803Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=intent_complete_ask_shipping", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:18.088089Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=intent_complete_ask_shipping", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:33.098626Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:33.099885Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1761997291639_abefr\n  user_id: usr_ee3014bbc51f4156\n  user_input: {\"recipient\":\"k\",\"postal_code\":\"k\",\"city\":\"i\",\"region\":\"k\",\"address_line1\":\"i\",\"country\":\"i\"}\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1058}
ap2_shopping_agent         | INFO:     172.67.69.85:37631 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:33.105358Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761997291639_abefr, step=intent_complete_ask_shipping", "module": "agent", "function": "_get_or_create_session", "line": 1943}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:33.106157Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1761997291639_abefr)", "module": "agent", "function": "event_generator", "line": 1073}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:33.106341Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1761997291639_abefr", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1646}
ap2_shopping_agent         | [2025-11-01 11:42:33,128] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: intent_complete_ask_shipping
ap2_shopping_agent         |   user_input: {"recipient":"k","postal_code":"k","city":"i","region":"k","address_line1":"i","country":"i"}
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-01 11:42:33,451] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] DEBUG: user_input='{"recipient":"k","postal_code":"k","city":"i","region":"k","address_line1":"i","country":"i"}', session['step']='select_cp', is_digit=False
ap2_shopping_agent         | [2025-11-01 11:42:33,455] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] Resolved CP from DID: did=did:ap2:cp:demo_cp, name=AP2 Demo Credential Provider, url=http://credential_provider:8003
ap2_shopping_agent         | [2025-11-01 11:42:33,455] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] Resolved CP from DID: did=did:ap2:cp:demo_cp_2, name=AP2 Demo Credential Provider 2, url=http://credential_provider_2:8003
ap2_shopping_agent         | [2025-11-01 11:42:33,455] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] AP2 Step 4: Presenting 2 Credential Providers to user
ap2_shopping_agent         |   User ID: usr_ee3014bbc51f4156
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:34.671200Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=select_cp", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:34.678531Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=select_cp", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:35.502086Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:35.502440Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1761997291639_abefr\n  user_id: usr_ee3014bbc51f4156\n  user_input: 1\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1058}
ap2_shopping_agent         | INFO:     172.67.69.85:37631 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:35.506959Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761997291639_abefr, step=select_cp", "module": "agent", "function": "_get_or_create_session", "line": 1943}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:35.507485Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1761997291639_abefr)", "module": "agent", "function": "event_generator", "line": 1073}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:35.507558Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1761997291639_abefr", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1646}
ap2_shopping_agent         | [2025-11-01 11:42:35,513] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: select_cp
ap2_shopping_agent         |   user_input: 1
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-01 11:42:35,514] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] DEBUG: user_input='1', session['step']='select_cp', is_digit=True
ap2_shopping_agent         | [2025-11-01 11:42:35,514] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] Resolved CP from DID: did=did:ap2:cp:demo_cp, name=AP2 Demo Credential Provider, url=http://credential_provider:8003
ap2_shopping_agent         | [2025-11-01 11:42:35,514] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] Resolved CP from DID: did=did:ap2:cp:demo_cp_2, name=AP2 Demo Credential Provider 2, url=http://credential_provider_2:8003
ap2_shopping_agent         | [2025-11-01 11:42:35,515] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] AP2 Step 4: User selected Credential Provider
ap2_shopping_agent         |   User ID: usr_ee3014bbc51f4156
ap2_shopping_agent         |   CP ID: did:ap2:cp:demo_cp
ap2_shopping_agent         |   CP Name: AP2 Demo Credential Provider
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:35.721418Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Requesting payment methods from Credential Provider (http://credential_provider:8003) for user: usr_ee3014bbc51f4156", "module": "agent", "function": "_get_payment_methods_from_cp", "line": 2316}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:35.722846Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: GET http://credential_provider:8003/payment-methods", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:35.723255Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"GET\", \"url\": \"http://credential_provider:8003/payment-methods\", \"headers\": {}, \"body\": null}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_shopping_agent         | [2025-11-01 11:42:35,721] INFO in services.shopping_agent.langgraph_shopping_flow: [get_payment_methods_node] AP2 Step 6-7: Requesting payment methods from CP
ap2_shopping_agent         |   User ID: usr_ee3014bbc51f4156
ap2_shopping_agent         |   CP ID: did:ap2:cp:demo_cp
ap2_shopping_agent         |   CP URL: http://credential_provider:8003
ap2_credential_provider    | {"timestamp": "2025-11-01T11:42:35.962295Z", "level": "INFO", "logger": "provider", "message": "[get_payment_methods] Retrieved 1 payment methods for user: usr_ee3014bbc51f4156", "module": "provider", "function": "get_payment_methods", "line": 631}
ap2_credential_provider    | INFO:     172.18.0.6:35824 - "GET /payment-methods?user_id=usr_ee3014bbc51f4156 HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:35.967255Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (245.17ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:35.967489Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:42:35 GMT\", \"server\": \"uvicorn\", \"content-length\": \"252\", \"content-type\": \"application/json\"}, \"body\": {\"user_id\": \"usr_ee3014bbc51f4156\", \"payment_methods\": [{\"id\": \"pm_e6367cd7\", \"type\": \"basic-card\", \"display_name\": \"Visaカード (****1111)\", \"brand\": \"Visa\", \"last4\": \"1111\", \"requires_step_up\": false, \"billing_address\": {\"country\": \"JP\", \"postal_code\": \"111-1111\"}}]}, \"duration_ms\": 245.16773223876953}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:35.967544Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Retrieved 1 payment methods from Credential Provider", "module": "agent", "function": "_get_payment_methods_from_cp", "line": 2334}
ap2_shopping_agent         | [2025-11-01 11:42:35,967] INFO in services.shopping_agent.langgraph_shopping_flow: [get_payment_methods_node] AP2 Step 7: Received 1 payment methods from CP
ap2_shopping_agent         |   Payment Methods: ['pm_e6367cd7']
ap2_shopping_agent         | [2025-11-01 11:42:36,176] INFO in services.shopping_agent.langgraph_shopping_flow: [fetch_carts_node] AP2 Step 8-12: Fetching cart candidates from Merchant Agent
ap2_shopping_agent         | [2025-11-01 11:42:36,176] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Requesting cart candidates from Merchant Agent for IntentMandate: intent_4956d1e9
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:36.185927Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 1009}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:36.193565Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 797, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.IntentMandate\",\"id\":\"intent_4956d1e9\",\"payload\":{\"intent_mandate\":{\"created_at\":\"2025-11-01T11:42:11.403084Z\",\"id\":\"intent_4956d1e9\",\"intent_expiry\":\"2025-11-01T12:4", "module": "crypto", "function": "sign_a2a_message", "line": 1013}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:36.193959Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 808}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:36.226937Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: shopping_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:36.229691Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:merchant_agent: ap2.mandates.IntentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:36.229933Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.mandates.IntentMandate\", \"peer\": \"did:ap2:agent:merchant_agent\", \"headers\": {\"message_id\": \"598662a8-5912-49d1-bb52-1dbf8e2743ce\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-01T11:42:36.177985Z\", \"nonce\": \"3be7627de7fda0094cd3ec9d1ecd1770eac86f72269754c7f2987ad5a7facdc0\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"intent_mandate\": {\"id\": \"intent_4956d1e9\", \"type\": \"IntentMandate\", \"user_id\": \"usr_ee3014bbc51f4156\", \"user_cart_confirmation_required\": true, \"natural_language_description\": \"かわいいグッズを購入したい。5000円以内\", \"requires_refundability\": false, \"intent_expiry\": \"2025-11-01T12:42:11.403084Z\", \"created_at\": \"2025-11-01T11:42:11.403084Z\"}, \"shipping_address\": {\"recipient\": \"k\", \"postal_code\": \"k\", \"city\": \"i\", \"region\": \"k\", \"address_line1\": \"i\", \"country\": \"i\"}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_shopping_agent         | [2025-11-01 11:42:36,229] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Intent A2A message created: message_id=598662a8-5912-49d1-bb52-1dbf8e2743ce, intent_mandate_id=intent_4956d1e9
ap2_shopping_agent         | [2025-11-01 11:42:36,230] INFO in services.shopping_agent.utils.merchant_integration:
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [ShoppingAgent → MerchantAgent] A2Aメッセージ送信
ap2_shopping_agent         |   URL: http://merchant_agent:8001/a2a/message
ap2_shopping_agent         |   メッセージID: 598662a8-5912-49d1-bb52-1dbf8e2743ce
ap2_shopping_agent         |   タイプ: ap2.mandates.IntentMandate
ap2_shopping_agent         |   ペイロード: {
ap2_shopping_agent         |   "id": "intent_4956d1e9",
ap2_shopping_agent         |   "type": "IntentMandate",
ap2_shopping_agent         |   "user_id": "usr_ee3014bbc51f4156",
ap2_shopping_agent         |   "user_cart_confirmation_required": true,
ap2_shopping_agent         |   "natural_language_description": "かわいいグッズを購入したい。5000円以内",
ap2_shopping_agent         |   "requires_refundability": false,
ap2_shopping_agent         |   "intent_expiry": "2025-11-01T12:42:11.403084Z",
ap2_shopping_agent         |   "created_at": "2025-11-01T11:42:11.403084Z"
ap2_shopping_agent         | }
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:36.233064Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent:8001/a2a/message", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:42:36.233113Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent:8001/a2a/message\", \"headers\": {}, \"body\": {\"header\": {\"message_id\": \"598662a8-5912-49d1-bb52-1dbf8e2743ce\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-01T11:42:36.177985Z\", \"nonce\": \"3be7627de7fda0094cd3ec9d1ecd1770eac86f72269754c7f2987ad5a7facdc0\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"aMCMUarSscFWY8/j+NKdKflvyzdMjpZHJJqGXuKWsW/XqO0loXpUIfrFFTBzenXXPAajkw7IpQYMWtv4ytyNDg==\", \"publicKeyMultibase\": \"z6MkwMTmaSbsecH3zoTBSAEY2vuMxguAebRnruND2a8oVvcq\", \"kid\": \"did:ap2:agent:shopping_agent#key-2\", \"created\": \"2025-11-01T11:42:36.177985Z\", \"proofPurpose\": \"authentication\"}, \"signature\": null}, \"dataPart\": {\"@type\": \"ap2.mandates.IntentMandate\", \"id\": \"intent_4956d1e9\", \"payload\": {\"intent_mandate\": {\"id\": \"intent_4956d1e9\", \"type\": \"IntentMandate\", \"user_id\": \"usr_ee3014bbc51f4156\", \"user_cart_confirmation_required\": true, \"natural_language_description\": \"かわいいグッズを購入したい。5000円以内\", \"requires_refundability\": false, \"intent_expiry\": \"2025-11-01T12:42:11.403084Z\", \"created_at\": \"2025-11-01T11:42:11.403084Z\"}, \"shipping_address\": {\"recipient\": \"k\", \"postal_code\": \"k\", \"city\": \"i\", \"region\": \"k\", \"address_line1\": \"i\", \"country\": \"i\"}}, \"kind\": null, \"artifact\": null}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | [2025-11-01 11:42:36,396] INFO in v2.common.base_agent:
ap2_merchant_agent         | ================================================================================
ap2_merchant_agent         | [Merchant Agent] A2Aエンドポイント: POST /a2a/message
ap2_merchant_agent         |   受信メッセージ: ID=598662a8-5912-49d1-bb52-1dbf8e2743ce
ap2_merchant_agent         |   送信元: did:ap2:agent:shopping_agent
ap2_merchant_agent         |   タイプ: ap2.mandates.IntentMandate
ap2_merchant_agent         | ================================================================================
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.403464Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message received to/from did:ap2:agent:shopping_agent: ap2.mandates.IntentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.405818Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"received\", \"message_type\": \"ap2.mandates.IntentMandate\", \"peer\": \"did:ap2:agent:shopping_agent\", \"headers\": {\"message_id\": \"598662a8-5912-49d1-bb52-1dbf8e2743ce\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-01T11:42:36.177985Z\", \"nonce\": \"3be7627de7fda0094cd3ec9d1ecd1770eac86f72269754c7f2987ad5a7facdc0\", \"schema_version\": \"0.2\"}, \"payload\": {\"intent_mandate\": {\"id\": \"intent_4956d1e9\", \"type\": \"IntentMandate\", \"user_id\": \"usr_ee3014bbc51f4156\", \"user_cart_confirmation_required\": true, \"natural_language_description\": \"かわいいグッズを購入したい。5000円以内\", \"requires_refundability\": false, \"intent_expiry\": \"2025-11-01T12:42:11.403084Z\", \"created_at\": \"2025-11-01T11:42:11.403084Z\"}, \"shipping_address\": {\"recipient\": \"k\", \"postal_code\": \"k\", \"city\": \"i\", \"region\": \"k\", \"address_line1\": \"i\", \"country\": \"i\"}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.410065Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Nonce validation successful: nonce=3be7627de7fda009...", "module": "a2a_handler", "function": "verify_message_signature", "line": 156}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.477476Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Using DID-resolved public key for verification: kid=did:ap2:agent:shopping_agent#key-2", "module": "a2a_handler", "function": "verify_message_signature", "line": 192}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.490047Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying A2A message signature", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1037}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.503860Z", "level": "DEBUG", "logger": "common.crypto", "message": "[VERIFY] Canonical JSON length: 797, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.IntentMandate\",\"id\":\"intent_4956d1e9\",\"payload\":{\"intent_mandate\":{\"created_at\":\"2025-11-01T11:42:11.403084Z\",\"id\":\"intent_4956d1e9\",\"intent_expiry\":\"2025-11-01T12:4", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1041}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.503901Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying signature (algorithm: ED25519)", "module": "crypto", "function": "verify_signature", "line": 871}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.513250Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto VERIFY: ED25519 (key: did:ap2:agent:shopping_agent#key-2) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.513851Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] proof署名検証成功: sender=did:ap2:agent:shopping_agent, alg=ed25519, kid=did:ap2:agent:shopping_agent#key-2, public_key_source=DID-resolved", "module": "a2a_handler", "function": "verify_message_signature", "line": 223}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.514061Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2A処理] ハンドラー実行中: type=ap2.mandates.IntentMandate, from=did:ap2:agent:shopping_agent", "module": "a2a_handler", "function": "handle_message", "line": 305}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.515737Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Received IntentMandate", "module": "intent_handler", "function": "handle_intent_mandate", "line": 32}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.516284Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Received IntentMandate with shipping_address (AP2 v0.1 compliant)", "module": "intent_handler", "function": "handle_intent_mandate", "line": 50}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.516305Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Searching products with intent: 'かわいいグッズを購入したい。5000円以内'", "module": "intent_handler", "function": "handle_intent_mandate", "line": 54}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.516319Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Using provided shipping address: k", "module": "intent_handler", "function": "handle_intent_mandate", "line": 71}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.516348Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Using LangGraph AI engine for cart generation", "module": "intent_handler", "function": "handle_intent_mandate", "line": 76}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.533016Z", "level": "INFO", "logger": "langgraph_merchant", "message": "[Langfuse] Created new handler for session: dadaef36-438c-4a0f-bad0-206f3f872fbf", "module": "langgraph_merchant", "function": "create_cart_candidates", "line": 289}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.616482Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: initialize", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.616545Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"initialize\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\"}, \"arguments\": {\"protocolVersion\": \"2025-03-26\", \"clientInfo\": {\"name\": \"ap2_langgraph_client\", \"version\": \"1.0.0\"}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.618418Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.618640Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"initialize\", \"params\": {\"protocolVersion\": \"2025-03-26\", \"clientInfo\": {\"name\": \"ap2_langgraph_client\", \"version\": \"1.0.0\"}}, \"id\": 753701}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent_mcp     | INFO:     172.18.0.8:39086 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.968086Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (349.74ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.968369Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:42:36 GMT\", \"server\": \"uvicorn\", \"mcp-session-id\": \"e4efc5f5-a6f8-4dcc-9dda-205398232050\", \"content-length\": \"1145\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 753701, \"result\": {\"protocolVersion\": \"2025-03-26\", \"serverInfo\": {\"name\": \"merchant_agent_mcp\", \"version\": \"1.0.0\"}, \"capabilities\": {\"tools\": {\"search_products\": {\"description\": \"データベースから商品を検索\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"keywords\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"検索キーワードリスト\"}, \"limit\": {\"type\": \"integer\", \"description\": \"最大検索結果数\", \"default\": 20}}, \"required\": [\"keywords\"]}}, \"check_inventory\": {\"description\": \"在庫状況
を確認\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"product_ids\": {\"type\": \"array\", \"items\": {\"type\": \"integer\"}, \"description\": \"商品IDリスト\"}}, \"required\": [\"product_ids\"]}}, \"build_cart_mandates\": {\"description\": \"AP2準拠のCartMandateを構築（未署名）\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"cart_plan\": {\"type\": \"object\", \"description\": \"カートプラン（optimize_cartの結果）\"}, \"products\": {\"type\": \"array\", \"items\": {\"type\": \"object\"}, \"description\": \"商品情報リスト\"}, \"shipping_address\": {\"type\": \"object\", \"description\": \"AP2準拠のContactAddress\"}}, \"required\": [\"cart_plan\", \"products\"]}}}}}}, \"duration_ms\": 349.7447967529297}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.971137Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: initialize - SUCCESS (354.19ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.971375Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"initialize\", \"result\": {\"protocolVersion\": \"2025-03-26\", \"serverInfo\": {\"name\": \"merchant_agent_mcp\", \"version\": \"1.0.0\"}, \"capabilities\": {\"tools\": {\"search_products\": {\"description\": \"データベースから商品を検索\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"keywords\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"検索キーワードリスト\"}, \"limit\": {\"type\": \"integer\", \"description\": \"最大検索結果数\", \"default\": 20}}, \"required\": [\"keywords\"]}}, \"check_inventory\": {\"description\": \"在庫状況を確認\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"product_ids\": {\"type\": \"array\", \"items\": {\"type\": \"integer\"}, \"description\": \"商品IDリスト\"}}, \"required\": [\"product_ids\"]}}, \"build_cart_mandates\": {\"description\": \"AP2準拠のCartMandateを構築（未署名）\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"cart_plan\": {\"type\": \"object\", \"description\": \"カートプラン（optimize_cartの結果）\"}, \"products\": {\"type\": \"array\", \"items\": {\"type\": \"object\"}, \"description\": \"商品情報リスト\"}, \"shipping_address\": {\"type\": \"object\", \"description\": \"AP2準拠のContactAddress\"}}, \"required\": [\"cart_plan\", \"products\"]}}}}}, \"error\": null, \"duration_ms\": 354.19273376464844}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.971426Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Initialized session: e4efc5f5-a6f8-4dcc-9dda-205398232050", "module": "mcp_client", "function": "initialize", "line": 88}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.971820Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Server capabilities: {'tools': {'search_products': {'description': 'データベースから商品を検索', 'inputSchema': {'type': 'object', 'properties': {'keywords': {'type': 'array', 'items': {'type': 'string'}, 'description': '検索キーワードリス
ト'}, 'limit': {'type': 'integer', 'description': '最大検索結果数', 'default': 20}}, 'required': ['keywords']}}, 'check_inventory': {'description': '在庫状況を確認', 'inputSchema': {'type': 'object', 'properties': {'product_ids': {'type': 'array', 'items': {'type': 'integer'}, 'description': '商品IDリスト'}}, 'required': ['product_ids']}}, 'build_cart_mandates': {'description': 'AP2準拠のCartMandateを構築（未署名）', 'inputSchema': {'type': 'object', 'properties': {'cart_plan': {'type': 'object', 'description': 'カートプラン（optimize_cartの結果）'}, 'products': {'type': 'array', 'items': {'type': 'object'}, 'description': '商品情報リスト'}, 'shipping_address': {'type': 'object', 'description': 'AP2準拠のContactAddress'}}, 'required': ['cart_plan', 'products']}}}}", "module": "mcp_client", "function": "initialize", "line": 89}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:42:36.971884Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.intent_node", "message": "[analyze_intent] MCP client initialized", "module": "intent_node", "function": "analyze_intent", "line": 35}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.177678Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.intent_node", "message": "[analyze_intent] LLM result: {'primary_need': 'かわいいグッズを5000円以内で購入したい', 'budget_strategy': 'low', 'key_factors': ['かわいさ', '価格'], 'search_keywords': ['かわいい', 'グッズ', '5000円']}", "module": "intent_node", "function": "analyze_intent", "line": 124}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.189241Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.189333Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"e4efc5f5-a6f8-4dcc-9dda-205398232050\"}, \"arguments\": {\"name\": \"search_products\", \"arguments\": {\"keywords\": [\"かわいい\", \"グッズ\", \"5000円\"], \"limit\": 20}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.189660Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.189714Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"e4efc5f5-a6f8-4dcc-9dda-205398232050\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"search_products\", \"arguments\": {\"keywords\": [\"かわいい\", \"グッズ\", \"5000円\"], \"limit\": 20}}, \"id\": 960499}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent_mcp     | {"timestamp": "2025-11-01T11:43:23.217997Z", "level": "INFO", "logger": "main", "message": "[search_products] Searching with query: 'かわいい グッズ 5000円'", "module": "main", "function": "search_products", "line": 123}
ap2_meilisearch            | 2025-11-01T11:43:23.627222Z  INFO HTTP request{method=POST host="meilisearch:7700" route=/indexes/products/search query_parameters= user_agent=python-httpx/0.28.1 status_code=200}: meilisearch: close time.busy=34.0ms time.idle=46.4ms
ap2_merchant_agent_mcp     | {"timestamp": "2025-11-01T11:43:23.636965Z", "level": "INFO", "logger": "common.search_engine", "message": "[MeilisearchClient] Search 'かわいい グッズ 5000円' returned 6 products", "module": "search_engine", "function": "search", "line": 187}
ap2_merchant_agent_mcp     | {"timestamp": "2025-11-01T11:43:23.725650Z", "level": "INFO", "logger": "main", "message": "[search_products] Returned 6 products for keywords: ['かわいい', 'グッズ', '5000円']", "module": "main", "function": "search_products", "line": 148}
ap2_merchant_agent_mcp     | INFO:     172.18.0.8:51580 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.727832Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (538.15ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.727910Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:43:22 GMT\", \"server\": \"uvicorn\", \"content-length\": \"3086\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 960499, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"products\\\": [\\n    {\\n      \\\"id\\\": \\\"3446cca8-fe68-4354-a518-63eb3e47d27f\\\",\\n      \\\"sku\\\": \\\"MUGI-KEYCHAIN-001\\\",\\n      \\\"name\\\": \\\"むぎぼーアクリルキーホルダー\\\",\\n      \\\"description\\\": \\\"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\\\",\\n      \\\"price_cents\\\": 80000,\\n      \\\"price_jpy\\\": 800.0,\\n      \\\"inventory_count\\\": 100,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\\\",\\n      \\\"sku\\\": \\\"MUGI-CLOCK-001\\\",\\n      \\\"name\\\": \\\"むぎぼー時計\\\",\\n      \\\"description\\\": \\\"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\\\",\\n      \\\"price_cents\\\": 350000,\\n      \\\"price_jpy\\\": 3500.0,\\n      \\\"inventory_count\\\": 30,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"cf08568b-8115-461c-aa7e-5a2e07bf4476\\\",\\n      \\\"sku\\\": \\\"MUGI-POUCH-001\\\",\\n      \\\"name\\\": \\\"むぎぼーポーチ\\\",\\n      \\\"description\\\": \\\"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\\\",\\n      \\\"price_cents\\\": 95000,\\n      \\\"price_jpy\\\": 950.0,\\n      \\\"inventory_count\\\": 120,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"e534386f-c89b-4548-9734-78bd34958f88\\\",\\n      \\\"sku\\\": \\\"MUGI-MUG-001\\\",\\n      \\\"name\\\": \\\"むぎぼーマグカップ\\\",\\n      \\\"description\\\": \\\"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\\\",\\n      \\\"price_cents\\\": 120000,\\n      \\\"price_jpy\\\": 1200.0,\\n      \\\"inventory_count\\\": 80,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"eb0e5de8-679d-4445-8e64-a1d4d40097fd\\\",\\n      \\\"sku\\\": \\\"MUGI-SOCKS-001\\\",\\n      \\\"name\\\": \\\"むぎぼー靴下\\\",\\n      \\\"description\\\": \\\"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\\\",\\n      \\\"price_cents\\\": 85000,\\n      \\\"price_jpy\\\": 850.0,\\n      \\\"inventory_count\\\": 100,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"f0f41c9f-a31d-4a88-a180-96149a9057fc\\\",\\n      \\\"sku\\\": \\\"MUGI-PLATE-001\\\",\\n      \\\"name\\\": \\\"むぎぼープレート皿\\\",\\n      \\\"description\\\": \\\"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\\\",\\n      \\\"price_cents\\\": 190000,\\n      \\\"price_jpy\\\": 1900.0,\\n      \\\"inventory_count\\\": 70,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    }\\n  ]\\n}\"}], \"isError\": false}}, \"duration_ms\": 538.1505489349365}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.728172Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (538.77ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.728218Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"products\\\": [\\n    {\\n      \\\"id\\\": \\\"3446cca8-fe68-4354-a518-63eb3e47d27f\\\",\\n      \\\"sku\\\": \\\"MUGI-KEYCHAIN-001\\\",\\n      \\\"name\\\": \\\"むぎぼーアクリルキーホルダー\\\",\\n      \\\"description\\\": \\\"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\\\",\\n      \\\"price_cents\\\": 80000,\\n      \\\"price_jpy\\\": 800.0,\\n      \\\"inventory_count\\\": 100,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\\\",\\n      \\\"sku\\\": \\\"MUGI-CLOCK-001\\\",\\n      \\\"name\\\": \\\"むぎぼー時計\\\",\\n      \\\"description\\\": \\\"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\\\",\\n      \\\"price_cents\\\": 350000,\\n      \\\"price_jpy\\\": 3500.0,\\n      \\\"inventory_count\\\": 30,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"cf08568b-8115-461c-aa7e-5a2e07bf4476\\\",\\n      \\\"sku\\\": \\\"MUGI-POUCH-001\\\",\\n      \\\"name\\\": \\\"むぎぼーポーチ\\\",\\n      \\\"description\\\": \\\"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\\\",\\n      \\\"price_cents\\\": 95000,\\n      \\\"price_jpy\\\": 950.0,\\n      \\\"inventory_count\\\": 120,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"e534386f-c89b-4548-9734-78bd34958f88\\\",\\n      \\\"sku\\\": \\\"MUGI-MUG-001\\\",\\n      \\\"name\\\": \\\"むぎぼーマグカップ\\\",\\n      \\\"description\\\": \\\"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\\\",\\n      \\\"price_cents\\\": 120000,\\n      \\\"price_jpy\\\": 1200.0,\\n      \\\"inventory_count\\\": 80,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"eb0e5de8-679d-4445-8e64-a1d4d40097fd\\\",\\n      \\\"sku\\\": \\\"MUGI-SOCKS-001\\\",\\n      \\\"name\\\": \\\"むぎぼー靴下\\\",\\n      \\\"description\\\": \\\"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\\\",\\n      \\\"price_cents\\\": 85000,\\n      \\\"price_jpy\\\": 850.0,\\n      \\\"inventory_count\\\": 100,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"f0f41c9f-a31d-4a88-a180-96149a9057fc\\\",\\n      \\\"sku\\\": \\\"MUGI-PLATE-001\\\",\\n      \\\"name\\\": \\\"むぎぼープレート
皿\\\",\\n      \\\"description\\\": \\\"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\\\",\\n      \\\"price_cents\\\": 190000,\\n      \\\"price_jpy\\\": 1900.0,\\n      \\\"inventory_count\\\": 70,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    }\\n  ]\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 538.773775100708}", "module": "logger", "function": "log_mcp_response", "line": 328}


ap2_merchant_agent_mcp     | {"timestamp": "2025-11-01T11:43:23.734692Z", "level": "INFO", "logger": "main", "message": "[check_inventory] Inventory: {'3446cca8-fe68-4354-a518-63eb3e47d27f': 100, '1530a7db-6b7a-458e-b7b9-f510f6fdaa89': 30, 'cf08568b-8115-461c-aa7e-5a2e07bf4476': 120, 'e534386f-c89b-4548-9734-78bd34958f88': 80, 'eb0e5de8-679d-4445-8e64-a1d4d40097fd': 100, 'f0f41c9f-a31d-4a88-a180-96149a9057fc': 70}", "module": "main", "function": "check_inventory", "line": 202}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.728301Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Tool search_products executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}


ap2_merchant_agent_mcp     | INFO:     172.18.0.8:51580 - "POST / HTTP/1.1" 200 OK

ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.728380Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.search_node", "message": "[search_products] MCP returned 6 products", "module": "search_node", "function": "search_products", "line": 69}


ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.730474Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.730504Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"e4efc5f5-a6f8-4dcc-9dda-205398232050\"}, \"arguments\": {\"name\": \"check_inventory\", \"arguments\": {\"product_ids\": [\"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"e534386f-c89b-4548-9734-78bd34958f88\", \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"f0f41c9f-a31d-4a88-a180-96149a9057fc\"]}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.730596Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.730622Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"e4efc5f5-a6f8-4dcc-9dda-205398232050\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"check_inventory\", \"arguments\": {\"product_ids\": [\"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"e534386f-c89b-4548-9734-78bd34958f88\", \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"f0f41c9f-a31d-4a88-a180-96149a9057fc\"]}}, \"id\": 639747}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.735499Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (4.88ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.735545Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:43:22 GMT\", \"server\": \"uvicorn\", \"content-length\": \"431\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 639747, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"inventory\\\": {\\n    \\\"3446cca8-fe68-4354-a518-63eb3e47d27f\\\": 100,\\n    \\\"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\\\": 30,\\n    \\\"cf08568b-8115-461c-aa7e-5a2e07bf4476\\\": 120,\\n    \\\"e534386f-c89b-4548-9734-78bd34958f88\\\": 80,\\n    \\\"eb0e5de8-679d-4445-8e64-a1d4d40097fd\\\": 100,\\n    \\\"f0f41c9f-a31d-4a88-a180-96149a9057fc\\\": 70\\n  }\\n}\"}], \"isError\": false}}, \"duration_ms\": 4.879474639892578}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.735711Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (5.17ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.735772Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"inventory\\\": {\\n    \\\"3446cca8-fe68-4354-a518-63eb3e47d27f\\\": 100,\\n    \\\"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\\\": 30,\\n    \\\"cf08568b-8115-461c-aa7e-5a2e07bf4476\\\": 120,\\n    \\\"e534386f-c89b-4548-9734-78bd34958f88\\\": 80,\\n    \\\"eb0e5de8-679d-4445-8e64-a1d4d40097fd\\\": 100,\\n    \\\"f0f41c9f-a31d-4a88-a180-96149a9057fc\\\": 70\\n  }\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 5.169868469238281}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.735825Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Tool check_inventory executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:43:23.736060Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.inventory_node", "message": "[check_inventory] MCP checked 6 products", "module": "inventory_node", "function": "check_inventory", "line": 62}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.325216Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.optimization_node", "message": "[optimize_cart] LLM generated 3 cart plans", "module": "optimization_node", "function": "optimize_cart", "line": 173}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.335524Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Creating 3 unsigned CartMandates...", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 66}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.336035Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.336143Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"e4efc5f5-a6f8-4dcc-9dda-205398232050\"}, \"arguments\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"コスパ最強プラン (4,700円)\", \"description\": \"かわいい時計とマグカップを組み合わせた予算内で最適なプラン。高品質なアイテムを2点で実現。\", \"items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"quantity\": 1}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"quantity\": 1}]}, \"products\": [{\"id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"むぎぼーポーチ\", \"description\": \"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"sku\": \"MUGI-MUG-001\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。
毎日のティータイムが楽しくなります。\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.336495Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.336560Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"e4efc5f5-a6f8-4dcc-9dda-205398232050\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"コスパ最強プラン (4,700円)\", \"description\": \"かわいい時計とマグカップを組み合わせた予算内で最適なプラン。高品質なアイテムを2点で実現。\", \"items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"quantity\": 1}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"quantity\": 1}]}, \"products\": [{\"id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチ
に付けて持ち歩けます。\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"むぎぼーポーチ\", \"description\": \"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"sku\": \"MUGI-MUG-001\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼー
がプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}, \"id\": 418432}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent_mcp     | INFO:     172.18.0.8:33722 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.385645Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (48.67ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.385749Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:45:48 GMT\", \"server\": \"uvicorn\", \"content-length\": \"3334\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 418432, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_432d01fc\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_432d01fc\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"むぎぼー時計\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 3500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"むぎぼーマグカップ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 1200.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"消費税（10%）\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 470.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"送料\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"合計\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 5670.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-01T12:45:48.380344Z\\\",\\n      \\\"merchant_name\\\": \\\"むぎぼーショップ\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-01T11:45:48.380776Z\\\",\\n      \\\"cart_name\\\": \\\"コスパ最強プラン (4,700円)\\\",\\n      \\\"cart_description\\\": \\\"かわいい時計とマグカップを組み合わせた予算内で最適なプラン。高品質なアイテムを2点で実現。\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\\\",\\n          \\\"name\\\": \\\"むぎぼー時計\\\",\\n          \\\"description\\\": \\\"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n        \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"e534386f-c89b-4548-9734-78bd34958f88\\\",\\n          \\\"name\\\": \\\"むぎぼーマグカップ\\\",\\n          \\\"description\\\": \\\"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}}, \"duration_ms\": 48.67243766784668}", "module": "logger", "function": "log_http_response", "line":226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.386168Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (49.90ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.386219Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_432d01fc\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_432d01fc\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"むぎぼー時計\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 3500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"むぎぼーマグカップ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 1200.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"消費税（10%）\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 470.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"送料\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"合計\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 5670.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-01T12:45:48.380344Z\\\",\\n      \\\"merchant_name\\\": \\\"むぎぼーショップ\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-01T11:45:48.380776Z\\\",\\n      \\\"cart_name\\\": \\\"コスパ最強プラン (4,700円)\\\",\\n      \\\"cart_description\\\": \\\"かわいい時計とマグカップを組み合わせた予算内で最適なプラン。高品質なアイテムを2点で実現。\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\\\",\\n          \\\"name\\\": \\\"むぎぼー時計\\\",\\n          \\\"description\\\": \\\"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"e534386f-c89b-4548-9734-78bd34958f88\\\",\\n          \\\"name\\\": \\\"むぎぼーマグカップ\\\",\\n          \\\"description\\\": \\\"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 49.90053176879883}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.386339Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Tool build_cart_mandates executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.386386Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Created unsigned CartMandate: cart_432d01fc, plan=コスパ最強プラン (4,700円)", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 94}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.386738Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.386869Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"e4efc5f5-a6f8-4dcc-9dda-205398232050\"}, \"arguments\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"高品質プラン (5,400円)\", \"description\": \"時計とプレート皿を組み合わせた高品質なプラン。予算を少し超えるが、かわいさと機能性を両立。\", \"items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"quantity\": 1}, {\"product_id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"quantity\": 1}]}, \"products\": [{\"id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"むぎぼーポーチ\", \"description\": \"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"sku\": \"MUGI-MUG-001\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。毎
日のティータイムが楽しくなります。\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.387024Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.387075Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"e4efc5f5-a6f8-4dcc-9dda-205398232050\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"高品質プラン (5,400円)\", \"description\": \"時計とプレート皿を組み合わせた高品質なプラン。予算を少し超えるが、かわいさと機能性を両立。\", \"items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"quantity\": 1}, {\"product_id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"quantity\": 1}]}, \"products\": [{\"id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに
付けて持ち歩けます。\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"むぎぼーポーチ\", \"description\": \"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"sku\": \"MUGI-MUG-001\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーが
プリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}, \"id\": 173527}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.393064Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (5.96ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.393146Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:45:48 GMT\", \"server\": \"uvicorn\", \"content-length\": \"3071\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 173527, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_738bc269\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_738bc269\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"むぎぼー時計\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 3500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"むぎぼープレート皿\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 1900.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"消費税（10%）\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 540.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"合計\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 5940.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-01T12:45:48.391175Z\\\",\\n      \\\"merchant_name\\\": \\\"むぎぼーショップ\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-01T11:45:48.391197Z\\\",\\n      \\\"cart_name\\\": \\\"高品質プラン (5,400円)\\\",\\n      \\\"cart_description\\\": \\\"時計とプレート皿を組み合わせた高品質なプラン。予算を少し超えるが、かわいさと機能性を両立。\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\\\",\\n          \\\"name\\\": \\\"むぎぼー時計\\\",\\n          \\\"description\\\": \\\"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n     },\\n        {\\n          \\\"product_id\\\": \\\"f0f41c9f-a31d-4a88-a180-96149a9057fc\\\",\\n          \\\"name\\\": \\\"むぎぼープレート皿\\\",\\n          \\\"description\\\": \\\"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 1900.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 1900.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}}, \"duration_ms\": 5.955696105957031}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.393451Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (6.52ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.393493Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_738bc269\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_738bc269\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"むぎぼー時計\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 3500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"むぎぼープレート皿\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 1900.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"消費税（10%）\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 540.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"合計\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 5940.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-01T12:45:48.391175Z\\\",\\n      \\\"merchant_name\\\": \\\"むぎぼーショップ\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-01T11:45:48.391197Z\\\",\\n      \\\"cart_name\\\": \\\"高品質プラン (5,400円)\\\",\\n      \\\"cart_description\\\": \\\"時計とプレート皿を組み合わせた高品質なプラン。予算を少し超えるが、かわいさと機能性を両立。\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\\\",\\n          \\\"name\\\": \\\"むぎぼー時計\\\",\\n          \\\"description\\\": \\\"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"f0f41c9f-a31d-4a88-a180-96149a9057fc\\\",\\n          \\\"name\\\": \\\"むぎぼープレート皿\\\",\\n          \\\"description\\\": \\\"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 1900.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 1900.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 6.516218185424805}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.393544Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Tool build_cart_mandates executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.393563Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Created unsigned CartMandate: cart_738bc269, plan=高品質プラン (5,400円)", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 94}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.393919Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.393968Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"e4efc5f5-a6f8-4dcc-9dda-205398232050\"}, \"arguments\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"シンプルプラン (2,000円)\", \"description\": \"かわいいキーホルダーとマグカップの2点セット。予算内でシンプルで実用的な選択肢。\", \"items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"quantity\": 1}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"quantity\": 1}]}, \"products\": [{\"id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"むぎぼーポーチ\", \"description\": \"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"sku\": \"MUGI-MUG-001\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。毎日のティー
タイムが楽しくなります。\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent_mcp     | INFO:     172.18.0.8:33722 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.394095Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}


ap2_merchant_agent_mcp     | INFO:     172.18.0.8:33722 - "POST / HTTP/1.1" 200 OK

ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.394163Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"e4efc5f5-a6f8-4dcc-9dda-205398232050\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"シンプルプラン (2,000円)\", \"description\": \"かわいいキーホルダーとマグカップの2点セット。予算内でシンプルで実用的な選択肢。\", \"items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"quantity\": 1}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"quantity\": 1}]}, \"products\": [{\"id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち
歩けます。\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"むぎぼーポーチ\", \"description\": \"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"sku\": \"MUGI-MUG-001\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントさ
れたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}, \"id\": 879775}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.397371Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (3.22ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.397431Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:45:48 GMT\", \"server\": \"uvicorn\", \"content-length\": \"3382\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 879775, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_e9218338\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_e9218338\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"むぎぼーアクリルキーホルダー\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 800.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n     \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"むぎぼーマグカップ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 1200.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"消費税（10%）\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 200.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"送料\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"合計\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 2700.0,\\n    \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-01T12:45:48.395730Z\\\",\\n      \\\"merchant_name\\\": \\\"むぎぼーショップ\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-01T11:45:48.395754Z\\\",\\n      \\\"cart_name\\\": \\\"シンプルプラン (2,000円)\\\",\\n      \\\"cart_description\\\": \\\"かわいいキーホルダーとマグカップの2点セット。予算内でシンプルで実用的な選択肢。\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"3446cca8-fe68-4354-a518-63eb3e47d27f\\\",\\n          \\\"name\\\": \\\"むぎぼーアクリルキーホルダー\\\",\\n          \\\"description\\\": \\\"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\\\",\\n          \\\"quantity\\\": 1,\\n      \\\"unit_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"e534386f-c89b-4548-9734-78bd34958f88\\\",\\n          \\\"name\\\": \\\"むぎぼーマグカップ\\\",\\n          \\\"description\\\": \\\"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}}, \"duration_ms\": 3.215312957763672}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.397658Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (3.64ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.397695Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_e9218338\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_e9218338\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"むぎぼーアクリルキーホルダー\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 800.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"むぎぼーマグカップ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 1200.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"消費税（10%）\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 200.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"送料\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"合計\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 2700.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-01T12:45:48.395730Z\\\",\\n      \\\"merchant_name\\\": \\\"むぎぼーショップ\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-01T11:45:48.395754Z\\\",\\n      \\\"cart_name\\\": \\\"シンプルプラン (2,000円)\\\",\\n      \\\"cart_description\\\": \\\"かわいいキーホルダーとマグカップの2点セット。予算内でシンプルで実用的な選択肢。\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"3446cca8-fe68-4354-a518-63eb3e47d27f\\\",\\n          \\\"name\\\": \\\"むぎぼーアクリルキーホルダー\\\",\\n          \\\"description\\\": \\\"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"e534386f-c89b-4548-9734-78bd34958f88\\\",\\n          \\\"name\\\": \\\"むぎぼーマグカップ\\\",\\n          \\\"description\\\": \\\"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 3.643035888671875}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.397760Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Tool build_cart_mandates executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.397778Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Created unsigned CartMandate: cart_e9218338, plan=シンプルプラン (2,000円)", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 94}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.397792Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Created 3 unsigned CartMandates, sending to Merchant for signature...", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 116}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.397815Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Processing 3 CartMandates in parallel...", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 330}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.398557Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant:8002/sign/cart", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.398643Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant:8002/sign/cart\", \"headers\": {}, \"body\": {\"cart_mandate\": {\"contents\": {\"id\": \"cart_432d01fc\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_432d01fc\", \"display_items\": [{\"label\": \"むぎぼー時計\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼーマグカップ\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 470.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 5670.0, \"currency\": \"JPY\"}}}, \"shipping_address\":null}, \"cart_expiry\": \"2025-11-01T12:45:48.380344Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": null, \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.380776Z\", \"cart_name\": \"コスパ最強プラン (4,700円)\", \"cart_description\": \"かわいい時計とマグカップを組み合わせた予算内で最適なプラン。高品質なアイテムを2点で実現。\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.399126Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant:8002/sign/cart", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.399199Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant:8002/sign/cart\", \"headers\": {}, \"body\": {\"cart_mandate\": {\"contents\": {\"id\": \"cart_738bc269\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_738bc269\", \"display_items\": [{\"label\": \"むぎぼー時計\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼープレート皿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 540.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.391175Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": null, \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.391197Z\", \"cart_name\": \"高品質プラン (5,400円)\", \"cart_description\": \"時計とプレート皿を組み合わせた高品質なプラン。予算を少し超えるが、かわいさと機能性を両立。\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.399719Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant:8002/sign/cart", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.399776Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant:8002/sign/cart\", \"headers\": {}, \"body\": {\"cart_mandate\": {\"contents\": {\"id\": \"cart_e9218338\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_e9218338\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼーマグカップ\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 200.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2700.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.395730Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": null, \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.395754Z\", \"cart_name\": \"シンプルプラン (2,000円)\", \"cart_description\": \"かわいいキーホルダーとマグカップの2点セット。予算内でシンプルで実用的な選択肢。\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"quantity\":1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant               | [2025-11-01 11:45:48,622] INFO in services.merchant.utils.validation_helpers: [Merchant] CartMandate validation passed: cart_738bc269
ap2_merchant               | [2025-11-01 11:45:48,636] INFO in services.merchant.utils.validation_helpers: [Merchant] CartMandate validation passed: cart_432d01fc
ap2_merchant               | [2025-11-01 11:45:48,636] INFO in services.merchant.utils.validation_helpers: [Merchant] CartMandate validation passed: cart_e9218338
ap2_merchant               | [2025-11-01 11:45:48,637] INFO in services.merchant.utils.inventory_helpers: [Merchant] Inventory check passed for CartMandate: cart_738bc269
ap2_merchant               | {"timestamp": "2025-11-01T11:45:48.693706Z", "level": "INFO", "logger": "service", "message": "[_generate_merchant_authorization_jwt] Generated signed JWT for CartMandate: cart_id=None, alg=ES256, merchant_id=did:ap2:merchant:mugibo_merchant", "module": "service", "function": "_generate_merchant_authorization_jwt", "line": 812}
ap2_merchant               | [2025-11-01 11:45:48,739] INFO in services.merchant.utils.inventory_helpers: [Merchant] Inventory check passed for CartMandate: cart_432d01fc
ap2_merchant               | {"timestamp": "2025-11-01T11:45:48.740610Z", "level": "INFO", "logger": "service", "message": "[_generate_merchant_authorization_jwt] Generated signed JWT for CartMandate: cart_id=None, alg=ES256, merchant_id=did:ap2:merchant:mugibo_merchant", "module": "service", "function": "_generate_merchant_authorization_jwt", "line": 812}
ap2_merchant               | [2025-11-01 11:45:48,742] INFO in services.merchant.utils.inventory_helpers: [Merchant] Inventory check passed for CartMandate: cart_e9218338
ap2_merchant               | {"timestamp": "2025-11-01T11:45:48.743181Z", "level": "INFO", "logger": "service", "message": "[_generate_merchant_authorization_jwt] Generated signed JWT for CartMandate: cart_id=None, alg=ES256, merchant_id=did:ap2:merchant:mugibo_merchant", "module": "service", "function": "_generate_merchant_authorization_jwt", "line": 812}
ap2_merchant               | {"timestamp": "2025-11-01T11:45:48.766522Z", "level": "INFO", "logger": "service", "message": "[Merchant] Created new CartMandate: cart_738bc269", "module": "service", "function": "sign_cart_mandate", "line": 218}
ap2_merchant               | {"timestamp": "2025-11-01T11:45:48.767054Z", "level": "INFO", "logger": "service", "message": "[Merchant] Auto-signed CartMandate: cart_738bc269 (with merchant_authorization JWT)", "module": "service", "function": "sign_cart_mandate", "line": 220}
ap2_merchant               | INFO:     172.18.0.8:51092 - "POST /sign/cart HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.773578Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (374.38ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.773708Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:45:47 GMT\", \"server\": \"uvicorn\", \"content-length\": \"2826\", \"content-type\": \"application/json\"}, \"body\": {\"signed_cart_mandate\": {\"contents\": {\"id\": \"cart_738bc269\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_738bc269\", \"display_items\": [{\"label\": \"むぎぼー時計\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼープレート皿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 540.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.391175Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiYmMwYzIwM2UzNGQ3YTE5M2RlYmYwN2YyMTU0NTI2YjJkMzE3OTlkODJkM2Y2MDg4ZmIxNzFmZDg4M2ZiZWM3ZSIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjUwYmEzNDQ3LTg1NTUtNDRkYy1iNDRhLTFjNzZjZjc1OWFkMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9FUmfbwMHe7ddS6NGOHkfPIct9tz4g9JL5W9gzzpjXUz2T84ykCYvwp3i_h4QAv614EHc6f7PPSZ4SBVQzWfhw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.391197Z\", \"cart_name\": \"高品質プラン (5,400円)\", \"cart_description\": \"時計とプレート皿を組み合わせた高品質なプラン。予算を少し超えるが、かわいさと機能性を両立。\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiYmMwYzIwM2UzNGQ3YTE5M2RlYmYwN2YyMTU0NTI2YjJkMzE3OTlkODJkM2Y2MDg4ZmIxNzFmZDg4M2ZiZWM3ZSIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjUwYmEzNDQ3LTg1NTUtNDRkYy1iNDRhLTFjNzZjZjc1OWFkMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9FUmfbwMHe7ddS6NGOHkfPIct9tz4g9JL5W9gzzpjXUz2T84ykCYvwp3i_h4QAv614EHc6f7PPSZ4SBVQzWfhw\"}, \"duration_ms\": 374.38440322875977}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.774090Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] CartMandate auto-signed: cart_738bc269, plan=高品質プラン (5,400円)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 173}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.774147Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Built signed CartMandate for plan: 高品質プラン (5,400円)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 306}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.778224Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (378.44ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.778318Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:45:47 GMT\", \"server\": \"uvicorn\", \"content-length\": \"2990\", \"content-type\": \"application/json\"}, \"body\": {\"signed_cart_mandate\": {\"contents\": {\"id\": \"cart_e9218338\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_e9218338\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼーマグカップ\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 200.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2700.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.395730Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMGUzMmMyYzZlYjQ4MjU5ZGI4OTMwYjJlMDE0NTU1ZTU3ODI4ZDFlMmVlNmUxZmM0MDE1ZjBmYmJlZTY1MzAzZSIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjZkYmQ4MWRiLWU3Y2ItNDIzMi05NDU2LWU0NDk3YTE0NGY1YSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.-S3BCOQWzLfG7qzJ3ATYm2_LSxAa7uzNLwC83FkcRhDO1fz2IrO7MPSmQtGSw3qPlrZpfusiiYBSN1l45Awu-A\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.395754Z\", \"cart_name\": \"シンプルプラン (2,000円)\", \"cart_description\": \"か
わいいキーホルダーとマグカップの2点セット。予算内でシンプルで実用的な選択肢。\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMGUzMmMyYzZlYjQ4MjU5ZGI4OTMwYjJlMDE0NTU1ZTU3ODI4ZDFlMmVlNmUxZmM0MDE1ZjBmYmJlZTY1MzAzZSIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjZkYmQ4MWRiLWU3Y2ItNDIzMi05NDU2LWU0NDk3YTE0NGY1YSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.-S3BCOQWzLfG7qzJ3ATYm2_LSxAa7uzNLwC83FkcRhDO1fz2IrO7MPSmQtGSw3qPlrZpfusiiYBSN1l45Awu-A\"}, \"duration_ms\": 378.43894958496094}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.778569Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] CartMandate auto-signed: cart_e9218338, plan=シンプルプラン (2,000円)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 173}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.778603Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Built signed CartMandate for plan: シンプルプラン (2,000円)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 306}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.780899Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (382.30ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.781036Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:45:47 GMT\", \"server\": \"uvicorn\", \"content-length\": \"2942\", \"content-type\": \"application/json\"}, \"body\": {\"signed_cart_mandate\": {\"contents\": {\"id\": \"cart_432d01fc\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_432d01fc\", \"display_items\": [{\"label\": \"むぎぼー時計\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼーマグカップ\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 470.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\":{\"label\": \"合計\", \"amount\": {\"value\": 5670.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.380344Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNTg2YzM2N2I0NGVjMGE0ZDQ1ZWI2ZGRkZDk5OGRlZjcxNTI1NTE2ODdhYjNhOGY3Y2RhNmZkZDQ2MTI4YTQxYiIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjU1NWY2OWIzLWY3YWQtNGU5ZS1iYTVlLTMwNzA1YTViNDg0MyIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.863Ktyr2xFUoJHUngERKhCV8FLlyLP-C9hHU-xZAFmL0PFKaE4ssnEU3rdveqbVL1rODSFq40oqI2hhQykBmYg\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.380776Z\", \"cart_name\": \"コスパ最強プラン (4,700円)\", \"cart_description\": \"かわいい時計とマ
グカップを組み合わせた予算内で最適なプラン。高品質なアイテムを2点で実現。\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNTg2YzM2N2I0NGVjMGE0ZDQ1ZWI2ZGRkZDk5OGRlZjcxNTI1NTE2ODdhYjNhOGY3Y2RhNmZkZDQ2MTI4YTQxYiIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjU1NWY2OWIzLWY3YWQtNGU5ZS1iYTVlLTMwNzA1YTViNDg0MyIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.863Ktyr2xFUoJHUngERKhCV8FLlyLP-C9hHU-xZAFmL0PFKaE4ssnEU3rdveqbVL1rODSFq40oqI2hhQykBmYg\"}, \"duration_ms\": 382.29823112487793}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.781340Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] CartMandate auto-signed: cart_432d01fc, plan=コスパ最強プラン (4,700円)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 173}
ap2_merchant               | {"timestamp": "2025-11-01T11:45:48.776765Z", "level": "INFO", "logger": "service", "message": "[Merchant] Created new CartMandate: cart_e9218338", "module": "service", "function": "sign_cart_mandate", "line": 218}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.781956Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Built signed CartMandate for plan: コスパ最強プラン (4,700円)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 306}
ap2_merchant               | {"timestamp": "2025-11-01T11:45:48.777015Z", "level": "INFO", "logger": "service", "message": "[Merchant] Auto-signed CartMandate: cart_e9218338 (with merchant_authorization JWT)", "module": "service", "function": "sign_cart_mandate", "line": 220}



ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.782341Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Parallel processing complete: 3 signed, 0 pending, 0 timeout, 0 rejected", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 353}


ap2_merchant               | INFO:     172.18.0.8:51116 - "POST /sign/cart HTTP/1.1" 200 OK
ap2_merchant               | {"timestamp": "2025-11-01T11:45:48.779860Z", "level": "INFO", "logger": "service", "message": "[Merchant] Created new CartMandate: cart_432d01fc", "module": "service", "function": "sign_cart_mandate", "line": 218}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.782367Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Built 3 signed CartMandates (pending: 0, timeout: 0)", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 373}
ap2_merchant               | {"timestamp": "2025-11-01T11:45:48.780100Z", "level": "INFO", "logger": "service", "message": "[Merchant] Auto-signed CartMandate: cart_432d01fc (with merchant_authorization JWT)", "module": "service", "function": "sign_cart_mandate", "line": 220}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.784714Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.ranking_node", "message": "[rank_and_select] Selected top 3 carts", "module": "ranking_node", "function": "rank_and_select", "line": 31}


ap2_merchant               | INFO:     172.18.0.8:51106 - "POST /sign/cart HTTP/1.1" 200 OK


ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.787530Z", "level": "INFO", "logger": "langgraph_merchant", "message": "[create_cart_candidates] 3 carts ready (pre-signed via MCP)", "module": "langgraph_merchant", "function": "create_cart_candidates", "line": 313}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.787610Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Generated 3 cart candidates", "module": "intent_handler", "function": "handle_intent_mandate", "line": 102}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.787805Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2A処理] ハンドラー完了: type=ap2.mandates.IntentMandate, result_type=ap2.responses.CartCandidates", "module": "a2a_handler", "function": "handle_message", "line": 313}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.790296Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 1009}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.790845Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 6733, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.responses.CartCandidates\",\"id\":\"270e5344-7b80-48bb-a673-6f5e0e006598\",\"payload\":{\"cart_candidates\":[{\"artifactId\":\"artifact_233194fd\",\"name\":\"コスパ最強プラ
ン (4,700円)\",\"parts\":[{\"da", "module": "crypto", "function": "sign_a2a_message", "line": 1013}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.790909Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 808}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.792643Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: merchant_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.793365Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:shopping_agent: ap2.responses.CartCandidates", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:45:48.793453Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.responses.CartCandidates\", \"peer\": \"did:ap2:agent:shopping_agent\", \"headers\": {\"message_id\": \"1a80fb1f-6d47-45c1-bfab-4cba3d83a9da\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:shopping_agent\", \"timestamp\": \"2025-11-01T11:45:48.788155Z\", \"nonce\": \"2c367a957de1d5ceba85b90152d4699ac734a7cbadfd10820ba5e68b99239ed7\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"intent_mandate_id\": \"intent_4956d1e9\", \"cart_candidates\": [{\"artifactId\": \"artifact_233194fd\", \"name\": \"コスパ最強プラン (4,700円)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_432d01fc\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_432d01fc\", \"display_items\": [{\"label\": \"むぎぼー時計\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼーマグカップ\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 470.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 5670.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.380344Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNTg2YzM2N2I0NGVjMGE0ZDQ1ZWI2ZGRkZDk5OGRlZjcxNTI1NTE2ODdhYjNhOGY3Y2RhNmZkZDQ2MTI4YTQxYiIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjU1NWY2OWIzLWY3YWQtNGU5ZS1iYTVlLTMwNzA1YTViNDg0MyIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.863Ktyr2xFUoJHUngERKhCV8FLlyLP-C9hHU-xZAFmL0PFKaE4ssnEU3rdveqbVL1rODSFq40oqI2hhQykBmYg\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.380776Z\", \"cart_name\": \"コスパ最強プラン (4,700円)\", \"cart_description\": \"かわいい時計とマグカップを組み合わせた予算内で最適なプラン。高品質なアイテムを2点で実現。\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}, {\"artifactId\": \"artifact_3ec594f8\", \"name\": \"高品質プラン (5,400円)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_738bc269\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_738bc269\", \"display_items\": [{\"label\": \"むぎぼー時計\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼープレート皿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 540.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.391175Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiYmMwYzIwM2UzNGQ3YTE5M2RlYmYwN2YyMTU0NTI2YjJkMzE3OTlkODJkM2Y2MDg4ZmIxNzFmZDg4M2ZiZWM3ZSIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjUwYmEzNDQ3LTg1NTUtNDRkYy1iNDRhLTFjNzZjZjc1OWFkMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9FUmfbwMHe7ddS6NGOHkfPIct9tz4g9JL5W9gzzpjXUz2T84ykCYvwp3i_h4QAv614EHc6f7PPSZ4SBVQzWfhw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.391197Z\", \"cart_name\": \"高品質プラン (5,400円)\", \"cart_description\": \"時計とプレート皿を組み合わせた高品質なプラン。予算を少し超えるが、かわいさと機能性を両立。\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}, {\"artifactId\": \"artifact_4d94e23f\", \"name\": \"シンプルプラン (2,000円)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_e9218338\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_e9218338\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼーマグカップ\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 200.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2700.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.395730Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMGUzMmMyYzZlYjQ4MjU5ZGI4OTMwYjJlMDE0NTU1ZTU3ODI4ZDFlMmVlNmUxZmM0MDE1ZjBmYmJlZTY1MzAzZSIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjZkYmQ4MWRiLWU3Y2ItNDIzMi05NDU2LWU0NDk3YTE0NGY1YSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.-S3BCOQWzLfG7qzJ3ATYm2_LSxAa7uzNLwC83FkcRhDO1fz2IrO7MPSmQtGSw3qPlrZpfusiiYBSN1l45Awu-A\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.395754Z\", \"cart_name\": \"シンプルプラン (2,000円)\", \"cart_description\": \"かわいいキーホルダーとマグカップの2点セット。予算内でシンプルで実用的な選択肢。\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼー
がプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}], \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"merchant_name\": \"むぎぼーショップ\"}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | [2025-11-01 11:45:48,793] INFO in v2.common.base_agent: [Merchant Agent] A2Aレスポンス返却: type=ap2.responses.CartCandidates, to=did:ap2:agent:shopping_agent
ap2_merchant_agent         | INFO:     172.18.0.6:35298 - "POST /a2a/message HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:48.806696Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (192572.87ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:48.807247Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:42:36 GMT\", \"server\": \"uvicorn\", \"content-length\": \"8253\", \"content-type\": \"application/json\"}, \"body\": {\"header\": {\"message_id\": \"1a80fb1f-6d47-45c1-bfab-4cba3d83a9da\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:shopping_agent\", \"timestamp\": \"2025-11-01T11:45:48.788155Z\", \"nonce\": \"2c367a957de1d5ceba85b90152d4699ac734a7cbadfd10820ba5e68b99239ed7\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"4aZA1IlPZquzjk5eDShuHuhhmmgb72WmQX9UiWv4zqnfzgLyf4DyGkC3j9tbca+uOUVKj756I0d4LaAJGhT7CA==\", \"publicKeyMultibase\": \"z6Mkv6MrdvEm5xDgUibhZgtv2ucmKugzjG8jNKJzUnkgxAve\", \"kid\": \"did:ap2:agent:merchant_agent#key-2\", \"created\": \"2025-11-01T11:45:48.788155Z\", \"proofPurpose\": \"authentication\"}, \"signature\": null}, \"dataPart\": {\"@type\": \"ap2.responses.CartCandidates\", \"id\": \"270e5344-7b80-48bb-a673-6f5e0e006598\", \"payload\": {\"intent_mandate_id\": \"intent_4956d1e9\", \"cart_candidates\": [{\"artifactId\": \"artifact_233194fd\", \"name\": \"コスパ最強プラン (4,700円)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_432d01fc\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_432d01fc\", \"display_items\": [{\"label\": \"むぎぼー時計\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼーマグカップ\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 470.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 5670.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.380344Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNTg2YzM2N2I0NGVjMGE0ZDQ1ZWI2ZGRkZDk5OGRlZjcxNTI1NTE2ODdhYjNhOGY3Y2RhNmZkZDQ2MTI4YTQxYiIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjU1NWY2OWIzLWY3YWQtNGU5ZS1iYTVlLTMwNzA1YTViNDg0MyIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.863Ktyr2xFUoJHUngERKhCV8FLlyLP-C9hHU-xZAFmL0PFKaE4ssnEU3rdveqbVL1rODSFq40oqI2hhQykBmYg\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.380776Z\", \"cart_name\": \"コスパ最強プラン (4,700円)\", \"cart_description\": \"かわいい時計と
マグカップを組み合わせた予算内で最適なプラン。高品質なアイテムを2点で実現。\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}, {\"artifactId\": \"artifact_3ec594f8\", \"name\": \"高品質プラン (5,400円)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_738bc269\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_738bc269\", \"display_items\": [{\"label\": \"むぎぼー時計\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼープレート皿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 540.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.391175Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiYmMwYzIwM2UzNGQ3YTE5M2RlYmYwN2YyMTU0NTI2YjJkMzE3OTlkODJkM2Y2MDg4ZmIxNzFmZDg4M2ZiZWM3ZSIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjUwYmEzNDQ3LTg1NTUtNDRkYy1iNDRhLTFjNzZjZjc1OWFkMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9FUmfbwMHe7ddS6NGOHkfPIct9tz4g9JL5W9gzzpjXUz2T84ykCYvwp3i_h4QAv614EHc6f7PPSZ4SBVQzWfhw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.391197Z\", \"cart_name\": \"高品質プラン (5,400円)\", \"cart_description\": \"時計とプレート皿を組み合わせた高品質なプラン。予算を少し超えるが、かわいさと機能性を両立。\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓を
かわいく演出。\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}, {\"artifactId\": \"artifact_4d94e23f\", \"name\": \"シンプルプラン (2,000円)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_e9218338\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_e9218338\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼーマグカップ\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 200.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2700.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.395730Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMGUzMmMyYzZlYjQ4MjU5ZGI4OTMwYjJlMDE0NTU1ZTU3ODI4ZDFlMmVlNmUxZmM0MDE1ZjBmYmJlZTY1MzAzZSIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjZkYmQ4MWRiLWU3Y2ItNDIzMi05NDU2LWU0NDk3YTE0NGY1YSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.-S3BCOQWzLfG7qzJ3ATYm2_LSxAa7uzNLwC83FkcRhDO1fz2IrO7MPSmQtGSw3qPlrZpfusiiYBSN1l45Awu-A\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.395754Z\", \"cart_name\": \"シンプルプラン (2,000円)\", \"cart_description\": \"かわいいキーホルダーとマグカップの2点セット。予算
内でシンプルで実用的な選択肢。\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}], \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"merchant_name\": \"むぎぼーショップ\"}, \"kind\": null, \"artifact\": null}}, \"duration_ms\": 192572.87335395813}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-01 11:45:48,809] INFO in services.shopping_agent.utils.merchant_integration:
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [ShoppingAgent ← MerchantAgent] A2Aレスポンス受信
ap2_shopping_agent         |   Status: 200
ap2_shopping_agent         |   Response Body: {
ap2_shopping_agent         |   "header": {
ap2_shopping_agent         |     "message_id": "1a80fb1f-6d47-45c1-bfab-4cba3d83a9da",
ap2_shopping_agent         |     "sender": "did:ap2:agent:merchant_agent",
ap2_shopping_agent         |     "recipient": "did:ap2:agent:shopping_agent",
ap2_shopping_agent         |     "timestamp": "2025-11-01T11:45:48.788155Z",
ap2_shopping_agent         |     "nonce": "2c367a957de1d5ceba85b90152d4699ac734a7cbadfd10820ba5e68b99239ed7",
ap2_shopping_agent         |     "schema_version": "0.2",
ap2_shopping_agent         |     "proof": {
ap2_shopping_agent         |       "algorithm": "ed25519",
ap2_shopping_agent         |       "signatureValue": "4aZA1IlPZquzjk5eDShuHuhhmmgb72WmQX9UiWv4zqnfzgLyf4DyGkC3j9tbca+uOUVKj756I0d4LaAJGhT7CA==",
ap2_shopping_agent         |       "publicKeyMultibase": "z6Mkv6MrdvEm5xDgUibhZgtv2ucmKugzjG8jNKJzUnkgxAve",
ap2_shopping_agent         |       "kid": "did:ap2:agent:merchant_agent#key-2",
ap2_shopping_agent         |       "created": "2025-11-01T11:45:48.788155Z",
ap2_shopping_agent         |       "proofPurpose": "authentication"
ap2_shopping_agent         |     },
ap2_shopping_agent         |     "signature": null
ap2_shopping_agent         |   },
ap2_shopping_agent         |   "dataPart": {
ap2_shopping_agent         |     "@type": "ap2.responses.CartCandidates",
ap2_shopping_agent         |     "id": "270e5344-7b80-48bb-a673-6f5e0e006598",
ap2_shopping_agent         |     "payload": {
ap2_shopping_agent         |       "intent_mandate_id": "intent_4956d1e9",
ap2_shopping_agent         |       "cart_candidates": [
ap2_shopping_agent         |         {
ap2_shopping_agent         |           "artifactId": "artifact_233194fd",
ap2_shopping_agent         |     ...
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [2025-11-01 11:45:48,810] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Received 3 cart candidates from Merchant Agent
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:49.618094Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=cart_selection", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:49.626922Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=cart_selection", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:55.298989Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:55.306773Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1761997291639_abefr\n  user_id: usr_ee3014bbc51f4156\n  user_input: cart_738bc269\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1058}
ap2_shopping_agent         | INFO:     172.67.69.85:65333 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:55.312455Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761997291639_abefr, step=cart_selection", "module": "agent", "function": "_get_or_create_session", "line": 1943}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:55.313042Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1761997291639_abefr)", "module": "agent", "function": "event_generator", "line": 1073}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:55.313206Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1761997291639_abefr", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1646}
ap2_shopping_agent         | [2025-11-01 11:45:55,339] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: cart_selection
ap2_shopping_agent         |   user_input: cart_738bc269
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-01 11:45:55,380] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cart_node] Merchant authorization JWT verified: merchant=did:ap2:merchant:mugibo_merchant, cart_hash=bc0c203e34d7a193...
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:55.402900Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=cart_signature_pending", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:55.407876Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=cart_signature_pending", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | INFO:     172.67.69.85:38223 - "OPTIONS /cart/submit-signature HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:58.575029Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:58.577364Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761997291639_abefr, step=cart_signature_pending", "module": "agent", "function": "_get_or_create_session", "line": 1943}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:58.577733Z", "level": "INFO", "logger": "agent", "message": "[submit_cart_signature] Received CartMandate signature: cart_id=None, session_id=session_1761997291639_abefr", "module": "agent", "function": "submit_cart_signature", "line": 1275}
ap2_shopping_agent         | [2025-11-01 11:45:58,577] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Verifying CartMandate WebAuthn signature: user_id=usr_ee3014bbc51f4156
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:58.578154Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://credential_provider:8003/verify/attestation", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:58.578431Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/verify/attestation\", \"headers\": {}, \"body\": {\"payment_mandate\": {\"contents\": {\"id\": \"cart_738bc269\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_738bc269\", \"display_items\": [{\"label\": \"むぎぼー時計\", \"amount\": {\"value\": 3500, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼープレート皿\", \"amount\": {\"value\": 1900, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 540, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 5940, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.391175Z\", \"merchant_name\": \"むぎぼー
ショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiYmMwYzIwM2UzNGQ3YTE5M2RlYmYwN2YyMTU0NTI2YjJkMzE3OTlkODJkM2Y2MDg4ZmIxNzFmZDg4M2ZiZWM3ZSIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjUwYmEzNDQ3LTg1NTUtNDRkYy1iNDRhLTFjNzZjZjc1OWFkMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9FUmfbwMHe7ddS6NGOHkfPIct9tz4g9JL5W9gzzpjXUz2T84ykCYvwp3i_h4QAv614EHc6f7PPSZ4SBVQzWfhw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.391197Z\", \"cart_name\": \"高品質プラン (5,400円)\", \"cart_description\": \"時計とプレート皿を組み合わせた高品質なプラン。予算を少し超えるが、かわいさと機能性を両立。\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"quantity\": 1, \"unit_price\": {\"value\": 3500, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"quantity\": 1, \"unit_price\": {\"value\": 1900, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900, \"currency\": \"JPY\"}, \"image_url\": null}]}}, \"attestation\": {\"id\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"rawId\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"response\": {\"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlbmdlIjoiZXlKdFlXNWtZWFJsWDJsa0lqb2lZMkZ5ZEY4M016aGlZekkyT1NJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRrNU56VTFOalE0T0gwIiwib3JpZ2luIjoiaHR0cDovL2xvY2FsaG9zdDozMDAwIiwiY3Jvc3NPcmlnaW4iOmZhbHNlfQ\", \"authenticatorData\": \"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2MdAAAAAA\", \"signature\": \"MEQCIE0yAZqKFRK65Bh1GHYCPAhw3DCAH7aICdiB11ve4KOpAiAUt_dJf_efzBEMLwPVw7qyHOwCjm1jsmwU-UNq_shyMQ\", \"userHandle\": \"usr_ee3014bbc51f4156\"}, \"type\": \"public-key\", \"attestation_type\": \"passkey\", \"challenge\": \"eyJtYW5kYXRlX2lkIjoiY2FydF83MzhiYzI2OSIsInRpbWVzdGFtcCI6MTc2MTk5NzU1NjQ4OH0\"}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:45:58.657813Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] Found passkey: nMJrfBrkstu2zYV5...", "module": "provider", "function": "verify_attestation", "line": 531}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:45:58.658049Z", "level": "INFO", "logger": "provider", "message": "  User: usr_ee3014bbc51f4156", "module": "provider", "function": "verify_attestation", "line": 532}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:45:58.658079Z", "level": "INFO", "logger": "provider", "message": "  Counter: 0", "module": "provider", "function": "verify_attestation", "line": 533}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:45:58.658745Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Verifying WebAuthn authentication result", "module": "crypto", "function": "verify_webauthn_signature", "line": 1414}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:45:58.659375Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Client Data Type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1435}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:45:58.659398Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Origin: http://localhost:3000", "module": "crypto", "function": "verify_webauthn_signature", "line": 1436}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:45:58.659408Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Challenge matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1448}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:45:58.659421Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Authentication type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1455}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:45:58.659718Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "AuthenticatorData parsed: counter=0", "module": "crypto", "function": "verify_webauthn_signature", "line": 1468}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:45:58.659738Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Signature counter: 0 (AP2 compliant: replay attacks prevented by user_authorization nonce)", "module": "crypto", "function": "verify_webauthn_signature", "line": 1474}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:45:58.662258Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "RP ID Hash matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1487}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:45:58.676084Z", "level": "INFO", "logger": "v2.common.crypto", "message": "WebAuthn signature verified successfully", "module": "crypto", "function": "verify_webauthn_signature", "line": 1539}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:45:58.688870Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] Signature counter: 0 → 0 (AP2準拠: Authenticatorがcounterを実装していない場合でも、user_authorizationのnonceによりリプレイ攻撃は防止されます)", "module": "provider", "function": "verify_attestation", "line": 551}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:45:58.691299Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] No payment_method.token in mandate (likely IntentMandate signature), skipping Payment Network call", "module": "provider", "function": "verify_attestation", "line": 579}
ap2_credential_provider    | [2025-11-01 11:45:58,690] INFO in services.credential_provider.utils.token_helpers: [CredentialProvider] Generated attestation token for user: None
ap2_credential_provider    | [2025-11-01 11:45:58,713] INFO in services.credential_provider.utils.token_helpers: [CredentialProvider] Saved attestation: user=unknown, verified=True, agent_token=None...
ap2_credential_provider    | INFO:     172.18.0.6:53628 - "POST /verify/attestation HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:58.723750Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (145.56ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:58.723827Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:45:57 GMT\", \"server\": \"uvicorn\", \"content-length\": \"191\", \"content-type\": \"application/json\"}, \"body\": {\"verified\": true, \"token\": \"cred_token_00f1de2d_sbY2_qAQUUZ7c_wrgYgKar1N\", \"details\": {\"attestation_type\": \"passkey\", \"timestamp\": \"2025-11-01T11:45:58.713940+00:00\", \"counter\": 0, \"agent_token\": null}}, \"duration_ms\": 145.56193351745605}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-01 11:45:58,723] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Sent WebAuthn verification request to Credential Provider: user_id=usr_ee3014bbc51f4156
ap2_shopping_agent         | [2025-11-01 11:45:58,723] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] ✅ WebAuthn signature verified successfully: counter=0, attestation_type=passkey
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:58.732100Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=cart_signature_pending", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:58.732367Z", "level": "INFO", "logger": "agent", "message": "[submit_cart_signature] CartMandate signed by user: cart_id=None, webauthn_assertion saved", "module": "agent", "function": "submit_cart_signature", "line": 1315}
ap2_shopping_agent         | INFO:     172.67.69.85:38223 - "POST /cart/submit-signature HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:58.742195Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:58.742394Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1761997291639_abefr\n  user_id: usr_ee3014bbc51f4156\n  user_input: _cart_signature_completed\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1058}
ap2_shopping_agent         | INFO:     172.67.69.85:38223 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:58.745534Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761997291639_abefr, step=cart_signature_pending", "module": "agent", "function": "_get_or_create_session", "line": 1943}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:58.746136Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1761997291639_abefr)", "module": "agent", "function": "event_generator", "line": 1073}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:58.746214Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1761997291639_abefr", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1646}
ap2_shopping_agent         | [2025-11-01 11:45:58,755] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: cart_signature_pending
ap2_shopping_agent         |   user_input: _cart_signature_completed
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-01 11:45:58,973] INFO in services.shopping_agent.langgraph_shopping_flow: [select_payment_method_node] AP2 Step 13-14: Presenting payment methods to user
ap2_shopping_agent         |   Available Methods: 1
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:59.548139Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=payment_method_selection", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:45:59.555741Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=payment_method_selection", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.571543Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.572617Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1761997291639_abefr\n  user_id: usr_ee3014bbc51f4156\n  user_input: 1\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1058}
ap2_shopping_agent         | INFO:     172.67.69.85:38223 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.581319Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761997291639_abefr, step=payment_method_selection", "module": "agent", "function": "_get_or_create_session", "line": 1943}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.582220Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1761997291639_abefr)", "module": "agent", "function": "event_generator", "line": 1073}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.582333Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1761997291639_abefr", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1646}
ap2_shopping_agent         | [2025-11-01 11:46:00,593] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: payment_method_selection
ap2_shopping_agent         |   user_input: 1
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-01 11:46:00,599] INFO in services.shopping_agent.langgraph_shopping_flow: [select_payment_method_node] AP2 Step 15-18: Tokenizing payment method
ap2_shopping_agent         |   User ID: usr_ee3014bbc51f4156
ap2_shopping_agent         |   Payment Method ID: pm_e6367cd7
ap2_shopping_agent         |   CP URL: http://credential_provider:8003
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.599232Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Requesting payment method tokenization for: pm_e6367cd7", "module": "agent", "function": "_tokenize_payment_method", "line": 2352}


ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.599307Z", "level": "INFO", "logger": "agent", "message": "\n================================================================================\n[ShoppingAgent → CredentialProvider] トークン化リクエスト送信\n  URL: http://credential_provider:8003/payment-methods/tokenize\n  User ID: usr_ee3014bbc51f4156\n  Payment Method ID: pm_e6367cd7\n================================================================================", "module": "agent", "function": "_tokenize_payment_method", "line": 2356}
ap2_credential_provider    | [2025-11-01 11:46:00,608] INFO in v2.common.redis_client: [RedisClient] Connected to Redis: redis://redis:6379/0


ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.599374Z", "level": "INFO", "logger": "agent", "message": "HTTP Reap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.599406Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/payment-methods/tokenize\", \"headers\": {}, \"body\": {\"user_id\": \"usr_ee3014bbc51f4156\", \"payment_method_id\": \"pm_e6367cd7\"}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:00.630608Z", "level": "INFO", "logger": "provider", "message": "[tokenize_payment_method] Generated secure token for payment method: pm_e6367cd7", "module": "provider", "function": "tokenize_payment_method", "line": 774}
ap2_credential_provider    | INFO:     172.18.0.6:53628 - "POST /payment-methods/tokenize HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.634984Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (35.52ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.635058Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:45:59 GMT\", \"server\": \"uvicorn\", \"content-length\": \"176\", \"content-type\": \"application/json\"}, \"body\": {\"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"payment_method_id\": \"pm_e6367cd7\", \"brand\": \"Visa\", \"last4\": \"1111\", \"type\": \"basic-card\", \"expires_at\": \"2025-11-01T12:01:00.604527Z\"}, \"duration_ms\": 35.51888465881348}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.635096Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent ← CredentialProvider] トークン化レスポンス受信: status=200", "module": "agent", "function": "_tokenize_payment_method", "line": 2376}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.635114Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Payment method tokenized: pm_e6367cd7 → tok_d4010a6f_JI2IHRB...", "module": "agent", "function": "_tokenize_payment_method", "line": 2386}
ap2_shopping_agent         | [2025-11-01 11:46:00,635] INFO in services.shopping_agent.langgraph_shopping_flow: [select_payment_method_node] AP2 Step 17-18: Received tokenized payment method
ap2_shopping_agent         |   Token: tok_d4010a6f_JI2IHRB...
ap2_shopping_agent         | [2025-11-01 11:46:00,635] INFO in services.shopping_agent.utils.payment_helpers: [_extract_payment_amount_from_cart] CartMandate structure: has_contents=True, has_payment_request=True, has_details=True, has_total=True, total_amount={'value': 5940.0, 'currency': 'JPY'}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.638063Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://credential_provider:8003/passkey/get-public-key", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.638109Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/passkey/get-public-key\", \"headers\": {}, \"body\": {\"credential_id\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"user_id\": \"usr_ee3014bbc51f4156\"}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_shopping_agent         | [2025-11-01 11:46:00,637] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Retrieving public key from Credential Provider: credential_id=nMJrfBrkstu2zYV5..., user_id=usr_ee3014bbc51f4156
ap2_shopping_agent         | [2025-11-01 11:46:00,642] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] ✅ Public key retrieved: credential_id=nMJrfBrkstu2zYV5...
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.642744Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (4.79ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.642793Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:45:59 GMT\", \"server\": \"uvicorn\", \"content-length\": \"205\", \"content-type\": \"application/json\"}, \"body\": {\"credential_id\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"public_key_cose\": \"pQECAyYgASFYIM9xvjRy3D0Rcg+26M/ZDzL5QEALG++za+5+ItHAHMeUIlggDyZjU2j5igyJMFReu7a+Rb64akZWKEM4lfO+11oED1c=\", \"user_id\": \"usr_ee3014bbc51f4156\"}, \"duration_ms\": 4.79435920715332}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-01 11:46:00,644] INFO in v2.common.user_authorization: [create_user_authorization_vp] WebAuthn challenge from assertion: eyJtYW5kYXRlX2lk...
ap2_shopping_agent         | [2025-11-01 11:46:00,644] INFO in v2.common.user_authorization: [create_user_authorization_vp] cart_hash: bc0c203e34d7a193...
ap2_shopping_agent         | [2025-11-01 11:46:00,644] INFO in v2.common.user_authorization: [create_user_authorization_vp] payment_hash: 28c14948eceb8a4a...
ap2_shopping_agent         | [2025-11-01 11:46:00,647] INFO in v2.common.user_authorization: [create_user_authorization_vp] Restored public key from COSE format (DB)
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:00.641561Z", "level": "INFO", "logger": "provider", "message": "[get_passkey_public_key] Public key retrieved: credential_id=nMJrfBrkstu2zYV5..., user_id=usr_ee3014bbc51f4156", "module": "provider", "function": "get_passkey_public_key", "line": 1497}


ap2_credential_provider    | INFO:     172.18.0.6:53628 - "POST /passkey/get-public-key HTTP/1.1" 200 OK
ap2_shopping_agent         | [2025-11-01 11:46:00,647] INFO in v2.common.user_authorization: [create_user_authorization_vp] cnf claim with JWK added to Issuer JWT
ap2_shopping_agent         | [2025-11-01 11:46:00,647] INFO in v2.common.user_authorization: [create_user_authorization_vp] Generated user_authorization VP: length=2407, cart_hash=bc0c203e34d7a193..., payment_hash=28c14948eceb8a4a...
ap2_shopping_agent         | [2025-11-01 11:46:00,648] INFO in services.shopping_agent.utils.payment_helpers: [_generate_user_authorization_for_payment] Generated user_authorization VP: length=2407
ap2_shopping_agent         | [2025-11-01 11:46:00,648] INFO in services.shopping_agent.utils.payment_helpers: [ShoppingAgent] transaction_type=human_present (WebAuthn assertion completed)
ap2_shopping_agent         | [2025-11-01 11:46:00,648] INFO in services.shopping_agent.utils.payment_helpers: [ShoppingAgent] Performing risk assessment...
ap2_shopping_agent         | [2025-11-01 11:46:00,649] WARNING in v2.common.risk_assessment: [RiskAssessmentEngine] Invalid amount value: 5940.0
ap2_shopping_agent         | [2025-11-01 11:46:00,649] WARNING in v2.common.risk_assessment: [RiskAssessmentEngine] Failed to parse amounts for constraint check
ap2_shopping_agent         | [2025-11-01 11:46:00,651] INFO in v2.common.risk_assessment: [RiskAssessmentEngine] Assessment completed: risk_score=2, recommendation=approve, fraud_indicators=[]
ap2_shopping_agent         | [2025-11-01 11:46:00,651] INFO in services.shopping_agent.utils.payment_helpers: [ShoppingAgent] Risk assessment completed: score=2, recommendation=approve, indicators=[]
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.651960Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] PaymentMandate created with user_authorization: has_user_auth=True", "module": "agent", "function": "_create_payment_mandate", "line": 2121}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.652101Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] PaymentMandate created: amount=5940.0 JPY, payment_method=Visa ****1111, token=tok_d4010a6f_JI2IHRB..., risk_score=2", "module": "agent", "function": "_create_payment_mandate", "line": 2126}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.686756Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=webauthn_signature_requested", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:00.693287Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=webauthn_signature_requested", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | INFO:     172.67.69.85:41711 - "OPTIONS /payment/submit-attestation HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:03.861932Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:03.865282Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] Verifying attestation for PaymentMandate: payment_941ae016", "module": "agent", "function": "submit_payment_attestation", "line": 1427}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:03.865516Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://credential_provider:8003/verify/attestation", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | [2025-11-01 11:46:03,865] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Verifying PaymentMandate attestation: payment_id=payment_941ae016
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:03.865637Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/verify/attestation\", \"headers\": {}, \"body\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_941ae016\", \"payment_details_id\": \"order_c6d3bdc3\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-01T11:46:00.636495Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJWbE16QXhOR0ppWXpVeFpqUXhOVFlpTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMlZsTXpBeE5HSmlZelV4WmpReE5UWWlMQ0pwWVhRaU9qRTNOakU1T1RjMU5qQXNJbVY0Y0NJNk1UYzJNVGs1TnpnMk1Dd2libUptSWpveE56WXhPVGszTlRZd0xDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaWVqTkhMVTVJVEdOUVVrWjVSRGRpYjNvNWExQk5kbXhCVVVGellqYzNUbkkzYmpScE1HTkJZM2cxVVNJc0lua2lPaUpFZVZwcVZUSnFOV2xuZVVwTlJsSmxkVGRoTFZKaU5qUmhhMXBYUzBWTk5HeG1UeTB4TVc5RlJERmpJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpoTlRaMFdreHRUV2xJUWtVMUxWTllVa0Z2VTJSU2NtaHRXVEp2Y2paWmFtRm1ORTVaYlc5R1dEZFpJaXdpYVdGMElqb3hOell4T1RrM05UWXdMQ0p6WkY5b1lYTm9Jam9pTUdRME1tTTFNRGM0TURjNU5tVXhOell5T0RsaE9Ea3paRGhrT1RjMlptVmpaV0UwTnpZeFpUQTJNbVJrTWpVeE1ERXpabUZrTTJZNE5HWTNNV1V6WWlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lZbU13WXpJd00yVXpOR1EzWVRFNU0yUmxZbVl3TjJZeU1UVTBOVEkyWWpKa016RTNPVGxrT0RKa00yWTJNRGc0Wm1JeE56Rm1aRGc0TTJaaVpXTTNaU0lzSWpJNFl6RTBPVFE0WldObFlqaGhOR0UxTWpNeU56Y3hOV05pTkRRNFlqWmpOelExT0RBNVl6RXlObUUxWXpNMFpHRXdPREppWmpJME5UWmhOelJrT0dNaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6Im5NSnJmQnJrc3R1MnpZVjUta2dpSXoycmluayIsInJhd0lkIjoibk1KcmZCcmtzdHUyellWNS1rZ2lJejJyaW5rIiwicmVzcG9uc2UiOnsiY2xpZW50RGF0YUpTT04iOiJleUowZVhCbElqb2lkMlZpWVhWMGFHNHVaMlYwSWl3aVkyaGhiR3hsYm1kbElqb2laWGxLZEZsWE5XdFpXRkpzV0RKc2EwbHFiMmxaTWtaNVpFWTRNMDE2YUdsWmVra3lUMU5KYzBsdVVuQmlWMVo2WkVkR2RHTkRTVFpOVkdNeVRWUnJOVTU2VlRGT2FsRTBUMGd3SWl3aWIzSnBaMmx1SWpvaWFIUjBjRG92TDJ4dlkyRnNhRzl6ZERvek1EQXdJaXdpWTNKdmMzTlBjbWxuYVc0aU9tWmhiSE5sZlEiLCJhdXRoZW50aWNhdG9yRGF0YSI6IlNaWU41WWdPakdoME5CY1BaSFpnVzRfa3JybWloakxIbVZ6enVvTWRsMk1kQUFBQUFBIiwic2lnbmF0dXJlIjoiTUVRQ0lFMHlBWnFLRlJLNjVCaDFHSFlDUEFodzNEQ0FIN2FJQ2RpQjExdmU0S09wQWlBVXRfZEpmX2VmekJFTUx3UFZ3N3F5SE93Q2ptMWpzbXdVLVVOcV9zaHlNUSIsInVzZXJIYW5kbGUiOiJ1c3JfZWUzMDE0YmJjNTFmNDE1NiJ9LCJ0eXBlIjoicHVibGljLWtleSIsImF0dGVzdGF0aW9uX3R5cGUiOiJwYXNza2V5IiwiY2hhbGxlbmdlIjoiZXlKdFlXNWtZWFJsWDJsa0lqb2lZMkZ5ZEY4M016aGlZekkyT1NJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRrNU56VTFOalE0T0gwIn0sImNhcnRfaGFzaCI6ImJjMGMyMDNlMzRkN2ExOTNkZWJmMDdmMjE1NDUyNmIyZDMxNzk5ZDgyZDNmNjA4OGZiMTcxZmQ4ODNmYmVjN2UiLCJwYXltZW50X2hhc2giOiIyOGMxNDk0OGVjZWI4YTRhNTIzMjc3MTVjYjQ0OGI2Yzc0NTgwOWMxMjZhNWMzNGRhMDgyYmYyNDU2YTc0ZDhjIn0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_941ae016\", \"cart_mandate_id\": \"cart_738bc269\", \"intent_mandate_id\": \"intent_4956d1e9\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"attestation\": {\"id\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"rawId\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"response\": {\"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlbmdlIjoiZXlKdFlXNWtZWFJsWDJsa0lqb2ljR0Y1YldWdWRGODVOREZoWlRBeE5pSXNJblJwYldWemRHRnRjQ0k2TVRjMk1UazVOelUyTVRnMk1YMCIsIm9yaWdpbiI6Imh0dHA6Ly9sb2NhbGhvc3Q6MzAwMCIsImNyb3NzT3JpZ2luIjpmYWxzZX0\", \"authenticatorData\": \"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2MdAAAAAA\", \"signature\": \"MEQCIBDBZNc364ZeKMI3-IVbhxLhxHQhYgn1fw1KONpc4fGVAiA_zd55AvtgEhzhsI9TfXoux4tt_4gUGShTatIdfMCzMw\", \"userHandle\": \"usr_ee3014bbc51f4156\"}, \"type\": \"public-key\", \"attestation_type\": \"passkey\", \"challenge\": \"eyJtYW5kYXRlX2lkIjoicGF5bWVudF85NDFhZTAxNiIsInRpbWVzdGFtcCI6MTc2MTk5NzU2MTg2MX0\"}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.874742Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] Found passkey: nMJrfBrkstu2zYV5...", "module": "provider", "function": "verify_attestation", "line": 531}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.874827Z", "level": "INFO", "logger": "provider", "message": "  User: usr_ee3014bbc51f4156", "module": "provider", "function": "verify_attestation", "line": 532}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.874861Z", "level": "INFO", "logger": "provider", "message": "  Counter: 0", "module": "provider", "function": "verify_attestation", "line": 533}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.874955Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Verifying WebAuthn authentication result", "module": "crypto", "function": "verify_webauthn_signature", "line": 1414}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.875058Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Client Data Type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1435}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.875078Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Origin: http://localhost:3000", "module": "crypto", "function": "verify_webauthn_signature", "line": 1436}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.875103Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Challenge matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1448}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.875123Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Authentication type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1455}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.875196Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "AuthenticatorData parsed: counter=0", "module": "crypto", "function": "verify_webauthn_signature", "line": 1468}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.875222Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Signature counter: 0 (AP2 compliant: replay attacks prevented by user_authorization nonce)", "module": "crypto", "function": "verify_webauthn_signature", "line": 1474}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.875355Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "RP ID Hash matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1487}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.877203Z", "level": "INFO", "logger": "v2.common.crypto", "message": "WebAuthn signature verified successfully", "module": "crypto", "function": "verify_webauthn_signature", "line": 1539}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.880795Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] Signature counter: 0 → 0 (AP2準拠: Authenticatorがcounterを実装していない場合でも、user_authorizationのnonceによりリプレイ攻撃は防止されます)", "module": "provider", "function": "verify_attestation", "line": 551}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.881117Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] PaymentMandate contains payment_method.token, calling Payment Network (Step 23)", "module": "provider", "function": "verify_attestation", "line": 570}
ap2_credential_provider    | [2025-11-01 11:46:03,881] INFO in services.credential_provider.utils.token_helpers: [CredentialProvider] Generated attestation token for user: usr_ee3014bbc51f4156
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.881559Z", "level": "INFO", "logger": "provider", "message": "[CredentialProvider] Requesting Agent Token from Payment Network: payment_mandate_id=payment_941ae016", "module": "provider", "function": "_request_agent_token_from_network", "line": 1808}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.881645Z", "level": "INFO", "logger": "provider", "message": "HTTP Request: POST http://payment_network:8005/network/tokenize", "module": "logger", "function": "log_http_request", "line": 182}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:03.881793Z", "level": "DEBUG", "logger": "provider", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://payment_network:8005/network/tokenize\", \"headers\": {}, \"body\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_941ae016\", \"payment_details_id\": \"order_c6d3bdc3\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-01T11:46:00.636495Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJWbE16QXhOR0ppWXpVeFpqUXhOVFlpTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMlZsTXpBeE5HSmlZelV4WmpReE5UWWlMQ0pwWVhRaU9qRTNOakU1T1RjMU5qQXNJbVY0Y0NJNk1UYzJNVGs1TnpnMk1Dd2libUptSWpveE56WXhPVGszTlRZd0xDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaWVqTkhMVTVJVEdOUVVrWjVSRGRpYjNvNWExQk5kbXhCVVVGellqYzNUbkkzYmpScE1HTkJZM2cxVVNJc0lua2lPaUpFZVZwcVZUSnFOV2xuZVVwTlJsSmxkVGRoTFZKaU5qUmhhMXBYUzBWTk5HeG1UeTB4TVc5RlJERmpJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpoTlRaMFdreHRUV2xJUWtVMUxWTllVa0Z2VTJSU2NtaHRXVEp2Y2paWmFtRm1ORTVaYlc5R1dEZFpJaXdpYVdGMElqb3hOell4T1RrM05UWXdMQ0p6WkY5b1lYTm9Jam9pTUdRME1tTTFNRGM0TURjNU5tVXhOell5T0RsaE9Ea3paRGhrT1RjMlptVmpaV0UwTnpZeFpUQTJNbVJrTWpVeE1ERXpabUZrTTJZNE5HWTNNV1V6WWlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lZbU13WXpJd00yVXpOR1EzWVRFNU0yUmxZbVl3TjJZeU1UVTBOVEkyWWpKa016RTNPVGxrT0RKa00yWTJNRGc0Wm1JeE56Rm1aRGc0TTJaaVpXTTNaU0lzSWpJNFl6RTBPVFE0WldObFlqaGhOR0UxTWpNeU56Y3hOV05pTkRRNFlqWmpOelExT0RBNVl6RXlObUUxWXpNMFpHRXdPREppWmpJME5UWmhOelJrT0dNaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6Im5NSnJmQnJrc3R1MnpZVjUta2dpSXoycmluayIsInJhd0lkIjoibk1KcmZCcmtzdHUyellWNS1rZ2lJejJyaW5rIiwicmVzcG9uc2UiOnsiY2xpZW50RGF0YUpTT04iOiJleUowZVhCbElqb2lkMlZpWVhWMGFHNHVaMlYwSWl3aVkyaGhiR3hsYm1kbElqb2laWGxLZEZsWE5XdFpXRkpzV0RKc2EwbHFiMmxaTWtaNVpFWTRNMDE2YUdsWmVra3lUMU5KYzBsdVVuQmlWMVo2WkVkR2RHTkRTVFpOVkdNeVRWUnJOVTU2VlRGT2FsRTBUMGd3SWl3aWIzSnBaMmx1SWpvaWFIUjBjRG92TDJ4dlkyRnNhRzl6ZERvek1EQXdJaXdpWTNKdmMzTlBjbWxuYVc0aU9tWmhiSE5sZlEiLCJhdXRoZW50aWNhdG9yRGF0YSI6IlNaWU41WWdPakdoME5CY1BaSFpnVzRfa3JybWloakxIbVZ6enVvTWRsMk1kQUFBQUFBIiwic2lnbmF0dXJlIjoiTUVRQ0lFMHlBWnFLRlJLNjVCaDFHSFlDUEFodzNEQ0FIN2FJQ2RpQjExdmU0S09wQWlBVXRfZEpmX2VmekJFTUx3UFZ3N3F5SE93Q2ptMWpzbXdVLVVOcV9zaHlNUSIsInVzZXJIYW5kbGUiOiJ1c3JfZWUzMDE0YmJjNTFmNDE1NiJ9LCJ0eXBlIjoicHVibGljLWtleSIsImF0dGVzdGF0aW9uX3R5cGUiOiJwYXNza2V5IiwiY2hhbGxlbmdlIjoiZXlKdFlXNWtZWFJsWDJsa0lqb2lZMkZ5ZEY4M016aGlZekkyT1NJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRrNU56VTFOalE0T0gwIn0sImNhcnRfaGFzaCI6ImJjMGMyMDNlMzRkN2ExOTNkZWJmMDdmMjE1NDUyNmIyZDMxNzk5ZDgyZDNmNjA4OGZiMTcxZmQ4ODNmYmVjN2UiLCJwYXltZW50X2hhc2giOiIyOGMxNDk0OGVjZWI4YTRhNTIzMjc3MTVjYjQ0OGI2Yzc0NTgwOWMxMjZhNWMzNGRhMDgyYmYyNDU2YTc0ZDhjIn0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_941ae016\", \"cart_mandate_id\": \"cart_738bc269\", \"intent_mandate_id\": \"intent_4956d1e9\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"attestation\": {\"id\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"rawId\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"response\": {\"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlbmdlIjoiZXlKdFlXNWtZWFJsWDJsa0lqb2ljR0Y1YldWdWRGODVOREZoWlRBeE5pSXNJblJwYldWemRHRnRjQ0k2TVRjMk1UazVOelUyTVRnMk1YMCIsIm9yaWdpbiI6Imh0dHA6Ly9sb2NhbGhvc3Q6MzAwMCIsImNyb3NzT3JpZ2luIjpmYWxzZX0\", \"authenticatorData\": \"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2MdAAAAAA\", \"signature\": \"MEQCIBDBZNc364ZeKMI3-IVbhxLhxHQhYgn1fw1KONpc4fGVAiA_zd55AvtgEhzhsI9TfXoux4tt_4gUGShTatIdfMCzMw\", \"userHandle\": \"usr_ee3014bbc51f4156\"}, \"type\": \"public-key\", \"attestation_type\": \"passkey\", \"challenge\": \"eyJtYW5kYXRlX2lkIjoicGF5bWVudF85NDFhZTAxNiIsInRpbWVzdGFtcCI6MTc2MTk5NzU2MTg2MX0\"}, \"payment_method_token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"transaction_context\": {\"credential_provider_id\": \"did:ap2:agent:credential_provider\", \"timestamp\": \"2025-11-01T11:46:03.881588+00:00\"}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_payment_network        | [2025-11-01 11:46:03,984] INFO in network: [DemoPaymentNetwork] Received tokenization request: payment_mandate_id=payment_941ae016, payment_method_token=tok_d4010a6f_JI2IHRB...
ap2_payment_network        | [2025-11-01 11:46:04,015] INFO in common.redis_client: [RedisClient] Connected to Redis: redis://redis:6379/2
ap2_payment_network        | [2025-11-01 11:46:04,045] INFO in services.payment_network.utils.token_helpers: [DemoPaymentNetwork] Issued Agent Token (Redis): agent_tok_demopaymentnetwork_7de..., expires_at=2025-11-01T12:46:03.988566+00:00, ttl=3600s
ap2_payment_network        | INFO:     172.18.0.13:45534 - "POST /network/tokenize HTTP/1.1" 200 OK
ap2_credential_provider    | [2025-11-01 11:46:04,055] INFO in httpx: HTTP Request: POST http://payment_network:8005/network/tokenize "HTTP/1.1 200 OK"
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:04.056439Z", "level": "INFO", "logger": "provider", "message": "HTTP Response: 200 (174.76ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:04.056486Z", "level": "DEBUG", "logger": "provider", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:46:03 GMT\", \"server\": \"uvicorn\", \"content-length\": \"186\", \"content-type\": \"application/json\"}, \"body\": {\"agent_token\": \"agent_tok_demopaymentnetwork_7ded707c_FQTbHlppnkYSFsKbT9FUM3id\", \"expires_at\": \"2025-11-01T12:46:03.988566Z\", \"network_name\": \"DemoPaymentNetwork\", \"token_type\": \"agent_token\"}, \"duration_ms\": 174.7605800628662}", "module": "logger", "function": "log_http_response", "line": 226}


ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:04.056521Z", "level": "INFO", "logger": "provider", "message": "[CredentialProvider] Received Agent Token from Payment Network: agent_tok_demopaymentnetwork_7de..., network_name=DemoPaymentNetwork", "module": "provider", "function": "_request_agent_token_from_network", "line": 1832}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.061692Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (196.06ms)", "module": "logger", "function": "log_http_response", "line": 215}


ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.061771Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:46:03 GMT\", \"server\": \"uvicorn\", \"content-length\": \"251\", \"content-type\": \"application/json\"}, \"body\": {\"verified\": true, \"token\": \"cred_token_94fc0239_2CoBwGal1lL6S9cQWMOz89lt\", \"details\": {\"attestation_type\": \"passkey\", \"timestamp\": \"2025-11-01T11:46:04.059768+00:00\", \"counter\": 0, \"agent_token\": \"agent_tok_demopaymentnetwork_7ded707c_FQTbHlppnkYSFsKbT9FUM3id\"}}, \"duration_ms\": 196.0592269897461}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_credential_provider    | [2025-11-01 11:46:04,059] INFO in services.credential_provider.utils.token_helpers: [CredentialProvider] Saved attestation: user=usr_ee3014bbc51f4156, verified=True, agent_token=agent_tok_demopaymentnetwork_7de...




ap2_shopping_agent         | [2025-11-01 11:46:04,061] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] ✅ PaymentMandate attestation verified: payment_id=payment_941ae016
ap2_credential_provider    | INFO:     172.18.0.6:53628 - "POST /verify/attestation HTTP/1.1" 200 OK
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:04.063508Z", "level": "INFO", "logger": "provider", "message": "[get_passkey_public_key] Public key retrieved: credential_id=nMJrfBrkstu2zYV5..., user_id=usr_ee3014bbc51f4156", "module": "provider", "function": "get_passkey_public_key", "line": 1497}



ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.061876Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] Attestation verified, processing payment...", "module": "agent", "function": "submit_payment_attestation", "line": 1447}


ap2_shopping_agent         | [2025-11-01 11:46:04,061] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Retrieving public key from Credential Provider: credential_id=nMJrfBrkstu2zYV5..., user_id=usr_ee3014bbc51f4156
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.061939Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://credential_provider:8003/passkey/get-public-key", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.061955Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/passkey/get-public-key\", \"headers\": {}, \"body\": {\"credential_id\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"user_id\": \"usr_ee3014bbc51f4156\"}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.064161Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (2.20ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.064189Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:46:03 GMT\", \"server\": \"uvicorn\", \"content-length\": \"205\", \"content-type\": \"application/json\"}, \"body\": {\"credential_id\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"public_key_cose\": \"pQECAyYgASFYIM9xvjRy3D0Rcg+26M/ZDzL5QEALG++za+5+ItHAHMeUIlggDyZjU2j5igyJMFReu7a+Rb64akZWKEM4lfO+11oED1c=\", \"user_id\": \"usr_ee3014bbc51f4156\"}, \"duration_ms\": 2.2029876708984375}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-01 11:46:04,064] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] ✅ Public key retrieved: credential_id=nMJrfBrkstu2zYV5...
ap2_shopping_agent         | [2025-11-01 11:46:04,064] INFO in v2.common.user_authorization: [create_user_authorization_vp] WebAuthn challenge from assertion: eyJtYW5kYXRlX2lk...
ap2_shopping_agent         | [2025-11-01 11:46:04,064] INFO in v2.common.user_authorization: [create_user_authorization_vp] cart_hash: bc0c203e34d7a193...
ap2_shopping_agent         | [2025-11-01 11:46:04,064] INFO in v2.common.user_authorization: [create_user_authorization_vp] payment_hash: 390dba57dc616d72...
ap2_shopping_agent         | [2025-11-01 11:46:04,065] INFO in v2.common.user_authorization: [create_user_authorization_vp] Restored public key from COSE format (DB)
ap2_shopping_agent         | [2025-11-01 11:46:04,065] INFO in v2.common.user_authorization: [create_user_authorization_vp] cnf claim with JWK added to Issuer JWT
ap2_shopping_agent         | [2025-11-01 11:46:04,065] INFO in v2.common.user_authorization: [create_user_authorization_vp] Generated user_authorization VP: length=2419, cart_hash=bc0c203e34d7a193..., payment_hash=390dba57dc616d72...
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.065756Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] SD-JWT-VC user_authorization generated: user_id=usr_ee3014bbc51f4156, vp_length=2419", "module": "agent", "function": "submit_payment_attestation", "line": 1491}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.075114Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=webauthn_signature_requested", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.075362Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] PaymentMandate signed by user: payment_id=payment_941ae016, next_step=payment_execution", "module": "agent", "function": "submit_payment_attestation", "line": 1512}
ap2_shopping_agent         | INFO:     172.67.69.85:41711 - "POST /payment/submit-attestation HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.085372Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.085684Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1761997291639_abefr\n  user_id: usr_ee3014bbc51f4156\n  user_input: _payment_signature_completed\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1058}
ap2_shopping_agent         | INFO:     172.67.69.85:41711 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.089602Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761997291639_abefr, step=webauthn_signature_requested", "module": "agent", "function": "_get_or_create_session", "line": 1943}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.090020Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1761997291639_abefr)", "module": "agent", "function": "event_generator", "line": 1073}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.090070Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1761997291639_abefr", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1646}
ap2_shopping_agent         | [2025-11-01 11:46:04,106] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: webauthn_signature_requested
ap2_shopping_agent         |   user_input: _payment_signature_completed
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-01 11:46:04,116] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Requesting payment processing via Merchant Agent for PaymentMandate: payment_941ae016
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.117018Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 1009}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.117484Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 5639, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_941ae016\",\"payload\":{\"cart_mandate\":{\"_metadata\":{\"cart_description\":\"時計とプレート皿を組み合わせた高品質なプラン。予算
を少し超えるが、かわいさと機能性を両立。\",\"cart_name\":\"高品質プラ", "module": "crypto", "function": "sign_a2a_message", "line": 1013}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.117528Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 808}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.118515Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: shopping_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.118674Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:merchant_agent: ap2.mandates.PaymentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_shopping_agent         | [2025-11-01 11:46:04,118] INFO in services.shopping_agent.utils.merchant_integration:
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [ShoppingAgent → MerchantAgent] A2Aメッセージ送信（PaymentRequest）
ap2_shopping_agent         |   URL: http://merchant_agent:8001/a2a/message
ap2_shopping_agent         |   メッセージID: e81d53b2-e4a8-4360-8773-e1ca99093115
ap2_shopping_agent         |   タイプ: ap2.mandates.PaymentMandate
ap2_shopping_agent         |   PaymentMandate ID: payment_941ae016
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.118771Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.mandates.PaymentMandate\", \"peer\": \"did:ap2:agent:merchant_agent\", \"headers\": {\"message_id\": \"e81d53b2-e4a8-4360-8773-e1ca99093115\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-01T11:46:04.116329Z\", \"nonce\": \"8b9d585184957c13f0a90fa65d5c953b5da168590c1ed22e99b3d3ed34a14f89\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_941ae016\", \"payment_details_id\": \"order_c6d3bdc3\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-01T11:46:00.636495Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJWbE16QXhOR0ppWXpVeFpqUXhOVFlpTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMlZsTXpBeE5HSmlZelV4WmpReE5UWWlMQ0pwWVhRaU9qRTNOakU1T1RjMU5qUXNJbVY0Y0NJNk1UYzJNVGs1TnpnMk5Dd2libUptSWpveE56WXhPVGszTlRZMExDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaWVqTkhMVTVJVEdOUVVrWjVSRGRpYjNvNWExQk5kbXhCVVVGellqYzNUbkkzYmpScE1HTkJZM2cxVVNJc0lua2lPaUpFZVZwcVZUSnFOV2xuZVVwTlJsSmxkVGRoTFZKaU5qUmhhMXBYUzBWTk5HeG1UeTB4TVc5RlJERmpJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpwWmpWalNqWkRlVUV4TlhWYWNuRlNXSGg1ZWs1MmFGTkJPSGxNTUZVeGNsTkRjMUJ6Y0U0ek9FUnpJaXdpYVdGMElqb3hOell4T1RrM05UWTBMQ0p6WkY5b1lYTm9Jam9pTVdFM1pqTmhaamRoWXpVeU9XTTFZbVEyT1RSbU1UZzVaREl5T0dGa1lqVmhZVFl3WTJRNE1UbG1aV015TkRVd1ptUmxPR0l4WW1ZeFptVXhNV1l3TnlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lZbU13WXpJd00yVXpOR1EzWVRFNU0yUmxZbVl3TjJZeU1UVTBOVEkyWWpKa016RTNPVGxrT0RKa00yWTJNRGc0Wm1JeE56Rm1aRGc0TTJaaVpXTTNaU0lzSWpNNU1HUmlZVFUzWkdNMk1UWmtOekpsWVdZeU1ERTFPV1UxWTJFellqSmlNbUkzWXpKalltUTJOalU1WTJZd1ltVXpPR000TVdKa1pHSmtNV1F6TXpraVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6Im5NSnJmQnJrc3R1MnpZVjUta2dpSXoycmluayIsInJhd0lkIjoibk1KcmZCcmtzdHUyellWNS1rZ2lJejJyaW5rIiwicmVzcG9uc2UiOnsiY2xpZW50RGF0YUpTT04iOiJleUowZVhCbElqb2lkMlZpWVhWMGFHNHVaMlYwSWl3aVkyaGhiR3hsYm1kbElqb2laWGxLZEZsWE5XdFpXRkpzV0RKc2EwbHFiMmxqUjBZMVlsZFdkV1JHT0RWT1JFWm9XbFJCZUU1cFNYTkpibEp3WWxkV2VtUkhSblJqUTBrMlRWUmpNazFVYXpWT2VsVXlUVlJuTWsxWU1DSXNJbTl5YVdkcGJpSTZJbWgwZEhBNkx5OXNiMk5oYkdodmMzUTZNekF3TUNJc0ltTnliM056VDNKcFoybHVJanBtWVd4elpYMCIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVFDSUJEQlpOYzM2NFplS01JMy1JVmJoeExoeEhRaFlnbjFmdzFLT05wYzRmR1ZBaUFfemQ1NUF2dGdFaHpoc0k5VGZYb3V4NHR0XzRnVUdTaFRhdElkZk1Dek13IiwidXNlckhhbmRsZSI6InVzcl9lZTMwMTRiYmM1MWY0MTU2In0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY4NU5ERmhaVEF4TmlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRrNU56VTJNVGcyTVgwIn0sImNhcnRfaGFzaCI6ImJjMGMyMDNlMzRkN2ExOTNkZWJmMDdmMjE1NDUyNmIyZDMxNzk5ZDgyZDNmNjA4OGZiMTcxZmQ4ODNmYmVjN2UiLCJwYXltZW50X2hhc2giOiIzOTBkYmE1N2RjNjE2ZDcyZWFmMjAxNTllNWNhM2IyYjJiN2MyY2JkNjY1OWNmMGJlMzhjODFiZGRiZDFkMzM5In0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_941ae016\", \"cart_mandate_id\": \"cart_738bc269\", \"intent_mandate_id\": \"intent_4956d1e9\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_738bc269\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_738bc269\", \"display_items\": [{\"label\": \"むぎぼー時計\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼープレート皿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 540.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.391175Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiYmMwYzIwM2UzNGQ3YTE5M2RlYmYwN2YyMTU0NTI2YjJkMzE3OTlkODJkM2Y2MDg4ZmIxNzFmZDg4M2ZiZWM3ZSIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjUwYmEzNDQ3LTg1NTUtNDRkYy1iNDRhLTFjNzZjZjc1OWFkMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9FUmfbwMHe7ddS6NGOHkfPIct9tz4g9JL5W9gzzpjXUz2T84ykCYvwp3i_h4QAv614EHc6f7PPSZ4SBVQzWfhw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.391197Z\", \"cart_name\": \"高品質プラン (5,400円)\", \"cart_description\": \"時計とプレート皿を組み合わせた高品質なプラン。予算を少し超えるが、かわいさと機能性を両立。\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.119141Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent:8001/a2a/message", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.119213Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent:8001/a2a/message\", \"headers\": {}, \"body\": {\"header\": {\"message_id\": \"e81d53b2-e4a8-4360-8773-e1ca99093115\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-01T11:46:04.116329Z\", \"nonce\": \"8b9d585184957c13f0a90fa65d5c953b5da168590c1ed22e99b3d3ed34a14f89\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"1bQiM1y70x5hPG5hHw+RUMAoCpwzkiWhMyxu2l9KvEliG8qzb0emJFIqsLzTnZMaIKi5FZ5IExiaPC5vfug0Cg==\", \"publicKeyMultibase\": \"z6MkwMTmaSbsecH3zoTBSAEY2vuMxguAebRnruND2a8oVvcq\", \"kid\": \"did:ap2:agent:shopping_agent#key-2\", \"created\": \"2025-11-01T11:46:04.116329Z\", \"proofPurpose\": \"authentication\"}, \"signature\": null}, \"dataPart\": {\"@type\": \"ap2.mandates.PaymentMandate\", \"id\": \"payment_941ae016\", \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_941ae016\", \"payment_details_id\": \"order_c6d3bdc3\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-01T11:46:00.636495Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJWbE16QXhOR0ppWXpVeFpqUXhOVFlpTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMlZsTXpBeE5HSmlZelV4WmpReE5UWWlMQ0pwWVhRaU9qRTNOakU1T1RjMU5qUXNJbVY0Y0NJNk1UYzJNVGs1TnpnMk5Dd2libUptSWpveE56WXhPVGszTlRZMExDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaWVqTkhMVTVJVEdOUVVrWjVSRGRpYjNvNWExQk5kbXhCVVVGellqYzNUbkkzYmpScE1HTkJZM2cxVVNJc0lua2lPaUpFZVZwcVZUSnFOV2xuZVVwTlJsSmxkVGRoTFZKaU5qUmhhMXBYUzBWTk5HeG1UeTB4TVc5RlJERmpJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpwWmpWalNqWkRlVUV4TlhWYWNuRlNXSGg1ZWs1MmFGTkJPSGxNTUZVeGNsTkRjMUJ6Y0U0ek9FUnpJaXdpYVdGMElqb3hOell4T1RrM05UWTBMQ0p6WkY5b1lYTm9Jam9pTVdFM1pqTmhaamRoWXpVeU9XTTFZbVEyT1RSbU1UZzVaREl5T0dGa1lqVmhZVFl3WTJRNE1UbG1aV015TkRVd1ptUmxPR0l4WW1ZeFptVXhNV1l3TnlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lZbU13WXpJd00yVXpOR1EzWVRFNU0yUmxZbVl3TjJZeU1UVTBOVEkyWWpKa016RTNPVGxrT0RKa00yWTJNRGc0Wm1JeE56Rm1aRGc0TTJaaVpXTTNaU0lzSWpNNU1HUmlZVFUzWkdNMk1UWmtOekpsWVdZeU1ERTFPV1UxWTJFellqSmlNbUkzWXpKalltUTJOalU1WTJZd1ltVXpPR000TVdKa1pHSmtNV1F6TXpraVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6Im5NSnJmQnJrc3R1MnpZVjUta2dpSXoycmluayIsInJhd0lkIjoibk1KcmZCcmtzdHUyellWNS1rZ2lJejJyaW5rIiwicmVzcG9uc2UiOnsiY2xpZW50RGF0YUpTT04iOiJleUowZVhCbElqb2lkMlZpWVhWMGFHNHVaMlYwSWl3aVkyaGhiR3hsYm1kbElqb2laWGxLZEZsWE5XdFpXRkpzV0RKc2EwbHFiMmxqUjBZMVlsZFdkV1JHT0RWT1JFWm9XbFJCZUU1cFNYTkpibEp3WWxkV2VtUkhSblJqUTBrMlRWUmpNazFVYXpWT2VsVXlUVlJuTWsxWU1DSXNJbTl5YVdkcGJpSTZJbWgwZEhBNkx5OXNiMk5oYkdodmMzUTZNekF3TUNJc0ltTnliM056VDNKcFoybHVJanBtWVd4elpYMCIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVFDSUJEQlpOYzM2NFplS01JMy1JVmJoeExoeEhRaFlnbjFmdzFLT05wYzRmR1ZBaUFfemQ1NUF2dGdFaHpoc0k5VGZYb3V4NHR0XzRnVUdTaFRhdElkZk1Dek13IiwidXNlckhhbmRsZSI6InVzcl9lZTMwMTRiYmM1MWY0MTU2In0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY4NU5ERmhaVEF4TmlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRrNU56VTJNVGcyTVgwIn0sImNhcnRfaGFzaCI6ImJjMGMyMDNlMzRkN2ExOTNkZWJmMDdmMjE1NDUyNmIyZDMxNzk5ZDgyZDNmNjA4OGZiMTcxZmQ4ODNmYmVjN2UiLCJwYXltZW50X2hhc2giOiIzOTBkYmE1N2RjNjE2ZDcyZWFmMjAxNTllNWNhM2IyYjJiN2MyY2JkNjY1OWNmMGJlMzhjODFiZGRiZDFkMzM5In0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_941ae016\", \"cart_mandate_id\": \"cart_738bc269\", \"intent_mandate_id\": \"intent_4956d1e9\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_738bc269\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_738bc269\", \"display_items\": [{\"label\": \"むぎぼー時計\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼープレート皿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 540.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.391175Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiYmMwYzIwM2UzNGQ3YTE5M2RlYmYwN2YyMTU0NTI2YjJkMzE3OTlkODJkM2Y2MDg4ZmIxNzFmZDg4M2ZiZWM3ZSIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjUwYmEzNDQ3LTg1NTUtNDRkYy1iNDRhLTFjNzZjZjc1OWFkMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9FUmfbwMHe7ddS6NGOHkfPIct9tz4g9JL5W9gzzpjXUz2T84ykCYvwp3i_h4QAv614EHc6f7PPSZ4SBVQzWfhw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.391197Z\", \"cart_name\": \"高品質プラン (5,400円)\", \"cart_description\": \"時計とプレート皿を組み合わせた高品質なプラン。予算を少し超えるが、かわいさと機能性を両立。\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}, \"kind\": null, \"artifact\": null}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | [2025-11-01 11:46:04,138] INFO in v2.common.base_agent:
ap2_merchant_agent         | ================================================================================
ap2_merchant_agent         | [Merchant Agent] A2Aエンドポイント: POST /a2a/message
ap2_merchant_agent         |   受信メッセージ: ID=e81d53b2-e4a8-4360-8773-e1ca99093115
ap2_merchant_agent         |   送信元: did:ap2:agent:shopping_agent
ap2_merchant_agent         |   タイプ: ap2.mandates.PaymentMandate
ap2_merchant_agent         | ================================================================================
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.138796Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message received to/from did:ap2:agent:shopping_agent: ap2.mandates.PaymentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.139280Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"received\", \"message_type\": \"ap2.mandates.PaymentMandate\", \"peer\": \"did:ap2:agent:shopping_agent\", \"headers\": {\"message_id\": \"e81d53b2-e4a8-4360-8773-e1ca99093115\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-01T11:46:04.116329Z\", \"nonce\": \"8b9d585184957c13f0a90fa65d5c953b5da168590c1ed22e99b3d3ed34a14f89\", \"schema_version\": \"0.2\"}, \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_941ae016\", \"payment_details_id\": \"order_c6d3bdc3\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-01T11:46:00.636495Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJWbE16QXhOR0ppWXpVeFpqUXhOVFlpTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMlZsTXpBeE5HSmlZelV4WmpReE5UWWlMQ0pwWVhRaU9qRTNOakU1T1RjMU5qUXNJbVY0Y0NJNk1UYzJNVGs1TnpnMk5Dd2libUptSWpveE56WXhPVGszTlRZMExDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaWVqTkhMVTVJVEdOUVVrWjVSRGRpYjNvNWExQk5kbXhCVVVGellqYzNUbkkzYmpScE1HTkJZM2cxVVNJc0lua2lPaUpFZVZwcVZUSnFOV2xuZVVwTlJsSmxkVGRoTFZKaU5qUmhhMXBYUzBWTk5HeG1UeTB4TVc5RlJERmpJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpwWmpWalNqWkRlVUV4TlhWYWNuRlNXSGg1ZWs1MmFGTkJPSGxNTUZVeGNsTkRjMUJ6Y0U0ek9FUnpJaXdpYVdGMElqb3hOell4T1RrM05UWTBMQ0p6WkY5b1lYTm9Jam9pTVdFM1pqTmhaamRoWXpVeU9XTTFZbVEyT1RSbU1UZzVaREl5T0dGa1lqVmhZVFl3WTJRNE1UbG1aV015TkRVd1ptUmxPR0l4WW1ZeFptVXhNV1l3TnlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lZbU13WXpJd00yVXpOR1EzWVRFNU0yUmxZbVl3TjJZeU1UVTBOVEkyWWpKa016RTNPVGxrT0RKa00yWTJNRGc0Wm1JeE56Rm1aRGc0TTJaaVpXTTNaU0lzSWpNNU1HUmlZVFUzWkdNMk1UWmtOekpsWVdZeU1ERTFPV1UxWTJFellqSmlNbUkzWXpKalltUTJOalU1WTJZd1ltVXpPR000TVdKa1pHSmtNV1F6TXpraVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6Im5NSnJmQnJrc3R1MnpZVjUta2dpSXoycmluayIsInJhd0lkIjoibk1KcmZCcmtzdHUyellWNS1rZ2lJejJyaW5rIiwicmVzcG9uc2UiOnsiY2xpZW50RGF0YUpTT04iOiJleUowZVhCbElqb2lkMlZpWVhWMGFHNHVaMlYwSWl3aVkyaGhiR3hsYm1kbElqb2laWGxLZEZsWE5XdFpXRkpzV0RKc2EwbHFiMmxqUjBZMVlsZFdkV1JHT0RWT1JFWm9XbFJCZUU1cFNYTkpibEp3WWxkV2VtUkhSblJqUTBrMlRWUmpNazFVYXpWT2VsVXlUVlJuTWsxWU1DSXNJbTl5YVdkcGJpSTZJbWgwZEhBNkx5OXNiMk5oYkdodmMzUTZNekF3TUNJc0ltTnliM056VDNKcFoybHVJanBtWVd4elpYMCIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVFDSUJEQlpOYzM2NFplS01JMy1JVmJoeExoeEhRaFlnbjFmdzFLT05wYzRmR1ZBaUFfemQ1NUF2dGdFaHpoc0k5VGZYb3V4NHR0XzRnVUdTaFRhdElkZk1Dek13IiwidXNlckhhbmRsZSI6InVzcl9lZTMwMTRiYmM1MWY0MTU2In0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY4NU5ERmhaVEF4TmlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRrNU56VTJNVGcyTVgwIn0sImNhcnRfaGFzaCI6ImJjMGMyMDNlMzRkN2ExOTNkZWJmMDdmMjE1NDUyNmIyZDMxNzk5ZDgyZDNmNjA4OGZiMTcxZmQ4ODNmYmVjN2UiLCJwYXltZW50X2hhc2giOiIzOTBkYmE1N2RjNjE2ZDcyZWFmMjAxNTllNWNhM2IyYjJiN2MyY2JkNjY1OWNmMGJlMzhjODFiZGRiZDFkMzM5In0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_941ae016\", \"cart_mandate_id\": \"cart_738bc269\", \"intent_mandate_id\": \"intent_4956d1e9\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_738bc269\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_738bc269\", \"display_items\": [{\"label\": \"むぎぼー時計\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼープレート皿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 540.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.391175Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiYmMwYzIwM2UzNGQ3YTE5M2RlYmYwN2YyMTU0NTI2YjJkMzE3OTlkODJkM2Y2MDg4ZmIxNzFmZDg4M2ZiZWM3ZSIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjUwYmEzNDQ3LTg1NTUtNDRkYy1iNDRhLTFjNzZjZjc1OWFkMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9FUmfbwMHe7ddS6NGOHkfPIct9tz4g9JL5W9gzzpjXUz2T84ykCYvwp3i_h4QAv614EHc6f7PPSZ4SBVQzWfhw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.391197Z\", \"cart_name\": \"高品質プラン (5,400円)\", \"cart_description\": \"時計とプレート皿を組み合わせた高品質なプラン。予算を少し超えるが、かわいさと機能性を両立。\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.139657Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Nonce validation successful: nonce=8b9d585184957c13...", "module": "a2a_handler", "function": "verify_message_signature", "line": 156}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.141627Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Using DID-resolved public key for verification: kid=did:ap2:agent:shopping_agent#key-2", "module": "a2a_handler", "function": "verify_message_signature", "line": 192}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.142373Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying A2A message signature", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1037}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.143040Z", "level": "DEBUG", "logger": "common.crypto", "message": "[VERIFY] Canonical JSON length: 5639, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_941ae016\",\"payload\":{\"cart_mandate\":{\"_metadata\":{\"cart_description\":\"時計とプレート皿を組み合わせた高品質なプラン。予
算を少し超えるが、かわいさと機能性を両立。\",\"cart_name\":\"高品質プラ", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1041}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.143092Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying signature (algorithm: ED25519)", "module": "crypto", "function": "verify_signature", "line": 871}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.143929Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto VERIFY: ED25519 (key: did:ap2:agent:shopping_agent#key-2) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.143997Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] proof署名検証成功: sender=did:ap2:agent:shopping_agent, alg=ed25519, kid=did:ap2:agent:shopping_agent#key-2, public_key_source=DID-resolved", "module": "a2a_handler", "function": "verify_message_signature", "line": 223}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.144149Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2A処理] ハンドラー実行中: type=ap2.mandates.PaymentMandate, from=did:ap2:agent:shopping_agent", "module": "a2a_handler", "function": "handle_message", "line": 305}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.144590Z", "level": "INFO", "logger": "handlers.payment_handler", "message": "[MerchantAgent] Received PaymentRequest from Shopping Agent", "module": "payment_handler", "function": "handle_payment_request", "line": 32}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.144658Z", "level": "INFO", "logger": "handlers.payment_handler", "message": "[MerchantAgent] Forwarding PaymentMandate to Payment Processor: payment_mandate_id=payment_941ae016", "module": "payment_handler", "function": "handle_payment_request", "line": 51}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.145107Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 1009}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.145362Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 5642, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_941ae016\",\"payload\":{\"cart_mandate\":{\"_metadata\":{\"cart_description\":\"時計とプレート皿を組み合わせた高品質なプラン。予算
を少し超えるが、かわいさと機能性を両立。\",\"cart_name\":\"高品質プラ", "module": "crypto", "function": "sign_a2a_message", "line": 1013}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.145404Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 808}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.145690Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: merchant_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.145814Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:payment_processor: ap2.mandates.PaymentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.145923Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.mandates.PaymentMandate\", \"peer\": \"did:ap2:agent:payment_processor\", \"headers\": {\"message_id\": \"aa4c0313-a389-4e4a-bad9-f59fbe71799d\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:payment_processor\", \"timestamp\": \"2025-11-01T11:46:04.144709Z\", \"nonce\": \"6d5368fd7d2401b7ee8d27aa5d2beb090903025ae069767648f3a8d9fb934aa2\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_941ae016\", \"payment_details_id\": \"order_c6d3bdc3\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-01T11:46:00.636495Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJWbE16QXhOR0ppWXpVeFpqUXhOVFlpTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMlZsTXpBeE5HSmlZelV4WmpReE5UWWlMQ0pwWVhRaU9qRTNOakU1T1RjMU5qUXNJbVY0Y0NJNk1UYzJNVGs1TnpnMk5Dd2libUptSWpveE56WXhPVGszTlRZMExDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaWVqTkhMVTVJVEdOUVVrWjVSRGRpYjNvNWExQk5kbXhCVVVGellqYzNUbkkzYmpScE1HTkJZM2cxVVNJc0lua2lPaUpFZVZwcVZUSnFOV2xuZVVwTlJsSmxkVGRoTFZKaU5qUmhhMXBYUzBWTk5HeG1UeTB4TVc5RlJERmpJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpwWmpWalNqWkRlVUV4TlhWYWNuRlNXSGg1ZWs1MmFGTkJPSGxNTUZVeGNsTkRjMUJ6Y0U0ek9FUnpJaXdpYVdGMElqb3hOell4T1RrM05UWTBMQ0p6WkY5b1lYTm9Jam9pTVdFM1pqTmhaamRoWXpVeU9XTTFZbVEyT1RSbU1UZzVaREl5T0dGa1lqVmhZVFl3WTJRNE1UbG1aV015TkRVd1ptUmxPR0l4WW1ZeFptVXhNV1l3TnlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lZbU13WXpJd00yVXpOR1EzWVRFNU0yUmxZbVl3TjJZeU1UVTBOVEkyWWpKa016RTNPVGxrT0RKa00yWTJNRGc0Wm1JeE56Rm1aRGc0TTJaaVpXTTNaU0lzSWpNNU1HUmlZVFUzWkdNMk1UWmtOekpsWVdZeU1ERTFPV1UxWTJFellqSmlNbUkzWXpKalltUTJOalU1WTJZd1ltVXpPR000TVdKa1pHSmtNV1F6TXpraVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6Im5NSnJmQnJrc3R1MnpZVjUta2dpSXoycmluayIsInJhd0lkIjoibk1KcmZCcmtzdHUyellWNS1rZ2lJejJyaW5rIiwicmVzcG9uc2UiOnsiY2xpZW50RGF0YUpTT04iOiJleUowZVhCbElqb2lkMlZpWVhWMGFHNHVaMlYwSWl3aVkyaGhiR3hsYm1kbElqb2laWGxLZEZsWE5XdFpXRkpzV0RKc2EwbHFiMmxqUjBZMVlsZFdkV1JHT0RWT1JFWm9XbFJCZUU1cFNYTkpibEp3WWxkV2VtUkhSblJqUTBrMlRWUmpNazFVYXpWT2VsVXlUVlJuTWsxWU1DSXNJbTl5YVdkcGJpSTZJbWgwZEhBNkx5OXNiMk5oYkdodmMzUTZNekF3TUNJc0ltTnliM056VDNKcFoybHVJanBtWVd4elpYMCIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVFDSUJEQlpOYzM2NFplS01JMy1JVmJoeExoeEhRaFlnbjFmdzFLT05wYzRmR1ZBaUFfemQ1NUF2dGdFaHpoc0k5VGZYb3V4NHR0XzRnVUdTaFRhdElkZk1Dek13IiwidXNlckhhbmRsZSI6InVzcl9lZTMwMTRiYmM1MWY0MTU2In0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY4NU5ERmhaVEF4TmlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRrNU56VTJNVGcyTVgwIn0sImNhcnRfaGFzaCI6ImJjMGMyMDNlMzRkN2ExOTNkZWJmMDdmMjE1NDUyNmIyZDMxNzk5ZDgyZDNmNjA4OGZiMTcxZmQ4ODNmYmVjN2UiLCJwYXltZW50X2hhc2giOiIzOTBkYmE1N2RjNjE2ZDcyZWFmMjAxNTllNWNhM2IyYjJiN2MyY2JkNjY1OWNmMGJlMzhjODFiZGRiZDFkMzM5In0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_941ae016\", \"cart_mandate_id\": \"cart_738bc269\", \"intent_mandate_id\": \"intent_4956d1e9\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_738bc269\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_738bc269\", \"display_items\": [{\"label\": \"むぎぼー時計\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼープレート皿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 540.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.391175Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiYmMwYzIwM2UzNGQ3YTE5M2RlYmYwN2YyMTU0NTI2YjJkMzE3OTlkODJkM2Y2MDg4ZmIxNzFmZDg4M2ZiZWM3ZSIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjUwYmEzNDQ3LTg1NTUtNDRkYy1iNDRhLTFjNzZjZjc1OWFkMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9FUmfbwMHe7ddS6NGOHkfPIct9tz4g9JL5W9gzzpjXUz2T84ykCYvwp3i_h4QAv614EHc6f7PPSZ4SBVQzWfhw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.391197Z\", \"cart_name\": \"高品質プラン (5,400円)\", \"cart_description\": \"時計とプレート皿を組み合わせた高品質なプラン。予算を少し超えるが、かわいさと機能性を両立。\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.146036Z", "level": "INFO", "logger": "handlers.payment_handler", "message": "\n================================================================================\n[MerchantAgent → PaymentProcessor] A2Aメッセージ転送\n  URL: http://payment_processor:8004/a2a/message\n  メッセージID: aa4c0313-a389-4e4a-bad9-f59fbe71799d\n  タ
イプ: ap2.mandates.PaymentMandate\n================================================================================", "module": "payment_handler", "function": "handle_payment_request", "line": 69}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.146272Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://payment_processor:8004/a2a/message", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.146439Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://payment_processor:8004/a2a/message\", \"headers\": {}, \"body\": {\"header\": {\"message_id\": \"aa4c0313-a389-4e4a-bad9-f59fbe71799d\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:payment_processor\", \"timestamp\": \"2025-11-01T11:46:04.144709Z\", \"nonce\": \"6d5368fd7d2401b7ee8d27aa5d2beb090903025ae069767648f3a8d9fb934aa2\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"ijoXCE7aJeVg1q/5sUR71Q4FHsDF5bQXt1kEFJg6L3k2rnDusnXuuHWF7Z/gw85t9HFGmZsgPj3zuVufnUJvCQ==\", \"publicKeyMultibase\": \"z6Mkv6MrdvEm5xDgUibhZgtv2ucmKugzjG8jNKJzUnkgxAve\", \"kid\": \"did:ap2:agent:merchant_agent#key-2\", \"created\": \"2025-11-01T11:46:04.144709Z\", \"proofPurpose\": \"authentication\"}, \"signature\": null}, \"dataPart\": {\"@type\": \"ap2.mandates.PaymentMandate\", \"id\": \"payment_941ae016\", \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_941ae016\", \"payment_details_id\": \"order_c6d3bdc3\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-01T11:46:00.636495Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJWbE16QXhOR0ppWXpVeFpqUXhOVFlpTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMlZsTXpBeE5HSmlZelV4WmpReE5UWWlMQ0pwWVhRaU9qRTNOakU1T1RjMU5qUXNJbVY0Y0NJNk1UYzJNVGs1TnpnMk5Dd2libUptSWpveE56WXhPVGszTlRZMExDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaWVqTkhMVTVJVEdOUVVrWjVSRGRpYjNvNWExQk5kbXhCVVVGellqYzNUbkkzYmpScE1HTkJZM2cxVVNJc0lua2lPaUpFZVZwcVZUSnFOV2xuZVVwTlJsSmxkVGRoTFZKaU5qUmhhMXBYUzBWTk5HeG1UeTB4TVc5RlJERmpJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpwWmpWalNqWkRlVUV4TlhWYWNuRlNXSGg1ZWs1MmFGTkJPSGxNTUZVeGNsTkRjMUJ6Y0U0ek9FUnpJaXdpYVdGMElqb3hOell4T1RrM05UWTBMQ0p6WkY5b1lYTm9Jam9pTVdFM1pqTmhaamRoWXpVeU9XTTFZbVEyT1RSbU1UZzVaREl5T0dGa1lqVmhZVFl3WTJRNE1UbG1aV015TkRVd1ptUmxPR0l4WW1ZeFptVXhNV1l3TnlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lZbU13WXpJd00yVXpOR1EzWVRFNU0yUmxZbVl3TjJZeU1UVTBOVEkyWWpKa016RTNPVGxrT0RKa00yWTJNRGc0Wm1JeE56Rm1aRGc0TTJaaVpXTTNaU0lzSWpNNU1HUmlZVFUzWkdNMk1UWmtOekpsWVdZeU1ERTFPV1UxWTJFellqSmlNbUkzWXpKalltUTJOalU1WTJZd1ltVXpPR000TVdKa1pHSmtNV1F6TXpraVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6Im5NSnJmQnJrc3R1MnpZVjUta2dpSXoycmluayIsInJhd0lkIjoibk1KcmZCcmtzdHUyellWNS1rZ2lJejJyaW5rIiwicmVzcG9uc2UiOnsiY2xpZW50RGF0YUpTT04iOiJleUowZVhCbElqb2lkMlZpWVhWMGFHNHVaMlYwSWl3aVkyaGhiR3hsYm1kbElqb2laWGxLZEZsWE5XdFpXRkpzV0RKc2EwbHFiMmxqUjBZMVlsZFdkV1JHT0RWT1JFWm9XbFJCZUU1cFNYTkpibEp3WWxkV2VtUkhSblJqUTBrMlRWUmpNazFVYXpWT2VsVXlUVlJuTWsxWU1DSXNJbTl5YVdkcGJpSTZJbWgwZEhBNkx5OXNiMk5oYkdodmMzUTZNekF3TUNJc0ltTnliM056VDNKcFoybHVJanBtWVd4elpYMCIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVFDSUJEQlpOYzM2NFplS01JMy1JVmJoeExoeEhRaFlnbjFmdzFLT05wYzRmR1ZBaUFfemQ1NUF2dGdFaHpoc0k5VGZYb3V4NHR0XzRnVUdTaFRhdElkZk1Dek13IiwidXNlckhhbmRsZSI6InVzcl9lZTMwMTRiYmM1MWY0MTU2In0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY4NU5ERmhaVEF4TmlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRrNU56VTJNVGcyTVgwIn0sImNhcnRfaGFzaCI6ImJjMGMyMDNlMzRkN2ExOTNkZWJmMDdmMjE1NDUyNmIyZDMxNzk5ZDgyZDNmNjA4OGZiMTcxZmQ4ODNmYmVjN2UiLCJwYXltZW50X2hhc2giOiIzOTBkYmE1N2RjNjE2ZDcyZWFmMjAxNTllNWNhM2IyYjJiN2MyY2JkNjY1OWNmMGJlMzhjODFiZGRiZDFkMzM5In0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_941ae016\", \"cart_mandate_id\": \"cart_738bc269\", \"intent_mandate_id\": \"intent_4956d1e9\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_738bc269\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_738bc269\", \"display_items\": [{\"label\": \"むぎぼー時計\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼープレート皿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 540.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.391175Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiYmMwYzIwM2UzNGQ3YTE5M2RlYmYwN2YyMTU0NTI2YjJkMzE3OTlkODJkM2Y2MDg4ZmIxNzFmZDg4M2ZiZWM3ZSIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjUwYmEzNDQ3LTg1NTUtNDRkYy1iNDRhLTFjNzZjZjc1OWFkMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9FUmfbwMHe7ddS6NGOHkfPIct9tz4g9JL5W9gzzpjXUz2T84ykCYvwp3i_h4QAv614EHc6f7PPSZ4SBVQzWfhw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.391197Z\", \"cart_name\": \"高品質プラン(5,400円)\", \"cart_description\": \"時計とプレート皿を組み合わせた高品質なプラン。予算を少し超えるが、かわいさと機能性を両立。\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}, \"kind\": null, \"artifact\": null}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_payment_processor      | [2025-11-01 11:46:04,431] INFO in v2.common.base_agent:
ap2_payment_processor      | ================================================================================
ap2_payment_processor      | [Payment Processor] A2Aエンドポイント: POST /a2a/message
ap2_payment_processor      |   受信メッセージ: ID=aa4c0313-a389-4e4a-bad9-f59fbe71799d
ap2_payment_processor      |   送信元: did:ap2:agent:merchant_agent
ap2_payment_processor      |   タイプ: ap2.mandates.PaymentMandate
ap2_payment_processor      | ================================================================================
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.434777Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message received to/from did:ap2:agent:merchant_agent: ap2.mandates.PaymentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.434965Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"received\", \"message_type\": \"ap2.mandates.PaymentMandate\", \"peer\": \"did:ap2:agent:merchant_agent\", \"headers\": {\"message_id\": \"aa4c0313-a389-4e4a-bad9-f59fbe71799d\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:payment_processor\", \"timestamp\": \"2025-11-01T11:46:04.144709Z\", \"nonce\": \"6d5368fd7d2401b7ee8d27aa5d2beb090903025ae069767648f3a8d9fb934aa2\", \"schema_version\": \"0.2\"}, \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_941ae016\", \"payment_details_id\": \"order_c6d3bdc3\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-01T11:46:00.636495Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJWbE16QXhOR0ppWXpVeFpqUXhOVFlpTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMlZsTXpBeE5HSmlZelV4WmpReE5UWWlMQ0pwWVhRaU9qRTNOakU1T1RjMU5qUXNJbVY0Y0NJNk1UYzJNVGs1TnpnMk5Dd2libUptSWpveE56WXhPVGszTlRZMExDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaWVqTkhMVTVJVEdOUVVrWjVSRGRpYjNvNWExQk5kbXhCVVVGellqYzNUbkkzYmpScE1HTkJZM2cxVVNJc0lua2lPaUpFZVZwcVZUSnFOV2xuZVVwTlJsSmxkVGRoTFZKaU5qUmhhMXBYUzBWTk5HeG1UeTB4TVc5RlJERmpJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpwWmpWalNqWkRlVUV4TlhWYWNuRlNXSGg1ZWs1MmFGTkJPSGxNTUZVeGNsTkRjMUJ6Y0U0ek9FUnpJaXdpYVdGMElqb3hOell4T1RrM05UWTBMQ0p6WkY5b1lYTm9Jam9pTVdFM1pqTmhaamRoWXpVeU9XTTFZbVEyT1RSbU1UZzVaREl5T0dGa1lqVmhZVFl3WTJRNE1UbG1aV015TkRVd1ptUmxPR0l4WW1ZeFptVXhNV1l3TnlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lZbU13WXpJd00yVXpOR1EzWVRFNU0yUmxZbVl3TjJZeU1UVTBOVEkyWWpKa016RTNPVGxrT0RKa00yWTJNRGc0Wm1JeE56Rm1aRGc0TTJaaVpXTTNaU0lzSWpNNU1HUmlZVFUzWkdNMk1UWmtOekpsWVdZeU1ERTFPV1UxWTJFellqSmlNbUkzWXpKalltUTJOalU1WTJZd1ltVXpPR000TVdKa1pHSmtNV1F6TXpraVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6Im5NSnJmQnJrc3R1MnpZVjUta2dpSXoycmluayIsInJhd0lkIjoibk1KcmZCcmtzdHUyellWNS1rZ2lJejJyaW5rIiwicmVzcG9uc2UiOnsiY2xpZW50RGF0YUpTT04iOiJleUowZVhCbElqb2lkMlZpWVhWMGFHNHVaMlYwSWl3aVkyaGhiR3hsYm1kbElqb2laWGxLZEZsWE5XdFpXRkpzV0RKc2EwbHFiMmxqUjBZMVlsZFdkV1JHT0RWT1JFWm9XbFJCZUU1cFNYTkpibEp3WWxkV2VtUkhSblJqUTBrMlRWUmpNazFVYXpWT2VsVXlUVlJuTWsxWU1DSXNJbTl5YVdkcGJpSTZJbWgwZEhBNkx5OXNiMk5oYkdodmMzUTZNekF3TUNJc0ltTnliM056VDNKcFoybHVJanBtWVd4elpYMCIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVFDSUJEQlpOYzM2NFplS01JMy1JVmJoeExoeEhRaFlnbjFmdzFLT05wYzRmR1ZBaUFfemQ1NUF2dGdFaHpoc0k5VGZYb3V4NHR0XzRnVUdTaFRhdElkZk1Dek13IiwidXNlckhhbmRsZSI6InVzcl9lZTMwMTRiYmM1MWY0MTU2In0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY4NU5ERmhaVEF4TmlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRrNU56VTJNVGcyTVgwIn0sImNhcnRfaGFzaCI6ImJjMGMyMDNlMzRkN2ExOTNkZWJmMDdmMjE1NDUyNmIyZDMxNzk5ZDgyZDNmNjA4OGZiMTcxZmQ4ODNmYmVjN2UiLCJwYXltZW50X2hhc2giOiIzOTBkYmE1N2RjNjE2ZDcyZWFmMjAxNTllNWNhM2IyYjJiN2MyY2JkNjY1OWNmMGJlMzhjODFiZGRiZDFkMzM5In0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_941ae016\", \"cart_mandate_id\": \"cart_738bc269\", \"intent_mandate_id\": \"intent_4956d1e9\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_738bc269\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_738bc269\", \"display_items\": [{\"label\": \"むぎぼー時計\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼープレート皿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 540.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T12:45:48.391175Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiYmMwYzIwM2UzNGQ3YTE5M2RlYmYwN2YyMTU0NTI2YjJkMzE3OTlkODJkM2Y2MDg4ZmIxNzFmZDg4M2ZiZWM3ZSIsImV4cCI6MTc2MjAwMTE0OCwiaWF0IjoxNzYxOTk3NTQ4LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjUwYmEzNDQ3LTg1NTUtNDRkYy1iNDRhLTFjNzZjZjc1OWFkMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9FUmfbwMHe7ddS6NGOHkfPIct9tz4g9JL5W9gzzpjXUz2T84ykCYvwp3i_h4QAv614EHc6f7PPSZ4SBVQzWfhw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T11:45:48.391197Z\", \"cart_name\": \"高品質プラン (5,400円)\", \"cart_description\": \"時計とプレート皿を組み合わせた高品質なプラン。予算を少し超えるが、かわいさと機能性を両立。\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.435612Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Nonce validation successful: nonce=6d5368fd7d2401b7...", "module": "a2a_handler", "function": "verify_message_signature", "line": 156}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.462898Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Using DID-resolved public key for verification: kid=did:ap2:agent:merchant_agent#key-2", "module": "a2a_handler", "function": "verify_message_signature", "line": 192}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.475068Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying A2A message signature", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1037}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.480167Z", "level": "DEBUG", "logger": "common.crypto", "message": "[VERIFY] Canonical JSON length: 5642, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_941ae016\",\"payload\":{\"cart_mandate\":{\"_metadata\":{\"cart_description\":\"時計とプレート皿を組み合わせた高品質なプラン。予
算を少し超えるが、かわいさと機能性を両立。\",\"cart_name\":\"高品質プラ", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1041}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.480216Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying signature (algorithm: ED25519)", "module": "crypto", "function": "verify_signature", "line": 871}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.499662Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto VERIFY: ED25519 (key: did:ap2:agent:merchant_agent#key-2) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.499730Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] proof署名検証成功: sender=did:ap2:agent:merchant_agent, alg=ed25519, kid=did:ap2:agent:merchant_agent#key-2, public_key_source=DID-resolved", "module": "a2a_handler", "function": "verify_message_signature", "line": 223}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.499762Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2A処理] ハンドラー実行中: type=ap2.mandates.PaymentMandate, from=did:ap2:agent:merchant_agent", "module": "a2a_handler", "function": "handle_message", "line": 305}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.500024Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Received PaymentMandate", "module": "processor", "function": "handle_payment_mandate", "line": 366}
ap2_payment_processor      | [2025-11-01 11:46:04,500] INFO in services.payment_processor.utils.mandate_helpers: [PaymentProcessor] PaymentMandate validation passed: payment_941ae016, user_authorization present: eyJpc3N1ZXJfand0Ijoi...
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.500385Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Mandate chain validation: PaymentMandate(payment_941ae016) → CartMandate(cart_738bc269)", "module": "processor", "function": "_validate_mandate_chain", "line": 631}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.502727Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Verifying SD-JWT-VC user_authorization: cart_hash=bc0c203e34d7a193..., payment_hash=390dba57dc616d72...", "module": "processor", "function": "_validate_mandate_chain", "line": 648}
ap2_payment_processor      | [2025-11-01 11:46:04,503] INFO in v2.common.user_authorization: [verify_user_authorization_vp] Decoded VP successfully
ap2_payment_processor      | [2025-11-01 11:46:04,503] INFO in v2.common.user_authorization: [verify_user_authorization_vp] Hash verification passed: cart_hash=bc0c203e34d7a193..., payment_hash=390dba57dc616d72...
ap2_payment_processor      | [2025-11-01 11:46:04,511] INFO in v2.common.user_authorization: [verify_user_authorization_vp] ✓ WebAuthn signature verified successfully
ap2_payment_processor      | [2025-11-01 11:46:04,511] INFO in v2.common.user_authorization: [verify_user_authorization_vp] Key-binding JWT payload verified
ap2_payment_processor      | [2025-11-01 11:46:04,511] INFO in v2.common.user_authorization: [verify_user_authorization_vp] ✓ VP verification passed
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.511473Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] ✓ SD-JWT-VC user_authorization verified: cart_hash_match=True, payment_hash_match=True, webauthn_signature_verified=True", "module": "processor", "function": "_validate_mandate_chain", "line": 661}
ap2_payment_processor      | [2025-11-01 11:46:04,516] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_payment_processor      | [2025-11-01 11:46:04,517] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録
: did:ap2:agent:shopping_agent
ap2_payment_processor      | [2025-11-01 11:46:04,517] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを
読み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_payment_processor      | [2025-11-01 11:46:04,518] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録
: did:ap2:agent:merchant_agent
ap2_payment_processor      | [2025-11-01 11:46:04,518] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを
読み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_payment_processor      | [2025-11-01 11:46:04,518] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録
: did:ap2:merchant:mugibo_merchant
ap2_payment_processor      | [2025-11-01 11:46:04,519] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを
読み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_payment_processor      | [2025-11-01 11:46:04,519] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録
: did:ap2:cp:demo_cp
ap2_payment_processor      | [2025-11-01 11:46:04,519] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを
読み込み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_payment_processor      | [2025-11-01 11:46:04,520] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録
: did:ap2:cp:demo_cp_2
ap2_payment_processor      | [2025-11-01 11:46:04,520] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを
読み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_payment_processor      | [2025-11-01 11:46:04,520] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録
: did:ap2:agent:payment_processor
ap2_payment_processor      | [2025-11-01 11:46:04,521] INFO in services.payment_processor.utils.jwt_helpers: [_verify_jwt_signature] ✓ JWT signature verified successfully (RFC 7515 compliant)
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.521814Z", "level": "INFO", "logger": "processor", "message": "[_verify_merchant_authorization_jwt] JWT validation passed: iss=did:ap2:merchant:mugibo_merchant, exp=1762001148, jti=50ba3447-8555-44..., cart_hash=bc0c203e34d7a193...", "module": "processor", "function": "_verify_merchant_authorization_jwt", "line": 573}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.521836Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] merchant_authorization JWT verified: iss=did:ap2:merchant:mugibo_merchant", "module": "processor", "function": "_validate_mandate_chain", "line": 685}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.521850Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] CartMandate hash in merchant_authorization: bc0c203e34d7a193...", "module": "processor", "function": "_validate_mandate_chain", "line": 693}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.521964Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] ✓ CartMandate hash verified (merchant_authorization): bc0c203e34d7a193...", "module": "processor", "function": "_validate_mandate_chain", "line": 710}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.521988Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Mandate chain validation passed", "module": "processor", "function": "_validate_mandate_chain", "line": 742}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.522228Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Processing payment (mock): txn_bb0bc4534f0e", "module": "processor", "function": "_process_payment_mock", "line": 761}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.522413Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Verifying credential with Credential Provider: token=tok_d4010a6f_JI2IHRB...", "module": "processor", "function": "_verify_credential_with_cp", "line": 876}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.523912Z", "level": "INFO", "logger": "processor", "message": "HTTP Request: POST http://credential_provider:8003/credentials/verify", "module": "logger", "function": "log_http_request", "line": 182}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.523948Z", "level": "DEBUG", "logger": "processor", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/credentials/verify\", \"headers\": {}, \"body\": {\"token\": \"tok_d4010a6f_JI2IHRBTlqfpIoqKR9KW1mJ8\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:04.549963Z", "level": "INFO", "logger": "provider", "message": "[verify_credentials] Verifying token for payer: usr_ee3014bbc51f4156", "module": "provider", "function": "verify_credentials", "line": 1572}
ap2_credential_provider    | {"timestamp": "2025-11-01T11:46:04.551263Z", "level": "INFO", "logger": "provider", "message": "[verify_credentials] Token verified: payment_method_id=pm_e6367cd7, user_id=usr_ee3014bbc51f4156", "module": "provider", "function": "verify_credentials", "line": 1609}
ap2_credential_provider    | INFO:     172.18.0.9:59942 - "POST /credentials/verify HTTP/1.1" 200 OK
ap2_payment_processor      | [2025-11-01 11:46:04,557] INFO in httpx: HTTP Request: POST http://credential_provider:8003/credentials/verify "HTTP/1.1 200 OK"
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.560573Z", "level": "INFO", "logger": "processor", "message": "HTTP Response: 200 (36.73ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.560828Z", "level": "DEBUG", "logger": "processor", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:46:03 GMT\", \"server\": \"uvicorn\", \"content-length\": \"186\", \"content-type\": \"application/json\"}, \"body\": {\"verified\": true, \"credential_info\": {\"payment_method_id\": \"pm_e6367cd7\", \"type\": \"basic-card\", \"brand\": \"Visa\", \"last4\": \"1111\", \"holder_name\": \"Unknown\", \"expiry_month\": \"03\", \"expiry_year\": \"2029\"}}, \"duration_ms\": 36.728858947753906}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.560947Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Credential verification succeeded: payment_method_id=pm_e6367cd7", "module": "processor", "function": "_verify_credential_with_cp", "line": 911}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.560981Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Credential verified: pm_e6367cd7", "module": "processor", "function": "_process_payment_mock", "line": 784}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.561009Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Risk assessment: score=2, indicators=[]", "module": "processor", "function": "_process_payment_mock", "line": 799}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.561056Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Payment succeeded: txn_bb0bc4534f0e, amount={'value': 5940.0, 'currency': 'JPY'}, risk_score=2", "module": "processor", "function": "_process_payment_mock", "line": 833}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.637662Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Transaction saved: txn_bb0bc4534f0e", "module": "processor", "function": "_save_transaction", "line": 860}
ap2_payment_processor      | [2025-11-01 11:46:04,951] INFO in v2.common.receipt_generator: [ReceiptGenerator] Generating PDF receipt for transaction: txn_bb0bc4534f0e
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.950979Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Generated user name for receipt: User usr_ee30 (payer_id: usr_ee3014bbc51f4156)", "module": "processor", "function": "_generate_receipt", "line": 1061}
ap2_payment_processor      | [2025-11-01 11:46:04,955] INFO in v2.common.receipt_generator: [ReceiptGenerator] PDF receipt generated successfully
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.956113Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Generated receipt PDF: /app/v2/data/receipts/txn_bb0bc4534f0e.pdf", "module": "processor", "function": "_generate_receipt", "line": 1080}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.961333Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Receipt record saved to database: txn_bb0bc4534f0e", "module": "processor", "function": "_generate_receipt", "line": 1099}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.961528Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Sending receipt notification to Credential Provider: transaction_id=txn_bb0bc4534f0e, payer_id=usr_ee3014bbc51f4156", "module": "processor", "function": "_send_receipt_to_credential_provider", "line": 940}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.961679Z", "level": "INFO", "logger": "processor", "message": "HTTP Request: POST http://credential_provider:8003/receipts", "module": "logger", "function": "log_http_request", "line": 182}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.961705Z", "level": "DEBUG", "logger": "processor", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/receipts\", \"headers\": {}, \"body\": {\"transaction_id\": \"txn_bb0bc4534f0e\", \"receipt_url\": \"http://localhost:8004/receipts/txn_bb0bc4534f0e.pdf\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"amount\": {\"value\": 5940.0, \"currency\": \"JPY\"}, \"timestamp\": \"2025-11-01T11:46:04.961658Z\"}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | [2025-11-01 11:46:04,970] INFO in services.credential_provider.utils.receipt_helpers: [CredentialProvider] Receipt received and stored to DB: transaction_id=txn_bb0bc4534f0e, payer_id=usr_ee3014bbc51f4156, receipt_url=http://localhost:8004/receipts/txn_bb0bc4534f0e.pdf
ap2_credential_provider    | INFO:     172.18.0.9:59942 - "POST /receipts HTTP/1.1" 200 OK
ap2_payment_processor      | [2025-11-01 11:46:04,971] INFO in httpx: HTTP Request: POST http://credential_provider:8003/receipts "HTTP/1.1 200 OK"
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.971308Z", "level": "INFO", "logger": "processor", "message": "HTTP Response: 200 (9.61ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.971344Z", "level": "DEBUG", "logger": "processor", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:46:04 GMT\", \"server\": \"uvicorn\", \"content-length\": \"97\", \"content-type\": \"application/json\"}, \"body\": {\"status\": \"received\", \"message\": \"Receipt stored successfully\", \"transaction_id\": \"txn_bb0bc4534f0e\"}, \"duration_ms\": 9.609699249267578}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.971406Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Receipt notification sent successfully: transaction_id=txn_bb0bc4534f0e, status=200", "module": "processor", "function": "_send_receipt_to_credential_provider", "line": 971}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.971442Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2A処理] ハンドラー完了: type=ap2.mandates.PaymentMandate, result_type=ap2.responses.PaymentResult", "module": "a2a_handler", "function": "handle_message", "line": 313}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.972218Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: payment_processor, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 1009}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.972279Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 521, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.responses.PaymentResult\",\"id\":\"458b6b66-2906-4b44-aa15-db2f04d8e730\",\"payload\":{\"receipt_url\":\"http://localhost:8004/receipts/txn_bb0bc4534f0e.pdf\",\"status\":\"captured\",\"trans", "module": "crypto", "function": "sign_a2a_message", "line": 1013}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.972321Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: payment_processor, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 808}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.972803Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: payment_processor) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.973943Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:merchant_agent: ap2.responses.PaymentResult", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_payment_processor      | [2025-11-01 11:46:04,973] INFO in v2.common.base_agent: [Payment Processor] A2Aレスポンス返却: type=ap2.responses.PaymentResult, to=did:ap2:agent:merchant_agent
ap2_payment_processor      | {"timestamp": "2025-11-01T11:46:04.973971Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.responses.PaymentResult\", \"peer\": \"did:ap2:agent:merchant_agent\", \"headers\": {\"message_id\": \"a8c29ba6-d8f7-4644-9e25-9dd3dee12bce\", \"sender\": \"did:ap2:agent:payment_processor\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-01T11:46:04.971489Z\", \"nonce\": \"7074597d08e994c98b287e9a224e300a1bb773da7a939960f3666cf1b6a355c5\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"transaction_id\": \"txn_bb0bc4534f0e\", \"status\": \"captured\", \"receipt_url\": \"http://localhost:8004/receipts/txn_bb0bc4534f0e.pdf\"}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_payment_processor      | INFO:     172.18.0.8:33852 - "POST /a2a/message HTTP/1.1" 200 OK

ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.979876Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (860.70ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.977926Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (831.63ms)", "module": "logger", "function": "log_http_response", "line": 215}


ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.977991Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:46:03 GMT\", \"server\": \"uvicorn\", \"content-length\": \"896\", \"content-type\": \"application/json\"}, \"body\": {\"header\": {\"message_id\": \"a8c29ba6-d8f7-4644-9e25-9dd3dee12bce\", \"sender\": \"did:ap2:agent:payment_processor\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-01T11:46:04.971489Z\", \"nonce\": \"7074597d08e994c98b287e9a224e300a1bb773da7a939960f3666cf1b6a355c5\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"m83J+Mq/ByDtHWKVdjxQwWaBYnWyvWV5fVnQ/C7/HTisAZ9M7fmgpQv4h9B4mCRH6yPf8qqmUnvV9InuqOwNBQ==\", \"publicKeyMultibase\": \"z6Mko4dSjEbxTFHbrjrLZA8U9aRyHt4Y4rSHrqH2bgRN8mig\", \"kid\": \"did:ap2:agent:payment_processor#key-2\", \"created\": \"2025-11-01T11:46:04.971489Z\", \"proofPurpose\": \"authentication\"}, \"signature\": null}, \"dataPart\": {\"@type\": \"ap2.responses.PaymentResult\", \"id\": \"458b6b66-2906-4b44-aa15-db2f04d8e730\", \"payload\": {\"transaction_id\": \"txn_bb0bc4534f0e\", \"status\": \"captured\", \"receipt_url\": \"http://localhost:8004/receipts/txn_bb0bc4534f0e.pdf\"}, \"kind\": null, \"artifact\": null}}, \"duration_ms\": 831.6268920898438}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:04.979952Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 11:46:03 GMT\", \"server\": \"uvicorn\", \"content-length\": \"890\", \"content-type\": \"application/json\"}, \"body\": {\"header\": {\"message_id\": \"80b2b162-56d7-4733-88ea-fb037072d041\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:shopping_agent\", \"timestamp\": \"2025-11-01T11:46:04.978217Z\", \"nonce\": \"e8eeecc46252d9146af7ffad9c6cf835699bab39f631164c1a1b677202c4fe78\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"MPDY38hpeIZTdl33DgHX14sCKcUGIy2AiIGHl35jrSMot8KR4O/hmPALAhwrh4QhvsZLQIHACGWU80TeDbzGBg==\", \"publicKeyMultibase\": \"z6Mkv6MrdvEm5xDgUibhZgtv2ucmKugzjG8jNKJzUnkgxAve\", \"kid\": \"did:ap2:agent:merchant_agent#key-2\", \"created\": \"2025-11-01T11:46:04.978217Z\", \"proofPurpose\": \"authentication\"}, \"signature\": null}, \"dataPart\": {\"@type\": \"ap2.responses.PaymentResult\", \"id\": \"458b6b66-2906-4b44-aa15-db2f04d8e730\", \"payload\": {\"transaction_id\": \"txn_bb0bc4534f0e\", \"status\": \"captured\", \"receipt_url\": \"http://localhost:8004/receipts/txn_bb0bc4534f0e.pdf\"}, \"kind\": null, \"artifact\": null}}, \"duration_ms\": 860.6994152069092}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.978114Z", "level": "INFO", "logger": "handlers.payment_handler", "message": "\n================================================================================\n[MerchantAgent ← PaymentProcessor] A2Aレスポンス受信\n  Status: 200\n  Response Body: {\n  \"header\": {\n    \"message_id\": \"a8c29ba6-d8f7-4644-9e25-9dd3dee12bce\",\n    \"sender\": \"did:ap2:agent:payment_processor\",\n    \"recipient\": \"did:ap2:agent:merchant_agent\",\n    \"timestamp\": \"2025-11-01T11:46:04.971489Z\",\n    \"nonce\": \"7074597d08e994c98b287e9a224e300a1bb773da7a939960f3666cf1b6a355c5\",\n    \"schema_version\": \"0.2\",\n    \"proof\": {\n      \"algorithm\": \"ed25519\",\n      \"signatureValue\": \"m83J+Mq/ByDtHWKVdjxQwWaBYnWyvWV5fVnQ/C7/HTisAZ9M7fmgpQv4h9B4mCRH6yPf8qqmUnvV9InuqOwNBQ==\",\n      \"publicKeyMultibase\": \"z6Mko4dSjEbxTFHbrjrLZA8U9aRyHt4Y4rSHrqH2bgRN8mig\",\n      \"kid\": \"did:ap2:agent:payment_processor#key-2\",\n      \"created\": \"2025-11-01T11:46:04.971489Z\",\n      \"proofPurpose\": \"authentication\"\n    },\n    \"signature\": null\n  },\n  \"dataPart\": {\n    \"@type\": \"ap2.responses.PaymentResult\",\n    \"id\": \"458b6b66-2906-4b44-aa15-db2f04d8e730\",\n    \"payload\": {\n      \"transaction_id\": \"txn_bb0bc4534f0e\",\n      \"status\": \"captured\",\n      \"receipt_url\": \"http://localhost:8004/receipts/txn_bb0bc4534f0e.pdf\"\n    },\n    \"kind\": null,\n    \"artifact\": null\n  }\n}\n================================================================================", "module": "payment_handler", "function": "handle_payment_request", "line": 86}
ap2_shopping_agent         | [2025-11-01 11:46:04,980] INFO in services.shopping_agent.utils.merchant_integration:


ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.978143Z", "level": "INFO", "logger": "handlers.payment_handler", "message": "[MerchantAgent] Payment processing completed, forwarding result to Shopping Agent", "module": "payment_handler", "function": "handle_payment_request", "line": 101}
ap2_shopping_agent         | ================================================================================


ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.978187Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2A処理] ハンドラー完了: type=ap2.mandates.PaymentMandate, result_type=ap2.responses.PaymentResult", "module": "a2a_handler", "function": "handle_message", "line": 313}
ap2_shopping_agent         | [ShoppingAgent ← MerchantAgent] A2Aレスポンス受信
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.978288Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 1009}
ap2_shopping_agent         |   Status: 200


ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.978351Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 518, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.responses.PaymentResult\",\"id\":\"458b6b66-2906-4b44-aa15-db2f04d8e730\",\"payload\":{\"receipt_url\":\"http://localhost:8004/receipts/txn_bb0bc4534f0e.pdf\",\"status\":\"captured\",\"trans", "module": "crypto", "function": "sign_a2a_message", "line": 1013}
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.978370Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 808}
ap2_shopping_agent         |   Response Type: ap2.responses.PaymentResult
ap2_shopping_agent         | ================================================================================

ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.978520Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: merchant_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}


ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.978550Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:shopping_agent: ap2.responses.PaymentResult", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_shopping_agent         | [2025-11-01 11:46:04,980] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Payment processing completed: status=captured
ap2_merchant_agent         | {"timestamp": "2025-11-01T11:46:04.978571Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.responses.PaymentResult\", \"peer\": \"did:ap2:agent:shopping_agent\", \"headers\": {\"message_id\": \"80b2b162-56d7-4733-88ea-fb037072d041\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:shopping_agent\", \"timestamp\": \"2025-11-01T11:46:04.978217Z\", \"nonce\": \"e8eeecc46252d9146af7ffad9c6cf835699bab39f631164c1a1b677202c4fe78\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"transaction_id\": \"txn_bb0bc4534f0e\", \"status\": \"captured\", \"receipt_url\": \"http://localhost:8004/receipts/txn_bb0bc4534f0e.pdf\"}}", "module": "logger", "function": "log_a2a_message", "line": 262}


ap2_shopping_agent         | [2025-11-01 11:46:04,980] INFO in services.shopping_agent.langgraph_shopping_flow: [execute_payment_node] Payment successful: status=captured, transaction_id=txn_bb0bc4534f0e
ap2_merchant_agent         | [2025-11-01 11:46:04,978] INFO in v2.common.base_agent: [Merchant Agent] A2Aレスポンス返却: type=ap2.responses.PaymentResult, to=did:ap2:agent:shopping_agent
ap2_merchant_agent         | INFO:     172.18.0.6:51392 - "POST /a2a/message HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:05.025731Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=completed", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T11:46:05.029782Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761997291639_abefr, step=completed", "module": "agent", "function": "_update_session", "line": 1978}
