(anaconda3-2023.09-0) kagadminmac% docker compose up                                                                                                       [~/project/ap2/v2][v2]
WARN[0000] /Users/kagadminmac/project/ap2/v2/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion
Attaching to ap2_credential_provider, ap2_frontend, ap2_init_keys, ap2_merchant, ap2_merchant_agent, ap2_payment_network, ap2_payment_processor, ap2_shopping_agent
ap2_init_keys  | ================================================================================
ap2_init_keys  | AP2 エージェント キーペア初期化
ap2_init_keys  | ================================================================================
ap2_init_keys  |
ap2_init_keys  | キー保存先: /app/v2/keys
ap2_init_keys  | DID Document保存先: /app/v2/data/did_documents
ap2_init_keys  |
ap2_init_keys  | [Shopping Agent]
ap2_init_keys  |   ℹ️  既存の鍵とDID Documentが見つかりました（スキップ）
ap2_init_keys  |      DID: did:ap2:agent:shopping_agent
ap2_init_keys  |
ap2_init_keys  | [Merchant Agent]
ap2_init_keys  |   ℹ️  既存の鍵とDID Documentが見つかりました（スキップ）
ap2_init_keys  |      DID: did:ap2:agent:merchant_agent
ap2_init_keys  |
ap2_init_keys  | [Merchant]
ap2_init_keys  |   ℹ️  既存の鍵とDID Documentが見つかりました（スキップ）
ap2_init_keys  |      DID: did:ap2:merchant:mugibo_merchant
ap2_init_keys  |
ap2_init_keys  | [Credential Provider]
ap2_init_keys  |   ℹ️  既存の鍵とDID Documentが見つかりました（スキップ）
ap2_init_keys  |      DID: did:ap2:cp:demo_cp
ap2_init_keys  |
ap2_init_keys  | [Payment Processor]
ap2_init_keys  |   ℹ️  既存の鍵とDID Documentが見つかりました（スキップ）
ap2_init_keys  |      DID: did:ap2:agent:payment_processor
ap2_init_keys  |
ap2_init_keys  | ================================================================================
ap2_init_keys  | ✅ 全エージェントの初期化が完了しました
ap2_init_keys  | ================================================================================
ap2_init_keys  |
ap2_init_keys  | 次のステップ:
ap2_init_keys  |   1. docker-compose up -d でサービスを起動
ap2_init_keys  |   2. 各エージェントはキーを永続化ストレージから読み込みます
ap2_init_keys  |   3. DIDは再起動後も一貫して維持されます
ap2_init_keys  |
ap2_init_keys exited with code 0
ap2_payment_network  | [2025-10-20 23:53:34,972] INFO in network: [DemoPaymentNetwork] Payment Network Service initialized
ap2_payment_network  | [2025-10-20 23:53:34,983] INFO in network: [DemoPaymentNetwork] Payment Network Service initialized
ap2_payment_network  | INFO:     Started server process [1]
ap2_payment_network  | INFO:     Waiting for application startup.
ap2_payment_network  | INFO:     Application startup complete.
ap2_payment_network  | INFO:     Uvicorn running on http://0.0.0.0:8005 (Press CTRL+C to quit)
ap2_frontend         |    ▲ Next.js 15.5.5
ap2_frontend         |    - Local:        http://localhost:3000
ap2_frontend         |    - Network:      http://0.0.0.0:3000
ap2_frontend         |
ap2_frontend         |  ✓ Starting...
ap2_shopping_agent   | {"timestamp": "2025-10-20T23:53:36.339876Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: shopping_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_shopping_agent   | {"timestamp": "2025-10-20T23:53:36.342631Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_shopping_agent   | {"timestamp": "2025-10-20T23:53:36.342908Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: shopping_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_shopping_agent   | [2025-10-20 23:53:36,342] INFO in v2.common.base_agent: [Shopping Agent] ✓ ECDSA鍵を読み込みました: shopping_agent
ap2_shopping_agent   | {"timestamp": "2025-10-20T23:53:36.343548Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_shopping_agent   | [2025-10-20 23:53:36,343] INFO in v2.common.base_agent: [Shopping Agent] ✓ Ed25519鍵を読み込みました: shopping_agent
ap2_shopping_agent   | [2025-10-20 23:53:36,343] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_shopping_agent   | [2025-10-20 23:53:36,343] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_shopping_agent   | [2025-10-20 23:53:36,343] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_shopping_agent   | [2025-10-20 23:53:36,343] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_shopping_agent   | [2025-10-20 23:53:36,343] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_shopping_agent   | [2025-10-20 23:53:36,343] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_shopping_agent   | [2025-10-20 23:53:36,343] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_shopping_agent   | [2025-10-20 23:53:36,344] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_shopping_agent   | [2025-10-20 23:53:36,344] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_shopping_agent   | [2025-10-20 23:53:36,344] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_shopping_agent   | [2025-10-20 23:53:36,344] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.mandates.CartMandate
ap2_shopping_agent   | [2025-10-20 23:53:36,344] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.responses.ProductList
ap2_shopping_agent   | [2025-10-20 23:53:36,344] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.responses.SignatureResponse
ap2_shopping_agent   | [2025-10-20 23:53:36,348] INFO in v2.common.base_agent: [Shopping Agent] Initialized: did:ap2:agent:shopping_agent
ap2_shopping_agent   | [2025-10-20 23:53:36,399] INFO in v2.common.risk_assessment: [RiskAssessmentEngine] Initialized (database_mode=enabled)
ap2_shopping_agent   | {"timestamp": "2025-10-20T23:53:36.399552Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] Initialized with database-backed risk assessment", "module": "agent", "function": "__init__", "line": 122}
ap2_frontend         |  ✓ Ready in 117ms
ap2_credential_provider  | {"timestamp": "2025-10-20T23:53:36.418520Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: credential_provider (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:53:36.420910Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:53:36.420990Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: credential_provider (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:53:36.421514Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_credential_provider  | [2025-10-20 23:53:36,420] INFO in v2.common.base_agent: [Credential Provider] ✓ ECDSA鍵を読み込みました: credential_provider
ap2_credential_provider  | [2025-10-20 23:53:36,421] INFO in v2.common.base_agent: [Credential Provider] ✓ Ed25519鍵を読み込みました: credential_provider
ap2_credential_provider  | [2025-10-20 23:53:36,421] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_credential_provider  | [2025-10-20 23:53:36,421] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_credential_provider  | [2025-10-20 23:53:36,421] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_credential_provider  | [2025-10-20 23:53:36,421] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_credential_provider  | [2025-10-20 23:53:36,421] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_credential_provider  | [2025-10-20 23:53:36,421] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_credential_provider  | [2025-10-20 23:53:36,421] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_credential_provider  | [2025-10-20 23:53:36,422] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_credential_provider  | [2025-10-20 23:53:36,422] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_credential_provider  | [2025-10-20 23:53:36,422] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_credential_provider  | [2025-10-20 23:53:36,422] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate
ap2_credential_provider  | [2025-10-20 23:53:36,422] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.requests.AttestationRequest
ap2_credential_provider  | [2025-10-20 23:53:36,432] INFO in v2.common.base_agent: [Credential Provider] Initialized: did:ap2:agent:credential_provider
ap2_payment_processor    | {"timestamp": "2025-10-20T23:53:36.428466Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: payment_processor (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_payment_processor    | [2025-10-20 23:53:36,434] INFO in v2.common.base_agent: [Payment Processor] ✓ ECDSA鍵を読み込みました: payment_processor
ap2_payment_processor    | {"timestamp": "2025-10-20T23:53:36.434811Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_payment_processor    | {"timestamp": "2025-10-20T23:53:36.434981Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: payment_processor (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_payment_processor    | [2025-10-20 23:53:36,436] INFO in v2.common.base_agent: [Payment Processor] ✓ Ed25519鍵を読み込みました: payment_processor
ap2_payment_processor    | {"timestamp": "2025-10-20T23:53:36.436689Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_payment_processor    | [2025-10-20 23:53:36,437] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_payment_processor    | [2025-10-20 23:53:36,439] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_payment_processor    | [2025-10-20 23:53:36,439] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_payment_processor    | [2025-10-20 23:53:36,440] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_payment_processor    | [2025-10-20 23:53:36,440] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_payment_processor    | [2025-10-20 23:53:36,440] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_payment_processor    | [2025-10-20 23:53:36,440] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_payment_processor    | [2025-10-20 23:53:36,440] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_payment_processor    | [2025-10-20 23:53:36,440] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_payment_processor    | [2025-10-20 23:53:36,440] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_payment_processor    | [2025-10-20 23:53:36,440] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate
ap2_payment_processor    | [2025-10-20 23:53:36,443] INFO in v2.common.base_agent: [Payment Processor] Initialized: did:ap2:agent:payment_processor
ap2_shopping_agent       | [2025-10-20 23:53:36,447] INFO in v2.common.base_agent: [Shopping Agent] ✓ ECDSA鍵を読み込みました: shopping_agent
ap2_shopping_agent       | [2025-10-20 23:53:36,447] INFO in v2.common.base_agent: [Shopping Agent] ✓ Ed25519鍵を読み込みました: shopping_agent
ap2_shopping_agent       | [2025-10-20 23:53:36,447] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_shopping_agent       | [2025-10-20 23:53:36,447] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_shopping_agent       | [2025-10-20 23:53:36,447] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_shopping_agent       | [2025-10-20 23:53:36,447] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_shopping_agent       | [2025-10-20 23:53:36,447] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_shopping_agent       | [2025-10-20 23:53:36,447] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_shopping_agent       | [2025-10-20 23:53:36,447] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_shopping_agent       | [2025-10-20 23:53:36,447] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_shopping_agent       | [2025-10-20 23:53:36,447] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_shopping_agent       | [2025-10-20 23:53:36,447] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_shopping_agent       | [2025-10-20 23:53:36,447] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.mandates.CartMandate
ap2_shopping_agent       | [2025-10-20 23:53:36,447] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.responses.ProductList
ap2_shopping_agent       | [2025-10-20 23:53:36,447] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.responses.SignatureResponse
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:36.444727Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: shopping_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:36.447069Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:36.447159Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: shopping_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:36.447437Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_shopping_agent       | [2025-10-20 23:53:36,452] INFO in v2.common.base_agent: [Shopping Agent] Initialized: did:ap2:agent:shopping_agent
ap2_credential_provider  | {"timestamp": "2025-10-20T23:53:36.447527Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Initialized", "module": "provider", "function": "__init__", "line": 129}
ap2_shopping_agent       | [2025-10-20 23:53:36,465] INFO in v2.common.risk_assessment: [RiskAssessmentEngine] Initialized (database_mode=enabled)
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:36.465572Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] Initialized with database-backed risk assessment", "module": "agent", "function": "__init__", "line": 122}
ap2_shopping_agent       | INFO:     Started server process [1]
ap2_shopping_agent       | INFO:     Waiting for application startup.
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:36.467791Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] Running startup tasks...", "module": "agent", "function": "startup_event", "line": 116}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:53:36.479074Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: credential_provider (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_credential_provider  | [2025-10-20 23:53:36,479] INFO in v2.common.base_agent: [Credential Provider] ✓ ECDSA鍵を読み込みました: credential_provider
ap2_credential_provider  | {"timestamp": "2025-10-20T23:53:36.479478Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:53:36.479546Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: credential_provider (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:53:36.479850Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_credential_provider  | [2025-10-20 23:53:36,479] INFO in v2.common.base_agent: [Credential Provider] ✓ Ed25519鍵を読み込みました: credential_provider
ap2_credential_provider  | [2025-10-20 23:53:36,479] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_credential_provider  | [2025-10-20 23:53:36,480] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_credential_provider  | [2025-10-20 23:53:36,480] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_credential_provider  | [2025-10-20 23:53:36,480] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_credential_provider  | [2025-10-20 23:53:36,480] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_credential_provider  | [2025-10-20 23:53:36,480] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_credential_provider  | [2025-10-20 23:53:36,480] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_credential_provider  | [2025-10-20 23:53:36,480] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_credential_provider  | [2025-10-20 23:53:36,480] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_credential_provider  | [2025-10-20 23:53:36,480] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_credential_provider  | [2025-10-20 23:53:36,480] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate
ap2_credential_provider  | [2025-10-20 23:53:36,480] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.requests.AttestationRequest
ap2_credential_provider  | [2025-10-20 23:53:36,484] INFO in v2.common.base_agent: [Credential Provider] Initialized: did:ap2:agent:credential_provider
ap2_credential_provider  | {"timestamp": "2025-10-20T23:53:36.484372Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Initialized", "module": "provider", "function": "__init__", "line": 129}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:53:36.485618Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Running startup tasks...", "module": "provider", "function": "startup_event", "line": 123}
ap2_credential_provider  | INFO:     Started server process [1]
ap2_credential_provider  | INFO:     Waiting for application startup.
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:36.483177Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] Database initialized", "module": "agent", "function": "startup_event", "line": 120}
ap2_shopping_agent       | INFO:     Application startup complete.
ap2_payment_processor    | {"timestamp": "2025-10-20T23:53:36.490202Z", "level": "INFO", "logger": "processor", "message": "[Payment Processor] Initialized", "module": "processor", "function": "__init__", "line": 75}
ap2_shopping_agent       | INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
ap2_credential_provider  | {"timestamp": "2025-10-20T23:53:36.502126Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Database initialized", "module": "provider", "function": "startup_event", "line": 127}
ap2_credential_provider  | INFO:     Application startup complete.
ap2_credential_provider  | INFO:     Uvicorn running on http://0.0.0.0:8003 (Press CTRL+C to quit)
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:53:36.507550Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: merchant_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_merchant_agent       | [2025-10-20 23:53:36,509] INFO in v2.common.base_agent: [Merchant Agent] ✓ ECDSA鍵を読み込みました: merchant_agent
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:53:36.509689Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:53:36.509833Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: merchant_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_merchant_agent       | [2025-10-20 23:53:36,510] INFO in v2.common.base_agent: [Merchant Agent] ✓ Ed25519鍵を読み込みました: merchant_agent
ap2_merchant_agent       | [2025-10-20 23:53:36,510] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_merchant_agent       | [2025-10-20 23:53:36,510] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_merchant_agent       | [2025-10-20 23:53:36,510] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant_agent       | [2025-10-20 23:53:36,510] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_merchant_agent       | [2025-10-20 23:53:36,510] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_merchant_agent       | [2025-10-20 23:53:36,510] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_merchant_agent       | [2025-10-20 23:53:36,510] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_merchant_agent       | [2025-10-20 23:53:36,510] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_merchant_agent       | [2025-10-20 23:53:36,510] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant_agent       | [2025-10-20 23:53:36,510] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_merchant_agent       | [2025-10-20 23:53:36,510] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.mandates.IntentMandate
ap2_merchant_agent       | [2025-10-20 23:53:36,510] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.requests.ProductSearch
ap2_merchant_agent       | [2025-10-20 23:53:36,510] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.requests.CartRequest
ap2_merchant_agent       | [2025-10-20 23:53:36,510] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:53:36.510341Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_merchant_agent       | [2025-10-20 23:53:36,518] INFO in v2.common.base_agent: [Merchant Agent] Initialized: did:ap2:agent:merchant_agent
ap2_payment_processor    | {"timestamp": "2025-10-20T23:53:36.516627Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: payment_processor (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_payment_processor    | {"timestamp": "2025-10-20T23:53:36.517164Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_payment_processor    | {"timestamp": "2025-10-20T23:53:36.517246Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: payment_processor (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_payment_processor    | [2025-10-20 23:53:36,517] INFO in v2.common.base_agent: [Payment Processor] ✓ ECDSA鍵を読み込みました: payment_processor
ap2_payment_processor    | {"timestamp": "2025-10-20T23:53:36.517570Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_payment_processor    | [2025-10-20 23:53:36,517] INFO in v2.common.base_agent: [Payment Processor] ✓ Ed25519鍵を読み込みました: payment_processor
ap2_payment_processor    | [2025-10-20 23:53:36,517] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_payment_processor    | [2025-10-20 23:53:36,517] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_payment_processor    | [2025-10-20 23:53:36,518] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_payment_processor    | [2025-10-20 23:53:36,519] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_payment_processor    | [2025-10-20 23:53:36,519] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_payment_processor    | [2025-10-20 23:53:36,519] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_payment_processor    | [2025-10-20 23:53:36,519] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_payment_processor    | [2025-10-20 23:53:36,519] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_payment_processor    | [2025-10-20 23:53:36,519] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_payment_processor    | [2025-10-20 23:53:36,519] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_payment_processor    | [2025-10-20 23:53:36,519] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate
ap2_payment_processor    | [2025-10-20 23:53:36,524] INFO in v2.common.base_agent: [Payment Processor] Initialized: did:ap2:agent:payment_processor
ap2_merchant             | {"timestamp": "2025-10-20T23:53:36.533328Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: merchant (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_payment_processor    | {"timestamp": "2025-10-20T23:53:36.534062Z", "level": "INFO", "logger": "processor", "message": "[Payment Processor] Initialized", "module": "processor", "function": "__init__", "line": 75}
ap2_payment_processor    | {"timestamp": "2025-10-20T23:53:36.534573Z", "level": "INFO", "logger": "processor", "message": "[Payment Processor] Running startup tasks...", "module": "processor", "function": "startup_event", "line": 69}
ap2_payment_processor    | INFO:     Started server process [1]
ap2_payment_processor    | INFO:     Waiting for application startup.
ap2_merchant             | [2025-10-20 23:53:36,535] INFO in v2.common.base_agent: [Merchant] ✓ ECDSA鍵を読み込みました: merchant
ap2_merchant             | {"timestamp": "2025-10-20T23:53:36.535460Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_merchant             | {"timestamp": "2025-10-20T23:53:36.535598Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: merchant (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_merchant             | {"timestamp": "2025-10-20T23:53:36.537073Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_merchant             | [2025-10-20 23:53:36,537] INFO in v2.common.base_agent: [Merchant] ✓ Ed25519鍵を読み込みました: merchant
ap2_merchant             | [2025-10-20 23:53:36,537] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_merchant             | [2025-10-20 23:53:36,537] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_merchant             | [2025-10-20 23:53:36,537] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant             | [2025-10-20 23:53:36,537] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_merchant             | [2025-10-20 23:53:36,537] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_merchant             | [2025-10-20 23:53:36,537] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_merchant             | [2025-10-20 23:53:36,537] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_merchant             | [2025-10-20 23:53:36,537] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_merchant             | [2025-10-20 23:53:36,537] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant             | [2025-10-20 23:53:36,537] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_merchant             | [2025-10-20 23:53:36,537] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.mandates.CartMandate
ap2_merchant             | [2025-10-20 23:53:36,544] INFO in v2.common.base_agent: [Merchant] Initialized: did:ap2:merchant
ap2_payment_processor    | {"timestamp": "2025-10-20T23:53:36.548167Z", "level": "INFO", "logger": "processor", "message": "[Payment Processor] Database initialized", "module": "processor", "function": "startup_event", "line": 73}
ap2_payment_processor    | INFO:     Application startup complete.
ap2_payment_processor    | INFO:     Uvicorn running on http://0.0.0.0:8004 (Press CTRL+C to quit)
ap2_merchant             | {"timestamp": "2025-10-20T23:53:36.557400Z", "level": "INFO", "logger": "service", "message": "[Merchant] Initialized", "module": "service", "function": "__init__", "line": 82}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:53:36.562023Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Initialized", "module": "agent", "function": "__init__", "line": 87}
ap2_merchant             | {"timestamp": "2025-10-20T23:53:36.573781Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: merchant (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_merchant             | {"timestamp": "2025-10-20T23:53:36.574131Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_merchant             | [2025-10-20 23:53:36,574] INFO in v2.common.base_agent: [Merchant] ✓ ECDSA鍵を読み込みました: merchant
ap2_merchant             | {"timestamp": "2025-10-20T23:53:36.574194Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: merchant (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_merchant             | [2025-10-20 23:53:36,574] INFO in v2.common.base_agent: [Merchant] ✓ Ed25519鍵を読み込みました: merchant
ap2_merchant             | [2025-10-20 23:53:36,574] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_merchant             | {"timestamp": "2025-10-20T23:53:36.574659Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_merchant             | [2025-10-20 23:53:36,574] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_merchant             | [2025-10-20 23:53:36,574] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant             | [2025-10-20 23:53:36,574] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_merchant             | [2025-10-20 23:53:36,574] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_merchant             | [2025-10-20 23:53:36,574] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_merchant             | [2025-10-20 23:53:36,574] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_merchant             | [2025-10-20 23:53:36,574] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_merchant             | [2025-10-20 23:53:36,574] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant             | [2025-10-20 23:53:36,575] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_merchant             | [2025-10-20 23:53:36,575] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.mandates.CartMandate
ap2_merchant             | [2025-10-20 23:53:36,578] INFO in v2.common.base_agent: [Merchant] Initialized: did:ap2:merchant
ap2_merchant             | INFO:     Started server process [1]
ap2_merchant             | INFO:     Waiting for application startup.
ap2_merchant             | {"timestamp": "2025-10-20T23:53:36.578422Z", "level": "INFO", "logger": "service", "message": "[Merchant] Initialized", "module": "service", "function": "__init__", "line": 82}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:53:36.575606Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: merchant_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:53:36.575968Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:53:36.576012Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Loading private key: merchant_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 346}
ap2_merchant_agent       | [2025-10-20 23:53:36,575] INFO in v2.common.base_agent: [Merchant Agent] ✓ ECDSA鍵を読み込みました: merchant_agent
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:53:36.576277Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 368}
ap2_merchant_agent       | [2025-10-20 23:53:36,576] INFO in v2.common.base_agent: [Merchant Agent] ✓ Ed25519鍵を読み込みました: merchant_agent
ap2_merchant_agent       | [2025-10-20 23:53:36,576] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_merchant_agent       | [2025-10-20 23:53:36,576] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_merchant_agent       | [2025-10-20 23:53:36,576] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant_agent       | [2025-10-20 23:53:36,576] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_merchant_agent       | [2025-10-20 23:53:36,576] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_merchant_agent       | [2025-10-20 23:53:36,576] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_merchant_agent       | [2025-10-20 23:53:36,576] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_merchant_agent       | [2025-10-20 23:53:36,576] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_merchant_agent       | [2025-10-20 23:53:36,576] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant_agent       | [2025-10-20 23:53:36,576] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_merchant_agent       | [2025-10-20 23:53:36,576] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.mandates.IntentMandate
ap2_merchant_agent       | [2025-10-20 23:53:36,576] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.requests.ProductSearch
ap2_merchant_agent       | [2025-10-20 23:53:36,576] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.requests.CartRequest
ap2_merchant_agent       | [2025-10-20 23:53:36,576] INFO in v2.common.a2a_handler: [A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate


ap2_merchant             | {"timestamp": "2025-10-20T23:53:36.580852Z", "level": "INFO", "logger": "service", "message": "[Merchant] Running startup tasks...", "module": "service", "function": "startup_event", "line": 66}
ap2_merchant_agent       | [2025-10-20 23:53:36,578] INFO in v2.common.base_agent: [Merchant Agent] Initialized: did:ap2:agent:merchant_agent
ap2_merchant             | {"timestamp": "2025-10-20T23:53:36.593819Z", "level": "INFO", "logger": "service", "message": "[Merchant] Database initialized", "module": "service", "function": "startup_event", "line": 70}
ap2_merchant             |
ap2_merchant             | ============================================================
ap2_merchant             | 商品データ投入中...
ap2_merchant             | ============================================================
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:53:36.594095Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Initialized", "module": "agent", "function": "__init__", "line": 87}
ap2_merchant_agent       | INFO:     Started server process [1]
ap2_merchant_agent       | INFO:     Waiting for application startup.
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:53:36.595590Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Running startup tasks...", "module": "agent", "function": "startup_event", "line": 73}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:53:36.601248Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Database initialized", "module": "agent", "function": "startup_event", "line": 77}
ap2_merchant_agent       |
ap2_merchant_agent       | ============================================================
ap2_merchant_agent       | 商品データ投入中...
ap2_merchant_agent       | ============================================================
ap2_merchant             |   ⏭️  スキップ: むぎぼーアクリルキーホルダー (既存)
ap2_merchant             |   ⏭️  スキップ: むぎぼー時計 (既存)
ap2_merchant             |   ⏭️  スキップ: むぎぼーカレンダー (既存)
ap2_merchant             |   ⏭️  スキップ: むぎぼーマグカップ (既存)
ap2_merchant             |   ⏭️  スキップ: むぎぼーステッカー (既存)
ap2_merchant             |   ⏭️  スキップ: むぎぼーTシャツ (既存)
ap2_merchant             |   ⏭️  スキップ: むぎぼートートバッグ (既存)
ap2_merchant_agent       |   ⏭️  スキップ: むぎぼーアクリルキーホルダー (既存)
ap2_merchant             |   ⏭️  スキップ: むぎぼーポーチ (既存)
ap2_merchant_agent       |   ⏭️  スキップ: むぎぼー時計 (既存)
ap2_merchant             |
ap2_merchant             | ✅ 商品データ投入完了 (8件)
ap2_merchant             |
ap2_merchant             | ============================================================
ap2_merchant             | ユーザーデータ投入中...
ap2_merchant             | ============================================================
ap2_merchant             |   ⏭️  スキップ: 山田太郎 (既存)
ap2_merchant_agent       |   ⏭️  スキップ: むぎぼーカレンダー (既存)
ap2_merchant_agent       |   ⏭️  スキップ: むぎぼーマグカップ (既存)
ap2_merchant             |   ⏭️  スキップ: 佐藤花子 (既存)
ap2_merchant_agent       |   ⏭️  スキップ: むぎぼーステッカー (既存)
ap2_merchant             |
ap2_merchant             | ✅ ユーザーデータ投入完了 (2件)
ap2_merchant             | {"timestamp": "2025-10-20T23:53:36.620898Z", "level": "INFO", "logger": "service", "message": "[Merchant] Sample data seeded successfully", "module": "service", "function": "startup_event", "line": 78}
ap2_merchant             | INFO:     Application startup complete.
ap2_merchant_agent       |   ⏭️  スキップ: むぎぼーTシャツ (既存)
ap2_merchant_agent       |   ⏭️  スキップ: むぎぼートートバッグ (既存)
ap2_merchant             | INFO:     Uvicorn running on http://0.0.0.0:8002 (Press CTRL+C to quit)
ap2_merchant_agent       |   ⏭️  スキップ: むぎぼーポーチ (既存)
ap2_merchant_agent       |
ap2_merchant_agent       | ✅ 商品データ投入完了 (8件)
ap2_merchant_agent       |
ap2_merchant_agent       | ============================================================
ap2_merchant_agent       | ユーザーデータ投入中...
ap2_merchant_agent       | ============================================================
ap2_merchant_agent       |   ⏭️  スキップ: 山田太郎 (既存)
ap2_merchant_agent       |   ⏭️  スキップ: 佐藤花子 (既存)
ap2_merchant_agent       |
ap2_merchant_agent       | ✅ ユーザーデータ投入完了 (2件)
ap2_merchant_agent       | INFO:     Application startup complete.
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:53:36.632746Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Sample data seeded successfully", "module": "agent", "function": "startup_event", "line": 83}
ap2_merchant_agent       | INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
ap2_shopping_agent       | INFO:     151.101.64.223:56471 - "OPTIONS /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent       | INFO:     151.101.64.223:56471 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:42.040054Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Created new session in DB: session_1761004418388_4i4i8g", "module": "agent", "function": "_get_or_create_session", "line": 2603}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:42.564902Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761004418388_4i4i8g, step=ask_max_amount", "module": "agent", "function": "_update_session", "line": 2616}
ap2_shopping_agent       | INFO:     151.101.64.223:56471 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:44.701478Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761004418388_4i4i8g, step=ask_max_amount", "module": "agent", "function": "_get_or_create_session", "line": 2581}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:45.219557Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761004418388_4i4i8g, step=ask_categories", "module": "agent", "function": "_update_session", "line": 2616}
ap2_shopping_agent       | INFO:     151.101.64.223:42396 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:47.151937Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761004418388_4i4i8g, step=ask_categories", "module": "agent", "function": "_get_or_create_session", "line": 2581}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:47.676649Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761004418388_4i4i8g, step=ask_brands", "module": "agent", "function": "_update_session", "line": 2616}
ap2_shopping_agent       | INFO:     151.101.64.223:42396 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:48.259139Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761004418388_4i4i8g, step=ask_brands", "module": "agent", "function": "_get_or_create_session", "line": 2581}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:48.868229Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] User public key not available yet (will be provided by frontend): 公開鍵ファイルが見つかりません: /app/v2/keys/user_demo_001_public.pem", "module": "agent", "function": "_create_intent_mandate", "line": 2436}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:48.868727Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] IntentMandate created (unsigned, awaiting Passkey signature): id=intent_ef599409, max_amount=50000, categories=[], brands=[]", "module": "agent", "function": "_create_intent_mandate", "line": 2440}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:48.890459Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] IntentMandate persisted to DB: id=intent_ef599409, mandate_record_id=intent_ef599409", "module": "agent", "function": "_persist_intent_mandate", "line": 2475}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:53:49.417619Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761004418388_4i4i8g, step=shipping_address_input", "module": "agent", "function": "_update_session", "line": 2616}
ap2_merchant             | INFO:     151.101.64.223:36010 - "GET /transactions HTTP/1.1" 200 OK
ap2_merchant             | INFO:     151.101.64.223:26315 - "GET /cart-mandates/pending HTTP/1.1" 200 OK
ap2_shopping_agent       | INFO:     151.101.64.223:45000 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:27.527297Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761004418388_4i4i8g, step=shipping_address_input", "module": "agent", "function": "_get_or_create_session", "line": 2581}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:27.529077Z", "level": "INFO", "logger": "agent", "message": "[shipping_address_input] Received user_input: {\"recipient\":\"test太郎\",\"postal_code\":\"111-1111\",\"address_line1\":\"テスト県テスト市テスト町1-1-1\",\"address_line2\":\"テストアパート111\",\"phone\":\"010-1111-1111\"}", "module": "agent", "function": "_generate_fixed_response", "line": 1351}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:27.529290Z", "level": "INFO", "logger": "agent", "message": "[shipping_address_input] Parsed JSON shipping address: {'recipient': 'test太郎', 'postal_code': '111-1111', 'address_line1': 'テスト県テスト市テスト町1-1-1', 'address_line2': 'テストアパート111', 'phone': '010-1111-1111'}", "module": "agent", "function": "_generate_fixed_response", "line": 1356}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:28.541993Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Requesting cart candidates from Merchant Agent for IntentMandate: intent_ef599409", "module": "agent", "function": "_search_products_via_merchant_agent", "line": 2941}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:28.545793Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Signing A2A message (sender: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 800}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:28.554019Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "[SIGN] Canonical JSON length: 922, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.IntentMandate\",\"id\":\"intent_ef599409\",\"payload\":{\"intent_mandate\":{\"constraints\":{\"brands\":[],\"categories\":[],\"max_amount\":{\"currency\":\"JPY\",\"value\":\"50000.00\"},\"mer", "module": "crypto", "function": "sign_a2a_message", "line": 804}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:28.554236Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Signing data (key_id: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 599}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:28.563275Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Crypto SIGN: ED25519 (key: shopping_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 271}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:28.564835Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Intent A2A message created: message_id=d568cf61-8bc0-4128-b5f7-1c6b4ee4740d, intent_mandate_id=intent_ef599409", "module": "agent", "function": "_search_products_via_merchant_agent", "line": 2967}
ap2_shopping_agent       | [2025-10-20 23:54:28,564] INFO in v2.common.a2a_handler:
ap2_shopping_agent       | ================================================================================
ap2_shopping_agent       | [A2A送信] レスポンス作成
ap2_shopping_agent       |   送信元: did:ap2:agent:shopping_agent
ap2_shopping_agent       |   送信先: did:ap2:agent:merchant_agent
ap2_shopping_agent       |   タイプ: ap2.mandates.IntentMandate
ap2_shopping_agent       |   データID: intent_ef599409
ap2_shopping_agent       |   署名: あり
ap2_shopping_agent       |   タイムスタンプ: 2025-10-20T23:54:28.542530Z
ap2_shopping_agent       |   ペイロード: {
ap2_shopping_agent       |   "intent_mandate": {
ap2_shopping_agent       |     "id": "intent_ef599409",
ap2_shopping_agent       |     "type": "IntentMandate",
ap2_shopping_agent       |     "version": "0.2",
ap2_shopping_agent       |     "user_id": "user_demo_001",
ap2_shopping_agent       |     "intent": "むぎぼーのグッズが欲しい",
ap2_shopping_agent       |     "constraints": {
ap2_shopping_agent       |       "valid_until": "2025-10-21T00:53:48.866475Z",
ap2_shopping_agent       |       "max_amount": {
ap2_shopping_agent       |         "value": "50000.00",
ap2_shopping_agent       |         "currency": "JPY"
ap2_shopping_agent       |       },
ap2_shopping_agent       |       "categories": [],
ap2_shopping_agent       |       "merchants": [],
ap2_shopping_agent       |       "brands": []
ap2_shopping_agent       |     },
ap2_shopping_agent       |     "created_at": "2025-10-20T23:53:48.866475Z",
ap2_shopping_agent       |     "expires_at": "2025-10-21T00:53:48.866475Z",
ap2_shopping_agent       |     "user_public_key": null
ap2_shopping_agent       |   },
ap2_shopping_agent       |   "shipping_address": {
ap2_shopping_agent       |     "recipient": "test太郎",
ap2_shopping_agent       |     "postal_code": "111-1111",
ap2_shopping_agent       |     "address_line1": "テスト県テスト市テスト町1-1-1",
ap2_shopping_agent       |     "address_line2": "テストアパート111",
ap2_shopping_agent       |     "phone": "010-1111-1111"
ap2_shopping_agent       |   }
ap2_shopping_agent       | }
ap2_shopping_agent       | ================================================================================
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:28.564992Z", "level": "INFO", "logger": "agent", "message": "\n================================================================================\n[ShoppingAgent → MerchantAgent] A2Aメッセージ送信\n  URL: http://merchant_agent:8001/a2a/message\n  メッセージID: d568cf61-8bc0-4128-b5f7-1c6b4ee4740d\n  タイプ: ap2.mandates.IntentMandate\n  ペイロード: {\n  \"id\": \"intent_ef599409\",\n  \"type\": \"IntentMandate\",\n  \"version\": \"0.2\",\n  \"user_id\": \"user_demo_001\",\n  \"intent\": \"むぎぼーのグッズが欲しい\",\n  \"constraints\": {\n    \"valid_until\": \"2025-10-21T00:53:48.866475Z\",\n    \"max_amount\": {\n      \"value\": \"50000.00\",\n      \"currency\": \"JPY\"\n    },\n    \"categories\": [],\n    \"merchants\": [],\n    \"brands\": []\n  },\n  \"created_at\": \"2025-10-20T23:53:48.866475Z\",\n  \"expires_at\": \"2025-10-21T00:53:48.866475Z\",\n  \"user_public_key\": null\n}\n================================================================================", "module": "agent", "function": "_search_products_via_merchant_agent", "line": 2974}
ap2_merchant_agent       | [2025-10-20 23:54:28,582] INFO in v2.common.base_agent:
ap2_merchant_agent       | ================================================================================
ap2_merchant_agent       | [Merchant Agent] A2Aエンドポイント: POST /a2a/message
ap2_merchant_agent       |   受信メッセージ: ID=d568cf61-8bc0-4128-b5f7-1c6b4ee4740d
ap2_merchant_agent       |   送信元: did:ap2:agent:shopping_agent
ap2_merchant_agent       |   タイプ: ap2.mandates.IntentMandate
ap2_merchant_agent       | ================================================================================
ap2_merchant_agent       | [2025-10-20 23:54:28,583] INFO in v2.common.a2a_handler:
ap2_merchant_agent       | ================================================================================
ap2_merchant_agent       | [A2A受信] メッセージID: d568cf61-8bc0-4128-b5f7-1c6b4ee4740d
ap2_merchant_agent       |   送信元: did:ap2:agent:shopping_agent
ap2_merchant_agent       |   送信先: did:ap2:agent:merchant_agent
ap2_merchant_agent       |   タイプ: ap2.mandates.IntentMandate
ap2_merchant_agent       |   データID: intent_ef599409
ap2_merchant_agent       |   タイムスタンプ: 2025-10-20T23:54:28.542530Z
ap2_merchant_agent       |   ペイロード: {
ap2_merchant_agent       |   "intent_mandate": {
ap2_merchant_agent       |     "id": "intent_ef599409",
ap2_merchant_agent       |     "type": "IntentMandate",
ap2_merchant_agent       |     "version": "0.2",
ap2_merchant_agent       |     "user_id": "user_demo_001",
ap2_merchant_agent       |     "intent": "むぎぼーのグッズが欲しい",
ap2_merchant_agent       |     "constraints": {
ap2_merchant_agent       |       "valid_until": "2025-10-21T00:53:48.866475Z",
ap2_merchant_agent       |       "max_amount": {
ap2_merchant_agent       |         "value": "50000.00",
ap2_merchant_agent       |         "currency": "JPY"
ap2_merchant_agent       |       },
ap2_merchant_agent       |       "categories": [],
ap2_merchant_agent       |       "merchants": [],
ap2_merchant_agent       |       "brands": []
ap2_merchant_agent       |     },
ap2_merchant_agent       |     "created_at": "2025-10-20T23:53:48.866475Z",
ap2_merchant_agent       |     "expires_at": "2025-10-21T00:53:48.866475Z",
ap2_merchant_agent       |     "user_public_key": null
ap2_merchant_agent       |   },
ap2_merchant_agent       |   "shipping_address": {
ap2_merchant_agent       |     "recipient": "test太郎",
ap2_merchant_agent       |     "postal_code": "111-1111",
ap2_merchant_agent       |     "address_line1": "テスト県テスト市テスト町1-1-1",
ap2_merchant_agent       |     "address_line2": "テストアパート111",
ap2_merchant_agent       |     "phone": "010-1111-1111"
ap2_merchant_agent       |   }
ap2_merchant_agent       | }
ap2_merchant_agent       | ================================================================================
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.584296Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Verifying A2A message signature", "module": "crypto", "function": "verify_a2a_message_signature", "line": 828}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.586101Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "[VERIFY] Canonical JSON length: 922, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.IntentMandate\",\"id\":\"intent_ef599409\",\"payload\":{\"intent_mandate\":{\"constraints\":{\"brands\":[],\"categories\":[],\"max_amount\":{\"currency\":\"JPY\",\"value\":\"50000.00\"},\"mer", "module": "crypto", "function": "verify_a2a_message_signature", "line": 832}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.586154Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Verifying signature (algorithm: ED25519)", "module": "crypto", "function": "verify_signature", "line": 662}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.589383Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Crypto VERIFY: ED25519 (key: did:ap2:agent:shopping_agent#key-2) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 271}
ap2_merchant_agent       | [2025-10-20 23:54:28,589] INFO in v2.common.a2a_handler: [A2AHandler] proof署名検証成功: sender=did:ap2:agent:shopping_agent, alg=ed25519, kid=did:ap2:agent:shopping_agent#key-2, public_key_source=DID-resolved
ap2_merchant_agent       | [2025-10-20 23:54:28,589] INFO in v2.common.a2a_handler: [A2A処理] ハンドラー実行中: type=ap2.mandates.IntentMandate, from=did:ap2:agent:shopping_agent
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.589607Z", "level": "INFO", "logger": "agent", "message": "[MerchantAgent] Received IntentMandate", "module": "agent", "function": "handle_intent_mandate", "line": 254}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.589635Z", "level": "INFO", "logger": "agent", "message": "[MerchantAgent] Received IntentMandate with shipping_address (AP2 v0.1 compliant)", "module": "agent", "function": "handle_intent_mandate", "line": 262}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.589659Z", "level": "INFO", "logger": "agent", "message": "[MerchantAgent] Searching products with intent: 'むぎぼー のグッズが欲しい'", "module": "agent", "function": "handle_intent_mandate", "line": 271}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.589683Z", "level": "INFO", "logger": "agent", "message": "[MerchantAgent] Using provided shipping address: test太郎", "module": "agent", "function": "handle_intent_mandate", "line": 277}
ap2_merchant_agent       | [2025-10-20 23:54:28,590] INFO in v2.common.database: [ProductCRUD.search] Original query: 'むぎぼーのグッズが欲しい' -> Cleaned: 'むぎぼー グッズ  '
ap2_merchant_agent       | [2025-10-20 23:54:28,590] INFO in v2.common.database: [ProductCRUD.search] Extracted keywords: ['むぎぼー', 'グッズ', 'むぎぼーのグッズが欲しい']
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.602724Z", "level": "INFO", "logger": "agent", "message": "[_create_multiple_cart_candidates] Found 8 products", "module": "agent", "function": "_create_multiple_cart_candidates", "line": 693}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.603428Z", "level": "INFO", "logger": "agent", "message": "[_create_multiple_cart_candidates] Creating 3 cart candidates", "module": "agent", "function": "_create_multiple_cart_candidates", "line": 726}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.623435Z", "level": "INFO", "logger": "service", "message": "[Merchant] CartMandate validation passed: cart_a090db3b", "module": "service", "function": "_validate_cart_mandate", "line": 655}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.641919Z", "level": "INFO", "logger": "service", "message": "[Merchant] CartMandate validation passed: cart_2165e626", "module": "service", "function": "_validate_cart_mandate", "line": 655}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.642431Z", "level": "INFO", "logger": "service", "message": "[Merchant] CartMandate validation passed: cart_ed2e20d6", "module": "service", "function": "_validate_cart_mandate", "line": 655}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.647772Z", "level": "INFO", "logger": "service", "message": "[Merchant] Inventory check passed for CartMandate: cart_a090db3b", "module": "service", "function": "_check_inventory", "line": 680}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.648069Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Signing data (key_id: merchant, algorithm: ECDSA)", "module": "crypto", "function": "sign_data", "line": 599}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.651796Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Crypto SIGN: ECDSA (key: merchant) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 271}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.669624Z", "level": "INFO", "logger": "service", "message": "[_generate_merchant_authorization_jwt] Generated signed JWT for CartMandate: cart_id=cart_a090db3b, cart_hash=77416ef2d36214cc..., alg=ES256, kid=did:ap2:merchant:mugibo_merchant#key-1", "module": "service", "function": "_generate_merchant_authorization_jwt", "line": 771}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.671758Z", "level": "INFO", "logger": "service", "message": "[Merchant] Inventory check passed for CartMandate: cart_2165e626", "module": "service", "function": "_check_inventory", "line": 680}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.671851Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Signing data (key_id: merchant, algorithm: ECDSA)", "module": "crypto", "function": "sign_data", "line": 599}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.672134Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Crypto SIGN: ECDSA (key: merchant) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 271}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.672367Z", "level": "INFO", "logger": "service", "message": "[_generate_merchant_authorization_jwt] Generated signed JWT for CartMandate: cart_id=cart_2165e626, cart_hash=40ba81d9c4aad1cf..., alg=ES256, kid=did:ap2:merchant:mugibo_merchant#key-1", "module": "service", "function": "_generate_merchant_authorization_jwt", "line": 771}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.673246Z", "level": "INFO", "logger": "service", "message": "[Merchant] Inventory check passed for CartMandate: cart_ed2e20d6", "module": "service", "function": "_check_inventory", "line": 680}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.673313Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Signing data (key_id: merchant, algorithm: ECDSA)", "module": "crypto", "function": "sign_data", "line": 599}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.673493Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Crypto SIGN: ECDSA (key: merchant) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 271}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.673653Z", "level": "INFO", "logger": "service", "message": "[_generate_merchant_authorization_jwt] Generated signed JWT for CartMandate: cart_id=cart_ed2e20d6, cart_hash=08421f2470ef8e2c..., alg=ES256, kid=did:ap2:merchant:mugibo_merchant#key-1", "module": "service", "function": "_generate_merchant_authorization_jwt", "line": 771}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.684208Z", "level": "INFO", "logger": "service", "message": "[Merchant] Created new CartMandate: cart_ed2e20d6", "module": "service", "function": "sign_cart_mandate", "line": 182}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.684454Z", "level": "INFO", "logger": "service", "message": "[Merchant] Auto-signed CartMandate: cart_ed2e20d6 (with merchant_authorization JWT)", "module": "service", "function": "sign_cart_mandate", "line": 184}
ap2_merchant             | INFO:     172.18.0.6:51514 - "POST /sign/cart HTTP/1.1" 200 OK
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.685203Z", "level": "INFO", "logger": "service", "message": "[Merchant] Created new CartMandate: cart_a090db3b", "module": "service", "function": "sign_cart_mandate", "line": 182}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.685445Z", "level": "INFO", "logger": "service", "message": "[Merchant] Auto-signed CartMandate: cart_a090db3b (with merchant_authorization JWT)", "module": "service", "function": "sign_cart_mandate", "line": 184}
ap2_merchant             | INFO:     172.18.0.6:51492 - "POST /sign/cart HTTP/1.1" 200 OK
ap2_merchant_agent       | [2025-10-20 23:54:28,685] INFO in httpx: HTTP Request: POST http://merchant:8002/sign/cart "HTTP/1.1 200 OK"
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.686358Z", "level": "INFO", "logger": "agent", "message": "[_create_cart_from_products] CartMandate signed: cart_ed2e20d6", "module": "agent", "function": "_create_cart_from_products", "line": 913}
ap2_merchant_agent       | [2025-10-20 23:54:28,686] INFO in httpx: HTTP Request: POST http://merchant:8002/sign/cart "HTTP/1.1 200 OK"
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.686786Z", "level": "INFO", "logger": "agent", "message": "[_create_cart_from_products] CartMandate signed: cart_a090db3b", "module": "agent", "function": "_create_cart_from_products", "line": 913}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.691464Z", "level": "INFO", "logger": "service", "message": "[Merchant] Created new CartMandate: cart_2165e626", "module": "service", "function": "sign_cart_mandate", "line": 182}
ap2_merchant             | {"timestamp": "2025-10-20T23:54:28.691714Z", "level": "INFO", "logger": "service", "message": "[Merchant] Auto-signed CartMandate: cart_2165e626 (with merchant_authorization JWT)", "module": "service", "function": "sign_cart_mandate", "line": 184}
ap2_merchant             | INFO:     172.18.0.6:51504 - "POST /sign/cart HTTP/1.1" 200 OK
ap2_merchant_agent       | [2025-10-20 23:54:28,692] INFO in httpx: HTTP Request: POST http://merchant:8002/sign/cart "HTTP/1.1 200 OK"
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.692458Z", "level": "INFO", "logger": "agent", "message": "[_create_cart_from_products] CartMandate signed: cart_2165e626", "module": "agent", "function": "_create_cart_from_products", "line": 913}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.692511Z", "level": "INFO", "logger": "agent", "message": "[_create_multiple_cart_candidates] Created 3 cart candidates", "module": "agent", "function": "_create_multiple_cart_candidates", "line": 754}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.692573Z", "level": "INFO", "logger": "agent", "message": "[MerchantAgent] Generated 3 cart candidates", "module": "agent", "function": "handle_intent_mandate", "line": 309}
ap2_merchant_agent       | [2025-10-20 23:54:28,692] INFO in v2.common.a2a_handler: [A2A処理] ハンドラー完了: type=ap2.mandates.IntentMandate, result_type=ap2.responses.CartCandidates
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.693010Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Signing A2A message (sender: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 800}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.693604Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "[SIGN] Canonical JSON length: 8829, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.responses.CartCandidates\",\"id\":\"32c60151-d3f3-431e-822e-441cc3e81f79\",\"payload\":{\"cart_candidates\":[{\"artifactId\":\"artifact_e99cbc7c\",\"name\":\"人気商品セット\",\"parts\":[{\"data\":{\"ap2.", "module": "crypto", "function": "sign_a2a_message", "line": 804}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.693629Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Signing data (key_id: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 599}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:28.698448Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Crypto SIGN: ED25519 (key: merchant_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 271}
ap2_merchant_agent       | [2025-10-20 23:54:28,700] INFO in v2.common.a2a_handler:
ap2_merchant_agent       | ================================================================================
ap2_merchant_agent       | [A2A送信] レスポンス作成
ap2_merchant_agent       |   送信元: did:ap2:agent:merchant_agent
ap2_merchant_agent       |   送信先: did:ap2:agent:shopping_agent
ap2_merchant_agent       |   タイプ: ap2.responses.CartCandidates
ap2_merchant_agent       |   データID: 32c60151-d3f3-431e-822e-441cc3e81f79
ap2_merchant_agent       |   署名: あり
ap2_merchant_agent       |   タイムスタンプ: 2025-10-20T23:54:28.692645Z
ap2_merchant_agent       |   ペイロード: {
ap2_merchant_agent       |   "intent_mandate_id": "intent_ef599409",
ap2_merchant_agent       |   "cart_candidates": [
ap2_merchant_agent       |     {
ap2_merchant_agent       |       "artifactId": "artifact_e99cbc7c",
ap2_merchant_agent       |       "name": "人気商品セット",
ap2_merchant_agent       |       "parts": [
ap2_merchant_agent       |         {
ap2_merchant_agent       |           "kind": "data",
ap2_merchant_agent       |           "data": {
ap2_merchant_agent       |             "ap2.mandates.CartMandate": {
ap2_merchant_agent       |               "id": "cart_a090db3b",
ap2_merchant_agent       |               "type": "CartMandate",
ap2_merchant_agent       |               "version": "0.2",
ap2_merchant_agent       |               "intent_mandate_id": "intent_ef599409",
ap2_merchant_agent       |               "items": [
ap2_merchant_agent       |                 {
ap2_merchant_agent       |                   "id": "item_60fee06e",
ap2_merchant_agent       |                   "name": "むぎぼーアクリルキーホルダー",
ap2_merchant_agent       |                   "description": "かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。",
ap2_merchant_agent       |                   "quantity": 1,
ap2_merchant_agent       |                   "unit_price": {


ap2_shopping_agent       | [2025-10-20 23:54:28,706] INFO in httpx: HTTP Request: POST http://merchant_agent:8001/a2a/message "HTTP/1.1 200 OK"
ap2_merchant_agent       |                     "value": "800.0",




ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:28.707652Z", "level": "INFO", "logger": "agent", "message": "\n================================================================================\n[ShoppingAgent ← MerchantAgent] A2Aレスポンス受信\n  Status: 200\n  Response Body: {\n  \"header\": {\n    \"message_id\": \"92e55daf-e321-4431-b432-1a437e0d2314\",\n    \"sender\": \"did:ap2:agent:merchant_agent\",\n    \"recipient\": \"did:ap2:agent:shopping_agent\",\n    \"timestamp\": \"2025-10-20T23:54:28.692645Z\",\n    \"nonce\": \"7eb8147a88ad0a08a1fbf51682c1044560091652b5484242963e1366a87bc8c5\",\n    \"schema_version\": \"0.2\",\n    \"proof\": {\n      \"algorithm\": \"ed25519\",\n      \"signatureValue\": \"rAwO4QdnfLeuqxjGZVFPc1Xr3s7SsbqqLuoebLVxQMcmQIFYocRdFlaS5ABasQBYQ8JThNHTW3na2CtEw0jaDQ==\",\n      \"publicKey\": \"LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUNvd0JRWURLMlZ3QXlFQVZGVk9taC9Kd2R3R0FTMGg3R0VnR1RtMS9IQ2FoVEgzZUl3NVI2K2poeW89Ci0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLQo=\",\n      \"kid\": \"did:ap2:agent:merchant_agent#key-2\",\n      \"created\": \"2025-10-20T23:54:28.692645Z\",\n      \"proofPurpose\": \"authentication\"\n    },\n    \"signature\": null\n  },\n  \"dataPart\": {\n    \"@type\": \"ap2.responses.CartCandidates\",\n    \"id\": \"32c60151-d3f3-431e-822e-441cc3e81f79\",\n    \"payload\": {\n      \"intent_mandate_id\": \"intent_ef...\n================================================================================", "module": "agent", "function": "_search_products_via_merchant_agent", "line": 2992}
ap2_merchant_agent       |                     "currency": "JPY"
ap2_merchant_agent       |                   },

ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:28.707693Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Received 3 cart candidates from Merchant Agent", "module": "agent", "function": "_search_products_via_merchant_agent", "line": 3009}
ap2_merchant_agent       |                   "total_price": {

ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:28.707718Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Extracted CartMandate from Artifact: cart_a090db3b", "module": "agent", "function": "_search_products_via_merchant_agent", "line": 3027}
ap2_merchant_agent       |                     "value": "800.0",

ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:28.707736Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Extracted CartMandate from Artifact: cart_2165e626", "module": "agent", "function": "_search_products_via_merchant_agent", "line": 3027}
ap2_merchant_agent       |                     "currency": "JPY"


ap2_merchant_agent       |                   },
ap2_merchant_agent       |                   "image_url": "/assets/むぎぼーアクリルキーホルダー.png",

ap2_merchant_agent       |                   "sku": "MUGI-KEYCHAIN-001",
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:28.707750Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Extracted CartMandate from Artifact: cart_ed2e20d6", "module": "agent", "function": "_search_products_via_merchant_agent", "line": 3027}


ap2_merchant_agent       |                   "category": "Keychains",


ap2_merchant_agent       |                   "brand": "Mugibow Official"
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:28.707763Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Expanded 3 cart mandates from artifacts", "module": "agent", "function": "_search_products_via_merchant_agent", "line": 3029}
ap2_merchant_agent       |                 },
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:28.707786Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Received 3 signed cart candidates from Merchant Agent", "module": "agent", "function": "_generate_fixed_response", "line": 1415}
ap2_merchant_agent       |                 {
ap2_merchant_agent       |                   "id": "item_2ada806d",
ap2_merchant_agent       |                   "name": "むぎぼー時計",
ap2_merchant_agent       |                   "description": "むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。",
ap2_merchant_agent       |                   "quantity": 1,
ap2_merchant_agent       |                   "unit_price": {
ap2_merchant_agent       |                     "value": "3500.0",
ap2_merchant_agent       |                     "currency": "JPY"
ap2_merchant_agent       |                   },
ap2_merchant_agent       |                   "total_price": {
ap2_merchant_agent       |                     "value": "3500.0",
ap2_merchant_agent       |                     "currency": "JPY"
ap2_merchant_agent       |                   },
ap2_merchant_agent       |                   "image_url": "/assets/むぎぼー時計.png",
ap2_merchant_agent       |                   "sku": "MUGI-CLOCK-001",
ap2_merchant_agent       |                   "category": "Clocks",
ap2_merchant_agent       |                   "brand": "Mugibow Official"
ap2_merchant_agent       |                 },
ap2_merchant_agent       |                 {
ap2_merchant_agent       |                   "id": "item_995133a7",
ap2_merchant_agent       |                   "name": "むぎぼーカレンダー",
ap2_merchant_agent       |                   "description": "むぎぼーの1年カレンダー。毎月違うむぎぼーのイラストが楽しめます。",
ap2_merchant_agent       |                   "quantity": 1,
ap2_merchant_agent       |                   "unit_price": {
ap2_merchant_agent       |                     "value": "1500.0",
ap2_merchant_agent       |                     "currency": "JPY"
ap2_merchant_agent       |                   },
ap2_merchant_agent       |                   "total_price": {
ap2_merchant_agent       |                     "value": "1500.0",
ap2_merchant_agent       |                     "currency": "JPY"
ap2_merchant_agent       |                   },
ap2_merchant_agent       |                   "image_url": "/assets/むぎぼーカレンダー.png",
ap2_merchant_agent       |                   "sku": "MUGI-CALENDAR-001",
ap2_merchant_agent       |                   "category": "Calendars",
ap2_merchant_agent       |                   "brand": "Mugibow Official"
ap2_merchant_agent       |                 }
ap2_merchant_agent       |               ],
ap2_merchant_agent       |               "subtotal": {
ap2_merchant_agent       |                 "value": "5800.0",
ap2_merchant_agent       |                 "currency": "JPY"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "tax": {
ap2_merchant_agent       |                 "value": "580.0",
ap2_merchant_agent       |                 "currency": "JPY"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "shipping": {
ap2_merchant_agent       |                 "address": {
ap2_merchant_agent       |                   "recipient": "test太郎",
ap2_merchant_agent       |                   "postal_code": "111-1111",
ap2_merchant_agent       |                   "address_line1": "テスト県テスト市テスト町1-1-1",
ap2_merchant_agent       |                   "address_line2": "テストアパート111",
ap2_merchant_agent       |                   "phone": "010-1111-1111"
ap2_merchant_agent       |                 },
ap2_merchant_agent       |                 "method": "standard",
ap2_merchant_agent       |                 "cost": {
ap2_merchant_agent       |                   "value": "500.0",
ap2_merchant_agent       |                   "currency": "JPY"
ap2_merchant_agent       |                 },
ap2_merchant_agent       |                 "estimated_delivery": "2025-10-23T23:54:28.603533Z"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "total": {
ap2_merchant_agent       |                 "value": "6880.0",
ap2_merchant_agent       |                 "currency": "JPY"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "merchant_id": "did:ap2:merchant:mugibo_merchant",
ap2_merchant_agent       |               "merchant_name": "むぎぼーショップ",
ap2_merchant_agent       |               "created_at": "2025-10-20T23:54:28.603533Z",
ap2_merchant_agent       |               "expires_at": "2025-10-21T00:24:28.603533Z",
ap2_merchant_agent       |               "merchant_signature": {
ap2_merchant_agent       |                 "algorithm": "ECDSA",
ap2_merchant_agent       |                 "value": "MEYCIQDQ9PwuVSZtUDaHJKKTEBsaFMz0vmEAXNDtdYSVYXv7+gIhAKCJCloEGHzWJJgIOBZV99LMcqbFg4iZ0ylsyhJsdqsQ",
ap2_merchant_agent       |                 "public_key": "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFdkF2KzJ4ODI4WjRjWEQ1Y0lha2l6RGt4dVRRTQpZdjM5TXZVR1hmeFFsaDljMVRIczZIUXhmc2tqM1FXUWkvcFZHRHQ2aDdndjBzSmQxdmdXTTFnSDhRPT0KLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg==",
ap2_merchant_agent       |                 "signed_at": "2025-10-20T23:54:28.651604Z",
ap2_merchant_agent       |                 "key_id": "merchant"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "cart_metadata": {
ap2_merchant_agent       |                 "name": "人気商品セット",
ap2_merchant_agent       |                 "description": "検索結果で人気の商品を組み合わせたカートです"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "merchant_authorization": "eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50IiwiYXVkIjoiZGlkOmFwMjphZ2VudDpwYXltZW50X3Byb2Nlc3NvciIsImlhdCI6MTc2MTAwNDQ2OCwiZXhwIjoxNzYxMDA1MzY4LCJqdGkiOiI1YjI5Y2E3YS1hN2M4LTRjZjctOTU0YS00YzEwNjBiZjNjMDkiLCJjYXJ0X2hhc2giOiI3NzQxNmVmMmQzNjIxNGNjZTY4ZWI1NWRmZTYwYTQwMDhhYTAxNmMwN2VmNTBiNzJiYjVmNjIzZjU4MjJiY2FkIn0.MEQCIDL30t8Xo5NAnPiHJSY0_yGJNgeRrTGb3zgrMjTnquhhAiAvykmZuiAEYb4MBnPQD3RDVPONKVSs5Yi9qjvfo8l7pg"
ap2_merchant_agent       |             }
ap2_merchant_agent       |           }
ap2_merchant_agent       |         }
ap2_merchant_agent       |       ]
ap2_merchant_agent       |     },
ap2_merchant_agent       |     {
ap2_merchant_agent       |       "artifactId": "artifact_8ca5a282",
ap2_merchant_agent       |       "name": "お得なセット",
ap2_merchant_agent       |       "parts": [
ap2_merchant_agent       |         {
ap2_merchant_agent       |           "kind": "data",
ap2_merchant_agent       |           "data": {
ap2_merchant_agent       |             "ap2.mandates.CartMandate": {
ap2_merchant_agent       |               "id": "cart_2165e626",
ap2_merchant_agent       |               "type": "CartMandate",
ap2_merchant_agent       |               "version": "0.2",
ap2_merchant_agent       |               "intent_mandate_id": "intent_ef599409",
ap2_merchant_agent       |               "items": [
ap2_merchant_agent       |                 {
ap2_merchant_agent       |                   "id": "item_d52ce218",
ap2_merchant_agent       |                   "name": "むぎぼーステッカー",
ap2_merchant_agent       |                   "description": "むぎぼーのステッカーセット（5枚入り）。ノートやスマホケースに貼れます。",
ap2_merchant_agent       |                   "quantity": 1,
ap2_merchant_agent       |                   "unit_price": {
ap2_merchant_agent       |                     "value": "500.0",
ap2_merchant_agent       |                     "currency": "JPY"
ap2_merchant_agent       |                   },
ap2_merchant_agent       |                   "total_price": {
ap2_merchant_agent       |                     "value": "500.0",
ap2_merchant_agent       |                     "currency": "JPY"
ap2_merchant_agent       |                   },
ap2_merchant_agent       |                   "image_url": "/assets/むぎぼーステッカー.png",
ap2_merchant_agent       |                   "sku": "MUGI-STICKER-001",
ap2_merchant_agent       |                   "category": "Stickers",
ap2_merchant_agent       |                   "brand": "Mugibow Official"
ap2_merchant_agent       |                 },
ap2_merchant_agent       |                 {
ap2_merchant_agent       |                   "id": "item_5e75ef0a",
ap2_merchant_agent       |                   "name": "むぎぼーアクリルキーホルダー",
ap2_merchant_agent       |                   "description": "かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。",
ap2_merchant_agent       |                   "quantity": 1,
ap2_merchant_agent       |                   "unit_price": {
ap2_merchant_agent       |                     "value": "800.0",
ap2_merchant_agent       |                     "currency": "JPY"
ap2_merchant_agent       |                   },
ap2_merchant_agent       |                   "total_price": {
ap2_merchant_agent       |                     "value": "800.0",
ap2_merchant_agent       |                     "currency": "JPY"
ap2_merchant_agent       |                   },
ap2_merchant_agent       |                   "image_url": "/assets/むぎぼーアクリルキーホルダー.png",
ap2_merchant_agent       |                   "sku": "MUGI-KEYCHAIN-001",
ap2_merchant_agent       |                   "category": "Keychains",
ap2_merchant_agent       |                   "brand": "Mugibow Official"
ap2_merchant_agent       |                 },
ap2_merchant_agent       |                 {
ap2_merchant_agent       |                   "id": "item_beefa134",
ap2_merchant_agent       |                   "name": "むぎぼーポーチ",
ap2_merchant_agent       |                   "description": "むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。",
ap2_merchant_agent       |                   "quantity": 1,
ap2_merchant_agent       |                   "unit_price": {
ap2_merchant_agent       |                     "value": "950.0",
ap2_merchant_agent       |                     "currency": "JPY"
ap2_merchant_agent       |                   },
ap2_merchant_agent       |                   "total_price": {
ap2_merchant_agent       |                     "value": "950.0",
ap2_merchant_agent       |                     "currency": "JPY"
ap2_merchant_agent       |                   },
ap2_merchant_agent       |                   "image_url": "/assets/むぎぼーポーチ.png",
ap2_merchant_agent       |                   "sku": "MUGI-POUCH-001",
ap2_merchant_agent       |                   "category": "Mugibow Pouches",
ap2_merchant_agent       |                   "brand": "Mugibow Official"
ap2_merchant_agent       |                 }
ap2_merchant_agent       |               ],
ap2_merchant_agent       |               "subtotal": {
ap2_merchant_agent       |                 "value": "2250.0",
ap2_merchant_agent       |                 "currency": "JPY"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "tax": {
ap2_merchant_agent       |                 "value": "225.0",
ap2_merchant_agent       |                 "currency": "JPY"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "shipping": {
ap2_merchant_agent       |                 "address": {
ap2_merchant_agent       |                   "recipient": "test太郎",
ap2_merchant_agent       |                   "postal_code": "111-1111",
ap2_merchant_agent       |                   "address_line1": "テスト県テスト市テスト町1-1-1",
ap2_merchant_agent       |                   "address_line2": "テストアパート111",
ap2_merchant_agent       |                   "phone": "010-1111-1111"
ap2_merchant_agent       |                 },
ap2_merchant_agent       |                 "method": "standard",
ap2_merchant_agent       |                 "cost": {
ap2_merchant_agent       |                   "value": "500.0",
ap2_merchant_agent       |                   "currency": "JPY"
ap2_merchant_agent       |                 },
ap2_merchant_agent       |                 "estimated_delivery": "2025-10-23T23:54:28.613122Z"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "total": {
ap2_merchant_agent       |                 "value": "2975.0",
ap2_merchant_agent       |                 "currency": "JPY"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "merchant_id": "did:ap2:merchant:mugibo_merchant",
ap2_merchant_agent       |               "merchant_name": "むぎぼーショップ",
ap2_merchant_agent       |               "created_at": "2025-10-20T23:54:28.613122Z",
ap2_merchant_agent       |               "expires_at": "2025-10-21T00:24:28.613122Z",
ap2_merchant_agent       |               "merchant_signature": {
ap2_merchant_agent       |                 "algorithm": "ECDSA",
ap2_merchant_agent       |                 "value": "MEYCIQC4OKSNU0QfAdy9uRR8quTVndhsMpYeGsWAaBQ2jMwgZAIhAK/XrohwLJTY1a6xuJ1R6q2TAgjpILf3xSmrf1nZVBNI",
ap2_merchant_agent       |                 "public_key": "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFdkF2KzJ4ODI4WjRjWEQ1Y0lha2l6RGt4dVRRTQpZdjM5TXZVR1hmeFFsaDljMVRIczZIUXhmc2tqM1FXUWkvcFZHRHQ2aDdndjBzSmQxdmdXTTFnSDhRPT0KLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg==",
ap2_merchant_agent       |                 "signed_at": "2025-10-20T23:54:28.672097Z",
ap2_merchant_agent       |                 "key_id": "merchant"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "cart_metadata": {
ap2_merchant_agent       |                 "name": "お得なセット",
ap2_merchant_agent       |                 "description": "価格を抑えた組み合わせのカートです"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "merchant_authorization": "eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50IiwiYXVkIjoiZGlkOmFwMjphZ2VudDpwYXltZW50X3Byb2Nlc3NvciIsImlhdCI6MTc2MTAwNDQ2OCwiZXhwIjoxNzYxMDA1MzY4LCJqdGkiOiJiY2E0ZWY4Zi03NmJkLTQ0YzctOTFhYi1lZWY2Y2VhMDQyMWUiLCJjYXJ0X2hhc2giOiI0MGJhODFkOWM0YWFkMWNmYTJlYWMxY2MyNTc1ODg3ZjQwYTEzYjBjNTMyMmM0MGFmZjVmYTA4YzY1ZTA4YzlkIn0.MEYCIQCUBP9ucw--JD5QsgTgATIEB4yb0rF5tAqJ4jorLFOqnAIhAL70FUMgxYCE-YSvIdMcyjoadPn-kT75B7g5SNRrT3ts"
ap2_merchant_agent       |             }
ap2_merchant_agent       |           }
ap2_merchant_agent       |         }
ap2_merchant_agent       |       ]
ap2_merchant_agent       |     },
ap2_merchant_agent       |     {
ap2_merchant_agent       |       "artifactId": "artifact_5631017c",
ap2_merchant_agent       |       "name": "プレミアムセット",
ap2_merchant_agent       |       "parts": [
ap2_merchant_agent       |         {
ap2_merchant_agent       |           "kind": "data",
ap2_merchant_agent       |           "data": {
ap2_merchant_agent       |             "ap2.mandates.CartMandate": {
ap2_merchant_agent       |               "id": "cart_ed2e20d6",
ap2_merchant_agent       |               "type": "CartMandate",
ap2_merchant_agent       |               "version": "0.2",
ap2_merchant_agent       |               "intent_mandate_id": "intent_ef599409",
ap2_merchant_agent       |               "items": [
ap2_merchant_agent       |                 {
ap2_merchant_agent       |                   "id": "item_6bcc8d4c",
ap2_merchant_agent       |                   "name": "むぎぼー時計",
ap2_merchant_agent       |                   "description": "むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。",
ap2_merchant_agent       |                   "quantity": 1,
ap2_merchant_agent       |                   "unit_price": {
ap2_merchant_agent       |                     "value": "3500.0",
ap2_merchant_agent       |                     "currency": "JPY"
ap2_merchant_agent       |                   },
ap2_merchant_agent       |                   "total_price": {
ap2_merchant_agent       |                     "value": "3500.0",
ap2_merchant_agent       |                     "currency": "JPY"
ap2_merchant_agent       |                   },
ap2_merchant_agent       |                   "image_url": "/assets/むぎぼー時計.png",
ap2_merchant_agent       |                   "sku": "MUGI-CLOCK-001",
ap2_merchant_agent       |                   "category": "Clocks",
ap2_merchant_agent       |                   "brand": "Mugibow Official"
ap2_merchant_agent       |                 },
ap2_merchant_agent       |                 {
ap2_merchant_agent       |                   "id": "item_d627fc3c",
ap2_merchant_agent       |                   "name": "むぎぼーTシャツ",
ap2_merchant_agent       |                   "description": "むぎぼーがプリントされたコットンTシャツ。普段着にぴったり。",
ap2_merchant_agent       |                   "quantity": 1,
ap2_merchant_agent       |                   "unit_price": {
ap2_merchant_agent       |                     "value": "2800.0",
ap2_merchant_agent       |                     "currency": "JPY"
ap2_merchant_agent       |                   },


ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:28.920619Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761004418388_4i4i8g, step=cart_selection", "module": "agent", "function": "_update_session", "line": 2616}
ap2_merchant_agent       |                   "total_price": {
ap2_merchant_agent       |                     "value": "2800.0",
ap2_merchant_agent       |                     "currency": "JPY"
ap2_merchant_agent       |                   },
ap2_merchant_agent       |                   "image_url": "/assets/むぎぼーTシャツ.png",
ap2_merchant_agent       |                   "sku": "MUGI-TSHIRT-001",
ap2_merchant_agent       |                   "category": "Mugibow Apparel",
ap2_merchant_agent       |                   "brand": "Mugibow Official"
ap2_merchant_agent       |                 }
ap2_merchant_agent       |               ],
ap2_merchant_agent       |               "subtotal": {
ap2_merchant_agent       |                 "value": "6300.0",
ap2_merchant_agent       |                 "currency": "JPY"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "tax": {
ap2_merchant_agent       |                 "value": "630.0",
ap2_merchant_agent       |                 "currency": "JPY"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "shipping": {
ap2_merchant_agent       |                 "address": {
ap2_merchant_agent       |                   "recipient": "test太郎",
ap2_merchant_agent       |                   "postal_code": "111-1111",
ap2_merchant_agent       |                   "address_line1": "テスト県テスト市テスト町1-1-1",
ap2_merchant_agent       |                   "address_line2": "テストアパート111",
ap2_merchant_agent       |                   "phone": "010-1111-1111"
ap2_merchant_agent       |                 },
ap2_merchant_agent       |                 "method": "standard",
ap2_merchant_agent       |                 "cost": {
ap2_merchant_agent       |                   "value": "500.0",
ap2_merchant_agent       |                   "currency": "JPY"
ap2_merchant_agent       |                 },
ap2_merchant_agent       |                 "estimated_delivery": "2025-10-23T23:54:28.613496Z"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "total": {
ap2_merchant_agent       |                 "value": "7430.0",
ap2_merchant_agent       |                 "currency": "JPY"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "merchant_id": "did:ap2:merchant:mugibo_merchant",
ap2_merchant_agent       |               "merchant_name": "むぎぼーショップ",
ap2_merchant_agent       |               "created_at": "2025-10-20T23:54:28.613496Z",
ap2_merchant_agent       |               "expires_at": "2025-10-21T00:24:28.613496Z",
ap2_merchant_agent       |               "merchant_signature": {
ap2_merchant_agent       |                 "algorithm": "ECDSA",
ap2_merchant_agent       |                 "value": "MEUCIQC0aOCMIaEJIwbQlgoYVFbIHBYHIOuLxk5QhUghxY5RhAIgJBW5zaT3QNBFZAOHiqaRuGyS20UE0FgBXJvODyQVNUM=",
ap2_merchant_agent       |                 "public_key": "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFdkF2KzJ4ODI4WjRjWEQ1Y0lha2l6RGt4dVRRTQpZdjM5TXZVR1hmeFFsaDljMVRIczZIUXhmc2tqM1FXUWkvcFZHRHQ2aDdndjBzSmQxdmdXTTFnSDhRPT0KLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg==",
ap2_merchant_agent       |                 "signed_at": "2025-10-20T23:54:28.673473Z",
ap2_merchant_agent       |                 "key_id": "merchant"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "cart_metadata": {
ap2_merchant_agent       |                 "name": "プレミアムセット",
ap2_merchant_agent       |                 "description": "高品質な商品を厳選したカートです"
ap2_merchant_agent       |               },
ap2_merchant_agent       |               "merchant_authorization": "eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50IiwiYXVkIjoiZGlkOmFwMjphZ2VudDpwYXltZW50X3Byb2Nlc3NvciIsImlhdCI6MTc2MTAwNDQ2OCwiZXhwIjoxNzYxMDA1MzY4LCJqdGkiOiIyZWJmODJlYS1iNTYwLTQ0YzctOWMwZi0xNmE3OWM0ZTdlZGIiLCJjYXJ0X2hhc2giOiIwODQyMWYyNDcwZWY4ZTJjYWRkZTNlMzdlNDM0YWRiMmQ2YWRkOGU0ZmVmZGY1NTI3NjE0ZTBmZWRmZjA1MzBhIn0.MEYCIQDSNs2ER-PEBgKr5TKhK5wFBBHCfMeXbtp6MsT0gH2vlwIhAP9cM1--cyGvNczRSJM1chKf89ZiSmq7K6eAK2Lm_vbK"
ap2_merchant_agent       |             }
ap2_merchant_agent       |           }
ap2_merchant_agent       |         }
ap2_merchant_agent       |       ]
ap2_merchant_agent       |     }
ap2_merchant_agent       |   ],
ap2_merchant_agent       |   "merchant_id": "did:ap2:merchant:mugibo_merchant",
ap2_merchant_agent       |   "merchant_name": "むぎぼーショップ"
ap2_merchant_agent       | }
ap2_merchant_agent       | ================================================================================
ap2_merchant_agent       | [2025-10-20 23:54:28,701] INFO in v2.common.base_agent: [Merchant Agent] A2Aレスポンス返却: type=ap2.responses.CartCandidates, to=did:ap2:agent:shopping_agent
ap2_merchant_agent       | INFO:     172.18.0.4:59438 - "POST /a2a/message HTTP/1.1" 200 OK
ap2_shopping_agent       | INFO:     151.101.64.223:45000 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:29.757716Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761004418388_4i4i8g, step=cart_selection", "module": "agent", "function": "_get_or_create_session", "line": 2581}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:30.197622Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Verifying signature (algorithm: ECDSA)", "module": "crypto", "function": "verify_signature", "line": 662}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:30.198952Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Crypto VERIFY: ECDSA (key: merchant) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 271}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:30.199019Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Merchant signature verified successfully: cart_id=cart_a090db3b, algorithm=ECDSA", "module": "agent", "function": "_generate_fixed_response", "line": 1551}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:30.204694Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761004418388_4i4i8g, step=cart_selection", "module": "agent", "function": "_update_session", "line": 2616}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:30.731740Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761004418388_4i4i8g, step=cart_signature_pending", "module": "agent", "function": "_update_session", "line": 2616}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:33.043541Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761004418388_4i4i8g, step=cart_signature_pending", "module": "agent", "function": "_get_or_create_session", "line": 2581}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:33.044419Z", "level": "INFO", "logger": "agent", "message": "[submit_cart_signature] Received CartMandate signature: cart_id=cart_a090db3b, session_id=session_1761004418388_4i4i8g", "module": "agent", "function": "submit_cart_signature", "line": 633}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:33.053388Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761004418388_4i4i8g, step=payment_mandate_creation", "module": "agent", "function": "_update_session", "line": 2616}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:33.053786Z", "level": "INFO", "logger": "agent", "message": "[submit_cart_signature] CartMandate signed by user: cart_id=cart_a090db3b, next_step=payment_mandate_creation", "module": "agent", "function": "submit_cart_signature", "line": 654}
ap2_shopping_agent       | INFO:     151.101.64.223:36687 - "POST /cart/submit-signature HTTP/1.1" 200 OK
ap2_shopping_agent       | INFO:     151.101.64.223:36687 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:33.060582Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761004418388_4i4i8g, step=payment_mandate_creation", "module": "agent", "function": "_get_or_create_session", "line": 2581}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:33.487298Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761004418388_4i4i8g, step=select_credential_provider_for_payment", "module": "agent", "function": "_update_session", "line": 2616}
ap2_shopping_agent       | INFO:     151.101.64.223:36687 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:34.821375Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761004418388_4i4i8g, step=select_credential_provider_for_payment", "module": "agent", "function": "_get_or_create_session", "line": 2581}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:34.822066Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Credential Provider selected for payment: cp_demo_001 (AP2 Demo Credential Provider)", "module": "agent", "function": "_generate_fixed_response", "line": 2051}
ap2_credential_provider  | INFO:     172.18.0.4:44518 - "GET /payment-methods?user_id=user_demo_001 HTTP/1.1" 200 OK
ap2_shopping_agent       | [2025-10-20 23:54:34,842] INFO in httpx: HTTP Request: GET http://credential_provider:8003/payment-methods?user_id=user_demo_001 "HTTP/1.1 200 OK"
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:35.272583Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761004418388_4i4i8g, step=select_payment_method", "module": "agent", "function": "_update_session", "line": 2616}
ap2_shopping_agent       | INFO:     151.101.64.223:36687 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:35.861882Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761004418388_4i4i8g, step=select_payment_method", "module": "agent", "function": "_get_or_create_session", "line": 2581}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:36.682252Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Requesting payment method tokenization for: pm_001", "module": "agent", "function": "_tokenize_payment_method", "line": 3355}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:36.682465Z", "level": "INFO", "logger": "agent", "message": "\n================================================================================\n[ShoppingAgent → CredentialProvider] トークン化リクエスト送信\n  URL: http://credential_provider:8003/payment-methods/tokenize\n  User ID: user_demo_001\n  Payment Method ID: pm_001\n================================================================================", "module": "agent", "function": "_tokenize_payment_method", "line": 3359}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:36.687045Z", "level": "INFO", "logger": "provider", "message": "[tokenize_payment_method] Generated secure token for payment method: pm_001", "module": "provider", "function": "tokenize_payment_method", "line": 539}
ap2_credential_provider  | INFO:     172.18.0.4:44518 - "POST /payment-methods/tokenize HTTP/1.1" 200 OK
ap2_shopping_agent       | [2025-10-20 23:54:36,688] INFO in httpx: HTTP Request: POST http://credential_provider:8003/payment-methods/tokenize "HTTP/1.1 200 OK"
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:36.689000Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent ← CredentialProvider] トークン化レスポンス 受信: status=200", "module": "agent", "function": "_tokenize_payment_method", "line": 3379}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:36.689142Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Payment method tokenized: pm_001 → tok_67202947_2JSsfRi...", "module": "agent", "function": "_tokenize_payment_method", "line": 3389}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:37.098715Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Using selected CartMandate: cart_a090db3b", "module": "agent", "function": "_generate_fixed_response", "line": 2274}
ap2_shopping_agent       | [2025-10-20 23:54:37,705] INFO in v2.common.user_authorization: [create_user_authorization_vp] WebAuthn challenge from assertion: eyJtYW5kYXRlX2lk...
ap2_shopping_agent       | [2025-10-20 23:54:37,706] INFO in v2.common.user_authorization: [create_user_authorization_vp] cart_hash: 77416ef2d36214cc...
ap2_shopping_agent       | [2025-10-20 23:54:37,706] INFO in v2.common.user_authorization: [create_user_authorization_vp] payment_hash: da3427e10591d597...
ap2_shopping_agent       | [2025-10-20 23:54:37,707] ERROR in v2.common.user_authorization: Failed to extract public key from WebAuthn assertion: attestationObject not found in assertion
ap2_shopping_agent       | Traceback (most recent call last):
ap2_shopping_agent       |   File "/app/v2/common/user_authorization.py", line 156, in extract_public_key_from_webauthn_assertion
ap2_shopping_agent       |     raise ValueError("attestationObject not found in assertion")
ap2_shopping_agent       | ValueError: attestationObject not found in assertion
ap2_shopping_agent       | [2025-10-20 23:54:37,709] WARNING in v2.common.user_authorization: [create_user_authorization_vp] No attestationObject, and no public_key_cose provided
ap2_shopping_agent       | [2025-10-20 23:54:37,709] WARNING in v2.common.user_authorization: [create_user_authorization_vp] No public key available, cnf claim not added
ap2_shopping_agent       | [2025-10-20 23:54:37,709] INFO in v2.common.user_authorization: [create_user_authorization_vp] Generated user_authorization VP: length=2259, cart_hash=77416ef2d36214cc..., payment_hash=da3427e10591d597...
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:37.709887Z", "level": "INFO", "logger": "agent", "message": "[_create_payment_mandate] Generated user_authorization VP: length=2259", "module": "agent", "function": "_create_payment_mandate", "line": 2747}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:37.710040Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] transaction_type=human_not_present (no strong authentication detected)", "module": "agent", "function": "_determine_transaction_type", "line": 2661}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:37.710119Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Performing risk assessment...", "module": "agent", "function": "_create_payment_mandate", "line": 2789}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:37.710518Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Risk assessment completed: score=6, recommendation=approve, indicators=['card_not_present_transaction']", "module": "agent", "function": "_create_payment_mandate", "line": 2800}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:37.710596Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] PaymentMandate created with user_authorization: has_user_auth=True", "module": "agent", "function": "_create_payment_mandate", "line": 2821}
ap2_shopping_agent       | [2025-10-20 23:54:37,710] INFO in v2.common.risk_assessment: [RiskAssessmentEngine] Assessment completed: risk_score=6, recommendation=approve, fraud_indicators=['card_not_present_transaction']
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:37.710638Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] PaymentMandate created: amount=6880.0 JPY, payment_method=visa ****4242, token=tok_67202947_2JSsfRi..., risk_score=6", "module": "agent", "function": "_create_payment_mandate", "line": 2826}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:38.535228Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761004418388_4i4i8g, step=webauthn_attestation_requested", "module": "agent", "function": "_update_session", "line": 2616}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.040974Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] Verifying attestation for PaymentMandate: payment_9fc6505c", "module": "agent", "function": "submit_payment_attestation", "line": 753}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.041089Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Verifying WebAuthn attestation with Credential Provider (http://credential_provider:8003) for PaymentMandate: payment_9fc6505c", "module": "agent", "function": "_verify_attestation_with_cp", "line": 3413}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.041346Z", "level": "INFO", "logger": "agent", "message": "\n================================================================================\n[ShoppingAgent → CredentialProvider] WebAuthn検証リクエスト送信\n  URL: http://credential_provider:8003/verify/attestation\n  PaymentMandate ID: payment_9fc6505c\n  Attestation Type: passkey\n  ペイロード:\n    PaymentMandate: {\n  \"payment_mandate_contents\": {\n    \"payment_mandate_id\": \"payment_9fc6505c\",\n    \"payment_details_id\": \"cart_a090db3b\",\n    \"payment_details_total\": {\n      \"label\": \"Total\",\n      \"amount\": {\n        \"value\": \"6880.0\",\n        \"currency\": \"JPY\"\n      }\n    },\n    \"payment_response\": {\n      \"methodName\": \"basic-card\",\n      \"details\": {\n        \"cardholderName\": \"Demo User\",\n        \"cardNumber\": \"****4242\",\n        \"cardSecurityCode\": \"***\",\n        \"cardBrand\": \"visa\",\n        \"expiryMonth\": 12,\n        \"expiryYear\": 2025,\n        \"token\": \"tok_67202947_2JSsfRiWK2DZWhf03vm3vTUS\",\n        \"tokenized\": true\n      }\n    },\n    \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\",\n    \"timestamp\": \"2025-10-20T23:54:37.705325Z\"\n  },\n  \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE5sY2w5a1pXMXZYekF3TVNJc0luTjFZaUk2SW1ScFpEcGhjREk2ZFhObGNqcDFjMlZ5WDJSbGJXOWZNREF4SWl3aWFXRjBJam94TnpZeE1EQTBORGMzTENKbGVIQWlPakUzTmpFd01EUTNOemNzSW01aVppSTZNVGMyTVRBd05EUTNOMzAiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpGYTA1elpWRTJZUzAxTldGU1p6VTJTQzAxV2t0MFMyOHpibmhZZEVOWlNIaFRTazVVUTBabllVaDNJaXdpYVdGMElqb3hOell4TURBME5EYzNMQ0p6WkY5b1lYTm9Jam9pWWpnMU9ETTJOV0kxT1RObVpUSTRabVptTm1WbU5EUTVaakZtTlRneVkyVXdOV1poWW1RNVptWmpZMkl5TnpnMVl6RmhabVk1Wm1ZMVpXTXlPV0k1T0NJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lOemMwTVRabFpqSmtNell5TVRSalkyVTJPR1ZpTlRWa1ptVTJNR0UwTURBNFlXRXdNVFpqTURkbFpqVXdZamN5WW1JMVpqWXlNMlkxT0RJeVltTmhaQ0lzSW1SaE16UXlOMlV4TURVNU1XUTFPVGRtWXpsa1ptTXpOMkV4T0RFNFpUVXpNV0l4Wm1Zek1qUXlZemd3WVRCak16UTBPREUyT0RoaVpEazFNV1U0TURVaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6InNSWVdESWU2LXV3ZUhpQU9rU0JEYTdVNGxDVVdaT3hMcFBVbXJlUW4zaF9JZ1VTLXVneFdvODZpM1ZtbG84RGNhbF92ajVPLWpBTUIiLCJyYXdJZCI6InNSWVdESWU2LXV3ZUhpQU9rU0JEYTdVNGxDVVdaT3hMcFBVbXJlUW4zaF9JZ1VTLXVneFdvODZpM1ZtbG84RGNhbF92ajVPLWpBTUIiLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybFpNa1o1WkVZNWFFMUVhM2RhUjBsNldXbEpjMGx1VW5CaVYxWjZaRWRHZEdORFNUWk5WR015VFZSQmQwNUVVVE5OVkZVMFRrZ3dJaXdpYjNKcFoybHVJam9pYUhSMGNEb3ZMMnh2WTJGc2FHOXpkRG96TURBd0lpd2lZM0p2YzNOUGNtbG5hVzRpT21aaGJITmxmUSIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVFDSUQ5MGRyR0NOMUpWRTVYTC1EMS1EWGkyRjhBaHZrejRMekFrQmhPcVJWWkFBaUJpc2NvSC0xZVg3NlJpclNGVTRnNjRoZXFRckhjMGRXN0J0NFNSREJzNkdBIiwidXNlckhhbmRsZSI6ImRYTmxjbDlrWlcxdlh6QXdNUSJ9LCJ0eXBlIjoicHVibGljLWtleSIsImF0dGVzdGF0aW9uX3R5cGUiOiJwYXNza2V5IiwiY2hhbGxlbmdlIjoiZXlKdFlXNWtZWFJsWDJsa0lqb2lZMkZ5ZEY5aE1Ea3daR0l6WWlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRBd05EUTNNVFU0TkgwIn0sImNhcnRfaGFzaCI6Ijc3NDE2ZWYyZDM2MjE0Y2NlNjhlYjU1ZGZlNjBhNDAwOGFhMDE2YzA3ZWY1MGI3MmJiNWY2MjNmNTgyMmJjYWQiLCJwYXltZW50X2hhc2giOiJkYTM0MjdlMTA1OTFkNTk3ZmM5ZGZjMzdhMTgxOGU1MzFiMWZmMzI0MmM4MGEwYzM0NDgxNjg4YmQ5NTFlODA1In0\",\n  \"agent_involved\": true,\n  \"transaction_type\": \"human_not_present\",\n  \"id\": \"payment_9fc6505c\",\n  \"cart_mandate_id\": \"cart_a090db3b\",\n  \"intent_mandate_id\": \"intent_ef599409\",\n  \"payer_id\": \"user_demo_001\",\n  \"payee_id\": \"did:ap2:merchant:mugibo_merchant\",\n  \"amount\": {\n    \"value\": \"6880.0\",\n    \"currency\": \"JPY\"\n  },\n  \"payment_method\": {\n    \"type\": \"card\",\n    \"token\": \"tok_67202947_2JSsfRiWK2DZWhf03vm3vTUS\",\n    \"last4\": \"4242\",\n    \"brand\": \"visa\",\n    \"expiry_month\": 12,\n    \"expiry_year\": 2025\n  },\n  \"risk_score\": 6,\n  \"fraud_indicators\": [\n    \"card_not_present_transaction\"\n  ]\n}\n    Attestation: {\n  \"id\": \"sRYWDIe6-uweHiAOkSBDa7U4lCUWZOxLpPUmreQn3h_IgUS-ugxWo86i3Vmlo8Dcal_vj5O-jAMB\",\n  \"rawId\": \"sRYWDIe6-uweHiAOkSBDa7U4lCUWZOxLpPUmreQn3h_IgUS-ugxWo86i3Vmlo8Dcal_vj5O-jAMB\",\n  \"response\": {\n    \"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlbmdlIjoiQy1MTk1zdHgxUFVCQ0lHVGE2R2QzODBILWdhUTJqaWtLVTZrOHpQUm1payIsIm9yaWdpbiI6Imh0dHA6Ly9sb2NhbGhvc3Q6MzAwMCIsImNyb3NzT3JpZ2luIjpmYWxzZX0\",\n    \"authenticatorData\": \"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2MdAAAAAA\",\n    \"signature\": \"MEUCIQD7ssmIFOiFssPc6Jk_O3G8cukvc1Vzh5QTqCW5xTNOOwIgXCgFtO-gLw910D6Sd3pu5qHtjsamSvknsMkNY66c-qs\",\n    \"userHandle\": \"dXNlcl9kZW1vXzAwMQ\"\n  },\n  \"type\": \"public-key\",\n  \"attestation_type\": \"passkey\",\n  \"challenge\": \"C-LNMstx1PUBCIGTa6Gd380H-gaQ2jikKU6k8zPRmik\"\n}\n================================================================================", "module": "agent", "function": "_verify_attestation_with_cp", "line": 3418}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.066454Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] Found passkey: sRYWDIe6-uweHiAO...", "module": "provider", "function": "verify_attestation", "line": 347}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.066520Z", "level": "INFO", "logger": "provider", "message": "  User: user_demo_001", "module": "provider", "function": "verify_attestation", "line": 348}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.066539Z", "level": "INFO", "logger": "provider", "message": "  Counter: 0", "module": "provider", "function": "verify_attestation", "line": 349}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.066651Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Verifying WebAuthn authentication result", "module": "crypto", "function": "verify_webauthn_signature", "line": 1205}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.066762Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Client Data Type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1226}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.066788Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Origin: http://localhost:3000", "module": "crypto", "function": "verify_webauthn_signature", "line": 1227}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.066804Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Challenge matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1239}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.066818Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Authentication type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1246}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.066949Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "AuthenticatorData parsed: counter=0", "module": "crypto", "function": "verify_webauthn_signature", "line": 1259}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.066985Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Signature counter: 0 (AP2 compliant: replay attacks prevented by user_authorization nonce)", "module": "crypto", "function": "verify_webauthn_signature", "line": 1265}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.067229Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "RP ID Hash matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1278}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.069858Z", "level": "INFO", "logger": "v2.common.crypto", "message": "WebAuthn signature verified successfully", "module": "crypto", "function": "verify_webauthn_signature", "line": 1330}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.073028Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] Signature counter: 0 → 0 (AP2準拠: Authenticatorがcounterを実装していない場合でも、user_authorizationのnonceによりリプレイ攻撃は防止されます)", "module": "provider", "function": "verify_attestation", "line": 367}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.073103Z", "level": "INFO", "logger": "provider", "message": "[CredentialProvider] Generated attestation token for user: user_demo_001", "module": "provider", "function": "_generate_token", "line": 1495}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.073124Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] PaymentMandate contains payment_method.token, calling Payment Network (Step 23)", "module": "provider", "function": "verify_attestation", "line": 386}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.073156Z", "level": "INFO", "logger": "provider", "message": "[CredentialProvider] Requesting Agent Token from Payment Network: payment_mandate_id=payment_9fc6505c", "module": "provider", "function": "_request_agent_token_from_network", "line": 1428}
ap2_payment_network      | [2025-10-20 23:54:41,128] INFO in network: [DemoPaymentNetwork] Received tokenization request: payment_mandate_id=payment_9fc6505c, payment_method_token=tok_67202947_2JSsfRi...
ap2_payment_network      | [2025-10-20 23:54:41,129] INFO in network: [DemoPaymentNetwork] Issued Agent Token: agent_tok_demopaymentnetwork_c04..., expires_at=2025-10-21T00:54:41.129297+00:00
ap2_payment_network      | INFO:     172.18.0.5:53904 - "POST /network/tokenize HTTP/1.1" 200 OK
ap2_credential_provider  | [2025-10-20 23:54:41,132] INFO in httpx: HTTP Request: POST http://payment_network:8005/network/tokenize "HTTP/1.1 200 OK"
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.132429Z", "level": "INFO", "logger": "provider", "message": "[CredentialProvider] Received Agent Token from Payment Network: agent_tok_demopaymentnetwork_c04..., network_name=DemoPaymentNetwork", "module": "provider", "function": "_request_agent_token_from_network", "line": 1453}
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.138928Z", "level": "INFO", "logger": "provider", "message": "[CredentialProvider] Saved attestation: user=user_demo_001, verified=True, agent_token=agent_tok_demopaymentnetwork_c04...", "module": "provider", "function": "_save_attestation", "line": 1532}
ap2_credential_provider  | INFO:     172.18.0.4:44518 - "POST /verify/attestation HTTP/1.1" 200 OK
ap2_shopping_agent       | [2025-10-20 23:54:41,140] INFO in httpx: HTTP Request: POST http://credential_provider:8003/verify/attestation "HTTP/1.1 200 OK"
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.140773Z", "level": "INFO", "logger": "agent", "message": "\n================================================================================\n[ShoppingAgent ← CredentialProvider] WebAuthn検証レスポンス受信\n  Status: 200\n  Verified: True\n  Response Body: {\n  \"verified\": true,\n  \"token\": \"cred_token_25703635_v9DdaJjoJX0N23t9TNCORQn3\",\n  \"details\": {\n    \"attestation_type\": \"passkey\",\n    \"timestamp\": \"2025-10-20T23:54:41.138994+00:00\",\n    \"counter\": 0,\n    \"agent_token\": \"agent_tok_demopaymentnetwork_c04b5df5_oD8DSqdy6smQwDYQTdk6MBK1\"\n  }\n}\n================================================================================", "module": "agent", "function": "_verify_attestation_with_cp", "line": 3441}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.140808Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] WebAuthn attestation verified successfully: token=cred_token_25703635_...", "module": "agent", "function": "_verify_attestation_with_cp", "line": 3454}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.140822Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] Attestation verified, processing payment...", "module": "agent", "function": "submit_payment_attestation", "line": 771}
ap2_shopping_agent       | [2025-10-20 23:54:41,142] INFO in httpx: HTTP Request: POST http://credential_provider:8003/passkey/get-public-key "HTTP/1.1 200 OK"
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.143233Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] Public key retrieved from Credential Provider: credential_id=sRYWDIe6-uweHiAO...", "module": "agent", "function": "submit_payment_attestation", "line": 803}
ap2_shopping_agent       | [2025-10-20 23:54:41,143] INFO in v2.common.user_authorization: [create_user_authorization_vp] WebAuthn challenge from assertion: C-LNMstx1PUBCIGT...
ap2_shopping_agent       | [2025-10-20 23:54:41,143] INFO in v2.common.user_authorization: [create_user_authorization_vp] cart_hash: 77416ef2d36214cc...
ap2_shopping_agent       | [2025-10-20 23:54:41,143] INFO in v2.common.user_authorization: [create_user_authorization_vp] payment_hash: 4f1440be1ea5e034...
ap2_shopping_agent       | [2025-10-20 23:54:41,143] INFO in v2.common.user_authorization: [create_user_authorization_vp] Restored public key from COSE format
ap2_shopping_agent       | [2025-10-20 23:54:41,143] INFO in v2.common.user_authorization: [create_user_authorization_vp] cnf claim with JWK added to Issuer JWT
ap2_shopping_agent       | [2025-10-20 23:54:41,143] INFO in v2.common.user_authorization: [create_user_authorization_vp] Generated user_authorization VP: length=2411, cart_hash=77416ef2d36214cc..., payment_hash=4f1440be1ea5e034...
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.143842Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] SD-JWT-VC user_authorization generated: user_id=user_demo_001, vp_length=2411", "module": "agent", "function": "submit_payment_attestation", "line": 827}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.143862Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Requesting payment processing for PaymentMandate: payment_9fc6505c", "module": "agent", "function": "_process_payment_via_payment_processor", "line": 2852}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.143974Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Signing A2A message (sender: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 800}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.144208Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "[SIGN] Canonical JSON length: 6639, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_9fc6505c\",\"payload\":{\"cart_mandate\":{\"cart_metadata\":{\"description\":\"検索結果で人気の商品を組み合わせたカートです\",\"name\":\"人気商品セット\"},\"created_at\":\"2025-10-20", "module": "crypto", "function": "sign_a2a_message", "line": 804}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.144233Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Signing data (key_id: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 599}
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.144408Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Crypto SIGN: ED25519 (key: shopping_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 271}
ap2_shopping_agent       | [2025-10-20 23:54:41,144] INFO in v2.common.a2a_handler:
ap2_shopping_agent       | ================================================================================
ap2_shopping_agent       | [A2A送信] レスポンス作成

ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.142379Z", "level": "INFO", "logger": "provider", "message": "[get_passkey_public_key] Public key retrieved: credential_id=sRYWDIe6-uweHiAO..., user_id=user_demo_001", "module": "provider", "function": "get_passkey_public_key", "line": 1048}
ap2_merchant_agent       | [2025-10-20 23:54:41,146] INFO in v2.common.base_agent:


ap2_shopping_agent       |   送信元: did:ap2:agent:shopping_agent
ap2_merchant_agent       | ================================================================================



ap2_credential_provider  | INFO:     172.18.0.4:44518 - "POST /passkey/get-public-key HTTP/1.1" 200 OK


ap2_shopping_agent       |   送信先: did:ap2:agent:merchant_agent



ap2_merchant_agent       | [Merchant Agent] A2Aエンドポイント: POST /a2a/message
ap2_shopping_agent       |   タイプ: ap2.mandates.PaymentMandate
ap2_shopping_agent       |   データID: payment_9fc6505c1-f0b0-4956-9fa1-be0f217fec86



ap2_shopping_agent       |   署名: あり
ap2_merchant_agent       |   送信元: did:ap2:agent:shopping_agent
ap2_merchant_agent       |   タイプ: ap2.mandates.PaymentMandate

ap2_shopping_agent       |   タイムスタンプ: 2025-10-20T23:54:41.143875Z
ap2_merchant_agent       | ================================================================================



ap2_shopping_agent       |   ペイロード: {


ap2_merchant_agent       | [2025-10-20 23:54:41,146] INFO in v2.common.a2a_handler:
ap2_shopping_agent       |   "payment_mandate": {==========================================================
ap2_merchant_agent       | [A2A受信] メッセージID: 6d157af1-f0b0-4956-9fa1-be0f217fec86
ap2_shopping_agent       |       "payment_mandate_id": "payment_9fc6505c",





ap2_shopping_agent       |       "payment_details_id": "cart_a090db3b",
ap2_merchant_agent       |   送信元: did:ap2:agent:shopping_agent
ap2_merchant_agent       |   送信先: did:ap2:agent:merchant_agent
ap2_shopping_agent       |       "payment_details_total": {

ap2_shopping_agent       |         "label": "Total",


ap2_shopping_agent       |         "amount": {
ap2_merchant_agent       |   タイプ: ap2.mandates.PaymentMandate


ap2_shopping_agent       |           "value": "6880.0",
ap2_shopping_agent       |           "currency": "JPY"

ap2_payment_processor    | [2025-10-20 23:54:41,172] INFO in v2.common.base_agent:
ap2_merchant_agent       |   データID: payment_9fc6505c

ap2_shopping_agent       |         }
ap2_payment_processor    | ================================================================================

ap2_shopping_agent       |       },
ap2_shopping_agent       |       "payment_response": {
ap2_shopping_agent       |         "methodName": "basic-card",
ap2_shopping_agent       |         "details": {
ap2_shopping_agent       |           "cardholderName": "Demo User",
ap2_shopping_agent       |           "cardNumber": "****4242",
ap2_shopping_agent       |           "cardSecurityCode": "***",
ap2_shopping_agent       |           "cardBrand": "visa",
ap2_payment_processor    | [Payment Processor] A2Aエンドポイント: POST /a2a/message

ap2_payment_processor    |   受信メッセージ: ID=58053338-b795-41b3-967b-e0a681cb4983

ap2_shopping_agent       |           "expiryMonth": 12,





ap2_shopping_agent       |           "expiryYear": 2025,
ap2_merchant_agent       |   "payment_mandate": {
ap2_payment_processor    |   送信元: did:ap2:agent:merchant_agent


ap2_payment_processor    |   タイプ: ap2.mandates.PaymentMandate


p2_merchant_agent       |     "payment_mandate_contents": {
ap2_shopping_agent       |           "token": "tok_67202947_2JSsfRiWK2DZWhf03vm3vTUS",


ap2_payment_processor    | ================================================================================
ap2_merchant_agent       |       "payment_mandate_id": "payment_9fc6505c",

ap2_shopping_agent       |           "tokenized": true
ap2_merchant_agent       |       "payment_details_id": "cart_a090db3b",
ap2_merchant_agent       |       "payment_details_total": {

ap2_shopping_agent       |         }



ap2_payment_processor    | [2025-10-20 23:54:41,173] INFO in v2.common.a2a_handler:
ap2_shopping_agent       |       },


ap2_merchant_agent       |         "amount": {


ap2_shopping_agent       |       "merchant_agent": "did:ap2:merchant:mugibo_merchant",
ap2_merchant_agent       |           "value": "6880.0",




ap2_payment_processor    | ================================================================================
ap2_payment_processor    | [A2A受信] メッセージID: 58053338-b795-41b3-967b-e0a681cb4983

ap2_merchant_agent       |           "currency": "JPY"


ap2_shopping_agent       |     }, Config   w Enable Watch

ap2_payment_processor    |   送信元: did:ap2:agent:merchant_agent

ap2_shopping_agent       |     "user_authorization": "eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE5sY2w5a1pXMXZYekF3TVNJc0luTjFZaUk2SW1ScFpEcGhjREk2ZFhObGNqcDFjMlZ5WDJSbGJXOWZNREF4SWl3aWFXRjBJam94TnpZeE1EQTBORGd4TENKbGVIQWlPakUzTmpFd01EUTNPREVzSW01aVppSTZNVGMyTVRBd05EUTRNU3dpWTI1bUlqcDdJbX                         5SXNJbU55ZGlJNklsQXRNalUySWl3aWVDSTZJblpaWlRObmFURnNVWEZMZEZNME56Rm9OMVI0ZDNwbWRsbFBZMmhyU1hBeVduaGxTazFQTldVME1Xc2lMQ0o1SWpvaVQweEpVbXRtYkRWcVIyUnpTRFk0VkUxMmIweE1UMFIzUlZVNVNsbDNkbGt3TUU1NldHNDNPRmxEV1NKOWZYMCIsImtiX2p3dCI6ImV5SmhiR2NpT2lKRlV6STFOaUlzSW5SNWNDSTZJbXRpSzJwM2RDSjkuZXlKaGRXUWlPaUprYVdRNllYQXlPbUZuWlc1ME9uQmhlVzFsYm5SZmNISnZZMlZ6YzI5eUlpd2libTl1WTJVaU9pSkZPR2xKVjFkdlV6aGhiak10VFZnd2QwOXJVVk15VjNvNVYwSnpZM1ZGTmpkT1FVdGxXbXhrWjNoeklpd2lhV0YwSWpveE56WXhNREEwTkRneExDSnpaRjlvWVhOb0lqb2lNbVk0TUdJM1pqaGhOR1V5WkRBd1pUWTJZbVU1WkdFME5tUm1ZbVkwTWprMVl6VXpOV0ZtTkRNM1pUbGhObVkyTWpWaVpqTTBPR1UxWW1aaVl6UmpZU0lzSW5SeVlXNXpZV04wYVc5dVgyUmhkR0VpT2xzaU56YzBNVFpsWmpKa016WXlNVFJqWTJVMk9HVmlOVFZrWm1VMk1HRTBNREE0WVdFd01UWmpNRGRsWmpVd1lqY3lZbUkxWmpZeU0yWTFPREl5WW1OaFpDSXNJalJtTVRRME1HSmxNV1ZoTldVd016UTRNRFE0TWpJM056TTFPVEl5T1dRd09UVmtORGswTldJMlltSXlZV1ExWTJGbVlqazRNVEExTldZd1pUWm1OVFFpWFgwIiwid2ViYXV0aG5fYXNzZXJ0aW9uIjp7ImlkIjoic1JZV0RJZTYtdXdlSGlBT2tTQkRhN1U0bENVV1pPeExwUFVtcmVRbjNoX0lnVVMtdWd4V284NmkzVm1sbzhEY2FsX3ZqNU8takFNQiIsInJhd0lkIjoic1JZV0RJZTYtdXdlSGlBT2tTQkRhN1U0bENVV1pPeExwUFVtcmVRbjNoX0lnVVMtdWd4V284NmkzVm1sbzhEY2FsX3ZqNU8takFNQiIsInJlc3BvbnNlIjp7ImNsaWVudERhdGFKU09OIjoiZXlKMGVYQmxJam9pZDJWaVlYVjBhRzR1WjJWMElpd2lZMmhoYkd4bGJtZGxJam9pUXkxTVRrMXpkSGd4VUZWQ1EwbEhWR0UyUjJRek9EQklMV2RoVVRKcWFXdExWVFpyT0hwUVVtMXBheUlzSW05eWFXZHBiaUk2SW1oMGRIQTZMeTlzYjJOaGJHaHZjM1E2TXpBd01DSXNJbU55YjNOelQzSnBaMmx1SWpwbVlXeHpaWDAiLCJhdXRoZW50aWNhdG9yRGF0YSI6IlNaWU41WWdPakdoME5CY1BaSFpnVzRfa3JybWloakxIbVZ6enVvTWRsMk1kQUFBQUFBIiwic2lnbmF0dXJlIjoiTUVVQ0lRRDdzc21JRk9pRnNzUGM2SmtfTzNHOGN1a3ZjMVZ6aDVRVHFDVzV4VE5PT3dJZ1hDZ0Z0Ty1nTHc5MTBENlNkM3B1NXFIdGpzYW1Tdmtuc01rTlk2NmMtcXMiLCJ1c2VySGFuZGxlIjoiZFhObGNsOWtaVzF2WHpBd01RIn0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJDLUxOTXN0eDFQVUJDSUdUYTZHZDM4MEgtZ2FRMmppa0tVNms4elBSbWlrIn0sImNhcnRfaGFzaCI6Ijc3NDE2ZWYyZDM2MjE0Y2NlNjhlYjU1ZGZlNjBhNDAwOGFhMDE2YzA3ZWY1MGI3MmJiNWY2MjNmNTgyMmJjYWQiLCJwYXltZW50X2hhc2giOiI0ZjE0NDBiZTFlYTVlMDM0ODA0ODIyNzczNTkyMjlkMDk1ZDQ5NDViNmJiMmFkNWNhZmI5ODEwNTVmMGU2ZjU0In0",
ap2_merchant_agent       |       },


ap2_merchant_agent       |       "payment_response": {
ap2_payment_processor    |   タイプ: ap2.mandates.PaymentMandate
ap2_shopping_agent       |     "agent_involved": true,
ap2_merchant_agent       |         "methodName": "basic-card",

ap2_shopping_agent       |     "transaction_type": "human_not_present",
ap2_payment_processor    |   データID: payment_9fc6505c




ap2_shopping_agent       |     "id": "payment_9fc6505c",


ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.208021Z", "level": "INFO", "logger": "provider", "message": "[verify_credentials] Verifying token for payer: user_demo_001", "module": "provider", "function": "verify_credentials", "line": 1192}


ap2_merchant_agent       |         "details": {
ap2_shopping_agent       |     "cart_mandate_id": "cart_a090db3b",47290Z


ap2_merchant_agent       |           "cardholderName": "Demo User",


ap2_payment_processor    |   ペイロード: {


ap2_shopping_agent       |     "intent_mandate_id": "intent_ef599409",
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.208113Z", "level": "INFO", "logger": "provider", "message": "[verify_credentials] Token verified: payment_method_id=pm_001, user_id=user_demo_001", "module": "provider", "function": "verify_credentials", "line": 1229}

v View in Docker Desktop   o View Config   w Enable Watchap2_merchant_agent       |           "cardSecurityCode": "***",


ap2_payment_processor    |   "payment_mandate": {






ap2_merchant_agent       |           "cardBrand": "visa",
ap2_credential_provider  | INFO:     172.18.0.2:51082 - "POST /credentials/verify HTTP/1.1" 200 OK
ap2_shopping_agent       |     "payer_id": "user_demo_001",


ap2_payment_processor    |     "payment_mandate_contents": {
ap2_merchant_agent       |           "expiryMonth": 12,








ap2_shopping_agent       |     "payee_id": "did:ap2:merchant:mugibo_merchant",
ap2_merchant_agent       |           "expiryYear": 2025,
ap2_payment_processor    |       "payment_mandate_id": "payment_9fc6505c",
ap2_merchant_agent       |           "token": "tok_67202947_2JSsfRiWK2DZWhf03vm3vTUS",


ap2_shopping_agent       |     "amount": {
ap2_shopping_agent       |       "value": "6880.0",
ap2_shopping_agent       |       "currency": "JPY"

ap2_merchant_agent       |           "tokenized": true



ap2_payment_processor    |       "payment_details_total": {
ap2_shopping_agent       |     },
ap2_payment_processor    |         "label": "Total",
ap2_shopping_agent       |     "payment_method": {


ap2_merchant_agent       |         }
ap2_payment_processor    |         "amount": {

ap2_shopping_agent       |       "type": "card",


ap2_merchant_agent       |       },




ap2_merchant_agent       |       "merchant_agent": "did:ap2:merchant:mugibo_merchant",
ap2_payment_processor    |           "value": "6880.0",


ap2_merchant_agent       |       "timestamp": "2025-10-20T23:54:37.705325Z"
ap2_payment_processor    |           "currency": "JPY"
ap2_shopping_agent       |       "last4": "4242",
ap2_shopping_agent       |       "brand": "visa",



ap2_merchant_agent       |     },


ap2_merchant_agent       |     "user_authorization": "eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE5sY2w5a1pXMXZYekF3TVNJc0luTjFZaUk2SW1ScFpEcGhjREk2ZFhObGNqcDFjMlZ5WDJSbGJXOWZNREF4SWl3aWFXRjBJam94TnpZeE1EQTBORGd4TENKbGVIQWlPakUzTmpFd01EUTNPREVzSW01aVppSTZNVGMyTVRBd05EUTRNU3dpWTI1bUlqcDdJbXAzYXlJNmV5SnJkSGtpT2lKRlF5SXNJbU55ZGlJNklsQXRNalUySWl3aWVDSTZJblpaWlRObmFURnNVWEZMZEZNME56Rm9OMVI0ZDNwbWRsbFBZMmhyU1hBeVduaGxTazFQTldVME1Xc2lMQ0o1SWpvaVQweEpVbXRtYkRWcVIyUnpTRFk0VkUxMmIweE1UMFIzUlZVNVNsbDNkbGt3TUU1NldHNDNPRmxEV1NKOWZYMCIsImtiX2p3dCI6ImV5SmhiR2NpT2lKRlV6STFOaUlzSW5SNWNDSTZJbXRpSzJwM2RDSjkuZXlKaGRXUWlPaUprYVdRNllYQXlPbUZuWlc1ME9uQmhlVzFsYm5SZmNISnZZMlZ6YzI5eUlpd2libTl1WTJVaU9pSkZPR2xKVjFkdlV6aGhiak10VFZnd2QwOXJVVk15VjNvNVYwSnpZM1ZGTmpkT1FVdGxXbXhrWjNoeklpd2lhV0YwSWpveE56WXhNREEwTkRneExDSnpaRjlvWVhOb0lqb2lNbVk0TUdJM1pqaGhOR1V5WkRBd1pUWTJZbVU1WkdFME5tUm1ZbVkwTWprMVl6VXpOV0ZtTkRNM1pUbGhObVkyTWpWaVpqTTBPR1UxWW1aaVl6UmpZU0lzSW5SeVlXNXpZV04wYVc5dVgyUmhkR0VpT2xzaU56YzBNVFpsWmpKa016WXlNVFJqWTJVMk9HVmlOVFZrWm1VMk1HRTBNREE0WVdFd01UWmpNRGRsWmpVd1lqY3lZbUkxWmpZeU0yWTFPREl5WW1OaFpDSXNJalJtTVRRME1HSmxNV1ZoTldVd016UTRNRFE0TWpJM056TTFPVEl5T1dRd09UVmtORGswTldJMlltSXlZV1ExWTJGbVlqazRNVEExTldZd1pUWm1OVFFpWFgwIiwid2ViYXV0aG5fYXNzZXJ0aW9uIjp7ImlkIjoic1JZV0RJZTYtdXdlSGlBT2tTQkRhN1U0bENVV1pPeExwUFVtcmVRbjNoX0lnVVMtdWd4V284NmkzVm1sbzhEY2FsX3ZqNU8takFNQiIsInJhd0lkIjoic1JZV0RJZTYtdXdlSGlBT2tTQkRhN1U0bENVV1pPeExwUFVtcmVRbjNoX0lnVVMtdWd4V284NmkzVm1sbzhEY2FsX3ZqNU8takFNQiIsInJlc3BvbnNlIjp7ImNsaWVudERhdGFKU09OIjoiZXlKMGVYQmxJam9pZDJWaVlYVjBhRzR1WjJWMElpd2lZMmhoYkd4bGJtZGxJam9pUXkxTVRrMXpkSGd4VUZWQ1EwbEhWR0UyUjJRek9EQklMV2RoVVRKcWFXdExWVFpyT0hwUVVtMXBheUlzSW05eWFXZHBiaUk2SW1oMGRIQTZMeTlzYjJOaGJHaHZjM1E2TXpBd01DSXNJbU55YjNOelQzSnBaMmx1SWpwbVlXeHpaWDAiLCJhdXRoZW50aWNhdG9yRGF0YSI6IlNaWU41WWdPakdoME5CY1BaSFpnVzRfa3JybWloakxIbVZ6enVvTWRsMk1kQUFBQUFBIiwic2lnbmF0dXJlIjoiTUVVQ0lRRDdzc21JRk9pRnNzUGM2SmtfTzNHOGN1a3ZjMVZ6aDVRVHFDVzV4VE5PT3dJZ1hDZ0Z0Ty1nTHc5MTBENlNkM3B1NXFIdGpzYW1Tdmtuc01rTlk2NmMtcXMiLCJ1c2VySGFuZGxlIjoiZFhObGNsOWtaVzF2WHpBd01RIn0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJDLUxOTXN0eDFQVUJDSUdUYTZHZDM4MEgtZ2FRMmppa0tVNms4elBSbWlrIn0sImNhcnRfaGFzaCI6Ijc3NDE2ZWYyZDM2MjE0Y2NlNjhlYjU1ZGZlNjBhNDAwOGFhMDE2YzA3ZWY1MGI3MmJiNWY2MjNmNTgyMmJjYWQiLCJwYXltZW50X2hhc2giOiI0ZjE0NDBiZTFlYTVlMDM0ODA0ODIyNzczNTkyMjlkMDk1ZDQ5NDViNmJiMmFkNWNhZmI5ODEwNTVmMGU2ZjU0In0",


ap2_merchant_agent       |     "agent_involved": true,


ap2_payment_processor    |       },
ap2_payment_processor    |       "payment_response": {

ap2_merchant_agent       |     "transaction_type": "human_not_present",
ap2_shopping_agent       |       "expiry_year": 2025
ap2_shopping_agent       |     },d": "payment_9fc6505c",



ap2_payment_processor    |         "methodName": "basic-card",



ap2_merchant_agent       |     "cart_mandate_id": "cart_a090db3b",
ap2_payment_processor    |         "details": {



ap2_shopping_agent       |     "risk_score": 6,

ap2_payment_processor    |           "cardholderName": "Demo User",




ap2_merchant_agent       |     "intent_mandate_id": "intent_ef599409",
ap2_merchant_agent       |     "payer_id": "user_demo_001",
ap2_payment_processor    |           "cardNumber": "****4242",
ap2_shopping_agent       |     "fraud_indicators": [


ap2_payment_processor    |           "cardSecurityCode": "***",

ap2_shopping_agent       |       "card_not_present_transaction"
ap2_merchant_agent       |     "payee_id": "did:ap2:merchant:mugibo_merchant",
ap2_payment_processor    |           "cardBrand": "visa",


ap2_shopping_agent       |     ]
ap2_merchant_agent       |     "amount": {


ap2_shopping_agent       |   },      "expiryMonth": 12,
ap2_merchant_agent       |       "value": "6880.0",
ap2_payment_processor    |           "expiryYear": 2025,


ap2_shopping_agent       |   "cart_mandate": {
ap2_merchant_agent       |       "currency": "JPY"e Watch


ap2_shopping_agent       |     "id": "cart_a090db3b",
ap2_payment_processor    |           "token": "tok_67202947_2JSsfRiWK2DZWhf03vm3vTUS",


ap2_shopping_agent       |     "type": "CartMandate",
ap2_merchant_agent       |     },
ap2_payment_processor    |           "tokenized": true


ap2_merchant_agent       |     "payment_method": {


ap2_shopping_agent       |     "version": "0.2",
ap2_payment_processor    |         }pe": "card",
ap2_merchant_agent       |       "token": "tok_67202947_2JSsfRiWK2DZWhf03vm3vTUS",

ap2_shopping_agent       |     "intent_mandate_id": "intent_ef599409",


ap2_shopping_agent       |     "items": [
ap2_payment_processor    |       },
ap2_merchant_agent       |       "last4": "4242",



ap2_shopping_agent       |       {
ap2_payment_processor    |       "merchant_agent": "did:ap2:merchant:mugibo_merchant",
ap2_merchant_agent       |       "brand": "visa",






ap2_shopping_agent       |         "id": "item_60fee06e",
ap2_merchant_agent       |       "expiry_month": 12,


ap2_payment_processor    |       "timestamp": "2025-10-20T23:54:37.705325Z"




ap2_shopping_agent       |         "name": "むぎぼーアクリルキーホルダー",
ap2_payment_processor    |     },
ap2_merchant_agent       |       "expiry_year": 2025

ap2_merchant_agent       |     },


ap2_payment_processor    |     "user_authorization": "eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE5sY2w5a1pXMXZYekF3TVNJc0luTjFZaUk2SW1ScFpEcGhjREk2ZFhObGNqcDFjMlZ5WDJSbGJXOWZNREF4SWl3aWFXRjBJam94TnpZeE1EQTBORGd4TENKbGVIQWlPakUzTmpFd01EUTNPREVzSW01aVppSTZNVGMyTVRBd05EUTRNU3dpWTI1bUlqcDdJbXAzYXlJNmV5SnJkSGtpT2lKRlF5SXNJbU55ZGlJNklsQXRNalUySWl3aWVDSTZJblpaWlRObmFURnNVWEZMZEZNME56Rm9OMVI0ZDNwbWRsbFBZMmhyU1hBeVduaGxTazFQTldVME1Xc2lMQ0o1SWpvaVQweEpVbXRtYkRWcVIyUnpTRFk0VkUxMmIweE1UMFIzUlZVNVNsbDNkbGt3TUU1NldHNDNPRmxEV1NKOWZYMCIsImtiX2p3dCI6ImV5SmhiR2NpT2lKRlV6STFOaUlzSW5SNWNDSTZJbXRpSzJwM2RDSjkuZXlKaGRXUWlPaUprYVdRNllYQXlPbUZuWlc1ME9uQmhlVzFsYm5SZmNISnZZMlZ6YzI5eUlpd2libTl1WTJVaU9pSkZPR2xKVjFkdlV6aGhiak10VFZnd2QwOXJVVk15VjNvNVYwSnpZM1ZGTmpkT1FVdGxXbXhrWjNoeklpd2lhV0YwSWpveE56WXhNREEwTkRneExDSnpaRjlvWVhOb0lqb2lNbVk0TUdJM1pqaGhOR1V5WkRBd1pUWTJZbVU1WkdFME5tUm1ZbVkwTWprMVl6VXpOV0ZtTkRNM1pUbGhObVkyTWpWaVpqTTBPR1UxWW1aaVl6UmpZU0lzSW5SeVlXNXpZV04wYVc5dVgyUmhkR0VpT2xzaU56YzBNVFpsWmpKa016WXlNVFJqWTJVMk9HVmlOVFZrWm1VMk1HRTBNREE0WVdFd01UWmpNRGRsWmpVd1lqY3lZbUkxWmpZeU0yWTFPREl5WW1OaFpDSXNJalJtTVRRME1HSmxNV1ZoTldVd016UTRNRFE0TWpJM056TTFPVEl5T1dRd09UVmtORGswTldJMlltSXlZV1ExWTJGbVlqazRNVEExTldZd1pUWm1OVFFpWFgwIiwid2ViYXV0aG5fYXNzZXJ0aW9uIjp7ImlkIjoic1JZV0RJZTYtdXdlSGlBT2tTQkRhN1U0bENVV1pPeExwUFVtcmVRbjNoX0lnVVMtdWd4V284NmkzVm1sbzhEY2FsX3ZqNU8takFNQiIsInJhd0lkIjoic1JZV0RJZTYtdXdlSGlBT2tTQkRhN1U0bENVV1pPeExwUFVtcmVRbjNoX0lnVVMtdWd4V284NmkzVm1sbzhEY2FsX3ZqNU8takFNQiIsInJlc3BvbnNlIjp7ImNsaWVudERhdGFKU09OIjoiZXlKMGVYQmxJam9pZDJWaVlYVjBhRzR1WjJWMElpd2lZMmhoYkd4bGJtZGxJam9pUXkxTVRrMXpkSGd4VUZWQ1EwbEhWR0UyUjJRek9EQklMV2RoVVRKcWFXdExWVFpyT0hwUVVtMXBheUlzSW05eWFXZHBiaUk2SW1oMGRIQTZMeTlzYjJOaGJHaHZjM1E2TXpBd01DSXNJbU55YjNOelQzSnBaMmx1SWpwbVlXeHpaWDAiLCJhdXRoZW50aWNhdG9yRGF0YSI6IlNaWU41WWdPakdoME5CY1BaSFpnVzRfa3JybWloakxIbVZ6enVvTWRsMk1kQUFBQUFBIiwic2lnbmF0dXJlIjoiTUVVQ0lRRDdzc21JRk9pRnNzUGM2SmtfTzNHOGN1a3ZjMVZ6aDVRVHFDVzV4VE5PT3dJZ1hDZ0Z0Ty1nTHc5MTBENlNkM3B1NXFIdGpzYW1Tdmtuc01rTlk2NmMtcXMiLCJ1c2VySGFuZGxlIjoiZFhObGNsOWtaVzF2WHpBd01RIn0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJDLUxOTXN0eDFQVUJDSUdUYTZHZDM4MEgtZ2FRMmppa0tVNms4elBSbWlrIn0sImNhcnRfaGFzaCI6Ijc3NDE2ZWYyZDM2MjE0Y2NlNjhlYjU1ZGZlNjBhNDAwOGFhMDE2YzA3ZWY1MGI3MmJiNWY2MjNmNTgyMmJjYWQiLCJwYXltZW50X2hhc2giOiI0ZjE0NDBiZTFlYTVlMDM0ODA0ODIyNzczNTkyMjlkMDk1ZDQ5NDViNmJiMmFkNWNhZmI5ODEwNTVmMGU2ZjU0In0",
ap2_merchant_agent       |     "risk_score": 6,
ap2_shopping_agent       |         "description": "かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。",
ap2_payment_processor    |     "agent_involved": true,

ap2_merchant_agent       |     "fraud_indicators": [
ap2_shopping_agent       |         "quantity": 1,






ap2_payment_processor    |     "transaction_type": "human_not_present",
ap2_merchant_agent       |       "card_not_present_transaction"




ap2_shopping_agent       |         "unit_price": {
ap2_merchant_agent       |     ]
ap2_payment_processor    |     "id": "payment_9fc6505c",


ap2_payment_processor    |     "cart_mandate_id": "cart_a090db3b",

ap2_shopping_agent       |           "value": "800.0",
ap2_payment_processor    |     "intent_mandate_id": "intent_ef599409",


ap2_merchant_agent       |   },





ap2_shopping_agent       |         },


ap2_payment_processor    |     "payer_id": "user_demo_001",
ap2_merchant_agent       |   "cart_mandate": {


ap2_payment_processor    |     "payee_id": "did:ap2:merchant:mugibo_merchant",
ap2_merchant_agent       |     "id": "cart_a090db3b",


ap2_shopping_agent       |         "total_price": {


ap2_merchant_agent       |     "type": "CartMandate",
ap2_payment_processor    |     "amount": {

ap2_payment_processor    |       "value": "6880.0",

ap2_shopping_agent       |           "value": "800.0",


ap2_shopping_agent       |           "currency": "JPY"
ap2_payment_processor    |       "currency": "JPY"
ap2_shopping_agent       |         },
ap2_merchant_agent       |     "items": [


ap2_shopping_agent       |         "image_url": "/assets/むぎぼーアクリルキーホルダー.png",


ap2_merchant_agent       |       {
ap2_shopping_agent       |         "sku": "MUGI-KEYCHAIN-001",
ap2_payment_processor    |     },


ap2_merchant_agent       |         "id": "item_60fee06e",
ap2_payment_processor    |     "payment_method": {
ap2_shopping_agent       |         "category": "Keychains",

ap2_merchant_agent       |         "name": "むぎぼーアクリルキーホルダー",


ap2_shopping_agent       |         "brand": "Mugibow Official"


ap2_merchant_agent       |         "description": "かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。",
ap2_payment_processor    |       "type": "card",


ap2_shopping_agent       |       },


ap2_payment_processor    |       "token": "tok_67202947_2JSsfRiWK2DZWhf03vm3vTUS",
ap2_merchant_agent       |         "quantity": 1,
ap2_payment_processor    |       "last4": "4242",


ap2_payment_processor    |       "brand": "visa",

ap2_merchant_agent       |         "unit_price": {


ap2_payment_processor    |       "expiry_month": 12,
ap2_shopping_agent       |         "id": "item_2ada806d",
ap2_merchant_agent       |           "value": "800.0",

ap2_shopping_agent       |         "name": "むぎぼー時計",
ap2_payment_processor    |       "expiry_year": 2025





ap2_payment_processor    |     },


ap2_merchant_agent       |           "currency": "JPY"
ap2_shopping_agent       |         "quantity": 1,

ap2_shopping_agent       |         "unit_price": {
ap2_merchant_agent       |         },
ap2_payment_processor    |     "risk_score": 6,
ap2_payment_processor    |     "fraud_indicators": [
ap2_shopping_agent       |           "value": "3500.0",
ap2_merchant_agent       |         "total_price": {


ap2_shopping_agent       |           "currency": "JPY"







ap2_shopping_agent       |         },
ap2_payment_processor    |       "card_not_present_transaction"
ap2_merchant_agent       |           "currency": "JPY"


ap2_shopping_agent       |         "total_price": {
ap2_payment_processor    |     ]

ap2_merchant_agent       |         },
ap2_payment_processor    |   },


ap2_shopping_agent       |           "value": "3500.0",


ap2_merchant_agent       |         "image_url": "/assets/むぎぼーアクリルキーホルダー.png",
ap2_shopping_agent       |           "currency": "JPY"
ap2_payment_processor    |   "cart_mandate": {






ap2_merchant_agent       |         "sku": "MUGI-KEYCHAIN-001",


ap2_shopping_agent       |         },
ap2_payment_processor    |     "id": "cart_a090db3b",


ap2_merchant_agent       |         "category": "Keychains",
ap2_shopping_agent       |         "image_url": "/assets/むぎぼー時計.png",
ap2_shopping_agent       |         "sku": "MUGI-CLOCK-001",


ap2_shopping_agent       |         "category": "Clocks",


ap2_payment_processor    |     "version": "0.2",

ap2_payment_processor    |     "intent_mandate_id": "intent_ef599409",
ap2_merchant_agent       |       },
ap2_payment_processor    |     "items": [": "Mugibow Official"



ap2_merchant_agent       |       {




ap2_shopping_agent       |       },


ap2_payment_processor    |       {
ap2_credential_provider  | {"timestamp": "2025-10-20T23:54:41.281352Z", "level": "INFO", "logger": "provider", "message": "[CredentialProvider] Receipt received and stored: transaction_id=txn_03af7fcc4f38, payer_id=user_demo_001, receipt_url=http://localhost:8004/receipts/txn_03af7fcc4f38.pdf", "module": "provider", "function": "receive_receipt", "line": 1110}


ap2_merchant_agent       |         "id": "item_2ada806d",






ap2_payment_processor    |         "id": "item_60fee06e",
ap2_credential_provider  | INFO:     172.18.0.2:51082 - "POST /receipts HTTP/1.1" 200 OK


ap2_payment_processor    |         "name": "むぎぼーアクリルキーホルダー",

ap2_merchant_agent       |         "name": "むぎぼー時計",
ap2_shopping_agent       |         "id": "item_995133a7",


ap2_shopping_agent       |         "name": "むぎぼーカレンダー",




ap2_merchant_agent       |         "description": "むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。",
ap2_payment_processor    |         "description": "かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。",
ap2_shopping_agent       |         "description": "むぎぼーの1年カレンダー。毎月違うむぎぼーのイラストが楽しめます。",
ap2_payment_processor    |         "quantity": 1,



ap2_merchant_agent       |         "quantity": 1,
ap2_shopping_agent       |         "quantity": 1,


v View in Docker Desktop   o View Config   w Enable Watchap2_payment_processor    |         "unit_price": {
ap2_shopping_agent       |         "unit_price": {


ap2_merchant_agent       |         "unit_price": {


ap2_payment_processor    |           "value": "800.0",
ap2_shopping_agent       |           "value": "1500.0",


ap2_shopping_agent       |           "currency": "JPY"



ap2_merchant_agent       |           "value": "3500.0",

ap2_shopping_agent       |         },
ap2_payment_processor    |           "currency": "JPY"





ap2_payment_processor    |         },
ap2_shopping_agent       |         "total_price": {


ap2_merchant_agent       |           "currency": "JPY"
ap2_payment_processor    |         "total_price": {
ap2_payment_processor    |           "value": "800.0",


ap2_shopping_agent       |           "value": "1500.0",

ap2_merchant_agent       |         },
ap2_payment_processor    |           "currency": "JPY"



ap2_shopping_agent       |           "currency": "JPY"
ap2_merchant_agent       |         "total_price": {


ap2_merchant_agent       |           "value": "3500.0",
ap2_shopping_agent       |         },
   _payment_processor    |         },

ap2_payment_processor    |         "image_url": "/assets/むぎぼーアクリルキーホルダー.png",


ap2_shopping_agent       |         "image_url": "/assets/むぎぼーカレンダー.png",


ap2_payment_processor    |         "sku": "MUGI-KEYCHAIN-001",
ap2_merchant_agent       |         "image_url": "/assets/むぎぼー時計.png",



ap2_shopping_agent       |         "sku": "MUGI-CALENDAR-001",
ap2_merchant_agent       |         "sku": "MUGI-CLOCK-001",
ap2_payment_processor    |         "category": "Keychains",
ap2_shopping_agent       |         "category": "Calendars",





ap2_merchant_agent       |         "category": "Clocks",


ap2_payment_processor    |         "brand": "Mugibow Official"

ap2_merchant_agent       |         "brand": "Mugibow Official"

ap2_shopping_agent       |       }


ap2_shopping_agent       |     ],},

ap2_payment_processor    |       },


v View in Docker Desktop   o View Config   w Enable Watch

ap2_payment_processor    |       {
ap2_merchant_agent       |       {
ap2_shopping_agent       |     "subtotal": {
ap2_merchant_agent       |         "id": "item_995133a7",
ap2_shopping_agent       |       "value": "5800.0",
ap2_payment_processor    |         "id": "item_2ada806d",




ap2_merchant_agent       |         "name": "むぎぼーカレンダー",


ap2_shopping_agent       |       "currency": "JPY"
ap2_payment_processor    |         "name": "むぎぼー時計",
ap2_merchant_agent       |         "description": "むぎぼーの1年カレンダー。毎月違うむぎぼーのイラストが楽しめます。",


ap2_shopping_agent       |     },





ap2_shopping_agent       |     "tax": {
ap2_payment_processor    |         "description": "むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。",
ap2_merchant_agent       |         "quantity": 1,



ap2_shopping_agent       |       "value": "580.0",
ap2_merchant_agent       |         "unit_price": {
ap2_payment_processor    |         "quantity": 1,



ap2_payment_processor    |         "unit_price": {
ap2_merchant_agent       |           "value": "1500.0",



ap2_shopping_agent       |     },
ap2_merchant_agent       |           "currency": "JPY"
ap2_payment_processor    |           "value": "3500.0",
ap2_shopping_agent       |     "shipping": {

ap2_payment_processor    |           "currency": "JPY"

ap2_merchant_agent       |         },



ap2_merchant_agent       |         "total_price": {



ap2_merchant_agent       |           "value": "1500.0",
ap2_payment_processor    |         "total_price": {
ap2_merchant_agent       |           "currency": "JPY"


ap2_merchant_agent       |         },

ap2_payment_processor    |           "value": "3500.0",
ap2_shopping_agent       |         "recipient": "test太郎",


ap2_merchant_agent       |         "image_url": "/assets/むぎぼーカレンダー.png",


ap2_payment_processor    |           "currency": "JPY"


ap2_shopping_agent       |         "postal_code": "111-1111",
ap2_merchant_agent       |         "sku": "MUGI-CALENDAR-001",


ap2_payment_processor    |         },
ap2_shopping_agent       |         "address_line1": "テスト県テスト市テスト町1-1-1",

ap2_payment_processor    |         "sku": "MUGI-CLOCK-001",ぎぼー時計.png",




ap2_merchant_agent       |         "brand": "Mugibow Official"

ap2_shopping_agent       |         "address_line2": "テストアパート111",




ap2_payment_processor    |         "brand": "Mugibow Official"


ap2_shopping_agent       |         "phone": "010-1111-1111"
ap2_merchant_agent       |       }



v View in Docker Desktop   o View Config   w Enable Watch


ap2_shopping_agent       |       },
ap2_merchant_agent       |     ],
ap2_payment_processor    |       },



ap2_merchant_agent       |     "subtotal": {
ap2_payment_processor    |       {method": "standard",

ap2_merchant_agent       |       "value": "5800.0",
ap2_shopping_agent       |       "cost": {






ap2_merchant_agent       |       "currency": "JPY"
ap2_shopping_agent       |         "value": "500.0",
ap2_payment_processor    |         "name": "むぎぼーカレンダー",


ap2_shopping_agent       |         "currency": "JPY"




ap2_shopping_agent       |       },
ap2_payment_processor    |         "description": "むぎぼーの1年カレンダー。毎月違うむぎぼーのイラストが楽しめます。",
ap2_merchant_agent       |     },




ap2_payment_processor    |         "quantity": 1,

ap2_merchant_agent       |     "tax": {

ap2_shopping_agent       |       "estimated_delivery": "2025-10-23T23:54:28.603533Z"
ap2_payment_processor    |         "unit_price": {


ap2_merchant_agent       |       "value": "580.0",
ap2_shopping_agent       |     },


ap2_merchant_agent       |       "currency": "JPY"0.0",
ap2_shopping_agent       |     "total": {


ap2_payment_processor    |           "currency": "JPY"
ap2_shopping_agent       |       "value": "6880.0",


ap2_merchant_agent       |     },


ap2_payment_processor    |         },
ap2_merchant_agent       |     "shipping": {


ap2_shopping_agent       |       "currency": "JPY"
ap2_payment_processor    |         "total_price": {
ap2_merchant_agent       |       "address": {


ap2_merchant_agent       |         "recipient": "test太郎",


ap2_payment_processor    |           "value": "1500.0",


v View in Docker Desktop   o View Config   w Enable Watch

ap2_merchant_agent       |         "postal_code": "111-1111",
ap2_shopping_agent       |     "merchant_id": "did:ap2:merchant:mugibo_merchant",


ap2_shopping_agent       |     "merchant_name": "むぎぼーショップ",


ap2_merchant_agent       |         "address_line1": "テスト県テスト市テスト町1-1-1",



ap2_shopping_agent       |     "created_at": "2025-10-20T23:54:28.603533Z",


ap2_payment_processor    |         "image_url": "/assets/むぎぼーカレンダー.png",

ap2_merchant_agent       |         "address_line2": "テストアパート111",


ap2_merchant_agent       |       },

ap2_payment_processor    |         "sku": "MUGI-CALENDAR-001",
ap2_shopping_agent       |     "expires_at": "2025-10-21T00:24:28.603533Z",




ap2_merchant_agent       |       "method": "standard",


ap2_merchant_agent       |       "cost": {
ap2_payment_processor    |         "category": "Calendars",




ap2_merchant_agent       |         "value": "500.0",

ap2_payment_processor    |         "brand": "Mugibow Official"
ap2_shopping_agent       |     "merchant_signature": {



ap2_merchant_agent       |         "currency": "JPY"



ap2_merchant_agent       |       },
ap2_shopping_agent       |       "algorithm": "ECDSA",
ap2_payment_processor    |     ],
ap2_payment_processor    |     "subtotal": {


ap2_payment_processor    |       "value": "5800.0",y": "2025-10-23T23:54:28.603533Z"

ap2_merchant_agent       |     },"value": "MEYCIQDQ9PwuVSZtUDaHJKKTEBsaFMz0vmEAXNDtdYSVYXv7+gIhAKCJCloEGHzWJJgIOBZV99LMcqbFg4iZ0ylsyhJsdqsQ",

ap2_payment_processor    |       "currency": "JPY"



ap2_payment_processor    |     },
ap2_shopping_agent       |       "public_key": "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFdkF2KzJ4ODI4WjRjWEQ1Y0lha2l6RGt4dVRRTQpZdjM5TXZVR1hmeFFsaDljMVRIczZIUXhmc2tqM1FXUWkvcFZHRHQ2aDdndjBzSmQxdmdXTTFnSDhRPT0KLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg==",

ap2_payment_processor    |     "tax": {


ap2_merchant_agent       |       "value": "6880.0",
ap2_shopping_agent       |       "signed_at": "2025-10-20T23:54:28.651604Z",


ap2_payment_processor    |       "value": "580.0",
ap2_merchant_agent       |       "currency": "JPY"
ap2_payment_processor    |       "currency": "JPY"






ap2_merchant_agent       |     },


ap2_shopping_agent       |     "cart_metadata": {
ap2_payment_processor    |     },erchant_id": "did:ap2:merchant:mugibo_merchant",



ap2_merchant_agent       |     "merchant_name": "むぎぼーショップ",
ap2_shopping_agent       |       "name": "人気商品セット",



ap2_payment_processor    |       "address": {



ap2_merchant_agent       |     "created_at": "2025-10-20T23:54:28.603533Z",


ap2_payment_processor    |         "recipient": "test太郎",
ap2_shopping_agent       |       "description": "検索結果で人気の商品を組み合わせたカートです"
ap2_shopping_agent       |     },
ap2_merchant_agent       |     "expires_at": "2025-10-21T00:24:28.603533Z",
ap2_payment_processor    |         "postal_code": "111-1111",

ap2_payment_processor    |         "address_line1": "テスト県テスト市テスト町1-1-1",


ap2_merchant_agent       |       "algorithm": "ECDSA",
ap2_shopping_agent       |     "merchant_authorization": "eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50IiwiYXVkIjoiZGlkOmFwMjphZ2VudDpwYXltZW50X3Byb2Nlc3NvciIsImlhdCI6MTc2MTAwNDQ2OCwiZXhwIjoxNzYxMDA1MzY4LCJqdGkiOiI1YjI5Y2E3YS1hN2M4LTRjZjctOTU0YS00YzEwNjBiZjNjMDkiLCJjYXJ0X2hhc2giOiI3NzQxNmVmMmQzNjIxNGNjZTY4ZWI1NWRmZTYwYTQwMDhhYTAxNmMwN2VmNTBiNzJiYjVmNjIzZjU4MjJiY2FkIn0.MEQCIDL30t8Xo5NAnPiHJSY0_yGJNgeRrTGb3zgrMjTnquhhAiAvykmZuiAEYb4MBnPQD3RDVPONKVSs5Yi9qjvfo8l7pg"


ap2_shopping_agent       |   }     "address_line2": "テストアパート111",





ap2_merchant_agent       |       "value": "MEYCIQDQ9PwuVSZtUDaHJKKTEBsaFMz0vmEAXNDtdYSVYXv7+gIhAKCJCloEGHzWJJgIOBZV99LMcqbFg4iZ0ylsyhJsdqsQ",
ap2_shopping_agent       | }

ap2_payment_processor    |         "phone": "010-1111-1111"
ap2_merchant_agent       |       "public_key": "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFdkF2KzJ4ODI4WjRjWEQ1Y0lha2l6RGt4dVRRTQpZdjM5TXZVR1hmeFFsaDljMVRIczZIUXhmc2tqM1FXUWkvcFZHRHQ2aDdndjBzSmQxdmdXTTFnSDhRPT0KLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg==",


ap2_merchant_agent       |       "signed_at": "2025-10-20T23:54:28.651604Z",
ap2_shopping_agent       | ================================================================================
ap2_payment_processor    |       },

ap2_merchant_agent       |       "key_id": "merchant"


ap2_merchant_agent       |     },

ap2_payment_processor    |       "method": "standard",
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.144647Z", "level": "INFO", "logger": "agent", "message": "\n================================================================================\n[ShoppingAgent → MerchantAgent] A2Aメッセージ送信（PaymentRequest）\n  URL: http://merchant_agent:8001/a2a/message\n  メッセージID: 6d157af1-f0b0-4956-9fa1-be0f217fec86\n  タイプ: ap2.mandates.PaymentMandate\n  ペイロード: {\n  \"payment_mandate_contents\": {\n    \"payment_mandate_id\": \"payment_9fc6505c\",\n    \"payment_details_id\": \"cart_a090db3b\",\n    \"payment_details_total\": {\n      \"label\": \"Total\",\n      \"amount\": {\n        \"value\": \"6880.0\",\n        \"currency\": \"JPY\"\n      }\n    },\n    \"payment_response\": {\n      \"methodName\": \"basic-card\",\n      \"details\": {\n        \"cardholderName\": \"Demo User\",\n        \"cardNumber\": \"****4242\",\n        \"cardSecurityCode\": \"***\",\n        \"cardBrand\": \"visa\",\n        \"expiryMonth\": 12,\n        \"expiryYear\": 2025,\n        \"token\": \"tok_67202947_2JSsfRiWK2DZWhf03vm3vTUS\",\n        \"tokenized\": true\n      }\n    },\n    \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\",\n    \"timestamp\": \"2025-10-20T23:54:37.705325Z\"\n  },\n  \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE5sY2w5a1pXMXZYekF3TVNJc0luTjFZaUk2SW1ScFpEcGhjREk2ZFhObGNqcDFjMlZ5WDJSbGJXOWZNREF4SWl3aWFXRjBJam94TnpZeE1EQTBORGd4TENKbGVIQWlPakUzTmpFd01EUTNPREVzSW01aVppSTZNVGMyTVRBd05EUTRNU3dpWTI1bUlqcDdJbXAzYXlJNmV5SnJkSGtpT2lKRlF5SXNJbU55ZGlJNklsQXRNalUySWl3aWVDSTZJblpaWlRObmFURnNVWEZMZEZNME56Rm9OMVI0ZDNwbWRsbFBZMmhyU1hBeVduaGxTazFQTldVME1Xc2lMQ0o1SWpvaVQweEpVbXRtYkRWcVIyUnpTRFk0VkUxMmIweE1UMFIzUlZVNVNsbDNkbGt3TUU1NldHNDNPRmxEV1NKOWZYMCIsImtiX2p3dCI6ImV5SmhiR2NpT2lKRlV6STFOaUlzSW5SNWNDSTZJbXRpSzJwM2RDSjkuZXlKaGRXUWlPaUprYVdRNllYQXlPbUZuWlc1ME9uQmhlVzFsYm5SZmNISnZZMlZ6YzI5eUlpd2libTl1WTJVaU9pSkZPR2xKVjFkdlV6aGhiak10VFZnd2QwOXJVVk15VjNvNVYwSnpZM1ZGTmpkT1FVdGxXbXhrWjNoeklpd2lhV0YwSWpveE56WXhNREEwTkRneExDSnpaRjlvWVhOb0lqb2lNbVk0TUdJM1pqaGhOR1V5WkRBd1pUWTJZbVU1WkdFME5tUm1ZbVkwTWprMVl6VXpOV0ZtTkRNM1pUbGhObVkyTWpWaVpqTTBPR1UxWW1aaVl6UmpZU0lzSW5SeVlXNXpZV04wYVc5dVgyUmhkR0VpT2xzaU56YzBNVFpsWmpKa016WXlNVFJqWTJVMk9HVmlOVFZrWm1VMk1HRTBNREE0WVdFd01UWmpNRGRsWmpVd1lqY3lZbUkxWmpZeU0yWTFPREl5WW1OaFpDSXNJalJtTVRRME1HSmxNV1ZoTldVd016UTRNRFE0TWpJM056TTFPVEl5T1dRd09UVmtORGswTldJMlltSXlZV1ExWTJGbVlqazRNVEExTldZd1pUWm1OVFFpWFgwIiwid2ViYXV0aG5fYXNzZXJ0aW9uIjp7ImlkIjoic1JZV0RJZTYtdXdlSGlBT2tTQkRhN1U0bENVV1pPeExwUFVtcmVRbjNoX0lnVVMtdWd4V284NmkzVm1sbzhEY2FsX3ZqNU8takFNQiIsInJhd0lkIjoic1JZV0RJZTYtdXdlSGlBT2tTQkRhN1U0bENVV1pPeExwUFVtcmVRbjNoX0lnVVMtdWd4V284NmkzVm1sbzhEY2FsX3ZqNU8takFNQiIsInJlc3BvbnNlIjp7ImNsaWVudERhdGFKU09OIjoiZXlKMGVYQmxJam9pZDJWaVlYVjBhRzR1WjJWMElpd2lZMmhoYkd4bGJtZGxJam9pUXkxTVRrMXpkSGd4VUZWQ1EwbEhWR0UyUjJRek9EQklMV2RoVVRKcWFXdExWVFpyT0hwUVVtMXBheUlzSW05eWFXZHBiaUk2SW1oMGRIQTZMeTlzYjJOaGJHaHZjM1E2TXpBd01DSXNJbU55YjNOelQzSnBaMmx1SWpwbVlXeHpaWDAiLCJhdXRoZW50aWNhdG9yRGF0YSI6IlNaWU41WWdPakdoME5CY1BaSFpnVzRfa3JybWloakxIbVZ6enVvTWRsMk1kQUFBQUFBIiwic2lnbmF0dXJlIjoiTUVVQ0lRRDdzc21JRk9pRnNzUGM2SmtfTzNHOGN1a3ZjMVZ6aDVRVHFDVzV4VE5PT3dJZ1hDZ0Z0Ty1nTHc5MTBENlNkM3B1NXFIdGpzYW1Tdmtuc01rTlk2NmMtcXMiLCJ1c2VySGFuZGxlIjoiZFhObGNsOWtaVzF2WHpBd01RIn0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJDLUxOTXN0eDFQVUJDSUdUYTZHZDM4MEgtZ2FRMmppa0tVNms4elBSbWlrIn0sImNhcnRfaGFzaCI6Ijc3NDE2ZWYyZDM2MjE0Y2NlNjhlYjU1ZGZlNjBhNDAwOGFhMDE2YzA3ZWY1MGI3MmJiNWY2MjNmNTgyMmJjYWQiLCJwYXltZW50X2hhc2giOiI0ZjE0NDBiZTFlYTVlMDM0ODA0ODIyNzczNTkyMjlkMDk1ZDQ5NDViNmJiMmFkNWNhZmI5ODEwNTVmMGU2ZjU0In0\",\n  \"agent_involved\": true,\n  \"transaction_type\": \"human_not_present\",\n  \"id\": \"payment_9fc6505c\",\n  \"cart_mandate_id\": \"cart_a090db3b\",\n  \"intent_mandate_id\": \"intent_ef599409\",\n  \"payer_id\": \"user_demo_001\",\n  \"payee_id\": \"did:ap2:merchant:mugibo_merchant\",\n  \"amount\": {\n    \"value\": \"6880.0\",\n    \"currency\": \"JPY\"\n  },\n  \"payment_method\": {\n    \"type\": \"card\",\n    \"token\": \"tok_67202947_2JSsfRiWK2DZWhf03vm3vTUS\",\n    \"last4\": \"4242\",\n    \"brand\": \"visa\",\n    \"expiry_month\": 12,\n    \
ap2_shopping_agent       | [2025-10-20 23:54:41,285] INFO in httpx: HTTP Request: POST http://merchant_agent:8001/a2a/message "HTTP/1.1 200 OK"===================================



ap2_merchant_agent       |     "cart_metadata": {


v View in Docker Desktop   o View Config   w Enable Watch

ap2_merchant_agent       |       "name": "人気商品セット",




ap2_payment_processor    |         "value": "500.0",
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.285782Z", "level": "INFO", "logger": "agent", "message": "\n================================================================================\n[ShoppingAgent ← MerchantAgent] A2Aレスポンス受信\n  Status: 200\n  Response Body: {\n  \"header\": {\n    \"message_id\": \"5de6dd33-6af3-4a53-9a7b-2100b64b1603\",\n    \"sender\": \"did:ap2:agent:merchant_agent\",\n    \"recipient\": \"did:ap2:agent:shopping_agent\",\n    \"timestamp\": \"2025-10-20T23:54:41.284262Z\",\n    \"nonce\": \"8b3e43240546c3d490eae18102270c20afddf21a5edfbc12437eb57fc8364222\",\n    \"schema_version\": \"0.2\",\n    \"proof\": {\n      \"algorithm\": \"ed25519\",\n      \"signatureValue\": \"oJEQqgUd751Lyzj8ScseBaBAOuCE5O6RC+KAGk3TRfrHjR4ikfXnHmSA6DSS/hIq4tgqVfY/hK5wN3N7aufOAg==\",\n      \"publicKey\": \"LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUNvd0JRWURLMlZ3QXlFQVZGVk9taC9Kd2R3R0FTMGg3R0VnR1RtMS9IQ2FoVEgzZUl3NVI2K2poeW89Ci0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLQo=\",\n      \"kid\": \"did:ap2:agent:merchant_agent#key-2\",\n      \"created\": \"2025-10-20T23:54:41.284262Z\",\n      \"proofPurpose\": \"authentication\"\n    },\n    \"signature\": null\n  },\n  \"dataPart\": {\n    \"@type\": \"ap2.responses.PaymentResult\",\n    \"id\": \"825753c0-131b-46f9-a82a-5618f151d27b\",\n    \"payload\": {\n      \"transaction_id\": \"txn_03af7fcc4f38\",\n      \"status\": \"captured\",\n      \"receipt_url\": \"http://localhost:8004/receipts/txn_03af7fcc4f38.pdf\"\n    },\n    \"kind\": null,\n    \"artifact\": null\n  }\n}\n================================================================================", "module": "agent", "function": "_process_payment_via_payment_processor", "line": 2892}




ap2_merchant_agent       |       "description": "検索結果で人気の商品を組み合わせたカートです"
ap2_payment_processor    |         "currency": "JPY"

ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.285892Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Payment processing completed: status=captured", "module": "agent", "function": "_process_payment_via_payment_processor", "line": 2908}
ap2_merchant_agent       |     },
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.285949Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] Payment successful: txn_03af7fcc4f38", "module": "agent", "function": "submit_payment_attestation", "line": 848}




ap2_merchant_agent       |     "merchant_authorization": "eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50IiwiYXVkIjoiZGlkOmFwMjphZ2VudDpwYXltZW50X3Byb2Nlc3NvciIsImlhdCI6MTc2MTAwNDQ2OCwiZXhwIjoxNzYxMDA1MzY4LCJqdGkiOiI1YjI5Y2E3YS1hN2M4LTRjZjctOTU0YS00YzEwNjBiZjNjMDkiLCJjYXJ0X2hhc2giOiI3NzQxNmVmMmQzNjIxNGNjZTY4ZWI1NWRmZTYwYTQwMDhhYTAxNmMwN2VmNTBiNzJiYjVmNjIzZjU4MjJiY2FkIn0.MEQCIDL30t8Xo5NAnPiHJSY0_yGJNgeRrTGb3zgrMjTnquhhAiAvykmZuiAEYb4MBnPQD3RDVPONKVSs5Yi9qjvfo8l7pg"
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.285969Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] CartMandate info: items_count=3, total={'value': '6880.0', 'currency': 'JPY'}", "module": "agent", "function": "submit_payment_attestation", "line": 855}





ap2_merchant_agent       |   }
ap2_shopping_agent       | {"timestamp": "2025-10-20T23:54:41.285991Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] Payment success response: product_name=むぎぼーアクリルキーホルダー 他2点, amount=6880.0, currency=JPY", "module": "agent", "function": "submit_payment_attestation", "line": 875}
ap2_payment_processor    |     },


ap2_payment_processor    |     "total": {
ap2_shopping_agent       | INFO:     151.101.64.223:19617 - "POST /payment/submit-attestation HTTP/1.1" 200 OK
ap2_merchant_agent       | }


ap2_merchant_agent       | ================================================================================

ap2_payment_processor    |       "currency": "JPY"

ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.146808Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Verifying A2A message signature", "module": "crypto", "function": "verify_a2a_message_signature", "line": 828}



ap2_payment_processor    |     },
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.147027Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "[VERIFY] Canonical JSON length: 6639, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_9fc6505c\",\"payload\":{\"cart_mandate\":{\"cart_metadata\":{\"description\":\"検索結果で人気の商品を組み合わせたカートです\",\"name\":\"人気商品セット\"},\"created_at\":\"2025-10-20", "module": "crypto", "function": "verify_a2a_message_signature", "line": 832}


ap2_payment_processor    |     "merchant_id": "did:ap2:merchant:mugibo_merchant",
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.147050Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Verifying signature (algorithm: ED25519)", "module": "crypto", "function": "verify_signature", "line": 662}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.147206Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Crypto VERIFY: ED25519 (key: did:ap2:agent:shopping_agent#key-2) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 271}


ap2_payment_processor    |     "created_at": "2025-10-20T23:54:28.603533Z",handler: [A2AHandler] proof署名検証成功: sender=did:ap2:agent:shopping_agent, alg=ed25519, kid=did:ap2:agent:shopping_agent#key-2, public_key_source=DID-resolved
ap2_payment_processor    |     "expires_at": "2025-10-21T00:24:28.603533Z",
ap2_merchant_agent       | [2025-10-20 23:54:41,147] INFO in v2.common.a2a_handler: [A2A処理] ハンドラー実行中: type=ap2.mandates.PaymentMandate, from=did:ap2:agent:shopping_agent
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.147264Z", "level": "INFO", "logger": "agent", "message": "[MerchantAgent] Received PaymentRequest from Shopping Agent", "module": "agent", "function": "handle_payment_request", "line": 448}
ap2_payment_processor    |     "merchant_signature": {



ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.147278Z", "level": "INFO", "logger": "agent", "message": "[MerchantAgent] Forwarding PaymentMandate to Payment Processor: payment_mandate_id=payment_9fc6505c", "module": "agent", "function": "handle_payment_request", "line": 467}
ap2_payment_processor    |       "algorithm": "ECDSA",
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.147335Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Signing A2A message (sender: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 800}





ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.147556Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "[SIGN] Canonical JSON length: 6642, first 200
ap2_payment_processor    |       "public_key": "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFdkF2KzJ4ODI4WjRjWEQ1Y0lha2l6RGt4dVRRTQpZdjM5TXZVR1hmeFFsaDljMVRIczZIUXhmc2tqM1FXUWkvcFZHRHQ2aDdndjBzSmQxdmdXTTFnSDhRPT0KLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg==",


ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.147585Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Signing data (key_id: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 599}
ap2_payment_processor    |       "signed_at": "2025-10-20T23:54:28.651604Z",
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.147772Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Crypto SIGN: ED25519 (key: merchant_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 271}
ap2_payment_processor    |       "key_id": "merchant"



ap2_merchant_agent       | [2025-10-20 23:54:41,147] INFO in v2.common.a2a_handler:
ap2_payment_processor    |     },
ap2_merchant_agent       | ================================================================================


ap2_payment_processor    |     "cart_metadata": {


ap2_payment_processor    |       "name": "人気商品セット",
ap2_merchant_agent       | [A2A送信] レスポンス作成


ap2_merchant_agent       |   送信元: did:ap2:agent:merchant_agent
ap2_payment_processor    |       "description": "検索結果で人気の商品を組み合わせたカートです"




ap2_merchant_agent       |   送信先: did:ap2:agent:payment_processor
ap2_payment_processor    |     },
ap2_payment_processor    |     "merchant_authorization": "eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50IiwiYXVkIjoiZGlkOmFwMjphZ2VudDpwYXltZW50X3Byb2Nlc3NvciIsImlhdCI6MTc2MTAwNDQ2OCwiZXhwIjoxNz
ap2_merchant_agent       |   タイプ: ap2.mandates.PaymentMandateNjMDkiLCJjYXJ0X2hhc2giOiI3NzQxNmVmMmQzNjIxNGNjZTY4ZWI1NWRmZTYwYTQwMDhhYTAxNmMwN2VmNTBiNzJiYjVmNjIzZjU4MjJiY2FkIn0.
ap2_merchant_agent       |   データID: payment_9fc6505c
ap2_merchant_agent       |   署名: あり



ap2_merchant_agent       |   タイムスタンプ: 2025-10-20T23:54:41.147290Z


ap2_payment_processor    | ================================================================================
ap2_merchant_agent       |   ペイロード: {


ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.174863Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Verifying A2A message signature", "module": "c
ap2_merchant_agent       |   "payment_mandate": {

ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.176066Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "[VERIFY] Canonical JSON length: 6642, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_9fc6505c\",\"payload\":{\"cart_mandate\":{\"cart_metadata\":{\"description\":\"検索結果で人気の商品を組み合わせたカートです\",\"name\":\"人気商品セット\"},\"created_at\":\"2025-10-20", "module": "crypto", "function": "verify_a2a_message_signature", "line": 832}
ap2_merchant_agent       |     "payment_mandate_contents": {
ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.176104Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Verifying signature (algorithm: ED25519)", "module": "crypto", "function": "verify_signature", "line": 662}


ap2_merchant_agent       |       "payment_mandate_id": "payment_9fc6505c",

ap2_payment_processor    | [2025-10-20 23:54:41,178] INFO in v2.common.a2a_handler: [A2AHandler] proof署名検証成功: sender=did:ap2:agent:merchant_agent, alg=ed25519, kid=did:ap2:

ap2_merchant_agent       |       "payment_details_id": "cart_a090db3b",
       ment_processor    | [2025-10-20 23:54:41,178] INFO in v2.common.a2a_handler: [A2A処理] ハンドラー実行中: type=ap2.mandates.PaymentMandate, from=did:ap2:agent:merchant_agent


ap2_merchant_agent       |       "payment_details_total": {


ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.178241Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Crypto VERIFY: ED25519 (key: did:ap2:agent:merchant_agent#key-2) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 271}
ap2_merchant_agent       |         "label": "Total",



ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.178404Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Received PaymentMandate", "module": "processor", "function": "handle_payment_mandate", "line": 268}


ap2_merchant_agent       |         "amount": {


ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.178551Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] PaymentMandate validation passed: payment_9fc6505c, user_authorization present: eyJpc3N1ZXJfand0Ijoi...", "module": "processor", "function": "_validate_payment_mandate", "line": 369}
ap2_merchant_agent       |           "value": "6880.0",


ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.178589Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Mandate chain validation: PaymentMandate(payment_9fc6505c) → CartMandate(cart_a090db3b)", "module": "processor", "function": "_validate_mandate_chain", "line": 765}
ap2_merchant_agent       |           "currency": "JPY"
ap2_merchant_agent       |         }
ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.178957Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Verifying SD-JWT-VC user_authorization: cart_hash=77416ef2d36214cc..., payment_hash=4f1440be1ea5e034...", "module": "processor", "function": "_validate_mandate_chain", "line": 782}
ap2_merchant_agent       |       },

ap2_payment_processor    | [2025-10-20 23:54:41,179] INFO in v2.common.user_authorization: [verify_user_authorization_vp] Decoded VP successfully

ap2_merchant_agent       |       "payment_response": {
ap2_payment_processor    | [2025-10-20 23:54:41,179] INFO in v2.common.user_authorization: [verify_user_authorization_vp] Hash verification passed: cart_hash=77416ef2d36214cc..., payment_hash=4f1440be1ea5e034...
ap2_merchant_agent       |         "methodName": "basic-card",
ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.182599Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] ✓ SD-JWT-VC user_authorization verified: cart_hash_match=True, payment_hash_match=True, webauthn_signature_verified=True", "module": "processor", "function": "_validate_mandate_chain", "line": 795}
ap2_merchant_agent       |         "details": {



ap2_payment_processor    | [2025-10-20 23:54:41,182] INFO in v2.common.user_authorization: [verify_user_authorization_vp] ✓ WebAuthn signature verified successfully
ap2_merchant_agent       |           "cardholderName": "Demo User",


ap2_merchant_agent       |           "cardNumber": "****4242",
ap2_payment_processor    | [2025-10-20 23:54:41,182] INFO in v2.common.user_authorization: [verify_user_authorization_vp] Key-binding JWT payload verified



ap2_payment_processor    | [2025-10-20 23:54:41,182] INFO in v2.common.user_authorization: [verify_user_authorization_vp] ✓ VP verification passed




ap2_payment_processor    | [2025-10-20 23:54:41,183] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/shopping_agent_did.json


ap2_merchant_agent       |           "expiryMonth": 12,

ap2_payment_processor    | [2025-10-20 23:54:41,183] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent




ap2_merchant_agent       |           "expiryYear": 2025,
ap2_payment_processor    | [2025-10-20 23:54:41,183] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_agent_did.json




ap2_merchant_agent       |           "token": "tok_67202947_2JSsfRiWK2DZWhf03vm3vTUS",


ap2_payment_processor    | [2025-10-20 23:54:41,183] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_merchant_agent       |           "tokenized": true
ap2_merchant_agent       |         }
ap2_payment_processor    | [2025-10-20 23:54:41,183] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/merchant_did.json




ap2_merchant_agent       |       },
ap2_payment_processor    | [2025-10-20 23:54:41,183] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant

ap2_merchant_agent       |       "merchant_agent": "did:ap2:merchant:mugibo_merchant",
ap2_payment_processor    | [2025-10-20 23:54:41,184] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_payment_processor    | [2025-10-20 23:54:41,184] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp

ap2_merchant_agent       |       "timestamp": "2025-10-20T23:54:37.705325Z"
ap2_payment_processor    | [2025-10-20 23:54:41,184] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant_agent       |     },


ap2_payment_processor    | [2025-10-20 23:54:41,184] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_merchant_agent       |     "user_authorization": "eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE5sY2w5a1pXMXZYekF3TVNJc0luTjFZaUk2SW1ScFpEcGhjREk2ZFhObGNqcDFjMlZ5WDJSbGJXOWZNREF4SWl3aWFXRjBJam94TnpZeE1EQTBORGd4TENKbGVIQWlPakUzTmpFd01EUTNPREVzSW01aVppSTZNVGMyTVRBd05EUTRNU3dpWTI1bUlqcDdJbXmFURnNVWEZMZEZNME56Rm9OMVI0ZDNwbWRsbFBZMmhyU1hBeVduaGxTazFQTldVME1Xc2lMQ0o1SWpvaVQweEpVbXRtYkRWcVIyUnpTRFk0VkUxMmIweE1UMFIzUlZVNVNsbDNkbGt3TUU1NldHNDNPRmxEV1NKOWZYMCIsImtiX2p3dCI6ImV5SmhiR2NpT2lKRlV6STFOaUlzSW5SNWNDSTZJbXRpSzJwM2RDSjkuZXlKaGRXUWlPaUprYVdRNllYQXlPbUZuWlc1ME9uQmhlVzFsYm5SZmNISnZZMlZ6YzI5eUlpd2libTl1WTJVaU9pSkZPR2xKVjFkdlV6aGhiak10VFZnd2QwOXJVVk15VjNvNVYwSnpZM1ZGTmpkT1FVdGxXbXhrWjNoeklpd2lhV0YwSWpveE56WXhNREEwTkRneExDSnpaRjlvWVhOb0lqb2lNbVk0TUdJM1pqaGhOR1V5WkRBd1pUWTJZbVU1WkdFME5tUm1ZbVkwTWprMVl6VXpOV0ZtTkRNM1pUbGhObVkyTWpWaVpqTTBPR1UxWW1aaVl6UmpZU0lzSW5SeVlXNXpZV04wYVc5dVgyUmhkR0VpT2xzaU56YzBNVFpsWmpKa016WXlNVFJqWTJVMk9HVmlOVFZrWm1VMk1HRTBNREE0WVdFd01UWmpNRGRsWmpVd1lqY3lZbUkxWmpZeU0yWTFPREl5WW1OaFpDSXNJalJtTVRRME1HSmxNV1ZoTldVd016UTRNRFE0TWpJM056TTFPVEl5T1dRd09UVmtORGswTldJMlltSXlZV1ExWTJGbVlqazRNVEExTldZd1pUWm1OVFFpWFgwIiwid2ViYXV0aG5fYXNzZXJ0aW9uIjp7ImlkIjoic1JZV0RJZTYtdXdlSGlBT2tTQkRhN1U0bENVV1pPeExwUFVtcmVRbjNoX0lnVVMtdWd4V284NmkzVm1sbzhEY2FsX3ZqNU8takFNQiIsInJhd0lkIjoic1JZV0RJZTYtdXdlSGlBT2tTQkRhN1U0bENVV1pPeExwUFVtcmVRbjNoX0lnVVMtdWd4V284NmkzVm1sbzhEY2FsX3ZqNU8takFNQiIsInJlc3BvbnNlIjp7ImNsaWVudERhdGFKU09OIjoiZXlKMGVYQmxJam9pZDJWaVlYVjBhRzR1WjJWMElpd2lZMmhoYkd4bGJtZGxJam9pUXkxTVRrMXpkSGd4VUZWQ1EwbEhWR0UyUjJRek9EQklMV2RoVVRKcWFXdExWVFpyT0hwUVVtMXBheUlzSW05eWFXZHBiaUk2SW1oMGRIQTZMeTlzYjJOaGJHaHZjM1E2TXpBd01DSXNJbU55YjNOelQzSnBaMmx1SWpwbVlXeHpaWDAiLCJhdXRoZW50aWNhdG9yRGF0YSI6IlNaWU41WWdPakdoME5CY1BaSFpnVzRfa3JybWloakxIbVZ6enVvTWRsMk1kQUFBQUFBIiwic2lnbmF0dXJlIjoiTUVVQ0lRRDdzc21JRk9pRnNzUGM2SmtfTzNHOGN1a3ZjMVZ6aDVRVHFDVzV4VE5PT3dJZ1hDZ0Z0Ty1nTHc5MTBENlNkM3B1NXFIdGpzYW1Tdmtuc01rTlk2NmMtcXMiLCJ1c2VySGFuZGxlIjoiZFhObGNsOWtaVzF2WHpBd01RIn0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJDLUxOTXN0eDFQVUJDSUdUYTZHZDM4MEgtZ2FRMmppa0tVNms4elBSbWlrIn0sImNhcnRfaGFzaCI6Ijc3NDE2ZWYyZDM2MjE0Y2NlNjhlYjU1ZGZlNjBhNDAwOGFhMDE2YzA3ZWY1MGI3MmJiNWY2MjNmNTgyMmJjYWQiLCJwYXltZW50X2hhc2giOiI0ZjE0NDBiZTFlYTVlMDM0ODA0ODIyNzczNTkyMjlkMDk1ZDQ5NDViNmJiMmFkNWNhZmI5ODEwNTVmMGU2ZjU0In0",




ap2_merchant_agent       |     "agent_involved": true,
ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.184552Z", "level": "INFO", "logger": "processor", "message": "[_verify_merchant_authorization_jwt] ✓ JWT signature verified successfully", "module": "processor", "function": "_verify_merchant_authorization_jwt", "line": 697}


ap2_merchant_agent       |     "transaction_type": "human_not_present",
ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.184587Z", "level": "INFO", "logger": "processor", "message": "[_verify_merchant_authorization_jwt] JWT validation passed: iss=did:ap2:merchant:mugibo_merchant, exp=1761005368, jti=5b29ca7a-a7c8-4c..., cart_hash=77416ef2d36214cc...", "module": "processor", "function": "_verify_merchant_authorization_jwt", "line": 706}


ap2_merchant_agent       |     "id": "payment_9fc6505c",


ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.184613Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] merchant_authorization JWT verified: iss=did:ap2:merchant:mugibo_merchant", "module": "processor", "function": "_validate_mandate_chain", "line": 819}
ap2_merchant_agent       |     "cart_mandate_id": "cart_a090db3b",




                                 ntent_mandate_id": "intent_ef599409",


ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.184786Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] ✓ CartMandate hash verified (merchant_authorization): 77416ef2d36214cc...", "module": "processor", "function": "_validate_mandate_chain", "line": 844}


ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.184827Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Full mandate chain validated: IntentMandate(intent_ef599409) → CartMandate(cart_a090db3b) → PaymentMandate(payment_9fc6505c)", "module": "processor", "function": "_validate_mandate_chain", "line": 869}
ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.184847Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Mandate chain validation passed", "module": "processor", "function": "_validate_mandate_chain", "line": 876}

ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.184997Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Processing payment (mock): txn_03af7fcc4f38", "module": "processor", "function": "_process_payment_mock", "line": 895}




ap2_merchant_agent       |     "amount": {
ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.185027Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Verifying credential with Credential Provider: token=tok_67202947_2JSsfRi...", "module": "processor", "function": "_verify_credential_with_cp", "line": 1010}
ap2_payment_processor    | [2025-10-20 23:54:41,209] INFO in httpx: HTTP Request: POST http://credential_provider:8003/credentials/verify "HTTP/1.1 200 OK"

ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.209810Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Credential verification succeeded: payment_method_id=pm_001", "module": "processor", "function": "_verify_credential_with_cp", "line": 1034}
ap2_merchant_agent       |       "currency": "JPY"




ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.209843Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Credential verified: pm_001", "module": "processor", "function": "_process_payment_mock", "line": 918}
ap2_merchant_agent       |     },
ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.209860Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Risk assessment: score=6, indicators=['card_not_present_transaction']", "module": "processor", "function": "_process_payment_mock", "line": 933}

ap2_merchant_agent       |       "type": "card",
ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.209909Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Payment succeeded: txn_03af7fcc4f38, amount={'value': '6880.0', 'currency': 'JPY'}, risk_score=6", "module": "processor", "function": "_process_payment_mock", "line": 967}
ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.226903Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Transaction saved: txn_03af7fcc4f38", "module": "processor", "function": "_save_transaction", "line": 994}
ap2_merchant_agent       |       "token": "tok_67202947_2JSsfRiWK2DZWhf03vm3vTUS",


ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.277945Z", "level": "WARNING", "logger": "processor", "message": "[PaymentProcessor] User not found for payer_id: user_demo_001, using default name", "module": "processor", "function": "_generate_receipt", "line": 1178}
ap2_merchant_agent       |       "last4": "4242",

ap2_payment_processor    | [2025-10-20 23:54:41,278] INFO in v2.common.receipt_generator: [ReceiptGenerator] Generating PDF receipt for transaction: txn_03af7fcc4f38




ap2_merchant_agent       |       "brand": "visa",
ap2_payment_processor    | [2025-10-20 23:54:41,280] INFO in v2.common.receipt_generator: [ReceiptGenerator] PDF receipt generated successfully




ap2_merchant_agent       |       "expiry_month": 12,
ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.280502Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Generated receipt PDF: /app/v2/data/receipts/txn_03af7fcc4f38.pdf", "module": "processor", "function": "_generate_receipt", "line": 1199}

ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.280555Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Sending receipt notification to Cre

ap2_merchant_agent       |       "expiry_year": 2025



                                       23:54:41,281] INFO in httpx: HTTP Request: POST http://credential_provider:8003/receipts "HTTP/1.1 200 OK"
ap2_merchant_agent       |     },



ap2_merchant_agent       |     "risk_score": 6,
ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.281969Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Receipt notification sent successfully: transaction_id=txn_03af7fcc4f38, status=200", "module": "processor", "function": "_send_receipt_to_credential_provider", "line": 1082}

ap2_payment_processor    | [2025-10-20 23:54:41,282] INFO in v2.common.a2a_handler: [A2A処理] ハンドラー完了: type=ap2.mandates.PaymentMandate, result_type=ap2.responses.PaymentResult
ap2_merchant_agent       |     "fraud_indicators": [




ap2_merchant_agent       |       "card_not_present_transaction"
ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.282124Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Signing A2A message (sender: payment_processor, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 800}
ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.282178Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "[SIGN] Canonical JSON length: 521, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.responses.PaymentResult\",\"id\":\"825753c0-131b-46f9-a82a-5618f151d27b\",\"payload\":{\"receipt_url\":\"http://localhost:8004/receipts/txn_03af7fcc4f38.pdf\",\"status\":\"captured\",\"trans", "module": "crypto", "function": "sign_a2a_message", "line": 804}



ap2_merchant_agent       |     ]
ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.282194Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Signing data (key_id: payment_processor, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 599}


ap2_payment_processor    | {"timestamp": "2025-10-20T23:54:41.282955Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Crypto SIGN: ED25519 (key: payment_processor) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 271}
ap2_merchant_agent       |   },

ap2_payment_processor    | [2025-10-20 23:54:41,283] INFO in v2.common.a2a_handler:




ap2_merchant_agent       |   "cart_mandate": {
ap2_payment_processor    | ================================================================================


ap2_payment_processor    | [A2A送信] レスポンス作成",


ap2_merchant_agent       |     "type": "CartMandate",


ap2_payment_processor    |   送信先: did:ap2:agent:merchant_agent

ap2_merchant_agent       |     "version": "0.2",
ap2_merchant_agent       |     "intent_mandate_id": "intent_ef599409",
ap2_payment_processor    |   タイプ: ap2.responses.PaymentResult


ap2_merchant_agent       |     "items": [
ap2_payment_processor    |   データID: 825753c0-131b-46f9-a82a-5618f151d27b



ap2_merchant_agent       |       {
ap2_payment_processor    |   署名: あり

ap2_payment_processor    |   タイムスタンプ: 2025-10-20T23:54:41.282031Z


ap2_merchant_agent       |         "name": "むぎぼーアクリルキーホルダー",

ap2_merchant_agent       |         "description": "かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。",
ap2_payment_processor    |   ペイロード: {



ap2_payment_processor    |   "transaction_id": "txn_03af7fcc4f38",




ap2_merchant_agent       |           "value": "800.0",

                                                                      eipts/txn_03af7fcc4f38.pdf"
ap2_merchant_agent       |           "currency": "JPY"



ap2_payment_processor    | }
ap2_merchant_agent       |         },
ap2_payment_processor    | ================================================================================
ap2_merchant_agent       |         "total_price": {



ap2_payment_processor    | [2025-10-20 23:54:41,283] INFO in v2.common.base_agent: [Payment Processor] A2Aレスポンス返却: type=ap2.responses.PaymentResult, to=did:ap2:agent:merchant_agent
ap2_merchant_agent       |           "value": "800.0",


ap2_payment_processor    | INFO:     172.18.0.6:36798 - "POST /a2a/message HTTP/1.1" 200 OK
ap2_merchant_agent       |           "currency": "JPY"
ap2_merchant_agent       |         },
ap2_merchant_agent       |         "image_url": "/assets/むぎぼーアクリルキーホルダー.png",
ap2_merchant_agent       |         "sku": "MUGI-KEYCHAIN-001",
ap2_merchant_agent       |         "category": "Keychains",
ap2_merchant_agent       |         "brand": "Mugibow Official"
ap2_merchant_agent       |       },
ap2_merchant_agent       |       {
ap2_merchant_agent       |         "id": "item_2ada806d",
ap2_merchant_agent       |         "name": "むぎぼー時計",
ap2_merchant_agent       |         "description": "むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。",
ap2_merchant_agent       |         "quantity": 1,
ap2_merchant_agent       |         "unit_price": {
ap2_merchant_agent       |           "value": "3500.0",
ap2_merchant_agent       |           "currency": "JPY"
ap2_merchant_agent       |         },
ap2_merchant_agent       |         "total_price": {
ap2_merchant_agent       |           "value": "3500.0",
ap2_merchant_agent       |           "currency": "JPY"
ap2_merchant_agent       |         },
ap2_merchant_agent       |         "image_url": "/assets/むぎぼー時計.png",
ap2_merchant_agent       |         "sku": "MUGI-CLOCK-001",
ap2_merchant_agent       |         "category": "Clocks",
ap2_merchant_agent       |         "brand": "Mugibow Official"
ap2_merchant_agent       |       },
ap2_merchant_agent       |       {
ap2_merchant_agent       |         "id": "item_995133a7",
ap2_merchant_agent       |         "name": "むぎぼーカレンダー",
ap2_merchant_agent       |         "description": "むぎぼーの1年カレンダー。毎月違うむぎぼーのイラストが楽しめます。",
ap2_merchant_agent       |         "quantity": 1,
ap2_merchant_agent       |         "unit_price": {
ap2_merchant_agent       |           "value": "1500.0",
ap2_merchant_agent       |           "currency": "JPY"
ap2_merchant_agent       |         },
ap2_merchant_agent       |         "total_price": {
ap2_merchant_agent       |           "value": "1500.0",
ap2_merchant_agent       |           "currency": "JPY"
ap2_merchant_agent       |         },
ap2_merchant_agent       |         "image_url": "/assets/むぎぼーカレンダー.png",
ap2_merchant_agent       |         "sku": "MUGI-CALENDAR-001",
ap2_merchant_agent       |         "category": "Calendars",
ap2_merchant_agent       |         "brand": "Mugibow Official"
ap2_merchant_agent       |       }
ap2_merchant_agent       |     ],
ap2_merchant_agent       |     "subtotal": {
ap2_merchant_agent       |       "value": "5800.0",
ap2_merchant_agent       |       "currency": "JPY"
ap2_merchant_agent       |     },
ap2_merchant_agent       |     "tax": {
ap2_merchant_agent       |       "value": "580.0",
ap2_merchant_agent       |       "currency": "JPY"
ap2_merchant_agent       |     },
ap2_merchant_agent       |     "shipping": {
ap2_merchant_agent       |       "address": {
ap2_merchant_agent       |         "recipient": "test太郎",
ap2_merchant_agent       |         "postal_code": "111-1111",
ap2_merchant_agent       |         "address_line1": "テスト県テスト市テスト町1-1-1",
ap2_merchant_agent       |         "address_line2": "テストアパート111",
ap2_merchant_agent       |         "phone": "010-1111-1111"
ap2_merchant_agent       |       },
ap2_merchant_agent       |       "method": "standard",
ap2_merchant_agent       |       "cost": {
ap2_merchant_agent       |         "value": "500.0",
ap2_merchant_agent       |         "currency": "JPY"
ap2_merchant_agent       |       },
ap2_merchant_agent       |       "estimated_delivery": "2025-10-23T23:54:28.603533Z"
ap2_merchant_agent       |     },
ap2_merchant_agent       |     "total": {
ap2_merchant_agent       |       "value": "6880.0",
ap2_merchant_agent       |       "currency": "JPY"
ap2_merchant_agent       |     },
ap2_merchant_agent       |     "merchant_id": "did:ap2:merchant:mugibo_merchant",
ap2_merchant_agent       |     "merchant_name": "むぎぼーショップ",
ap2_merchant_agent       |     "created_at": "2025-10-20T23:54:28.603533Z",
ap2_merchant_agent       |     "expires_at": "2025-10-21T00:24:28.603533Z",
ap2_merchant_agent       |     "merchant_signature": {
ap2_merchant_agent       |       "algorithm": "ECDSA",
ap2_merchant_agent       |       "value": "MEYCIQDQ9PwuVSZtUDaHJKKTEBsaFMz0vmEAXNDtdYSVYXv7+gIhAKCJCloEGHzWJJgIOBZV99LMcqbFg4iZ0ylsyhJsdqsQ",
ap2_merchant_agent       |       "public_key": "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFdkF2KzJ4ODI4WjRjWEQ1Y0lha2l6RGt4dVRRTQpZdjM5TXZVR1hmeFFsaDljMVRIczZIUXhmc2tqM1FXUWkvcFZHRHQ2aDdndjBzSmQxdmdXTTFnSDhRPT0KLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg==",
ap2_merchant_agent       |       "signed_at": "2025-10-20T23:54:28.651604Z",
ap2_merchant_agent       |       "key_id": "merchant"
ap2_merchant_agent       |     },
ap2_merchant_agent       |     "cart_metadata": {
ap2_merchant_agent       |       "name": "人気商品セット",
ap2_merchant_agent       |       "description": "検索結果で人気の商品を組み合わせたカートです"
ap2_merchant_agent       |     },
ap2_merchant_agent       |     "merchant_authorization": "eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50IiwiYXVkIjoiZGlkOmFwMjphZ2VudDpwYXltZW50X3Byb2Nlc3NvciIsImlhdCI6MTc2MTAwNDQ2OCwiZXhwIjoxNzYxMDA1MzY4LCJqdGkiOiI1YjI5Y2E3YS1hN2M4LTRjZjctOTU0YS00YzEwNjBiZjNjMDkiLCJjYXJ0X2hhc2giOiI3NzQxNmVmMmQzNjIxNGNjZTY4ZWI1NWRmZTYwYTQwMDhhYTAxNmMwN2VmNTBiNzJiYjVmNjIzZjU4MjJiY2FkIn0.MEQCIDL30t8Xo5NAnPiHJSY0_yGJNgeRrTGb3zgrMjTnquhhAiAvykmZuiAEYb4MBnPQD3RDVPONKVSs5Yi9qjvfo8l7pg"
ap2_merchant_agent       |   }
ap2_merchant_agent       | }
ap2_merchant_agent       | ================================================================================
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.147965Z", "level": "INFO", "logger": "agent", "message": "\n================================================================================\n[MerchantAgent → PaymentProcessor] A2Aメッセージ転送\n  URL: http://payment_processor:8004/a2a/message\n  メッセージID: 58053338-b795-41b3-967b-e0a681cb4983\n  タイプ: ap2.mandates.PaymentMandate\n================================================================================", "module": "agent", "function": "handle_payment_request", "line": 486}
ap2_merchant_agent       | [2025-10-20 23:54:41,283] INFO in httpx: HTTP Request: POST http://payment_processor:8004/a2a/message "HTTP/1.1 200 OK"
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.284179Z", "level": "INFO", "logger": "agent", "message": "\n================================================================================\n[MerchantAgent ← PaymentProcessor] A2Aレスポンス受信\n  Status: 200\n  Response Body: {\n  \"header\": {\n    \"message_id\": \"a2398e17-8663-4ea3-92b2-4d3fe0ffbdce\",\n    \"sender\": \"did:ap2:agent:payment_processor\",\n    \"recipient\": \"did:ap2:agent:merchant_agent\",\n    \"timestamp\": \"2025-10-20T23:54:41.282031Z\",\n    \"nonce\": \"4cee26c0a4587bddb5798e73acdd5f1754a5724ba47649d1b02d5af8b6de740a\",\n    \"schema_version\": \"0.2\",\n    \"proof\": {\n      \"algorithm\": \"ed25519\",\n      \"signatureValue\": \"tuwi+0LdGU7DnjYN8p3sc7oJjzf3/hpBsnJOAroaOvzh6vF1okIqIA9W1ji4QJdWJsXbphmuAqMeYDQME01KAA==\",\n      \"publicKey\": \"LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUNvd0JRWURLMlZ3QXlFQTlHc1ZlVFQ0b2d2b2NocHRuanc0YWY3MEdXeTQ5UUsvK3FoRjFMcVh2SGs9Ci0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLQo=\",\n      \"kid\": \"did:ap2:agent:payment_processor#key-2\",\n      \"created\": \"2025-10-20T23:54:41.282031Z\",\n      \"proofPurpose\": \"authentication\"\n    },\n    \"signature\": null\n  },\n  \"dataPart\": {\n    \"@type\": \"ap2.responses.PaymentResult\",\n    \"id\": \"825753c0-131b-46f9-a82a-5618f151d27b\",\n    \"payload\": {\n      \"transaction_id\": \"txn_03af7fcc4f38\",\n      \"status\": \"captured\",\n      \"receipt_url\": \"http://localhost:8004/receipts/txn_03af7fcc4f38.pdf\"\n    },\n    \"kind\": null,\n    \"artifact\": null\n  }\n}\n================================================================================", "module": "agent", "function": "handle_payment_request", "line": 503}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.284217Z", "level": "INFO", "logger": "agent", "message": "[MerchantAgent] Payment processing completed, forwarding result to Shopping Agent", "module": "agent", "function": "handle_payment_request", "line": 518}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.284319Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Signing A2A message (sender: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 800}
ap2_merchant_agent       | [2025-10-20 23:54:41,284] INFO in v2.common.a2a_handler: [A2A処理] ハンドラー完了: type=ap2.mandates.PaymentMandate, result_type=ap2.responses.PaymentResult
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.284364Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "[SIGN] Canonical JSON length: 518, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.responses.PaymentResult\",\"id\":\"825753c0-131b-46f9-a82a-5618f151d27b\",\"payload\":{\"receipt_url\":\"http://localhost:8004/receipts/txn_03af7fcc4f38.pdf\",\"status\":\"captured\",\"trans", "module": "crypto", "function": "sign_a2a_message", "line": 804}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.284386Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Signing data (key_id: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 599}
ap2_merchant_agent       | {"timestamp": "2025-10-20T23:54:41.284550Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Crypto SIGN: ED25519 (key: merchant_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 271}
ap2_merchant_agent       | [2025-10-20 23:54:41,284] INFO in v2.common.a2a_handler:
ap2_merchant_agent       | ================================================================================
ap2_merchant_agent       | [A2A送信] レスポンス作成
ap2_merchant_agent       |   送信元: did:ap2:agent:merchant_agent
ap2_merchant_agent       |   送信先: did:ap2:agent:shopping_agent
ap2_merchant_agent       |   タイプ: ap2.responses.PaymentResult
ap2_merchant_agent       |   データID: 825753c0-131b-46f9-a82a-5618f151d27b
ap2_merchant_agent       |   署名: あり
ap2_merchant_agent       |   タイムスタンプ: 2025-10-20T23:54:41.284262Z
ap2_merchant_agent       |   ペイロード: {
ap2_merchant_agent       |   "transaction_id": "txn_03af7fcc4f38",
ap2_merchant_agent       |   "status": "captured",
ap2_merchant_agent       |   "receipt_url": "http://localhost:8004/receipts/txn_03af7fcc4f38.pdf"
ap2_merchant_agent       | }
ap2_merchant_agent       | ================================================================================
ap2_merchant_agent       | [2025-10-20 23:54:41,284] INFO in v2.common.base_agent: [Merchant Agent] A2Aレスポンス返却: type=ap2.responses.PaymentResult, to=did:ap2:agent:shopping_agent
ap2_merchant_agent       | INFO:     172.18.0.4:41656 - "POST /a2a/message HTTP/1.1" 200 OK
ap2_payment_processor    | INFO:     151.101.64.223:59959 - "GET /receipts/txn_03af7fcc4f38.pdf HTTP/1.1" 200 OK
ap2_merchant             | INFO:     151.101.64.223:20319 - "GET /cart-mandates/pending HTTP/1.1" 200 OK
ap2_merchant             | INFO:     151.101.64.223:41011 - "GET /transactions HTTP/1.1" 200 OK
