Attaching to ap2_credential_provider, ap2_credential_provider_2, ap2_frontend, ap2_init_keys, ap2_init_seeds, ap2_jaeger, ap2_meilisearch, ap2_merchant, ap2_merchant_agent, ap2_merchant_agent_mcp, ap2_payment_network, ap2_payment_processor, ap2_redis, ap2_shopping_agent, ap2_shopping_agent_mcp
ap2_jaeger  | 2025/11/01 00:49:10 maxprocs: Leaving GOMAXPROCS=8: CPU quota undefined
ap2_jaeger  |
ap2_jaeger  | *******************************************************************************
ap2_jaeger  |
ap2_jaeger  | ðŸ›‘  WARNING: End-of-life Notice for Jaeger v1
ap2_jaeger  |
ap2_jaeger  | You are currently running a v1 version of Jaeger, which is deprecated and will
ap2_jaeger  | reach end-of-life on December 31st, 2025. This means there will be no further
ap2_jaeger  | development, bug fixes, or security patches for v1 after this date.
ap2_jaeger  |
ap2_jaeger  | We strongly recommend migrating to Jaeger v2 for continued support and access
ap2_jaeger  | to new features.
ap2_jaeger  |
ap2_jaeger  | For detailed migration instructions, please refer to the official Jaeger
ap2_jaeger  | documentation:  https://www.jaegertracing.io/docs/latest/migration/
ap2_jaeger  |
ap2_jaeger  | Tracking issue: https://github.com/jaegertracing/jaeger/issues/6321
ap2_jaeger  |


ap2_jaeger  | ðŸ›‘  WARNING: End-of-life Notice for Jaeger v1
ap2_meilisearch  |




ap2_jaeger       |
ap2_meilisearch  | 888b     d888          d8b 888 d8b                                            888
ap2_jaeger       | *******************************************************************************

ap2_jaeger       | 2025/11/01 00:49:10 application version: git-commit=a204929483c734da6c54eaa75f3f7c322b3e886b, git-version=v1.74.0, build-date=2025-10-03T02:41:46Z


ap2_meilisearch  | 88888b.d88888              888                                                888
ap2_jaeger       | {"level":"info","ts":1761958150.3974442,"caller":"flags/service.go:124","msg":"Mounting metrics handler on adm

ap2_jaeger       | {"level":"info","ts":1761958150.3981693,"caller":"flags/service.go:130","msg":"Mounting expvar handler on admin server","route":"/debug/vars"}
ap2_meilisearch  | 888Y88888P888  .d88b.  888 888 888 .d8888b   .d88b.   8888b.  888d888 .d8888b 88888b.
ap2_meilisearch  | 888 Y888P 888 d8P  Y8b 888 888 888 88K      d8P  Y8b     "88b 888P"  d88P"    888 "88b
ap2_meilisearch  | 888  Y8P  888 88888888 888 888 888 "Y8888b. 88888888 .d888888 888    888      888  888
ap2_meilisearch  | 888   "   888 Y8b.     888 888 888      X88 Y8b.     888  888 888    Y88b.    888  888
ap2_meilisearch  | 888       888  "Y8888  888 888 888  88888P'  "Y8888  "Y888888 888     "Y8888P 888  888
ap2_meilisearch  |
ap2_meilisearch  | Config file path:    "none"
ap2_meilisearch  | Database path:               "./data.ms"
ap2_meilisearch  | Server listening on: "http://0.0.0.0:7700"
ap2_meilisearch  | Environment:         "development"
ap2_meilisearch  | Commit SHA:          "cfaac6f7ca55e91ec3cf40f8682f528cd8743562"
ap2_meilisearch  | Commit date:         "2024-11-14T15:55:14Z"
ap2_meilisearch  | Package version:     "1.11.3"
ap2_meilisearch  | Anonymous telemetry: "Disabled"
ap2_meilisearch  |
ap2_meilisearch  | A master key has been set. Requests to Meilisearch won't be authorized unless you provide an authentication key.
ap2_meilisearch  |
ap2_meilisearch  |
ap2_meilisearch  |  Meilisearch started with a master key considered unsafe for use in a production environment.
ap2_meilisearch  |
ap2_meilisearch  |  A master key of at least 16 bytes will be required when switching to a production environment.
ap2_meilisearch  |
ap2_meilisearch  |
ap2_meilisearch  | We generated a new secure master key for you (you can safely use this token):
ap2_meilisearch  |
ap2_meilisearch  | >> --master-key y1RQ2XgmV4BYZ8IaWlRpM9PROErgMqGuCdmetiJtMeQ <<
ap2_meilisearch  |
ap2_meilisearch  | Restart Meilisearch with the argument above to use this new and secure master key.
ap2_meilisearch  |
ap2_meilisearch  | Check out Meilisearch Cloud! https://www.meilisearch.com/cloud?utm_campaign=oss&utm_source=engine&utm_medium=cli
ap2_meilisearch  | Documentation:                       https://www.meilisearch.com/docs
ap2_meilisearch  | Source code:                 https://github.com/meilisearch/meilisearch
ap2_meilisearch  | Discord:                     https://discord.meilisearch.com
ap2_meilisearch  |
ap2_meilisearch  | 2025-11-01T00:49:10.419454Z  INFO actix_server::builder: starting 8 workers
ap2_meilisearch  | 2025-11-01T00:49:10.433308Z  INFO actix_server::server: Actix runtime found; starting in Actix runtime
ap2_jaeger       | {"level":"info","ts":1761958150.458512,"caller":"flags/admin.go:106","msg":"Mounting health check on admin server","route":"/"}
ap2_jaeger       | {"level":"info","ts":1761958150.4732285,"caller":"flags/admin.go:123","msg":"Starting admin HTTP server"}
ap2_jaeger       | {"level":"info","ts":1761958150.4770515,"caller":"flags/admin.go:137","msg":"Admin server started","http.host-port":"[::]:14269","health-status":"unavailable"}
ap2_jaeger       | {"level":"info","ts":1761958150.4796019,"caller":"grpc@v1.75.0/clientconn.go:176","msg":"[core] original dial target is: \"localhost:4317\""}
ap2_jaeger       | {"level":"info","ts":1761958150.4809375,"caller":"grpc@v1.75.0/clientconn.go:459","msg":"[core] [Channel #1]Channel created"}
ap2_jaeger       | {"level":"info","ts":1761958150.4816797,"caller":"grpc@v1.75.0/clientconn.go:207","msg":"[core] [Channel #1]parsed dial target is: resolver.Target{URL:url.URL{Scheme:\"dns\", Opaque:\"\", User:(*url.Userinfo)(nil), Host:\"\", Path:\"/localhost:4317\", RawPath:\"\", OmitHost:false, ForceQuery:false, RawQuery:\"\", Fragment:\"\", RawFragment:\"\"}}"}
ap2_jaeger       | {"level":"info","ts":1761958150.4816964,"caller":"grpc@v1.75.0/clientconn.go:208","msg":"[core] [Channel #1]Channel authority set to \"localhost:4317\""}
ap2_jaeger       | {"level":"info","ts":1761958150.4831386,"caller":"memory/factory.go:75","msg":"Memory storage initialized","configuration":{"MaxTraces":0}}
ap2_jaeger       | {"level":"info","ts":1761958150.5049982,"caller":"grpc@v1.75.0/server.go:715","msg":"[core] [Server #2]Server created"}
ap2_jaeger       | {"level":"info","ts":1761958150.5139618,"caller":"server/grpc.go:75","msg":"Starting jaeger-collector gRPC server","grpc.host-port":"[::]:14250"}
ap2_jaeger       | {"level":"info","ts":1761958150.5148542,"caller":"server/http.go:37","msg":"Starting jaeger-collector HTTP server","host-port":":14268"}
ap2_jaeger       | {"level":"info","ts":1761958150.5168886,"caller":"app/collector.go:128","msg":"Not listening for Zipkin HTTP traffic, port not configured"}
ap2_jaeger       | {"level":"info","ts":1761958150.5206873,"caller":"grpc@v1.75.0/server.go:911","msg":"[core] [Server #2 ListenSocket #3]ListenSocket created"}
ap2_jaeger       | {"level":"info","ts":1761958150.5197656,"caller":"handler/otlp_receiver.go:75","msg":"OTLP receiver status change","status":"StatusStarting"}
ap2_jaeger       | {"level":"info","ts":1761958150.5207956,"caller":"grpc@v1.75.0/server.go:715","msg":"[core] [Server #4]Server created"}
ap2_jaeger       | {"level":"info","ts":1761958150.5208075,"caller":"otlpreceiver@v0.132.0/otlp.go:117","msg":"Starting GRPC server","endpoint":":4317"}
ap2_jaeger       | {"level":"info","ts":1761958150.5209575,"caller":"grpc@v1.75.0/server.go:911","msg":"[core] [Server #4 ListenSocket #5]ListenSocket created"}
ap2_jaeger       | {"level":"info","ts":1761958150.52098,"caller":"otlpreceiver@v0.132.0/otlp.go:175","msg":"Starting HTTP server","endpoint":":4318"}
ap2_jaeger       | {"level":"info","ts":1761958150.521007,"caller":"app/flags.go:168","msg":"Archive storage not initialized"}
ap2_jaeger       | {"level":"info","ts":1761958150.5215929,"caller":"grpc@v1.75.0/server.go:715","msg":"[core] [Server #6]Server created"}
ap2_jaeger       | {"level":"info","ts":1761958150.523253,"caller":"app/static_handler.go:92","msg":"Using UI configuration","path":""}
ap2_jaeger       | {"level":"info","ts":1761958150.5245254,"caller":"app/server.go:258","msg":"Query server started","http_addr":"[::]:16686","grpc_addr":"[::]:16685"}
ap2_jaeger       | {"level":"info","ts":1761958150.5246282,"caller":"healthcheck/handler.go:117","msg":"Health Check state change","status":"ready"}
ap2_jaeger       | {"level":"info","ts":1761958150.5247803,"caller":"app/server.go:300","msg":"Starting GRPC server","port":16685,"addr":":16685"}
ap2_jaeger       | {"level":"info","ts":1761958150.5248637,"caller":"grpc@v1.75.0/server.go:911","msg":"[core] [Server #6 ListenSocket #7]ListenSocket created"}
ap2_jaeger       | {"level":"info","ts":1761958150.5249522,"caller":"app/server.go:286","msg":"Starting HTTP server","port":16686,"addr":":16686"}
ap2_redis        | 1:C 01 Nov 2025 00:49:10.555 * oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
ap2_redis        | 1:C 01 Nov 2025 00:49:10.555 * Redis version=7.4.6, bits=64, commit=00000000, modified=0, pid=1, just started
ap2_redis        | 1:C 01 Nov 2025 00:49:10.555 * Configuration loaded
ap2_redis        | 1:M 01 Nov 2025 00:49:10.555 * monotonic clock: POSIX clock_gettime
ap2_redis        | 1:M 01 Nov 2025 00:49:10.559 * Running mode=standalone, port=6379.
ap2_redis        | 1:M 01 Nov 2025 00:49:10.565 * Server initialized
ap2_redis        | 1:M 01 Nov 2025 00:49:10.569 * Reading RDB base file on AOF loading...
ap2_redis        | 1:M 01 Nov 2025 00:49:10.569 * Loading RDB produced by version 7.4.6
ap2_redis        | 1:M 01 Nov 2025 00:49:10.569 * RDB age 89097 seconds
ap2_redis        | 1:M 01 Nov 2025 00:49:10.569 * RDB memory usage when created 0.94 Mb
ap2_redis        | 1:M 01 Nov 2025 00:49:10.569 * RDB is base AOF
ap2_redis        | 1:M 01 Nov 2025 00:49:10.569 * Done loading RDB, keys loaded: 0, keys expired: 0.
ap2_redis        | 1:M 01 Nov 2025 00:49:10.570 * DB loaded from base file appendonly.aof.1.base.rdb: 0.001 seconds
ap2_redis        | 1:M 01 Nov 2025 00:49:10.572 * DB loaded from incr file appendonly.aof.1.incr.aof: 0.002 seconds
ap2_redis        | 1:M 01 Nov 2025 00:49:10.572 * DB loaded from append only file: 0.004 seconds
ap2_redis        | 1:M 01 Nov 2025 00:49:10.573 * Opening AOF incr file appendonly.aof.1.incr.aof on server start
ap2_redis        | 1:M 01 Nov 2025 00:49:10.573 * Ready to accept connections tcp
ap2_init_keys    | ================================================================================
ap2_init_keys    | AP2 ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ ã‚­ãƒ¼ãƒšã‚¢åˆæœŸåŒ–
ap2_init_keys    | ================================================================================
ap2_init_keys    |
ap2_init_keys    | ã‚­ãƒ¼ä¿å­˜å…ˆ: /app/v2/keys
ap2_init_keys    | DID Documentä¿å­˜å…ˆ: /app/v2/data/did_documents
ap2_init_keys    |
ap2_init_keys    | [Shopping Agent]
ap2_init_keys    |   â„¹ï¸  æ—¢å­˜ã®éµã¨DID DocumentãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰
ap2_init_keys    |      DID: did:ap2:agent:shopping_agent
ap2_init_keys    |
ap2_init_keys    | [Merchant Agent]
ap2_init_keys    |   â„¹ï¸  æ—¢å­˜ã®éµã¨DID DocumentãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰
ap2_init_keys    |      DID: did:ap2:agent:merchant_agent
ap2_init_keys    |
ap2_init_keys    | [Merchant]
ap2_init_keys    |   â„¹ï¸  æ—¢å­˜ã®éµã¨DID DocumentãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰
ap2_init_keys    |      DID: did:ap2:merchant:mugibo_merchant
ap2_init_keys    |
ap2_init_keys    | [Credential Provider]
ap2_init_keys    |   â„¹ï¸  æ—¢å­˜ã®éµã¨DID DocumentãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰
ap2_init_keys    |      DID: did:ap2:cp:demo_cp
ap2_init_keys    |
ap2_init_keys    | [Credential Provider 2]
ap2_init_keys    |   â„¹ï¸  æ—¢å­˜ã®éµã¨DID DocumentãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰
ap2_init_keys    |      DID: did:ap2:cp:demo_cp_2
ap2_init_keys    |
ap2_init_keys    | [Payment Processor]
ap2_init_keys    |   â„¹ï¸  æ—¢å­˜ã®éµã¨DID DocumentãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰
ap2_init_keys    |      DID: did:ap2:agent:payment_processor
ap2_init_keys    |
ap2_init_keys    | ================================================================================
ap2_init_keys    | âœ… å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸ
ap2_init_keys    | ================================================================================
ap2_init_keys    |
ap2_init_keys    | æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:
ap2_init_keys    |   1. docker-compose up -d ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•
ap2_init_keys    |   2. å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ã‚­ãƒ¼ã‚’æ°¸ç¶šåŒ–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿ã¾ã™
ap2_init_keys    |   3. DIDã¯å†èµ·å‹•å¾Œã‚‚ä¸€è²«ã—ã¦ç¶­æŒã•ã‚Œã¾ã™
ap2_init_keys    |
ap2_init_keys exited with code 0
ap2_init_seeds   | ================================================================================
ap2_init_seeds   | AP2 ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ (AP2å®Œå…¨æº–æ‹ )
ap2_init_seeds   | ================================================================================
ap2_init_seeds   |
ap2_init_seeds   | ãƒ‡ãƒ¼ã‚¿ä¿å­˜å…ˆ: /app/v2/data
ap2_init_seeds   |
ap2_init_seeds   | AP2å®Œå…¨æº–æ‹ ã®ãŸã‚ã€ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿æŠ•å…¥ã—ã¾ã™ï¼š
ap2_init_seeds   |   âœ… å•†å“ãƒ‡ãƒ¼ã‚¿: MerchantãŒç®¡ç†
ap2_init_seeds   |   âš ï¸  ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿: Passkeyç™»éŒ²æ™‚ã«è‡ªå‹•ä½œæˆï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰
ap2_init_seeds   |   âš ï¸  æ”¯æ‰•ã„æ–¹æ³•: Passkeyç™»éŒ²å¾Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ï¼‰
ap2_init_seeds   |
ap2_init_seeds   | [å•†å“ãƒ‡ãƒ¼ã‚¿æŠ•å…¥]
ap2_init_seeds   | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: sqlite+aiosqlite:////app/v2/data/merchant_agent.db
ap2_init_seeds   |   â„¹ï¸  æ—¢å­˜ã®å•†å“ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆ28ä»¶ã€ã‚¹ã‚­ãƒƒãƒ—ï¼‰
ap2_init_seeds   |
ap2_init_seeds   | ================================================================================
ap2_init_seeds   | âœ… å•†å“ãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥ãŒå®Œäº†ã—ã¾ã—ãŸ (AP2å®Œå…¨æº–æ‹ )
ap2_init_seeds   | ================================================================================
ap2_init_seeds   |
ap2_init_seeds   | æŠ•å…¥ãƒ‡ãƒ¼ã‚¿ã‚µãƒžãƒª:
ap2_init_seeds   |   - å•†å“: 28ä»¶ (merchant_agent.db)
ap2_init_seeds   |
ap2_init_seeds   | æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:
ap2_init_seeds   |   1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (http://localhost:3000) ã«ã‚¢ã‚¯ã‚»ã‚¹
ap2_init_seeds   |   2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ² (/auth/register)
ap2_init_seeds   |   3. Passkeyç™»éŒ² (/auth/register-passkey)
ap2_init_seeds   |   4. æ”¯æ‰•ã„æ–¹æ³•ç™»éŒ²ï¼ˆPasskeyç™»éŒ²å¾Œã«è‡ªå‹•è¡¨ç¤ºï¼‰
ap2_init_seeds   |
ap2_init_seeds exited with code 0
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.014615Z", "level": "INFO", "logger": "common.search_engine", "message": "[MeilisearchClient] Initialized: http://meilisearch:7700, index=products", "module": "search_engine", "function": "__init__", "line": 38}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.018705Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Initialized: merchant_agent_mcp v1.0.0", "module": "mcp_server", "function": "__init__", "line": 90}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.018870Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: search_products", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.018943Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: check_inventory", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.018980Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_cart_mandates", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.207337Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Initialized: shopping_agent_mcp v1.0.0", "module": "mcp_server", "function": "__init__", "line": 90}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.207573Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_intent_mandate", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.207629Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: request_cart_candidates", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.207656Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: select_and_sign_cart", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.207673Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: assess_payment_risk", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.207688Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_payment_mandate", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.207700Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: execute_payment", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.227018Z", "level": "INFO", "logger": "common.search_engine", "message": "[MeilisearchClient] Initialized: http://meilisearch:7700, index=products", "module": "search_engine", "function": "__init__", "line": 38}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.228548Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Initialized: merchant_agent_mcp v1.0.0", "module": "mcp_server", "function": "__init__", "line": 90}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.229008Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: search_products", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.229206Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: check_inventory", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.229315Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_cart_mandates", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | INFO:     Started server process [1]
ap2_merchant_agent_mcp  | INFO:     Waiting for application startup.
ap2_merchant_agent_mcp  | INFO:     Application startup complete.
ap2_merchant_agent_mcp  | INFO:     Uvicorn running on http://0.0.0.0:8011 (Press CTRL+C to quit)
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.341283Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Initialized: shopping_agent_mcp v1.0.0", "module": "mcp_server", "function": "__init__", "line": 90}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.341393Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_intent_mandate", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.341416Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: request_cart_candidates", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.341448Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: select_and_sign_cart", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.341479Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: assess_payment_risk", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.341494Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_payment_mandate", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.341507Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: execute_payment", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | INFO:     Started server process [1]
ap2_shopping_agent_mcp  | INFO:     Waiting for application startup.
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.344540Z", "level": "INFO", "logger": "main", "message": "[Shopping Agent MCP] Starting up...", "module": "main", "function": "lifespan", "line": 404}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.360322Z", "level": "INFO", "logger": "main", "message": "[Shopping Agent MCP] Database initialized", "module": "main", "function": "lifespan", "line": 408}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.372163Z", "level": "INFO", "logger": "main", "message": "[Startup] KeyManager initialized with keys_directory=/app/v2/keys", "module": "main", "function": "lifespan", "line": 415}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.372209Z", "level": "INFO", "logger": "main", "message": "[Startup] Extracted key_id=shopping_agent from AGENT_ID=did:ap2:agent:shopping_agent", "module": "main", "function": "lifespan", "line": 419}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.372246Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.385881Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.385946Z", "level": "INFO", "logger": "main", "message": "[Startup] ED25519 private key loaded for shopping_agent", "module": "main", "function": "lifespan", "line": 425}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.385963Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.392645Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.392727Z", "level": "INFO", "logger": "main", "message": "[Startup] ECDSA private key loaded for shopping_agent", "module": "main", "function": "lifespan", "line": 433}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.392775Z", "level": "INFO", "logger": "main", "message": "[Startup] SignatureManager initialized", "module": "main", "function": "lifespan", "line": 443}
ap2_shopping_agent_mcp  | INFO:     Application startup complete.
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.396287Z", "level": "INFO", "logger": "main", "message": "[Startup] A2AMessageHandler initialized with key_id: shopping_agent", "module": "main", "function": "lifespan", "line": 451}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.396397Z", "level": "INFO", "logger": "main", "message": "[Startup] RiskAssessmentEngine initialized", "module": "main", "function": "lifespan", "line": 455}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-01T00:49:15.396420Z", "level": "INFO", "logger": "main", "message": "[Shopping Agent MCP] Startup complete", "module": "main", "function": "lifespan", "line": 457}
ap2_shopping_agent_mcp  | INFO:     Uvicorn running on http://0.0.0.0:8010 (Press CTRL+C to quit)
ap2_merchant            | [2025-11-01 00:49:16,677] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_merchant            | [2025-11-01 00:49:16,677] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_merchant            |   Service Name: merchant
ap2_merchant            |   OTLP Endpoint: http://jaeger:4317
ap2_merchant            |   Insecure: True
ap2_shopping_agent      | [2025-11-01 00:49:16,703] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_shopping_agent      | [2025-11-01 00:49:16,703] INFO in v2.common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_shopping_agent      |   Service Name: shopping_agent
ap2_shopping_agent      |   OTLP Endpoint: http://jaeger:4317
ap2_shopping_agent      |   Insecure: True
ap2_merchant            | [2025-11-01 00:49:16,704] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: merchant
ap2_merchant            | [2025-11-01 00:49:16,705] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant            | [2025-11-01 00:49:16,705] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant'. Adding OTLP exporter to existing provider.
ap2_merchant            | [2025-11-01 00:49:16,705] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant            | [2025-11-01 00:49:16,705] INFO in v2.common.base_agent: [Merchant] OpenTelemetry distributed tracing enabled (service: merchant, manual instrumentation only)
ap2_merchant            | {"timestamp": "2025-11-01T00:49:16.718042Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_shopping_agent      | [2025-11-01 00:49:16,725] INFO in v2.common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: shopping_agent
ap2_shopping_agent      | [2025-11-01 00:49:16,725] INFO in v2.common.base_agent: [Shopping Agent] OpenTelemetry distributed tracing enabled (service: shopping_agent, manual instrumentation only)
ap2_merchant            | {"timestamp": "2025-11-01T00:49:16.730238Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_merchant            | {"timestamp": "2025-11-01T00:49:16.730359Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_merchant            | [2025-11-01 00:49:16,730] INFO in v2.common.base_agent: [Merchant] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: merchant
ap2_merchant            | [2025-11-01 00:49:16,733] INFO in v2.common.base_agent: [Merchant] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: merchant
ap2_merchant            | [2025-11-01 00:49:16,733] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/shopping_agent_did.json
ap2_merchant            | {"timestamp": "2025-11-01T00:49:16.733438Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_merchant            | [2025-11-01 00:49:16,734] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_merchant            | [2025-11-01 00:49:16,734] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant            | [2025-11-01 00:49:16,735] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_merchant            | [2025-11-01 00:49:16,736] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/merchant_did.json
ap2_merchant            | [2025-11-01 00:49:16,737] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_merchant            | [2025-11-01 00:49:16,737] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/credential_provider_did.json
ap2_merchant            | [2025-11-01 00:49:16,738] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp
ap2_merchant            | [2025-11-01 00:49:16,738] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:16.736366Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_merchant            | [2025-11-01 00:49:16,739] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2


ap2_shopping_agent      | [2025-11-01 00:49:16,745] INFO in v2.common.base_agent: [Shopping Agent] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: shopping_agent
ap2_merchant            | [2025-11-01 00:49:16,739] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/payment_processor_did.json


ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:16.745930Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}


ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:16.746036Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}


ap2_merchant            | [2025-11-01 00:49:16,741] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:16.747567Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}


ap2_shopping_agent      | [2025-11-01 00:49:16,747] INFO in v2.common.base_agent: [Shopping Agent] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: shopping_agent
ap2_merchant            | {"timestamp": "2025-11-01T00:49:16.741710Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.CartMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | [2025-11-01 00:49:16,747] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/shopping_agent_did.json
ap2_shopping_agent      | [2025-11-01 00:49:16,750] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_shopping_agent      | [2025-11-01 00:49:16,751] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant            | [2025-11-01 00:49:16,755] INFO in v2.common.base_agent: [Merchant] Initialized: did:ap2:merchant
ap2_shopping_agent      | [2025-11-01 00:49:16,756] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_shopping_agent      | [2025-11-01 00:49:16,756] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/merchant_did.json
ap2_shopping_agent      | [2025-11-01 00:49:16,757] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_shopping_agent      | [2025-11-01 00:49:16,757] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/credential_provider_did.json
ap2_shopping_agent      | [2025-11-01 00:49:16,759] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp
ap2_shopping_agent      | [2025-11-01 00:49:16,759] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_shopping_agent      | [2025-11-01 00:49:16,760] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2
ap2_shopping_agent      | [2025-11-01 00:49:16,760] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/payment_processor_did.json
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:16.762311Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.CartMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:16.762356Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.responses.ProductList", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:16.762377Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.responses.SignatureResponse", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | [2025-11-01 00:49:16,762] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor
ap2_payment_processor   | [2025-11-01 00:49:16,766] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_payment_processor   | [2025-11-01 00:49:16,767] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_payment_processor   |   Service Name: payment_processor
ap2_payment_processor   |   OTLP Endpoint: http://jaeger:4317
ap2_payment_processor   |   Insecure: True
ap2_shopping_agent      | [2025-11-01 00:49:16,771] INFO in v2.common.base_agent: [Shopping Agent] Initialized: did:ap2:agent:shopping_agent
ap2_payment_processor   | [2025-11-01 00:49:16,790] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: payment_processor
ap2_payment_processor   | [2025-11-01 00:49:16,791] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_payment_processor   | [2025-11-01 00:49:16,791] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='payment_processor'. Adding OTLP exporter to existing provider.
ap2_payment_processor   | [2025-11-01 00:49:16,792] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_payment_processor   | [2025-11-01 00:49:16,792] INFO in v2.common.base_agent: [Payment Processor] OpenTelemetry distributed tracing enabled (service: payment_processor, manual instrumentation only)
ap2_payment_processor   | {"timestamp": "2025-11-01T00:49:16.808894Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: payment_processor (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_payment_processor   | {"timestamp": "2025-11-01T00:49:16.819761Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_payment_processor   | {"timestamp": "2025-11-01T00:49:16.819882Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: payment_processor (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_payment_processor   | [2025-11-01 00:49:16,819] INFO in v2.common.base_agent: [Payment Processor] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: payment_processor
ap2_payment_processor   | [2025-11-01 00:49:16,821] INFO in v2.common.base_agent: [Payment Processor] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ
: payment_processor
ap2_payment_processor   | [2025-11-01 00:49:16,821] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/shopping_agent_did.json
ap2_payment_processor   | {"timestamp": "2025-11-01T00:49:16.821654Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_payment_processor   | [2025-11-01 00:49:16,823] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_payment_processor   | [2025-11-01 00:49:16,823] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/merchant_agent_did.json
ap2_payment_processor   | [2025-11-01 00:49:16,824] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_payment_processor   | [2025-11-01 00:49:16,824] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/merchant_did.json
ap2_payment_processor   | [2025-11-01 00:49:16,824] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_payment_processor   | [2025-11-01 00:49:16,824] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/credential_provider_did.json
ap2_payment_processor   | [2025-11-01 00:49:16,828] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp
ap2_payment_processor   | [2025-11-01 00:49:16,828] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_payment_processor   | [2025-11-01 00:49:16,828] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2
ap2_payment_processor   | [2025-11-01 00:49:16,829] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/payment_processor_did.json
ap2_payment_processor   | [2025-11-01 00:49:16,830] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor
ap2_payment_processor   | {"timestamp": "2025-11-01T00:49:16.830891Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_payment_processor   | [2025-11-01 00:49:16,836] INFO in v2.common.base_agent: [Payment Processor] Initialized: did:ap2:agent:payment_processor
ap2_merchant            | {"timestamp": "2025-11-01T00:49:16.846608Z", "level": "INFO", "logger": "service", "message": "[Merchant] Initialized", "module": "service", "function": "__init__", "line": 118}
ap2_merchant            | [2025-11-01 00:49:16,846] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_shopping_agent      | [2025-11-01 00:49:16,862] INFO in v2.common.risk_assessment: [RiskAssessmentEngine] Initialized (database_mode=enabled)
ap2_merchant            | [2025-11-01 00:49:16,957] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant            | [2025-11-01 00:49:16,957] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant'. Adding OTLP exporter to existing provider.
ap2_merchant            | [2025-11-01 00:49:16,958] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant            | [2025-11-01 00:49:16,959] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant            | [2025-11-01 00:49:16,959] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant'. Adding OTLP exporter to existing provider.
ap2_merchant            | [2025-11-01 00:49:16,959] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant            | [2025-11-01 00:49:16,959] INFO in v2.common.base_agent: [Merchant] OpenTelemetry distributed tracing enabled (service: merchant, manual instrumentation only)
ap2_merchant            | {"timestamp": "2025-11-01T00:49:16.959527Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_merchant            | [2025-11-01 00:49:16,961] INFO in v2.common.base_agent: [Merchant] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: merchant
ap2_merchant            | {"timestamp": "2025-11-01T00:49:16.961384Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_merchant            | {"timestamp": "2025-11-01T00:49:16.961563Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_merchant            | [2025-11-01 00:49:16,962] INFO in v2.common.base_agent: [Merchant] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: merchant
ap2_merchant            | {"timestamp": "2025-11-01T00:49:16.962750Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_merchant            | [2025-11-01 00:49:16,962] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/shopping_agent_did.json
ap2_merchant            | [2025-11-01 00:49:16,964] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_merchant            | [2025-11-01 00:49:16,964] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant            | [2025-11-01 00:49:16,967] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_merchant            | [2025-11-01 00:49:16,967] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/merchant_did.json
ap2_merchant            | [2025-11-01 00:49:16,971] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_merchant            | [2025-11-01 00:49:16,971] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/credential_provider_did.json


ap2_payment_processor   | {"timestamp": "2025-11-01T00:49:16.981674Z", "level": "INFO", "logger": "processor", "message": "[Payment Processor] Initialized", "module": "processor", "function": "__init__", "line": 102}


ap2_merchant            | [2025-11-01 00:49:16,971] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp
ap2_payment_processor   | [2025-11-01 00:49:16,981] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_merchant            | [2025-11-01 00:49:16,971] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_merchant            | [2025-11-01 00:49:16,972] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2
ap2_merchant            | [2025-11-01 00:49:16,972] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant            | [2025-11-01 00:49:16,973] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor
ap2_merchant            | {"timestamp": "2025-11-01T00:49:16.973454Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.CartMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant            | [2025-11-01 00:49:16,982] INFO in v2.common.base_agent: [Merchant] Initialized: did:ap2:merchant
ap2_merchant            | {"timestamp": "2025-11-01T00:49:16.983339Z", "level": "INFO", "logger": "service", "message": "[Merchant] Initialized", "module": "service", "function": "__init__", "line": 118}
ap2_merchant            | [2025-11-01 00:49:16,983] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_merchant            | INFO:     Started server process [1]
ap2_merchant            | INFO:     Waiting for application startup.
ap2_merchant            | {"timestamp": "2025-11-01T00:49:16.983865Z", "level": "INFO", "logger": "service", "message": "[Merchant] Running startup tasks...", "module": "service", "function": "startup_event", "line": 102}
ap2_merchant            | {"timestamp": "2025-11-01T00:49:16.999272Z", "level": "INFO", "logger": "service", "message": "[Merchant] Database initialized", "module": "service", "function": "startup_event", "line": 106}
ap2_merchant            |
ap2_merchant            | ============================================================
ap2_merchant            | å•†å“ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ä¸­...
ap2_merchant            | ============================================================
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ— (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼Tã‚·ãƒ£ãƒ„ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒˆãƒ¼ãƒˆãƒãƒƒã‚° (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã¬ã„ãã‚‹ã¿ï¼ˆSï¼‰ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã¬ã„ãã‚‹ã¿ï¼ˆLï¼‰ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚­ãƒ£ãƒƒãƒ— (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¯ãƒƒã‚·ãƒ§ãƒ³ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒŽãƒ¼ãƒˆ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒœãƒ¼ãƒ«ãƒšãƒ³ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒœãƒˆãƒ« (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼é´ä¸‹ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒžã‚¦ã‚¹ãƒ‘ãƒƒãƒ‰ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¹ãƒžãƒ›ã‚±ãƒ¼ã‚¹ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼æŠ˜ã‚ŠãŸãŸã¿å‚˜ (æ—¢å­˜)
ap2_payment_processor   | [2025-11-01 00:49:17,062] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_payment_processor   | [2025-11-01 00:49:17,062] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='payment_processor'. Adding OTLP exporter to existing provider.
ap2_payment_processor   | [2025-11-01 00:49:17,063] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_payment_processor   | [2025-11-01 00:49:17,063] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_payment_processor   | [2025-11-01 00:49:17,063] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='payment_processor'. Adding OTLP exporter to existing provider.
ap2_payment_processor   | [2025-11-01 00:49:17,064] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_payment_processor   | [2025-11-01 00:49:17,064] INFO in v2.common.base_agent: [Payment Processor] OpenTelemetry distributed tracing enabled (service: payment_processor, manual instrumentation only)
ap2_payment_processor   | {"timestamp": "2025-11-01T00:49:17.065009Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: payment_processor (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_payment_processor   | {"timestamp": "2025-11-01T00:49:17.066708Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_payment_processor   | {"timestamp": "2025-11-01T00:49:17.066782Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: payment_processor (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_payment_processor   | [2025-11-01 00:49:17,066] INFO in v2.common.base_agent: [Payment Processor] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: payment_processor
ap2_payment_processor   | {"timestamp": "2025-11-01T00:49:17.067574Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_payment_processor   | [2025-11-01 00:49:17,067] INFO in v2.common.base_agent: [Payment Processor] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ
: payment_processor
ap2_payment_processor   | [2025-11-01 00:49:17,067] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/shopping_agent_did.json
ap2_payment_processor   | [2025-11-01 00:49:17,068] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_payment_processor   | [2025-11-01 00:49:17,068] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/merchant_agent_did.json
ap2_payment_processor   | [2025-11-01 00:49:17,068] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_payment_processor   | [2025-11-01 00:49:17,069] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/merchant_did.json
ap2_payment_processor   | [2025-11-01 00:49:17,069] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¨ã‚³ãƒãƒƒã‚° (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ–ãƒ©ãƒ³ã‚±ãƒƒãƒˆ (æ—¢å­˜)

ap2_payment_processor   | [2025-11-01 00:49:17,069] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/credential_provider_did.json


ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ (æ—¢å­˜)
ap2_payment_processor   | [2025-11-01 00:49:17,070] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did

ap2_payment_processor   | [2025-11-01 00:49:17,070] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ‘ãƒ¼ã‚«ãƒ¼ (æ—¢å­˜)
ap2_payment_processor   | [2025-11-01 00:49:17,071] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2





ap2_payment_processor   | [2025-11-01 00:49:17,071] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¢ãƒ­ãƒžã‚­ãƒ£ãƒ³ãƒ‰ãƒ« (æ—¢å­˜)


ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼æŠ±ãæž• (æ—¢å­˜)



ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒã‚¹ã‚¿ãƒ¼ (æ—¢å­˜)on.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: didap2_payment_processor   | {"timestamp": "2025-11-01T00:49:17.071788Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ‹ãƒƒãƒˆå¸½ (æ—¢å­˜)
ap2_payment_processor   | [2025-11-01 00:49:17,074] INFO in v2.common.base_agent: [Payment Processor] Initialized: did:ap2:agent:payment_processor
ap2_payment_processor   | [2025-11-01 00:49:17,080] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_merchant            |
ap2_merchant            | âœ… å•†å“ãƒ‡ãƒ¼ã‚¿æŠ•å…¥å®Œäº† (28ä»¶)





ap2_merchant            |
ap2_payment_processor   | {"timestamp": "2025-11-01T00:49:17.080867Z", "level": "INFO", "logger": "processor", "message": "[Payment Processor] Initialized", "module": "processor", "function": "__init__", "line": 102}


ap2_merchant            | ============================================================

ap2_payment_processor   | INFO:     Started server process [1]


ap2_merchant            | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ä¸­...
ap2_merchant            | ============================================================


ap2_payment_processor   | {"timestamp": "2025-11-01T00:49:17.082133Z", "level": "INFO", "logger": "processor", "message": "[Payment Processor] Running startup tasks...", "module": "processor", "function": "startup_event", "line": 96}
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: å±±ç”°å¤ªéƒŽ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ä½è—¤èŠ±å­ (æ—¢å­˜)
ap2_merchant            |
ap2_merchant            | âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿æŠ•å…¥å®Œäº† (2ä»¶)
ap2_merchant            | {"timestamp": "2025-11-01T00:49:17.082791Z", "level": "INFO", "logger": "service", "message": "[Merchant] Sample data seeded successfully", "module": "service", "function": "startup_event", "line": 114}
ap2_merchant            | INFO:     Application startup complete.
ap2_merchant            | INFO:     Uvicorn running on http://0.0.0.0:8002 (Press CTRL+C to quit)
ap2_payment_processor   | INFO:     Application startup complete.
ap2_payment_processor   | {"timestamp": "2025-11-01T00:49:17.105552Z", "level": "INFO", "logger": "processor", "message": "[Payment Processor] Database initialized", "module": "processor", "function": "startup_event", "line": 100}
ap2_payment_processor   | INFO:     Uvicorn running on http://0.0.0.0:8004 (Press CTRL+C to quit)
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.174461Z", "level": "INFO", "logger": "langgraph_merchant", "message": "[Langfuse] Tracing enabled", "module": "langgraph_merchant", "function": "<module>", "line": 83}
ap2_merchant_agent      | [2025-11-01 00:49:18,184] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant_agent      | [2025-11-01 00:49:18,184] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant_agent'. Adding OTLP exporter to existing provider.
ap2_merchant_agent      | [2025-11-01 00:49:18,228] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant_agent      | [2025-11-01 00:49:18,228] INFO in v2.common.base_agent: [Merchant Agent] OpenTelemetry distributed tracing enabled (service: merchant_agent, manual instrumentation only)
ap2_shopping_agent      | [2025-11-01 00:49:18,262] INFO in services.shopping_agent.langgraph_shopping_flow: [Langfuse] Shopping Agent tracing enabled
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.294844Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.307485Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.307630Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_merchant_agent      | [2025-11-01 00:49:18,307] INFO in v2.common.base_agent: [Merchant Agent] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: merchant_agent
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.310041Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_merchant_agent      | [2025-11-01 00:49:18,310] INFO in v2.common.base_agent: [Merchant Agent] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: merchant_agent
ap2_merchant_agent      | [2025-11-01 00:49:18,310] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/shopping_agent_did.json
ap2_merchant_agent      | [2025-11-01 00:49:18,311] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_merchant_agent      | [2025-11-01 00:49:18,311] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant_agent      | [2025-11-01 00:49:18,312] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_merchant_agent      | [2025-11-01 00:49:18,312] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/merchant_did.json
ap2_merchant_agent      | [2025-11-01 00:49:18,313] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_merchant_agent      | [2025-11-01 00:49:18,313] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/credential_provider_did.json
ap2_merchant_agent      | [2025-11-01 00:49:18,314] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp
ap2_merchant_agent      | [2025-11-01 00:49:18,314] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_merchant_agent      | [2025-11-01 00:49:18,314] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2
ap2_merchant_agent      | [2025-11-01 00:49:18,315] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant_agent      | [2025-11-01 00:49:18,315] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.315564Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.IntentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.315600Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.ProductSearch", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.315612Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.CartRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.315627Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.CartSelection", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.315642Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | [2025-11-01 00:49:18,320] INFO in v2.common.base_agent: [Merchant Agent] Initialized: did:ap2:agent:merchant_agent
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.388062Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Initialized (AI Mode: True)", "module": "agent", "function": "__init__", "line": 163}
ap2_merchant_agent      | [2025-11-01 00:49:18,507] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant_agent      | [2025-11-01 00:49:18,507] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant_agent'. Adding OTLP exporter to existing provider.
ap2_merchant_agent      | [2025-11-01 00:49:18,508] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant_agent      | [2025-11-01 00:49:18,508] INFO in v2.common.base_agent: [Merchant Agent] OpenTelemetry distributed tracing enabled (service: merchant_agent, manual instrumentation only)
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.508357Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.509087Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.509139Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_merchant_agent      | [2025-11-01 00:49:18,509] INFO in v2.common.base_agent: [Merchant Agent] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: merchant_agent
ap2_merchant_agent      | [2025-11-01 00:49:18,509] INFO in v2.common.base_agent: [Merchant Agent] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: merchant_agent
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.509831Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_merchant_agent      | [2025-11-01 00:49:18,509] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/shopping_agent_did.json
ap2_merchant_agent      | [2025-11-01 00:49:18,510] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_merchant_agent      | [2025-11-01 00:49:18,510] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant_agent      | [2025-11-01 00:49:18,510] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_merchant_agent      | [2025-11-01 00:49:18,510] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/merchant_did.json
ap2_merchant_agent      | [2025-11-01 00:49:18,511] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_merchant_agent      | [2025-11-01 00:49:18,511] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/credential_provider_did.json
ap2_merchant_agent      | [2025-11-01 00:49:18,511] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp
ap2_merchant_agent      | [2025-11-01 00:49:18,511] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_merchant_agent      | [2025-11-01 00:49:18,511] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2
ap2_merchant_agent      | [2025-11-01 00:49:18,511] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant_agent      | [2025-11-01 00:49:18,512] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.512267Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.IntentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.512288Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.ProductSearch", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.512298Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.CartRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.512306Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.CartSelection", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.512315Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | [2025-11-01 00:49:18,515] INFO in v2.common.base_agent: [Merchant Agent] Initialized: did:ap2:agent:merchant_agent
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.520588Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Initialized (AI Mode: True)", "module": "agent", "function": "__init__", "line": 163}
ap2_merchant_agent      | INFO:     Started server process [1]
ap2_merchant_agent      | INFO:     Waiting for application startup.
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.521138Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Running startup tasks...", "module": "agent", "function": "startup_event", "line": 111}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.533241Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Database initialized", "module": "agent", "function": "startup_event", "line": 115}
ap2_merchant_agent      |
ap2_merchant_agent      | ============================================================
ap2_merchant_agent      | å•†å“ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ä¸­...
ap2_merchant_agent      | ============================================================
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ— (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼Tã‚·ãƒ£ãƒ„ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒˆãƒ¼ãƒˆãƒãƒƒã‚° (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã¬ã„ãã‚‹ã¿ï¼ˆSï¼‰ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã¬ã„ãã‚‹ã¿ï¼ˆLï¼‰ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚­ãƒ£ãƒƒãƒ— (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¯ãƒƒã‚·ãƒ§ãƒ³ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒŽãƒ¼ãƒˆ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒœãƒ¼ãƒ«ãƒšãƒ³ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒœãƒˆãƒ« (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼é´ä¸‹ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒžã‚¦ã‚¹ãƒ‘ãƒƒãƒ‰ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¹ãƒžãƒ›ã‚±ãƒ¼ã‚¹ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼æŠ˜ã‚ŠãŸãŸã¿å‚˜ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¨ã‚³ãƒãƒƒã‚° (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ–ãƒ©ãƒ³ã‚±ãƒƒãƒˆ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ‘ãƒ¼ã‚«ãƒ¼ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚¿ã‚ªãƒ« (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¢ãƒ­ãƒžã‚­ãƒ£ãƒ³ãƒ‰ãƒ« (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼æŠ±ãæž• (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒã‚¹ã‚¿ãƒ¼ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ‹ãƒƒãƒˆå¸½ (æ—¢å­˜)
ap2_merchant_agent      |
ap2_merchant_agent      | âœ… å•†å“ãƒ‡ãƒ¼ã‚¿æŠ•å…¥å®Œäº† (28ä»¶)
ap2_merchant_agent      |
ap2_merchant_agent      | ============================================================
ap2_merchant_agent      | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ä¸­...
ap2_merchant_agent      | ============================================================
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: å±±ç”°å¤ªéƒŽ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ä½è—¤èŠ±å­ (æ—¢å­˜)
ap2_merchant_agent      |
ap2_merchant_agent      | âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿æŠ•å…¥å®Œäº† (2ä»¶)
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.564834Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Sample data seeded successfully", "module": "agent", "function": "startup_event", "line": 121}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.564882Z", "level": "INFO", "logger": "v2.common.search_engine", "message": "[MeilisearchClient] Initialized: http://meilisearch:7700, index=products", "module": "search_engine", "function": "__init__", "line": 38}
ap2_meilisearch         | 2025-11-01T00:49:18.637421Z ERROR index_scheduler: Batch failed Index `products` already exists.
ap2_meilisearch         | 2025-11-01T00:49:18.637846Z  INFO HTTP request{method=POST host="meilisearch:7700" route=/indexes query_parameters= user_agent=python-httpx/0.28.1 status_code=202}: meilisearch: close time.busy=4.34ms time.idle=6.31ms
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.642390Z", "level": "INFO", "logger": "v2.common.search_engine", "message": "[MeilisearchClient] Index already exists: products", "module": "search_engine", "function": "create_index", "line": 65}
ap2_shopping_agent      | [2025-11-01 00:49:18,653] INFO in services.shopping_agent.langgraph_shopping_flow: [LangGraph Shopping Flow] LLM initialized: ai/qwen3 at http://host.docker.internal:12434/engines/llama.cpp/v1


ap2_meilisearch         | 2025-11-01T00:49:18.653287Z  INFO HTTP request{method=PATCH host="meilisearch:7700" route=/indexes/products/settings query_parameters= user_agent=python-httpx/0.28.1 status_code=202}: meilisearch: close time.busy=798Âµs time.idle=1.53ms
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.653828Z", "level": "INFO", "logger": "v2.common.search_engine", "message": "[MeilisearchClient] Index configured: products", "module": "search_engine", "function": "configure_index", "line": 115}
ap2_meilisearch         | 2025-11-01T00:49:18.657330Z  INFO index_scheduler: A batch of tasks was successfully completed with 1 successful tasks and 0 failed tasks.
ap2_shopping_agent      | [2025-11-01 00:49:18,658] INFO in services.shopping_agent.langgraph_shopping_flow: [create_shopping_flow_graph] LangGraph shopping flow compiled successfully (14 nodes, AP2 compliant, with checkpointer for trace continuity)
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:18.658657Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] LangGraph shopping flow graph initialized successfully (12 nodes)", "module": "agent", "function": "__init__", "line": 241}
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:18.658755Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] Initialized with database-backed risk assessment", "module": "agent", "function": "__init__", "line": 268}
ap2_meilisearch         | 2025-11-01T00:49:18.672038Z  INFO HTTP request{method=DELETE host="meilisearch:7700" route=/indexes/products/documents query_parameters= user_agent=python-httpx/0.28.1 status_code=202}: meilisearch: close time.busy=2.10ms time.idle=6.15ms
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.674581Z", "level": "INFO", "logger": "v2.common.search_engine", "message": "[MeilisearchClient] Cleared index: products", "module": "search_engine", "function": "clear_index", "line": 239}
ap2_meilisearch         | 2025-11-01T00:49:18.674540Z  INFO index_scheduler: A batch of tasks was successfully completed with 1 successful tasks and 0 failed tasks.
ap2_meilisearch         | 2025-11-01T00:49:18.702680Z  INFO HTTP request{method=POST host="meilisearch:7700" route=/indexes/products/documents query_parameters= user_agent=python-httpx/0.28.1 status_code=202}: meilisearch: close time.busy=2.94ms time.idle=5.19ms
ap2_merchant_agent      | [2025-11-01 00:49:18,704] INFO in utils.product_helpers: [_sync_products_to_meilisearch] Synced 28 products to Meilisearch
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.704160Z", "level": "INFO", "logger": "v2.common.search_engine", "message": "[MeilisearchClient] Added 28 documents, taskUid=103", "module": "search_engine", "function": "add_documents", "line": 144}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:18.705497Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Meilisearch synchronized", "module": "agent", "function": "startup_event", "line": 129}
ap2_shopping_agent      | [2025-11-01 00:49:18,783] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_shopping_agent      | [2025-11-01 00:49:18,783] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='shopping_agent'. Adding OTLP exporter to existing provider.
ap2_shopping_agent      | [2025-11-01 00:49:18,785] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_shopping_agent      | [2025-11-01 00:49:18,785] INFO in v2.common.base_agent: [Shopping Agent] OpenTelemetry distributed tracing enabled (service: shopping_agent, manual instrumentation only)
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:18.785485Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_shopping_agent      | [2025-11-01 00:49:18,786] INFO in v2.common.base_agent: [Shopping Agent] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: shopping_agent
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:18.786674Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:18.786730Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:18.788630Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_shopping_agent      | [2025-11-01 00:49:18,788] INFO in v2.common.base_agent: [Shopping Agent] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: shopping_agent
ap2_shopping_agent      | [2025-11-01 00:49:18,788] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/shopping_agent_did.json
ap2_shopping_agent      | [2025-11-01 00:49:18,790] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_shopping_agent      | [2025-11-01 00:49:18,790] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/merchant_agent_did.json
ap2_shopping_agent      | [2025-11-01 00:49:18,791] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_shopping_agent      | [2025-11-01 00:49:18,791] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/merchant_did.json
ap2_shopping_agent      | [2025-11-01 00:49:18,792] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_shopping_agent      | [2025-11-01 00:49:18,792] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/credential_provider_did.json
ap2_shopping_agent      | [2025-11-01 00:49:18,793] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp
ap2_shopping_agent      | [2025-11-01 00:49:18,793] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_shopping_agent      | [2025-11-01 00:49:18,793] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2
ap2_shopping_agent      | [2025-11-01 00:49:18,793] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/v2/data/did_documents/payment_processor_did.json
ap2_shopping_agent      | [2025-11-01 00:49:18,794] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:18.794446Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.CartMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:18.794485Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.responses.ProductList", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:18.794497Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.responses.SignatureResponse", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | [2025-11-01 00:49:18,800] INFO in v2.common.base_agent: [Shopping Agent] Initialized: did:ap2:agent:shopping_agent
ap2_shopping_agent      | [2025-11-01 00:49:18,807] INFO in v2.common.risk_assessment: [RiskAssessmentEngine] Initialized (database_mode=enabled)
ap2_shopping_agent      | [2025-11-01 00:49:18,808] INFO in services.shopping_agent.langgraph_shopping_flow: [LangGraph Shopping Flow] LLM initialized: ai/qwen3 at http://host.docker.internal:12434/engines/llama.cpp/v1
ap2_shopping_agent      | [2025-11-01 00:49:18,818] INFO in services.shopping_agent.langgraph_shopping_flow: [create_shopping_flow_graph] LangGraph shopping flow compiled successfully (14 nodes, AP2 compliant, with checkpointer for trace continuity)
ap2_shopping_agent      | INFO:     Started server process [1]
ap2_shopping_agent      | INFO:     Waiting for application startup.
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:18.818345Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] LangGraph shopping flow graph initialized successfully (12 nodes)", "module": "agent", "function": "__init__", "line": 241}
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:18.818419Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] Initialized with database-backed risk assessment", "module": "agent", "function": "__init__", "line": 268}
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:18.818997Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] Running startup tasks...", "module": "agent", "function": "startup_event", "line": 262}
ap2_shopping_agent      | INFO:     Application startup complete.
ap2_shopping_agent      | {"timestamp": "2025-11-01T00:49:18.831349Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] Database initialized", "module": "agent", "function": "startup_event", "line": 266}
ap2_shopping_agent      | INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:19.061091Z", "level": "INFO", "logger": "langgraph_merchant", "message": "[MerchantLangGraphAgent] LLM initialized with DMR: http://host.docker.internal:12434/engines/llama.cpp/v1, model: ai/qwen3", "module": "langgraph_merchant", "function": "__init__", "line": 178}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:19.062736Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Initialized: http://merchant_agent_mcp:8011", "module": "mcp_client", "function": "__init__", "line": 65}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:19.065085Z", "level": "INFO", "logger": "langgraph_merchant", "message": "[MerchantLangGraphAgent] Initialized with LLM: ai/qwen3, MCP: http://merchant_agent_mcp:8011", "module": "langgraph_merchant", "function": "__init__", "line": 196}
ap2_merchant_agent      | {"timestamp": "2025-11-01T00:49:19.065133Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] LangGraph AI engine initialized", "module": "agent", "function": "startup_event", "line": 143}
ap2_merchant_agent      | INFO:     Application startup complete.
ap2_merchant_agent      | INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
ap2_meilisearch         | 2025-11-01T00:49:21.941163Z  INFO index_scheduler::batch: document indexing done indexing_result=DocumentAdditionResult { indexed_documents: 28, number_of_documents: 28 } processed_in=3.238484751s
ap2_meilisearch         | 2025-11-01T00:49:21.954088Z  INFO index_scheduler: A batch of tasks was successfully completed with 1 successful tasks and 0 failed tasks.
ap2_payment_network     | [2025-11-01 00:49:23,179] INFO in network: [DemoPaymentNetwork] Payment Network Service initialized
ap2_payment_network     |   Redis URL: redis://redis:6379/2
ap2_payment_network     |   Token Store: Redisãƒ™ãƒ¼ã‚¹ã®KVã‚¹ãƒˆã‚¢ï¼ˆTTLç®¡ç†å¯¾å¿œï¼‰
ap2_payment_network     | [2025-11-01 00:49:23,387] INFO in network: [DemoPaymentNetwork] Payment Network Service initialized
ap2_payment_network     |   Redis URL: redis://redis:6379/2
ap2_payment_network     |   Token Store: Redisãƒ™ãƒ¼ã‚¹ã®KVã‚¹ãƒˆã‚¢ï¼ˆTTLç®¡ç†å¯¾å¿œï¼‰
ap2_payment_network     | INFO:     Started server process [1]
ap2_payment_network     | INFO:     Waiting for application startup.
ap2_payment_network     | INFO:     Application startup complete.
ap2_payment_network     | INFO:     Uvicorn running on http://0.0.0.0:8005 (Press CTRL+C to quit)
ap2_frontend            |    â–² Next.js 15.5.5
ap2_frontend            |    - Local:        http://localhost:3000
ap2_frontend            |    - Network:      http://0.0.0.0:3000
ap2_frontend            |
ap2_frontend            |  âœ“ Starting...
ap2_frontend            |  âœ“ Ready in 242ms
ap2_credential_provider_2  | [2025-11-01 00:49:27,409] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_credential_provider_2  | [2025-11-01 00:49:27,410] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_credential_provider_2  |   Service Name: credential_provider_2
ap2_credential_provider_2  |   OTLP Endpoint: http://jaeger:4317
ap2_credential_provider_2  |   Insecure: True
ap2_credential_provider    | [2025-11-01 00:49:27,474] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_credential_provider    | [2025-11-01 00:49:27,474] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_credential_provider    |   Service Name: credential_provider
ap2_credential_provider    |   OTLP Endpoint: http://jaeger:4317
ap2_credential_provider    |   Insecure: True
ap2_credential_provider    | [2025-11-01 00:49:27,533] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: credential_provider
ap2_credential_provider    | [2025-11-01 00:49:27,534] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider    | [2025-11-01 00:49:27,534] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider'. Adding OTLP exporter to existing provider.
ap2_credential_provider    | [2025-11-01 00:49:27,535] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider    | [2025-11-01 00:49:27,535] INFO in v2.common.base_agent: [Credential Provider] OpenTelemetry distributed tracing enabled (service: credential_provider, manual instrumentation only)
ap2_credential_provider_2  | [2025-11-01 00:49:27,534] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: credential_provider_2
ap2_credential_provider_2  | [2025-11-01 00:49:27,535] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider_2  | [2025-11-01 00:49:27,535] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider_2'. Adding OTLP exporter to existing provider.
ap2_credential_provider_2  | [2025-11-01 00:49:27,537] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider_2  | [2025-11-01 00:49:27,538] INFO in v2.common.base_agent: [Credential Provider] OpenTelemetry distributed tracing enabled (service: credential_provider_2, manual instrumentation only)
ap2_credential_provider_2  | {"timestamp": "2025-11-01T00:49:27.604856Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:49:27.642781Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_credential_provider_2  | {"timestamp": "2025-11-01T00:49:27.662346Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_credential_provider_2  | [2025-11-01 00:49:27,662] INFO in v2.common.base_agent: [Credential Provider] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—
ãŸ: credential_provider
ap2_credential_provider_2  | {"timestamp": "2025-11-01T00:49:27.662744Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:49:27.662375Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_credential_provider    | [2025-11-01 00:49:27,662] INFO in v2.common.base_agent: [Credential Provider] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—
ãŸ: credential_provider
ap2_credential_provider    | {"timestamp": "2025-11-01T00:49:27.662669Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:49:27.668721Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_credential_provider    | [2025-11-01 00:49:27,668] INFO in v2.common.base_agent: [Credential Provider] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾
ã—ãŸ: credential_provider
ap2_credential_provider    | [2025-11-01 00:49:27,669] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/shopping_agent_did.json
ap2_credential_provider    | [2025-11-01 00:49:27,670] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_credential_provider    | [2025-11-01 00:49:27,670] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/merchant_agent_did.json
ap2_credential_provider    | [2025-11-01 00:49:27,671] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_credential_provider    | [2025-11-01 00:49:27,671] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/merchant_did.json
ap2_credential_provider_2  | [2025-11-01 00:49:27,668] INFO in v2.common.base_agent: [Credential Provider] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾
ã—ãŸ: credential_provider
ap2_credential_provider_2  | {"timestamp": "2025-11-01T00:49:27.668917Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_credential_provider_2  | [2025-11-01 00:49:27,669] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/shopping_agent_did.json
ap2_credential_provider_2  | [2025-11-01 00:49:27,670] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_credential_provider_2  | [2025-11-01 00:49:27,670] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/merchant_agent_did.json
ap2_credential_provider_2  | [2025-11-01 00:49:27,671] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_credential_provider_2  | [2025-11-01 00:49:27,671] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/merchant_did.json
ap2_credential_provider    | [2025-11-01 00:49:27,673] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_credential_provider    | [2025-11-01 00:49:27,676] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/credential_provider_did.json
ap2_credential_provider_2  | [2025-11-01 00:49:27,675] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_credential_provider_2  | [2025-11-01 00:49:27,675] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/credential_provider_did.json
ap2_credential_provider    | [2025-11-01 00:49:27,684] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp
ap2_credential_provider    | [2025-11-01 00:49:27,684] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_credential_provider    | [2025-11-01 00:49:27,685] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2
ap2_credential_provider    | [2025-11-01 00:49:27,685] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/payment_processor_did.json
ap2_credential_provider_2  | [2025-11-01 00:49:27,683] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp
ap2_credential_provider_2  | [2025-11-01 00:49:27,684] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_credential_provider_2  | [2025-11-01 00:49:27,685] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2
ap2_credential_provider_2  | [2025-11-01 00:49:27,685] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/payment_processor_did.json
ap2_credential_provider_2  | [2025-11-01 00:49:27,687] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor
ap2_credential_provider_2  | {"timestamp": "2025-11-01T00:49:27.687645Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider_2  | {"timestamp": "2025-11-01T00:49:27.687781Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.AttestationRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider    | [2025-11-01 00:49:27,687] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor
ap2_credential_provider    | {"timestamp": "2025-11-01T00:49:27.687454Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:49:27.687502Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.AttestationRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider_2  | [2025-11-01 00:49:27,698] INFO in v2.common.base_agent: [Credential Provider] Initialized: did:ap2:agent:credential_provider
ap2_credential_provider    | [2025-11-01 00:49:27,699] INFO in v2.common.base_agent: [Credential Provider] Initialized: did:ap2:agent:credential_provider
ap2_credential_provider_2  | {"timestamp": "2025-11-01T00:49:27.928078Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Initialized", "module": "provider", "function": "__init__", "line": 151}
ap2_credential_provider_2  | [2025-11-01 00:49:27,928] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_credential_provider    | {"timestamp": "2025-11-01T00:49:27.932606Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Initialized", "module": "provider", "function": "__init__", "line": 151}
ap2_credential_provider    | [2025-11-01 00:49:27,935] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_credential_provider_2  | [2025-11-01 00:49:28,198] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider_2  | [2025-11-01 00:49:28,198] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider_2'. Adding OTLP exporter to existing provider.
ap2_credential_provider_2  | [2025-11-01 00:49:28,198] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider_2  | [2025-11-01 00:49:28,199] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider_2  | [2025-11-01 00:49:28,199] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider_2'. Adding OTLP exporter to existing provider.
ap2_credential_provider_2  | [2025-11-01 00:49:28,199] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider_2  | [2025-11-01 00:49:28,199] INFO in v2.common.base_agent: [Credential Provider] OpenTelemetry distributed tracing enabled (service: credential_provider_2, manual instrumentation only)
ap2_credential_provider_2  | {"timestamp": "2025-11-01T00:49:28.199859Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_credential_provider_2  | {"timestamp": "2025-11-01T00:49:28.200582Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_credential_provider_2  | [2025-11-01 00:49:28,200] INFO in v2.common.base_agent: [Credential Provider] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—
ãŸ: credential_provider
ap2_credential_provider_2  | {"timestamp": "2025-11-01T00:49:28.200639Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}

ap2_credential_provider    | [2025-11-01 00:49:28,202] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider


ap2_credential_provider_2  | [2025-11-01 00:49:28,201] INFO in v2.common.base_agent: [Credential Provider] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: credential_provider

ap2_credential_provider    | [2025-11-01 00:49:28,202] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider'. Adding OTLP exporter to existing provider.




ap2_credential_provider    | [2025-11-01 00:49:28,203] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider_2  | {"timestamp": "2025-11-01T00:49:28.201397Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}



ap2_credential_provider_2  | [2025-11-01 00:49:28,201] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ap2_credential_provider    | [2025-11-01 00:49:28,203] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider_2  | [2025-11-01 00:49:28,202] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_credential_provider    | [2025-11-01 00:49:28,203] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider'. Adding OTLP exporter to existing provider.


ap2_credential_provider_2  | [2025-11-01 00:49:28,202] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/merchant_agent_did.json

ap2_credential_provider    | [2025-11-01 00:49:28,203] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully

ap2_credential_provider    | [2025-11-01 00:49:28,203] INFO in v2.common.base_agent: [Credential Provider] OpenTelemetry distributed tracing enabled (service: credential_provider, manual instrumentation only)
ap2_credential_provider_2  | [2025-11-01 00:49:28,202] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent


ap2_credential_provider    | {"timestamp": "2025-11-01T00:49:28.203880Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_credential_provider_2  | [2025-11-01 00:49:28,202] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/merchant_did.json
ap2_credential_provider_2  | [2025-11-01 00:49:28,202] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_credential_provider    | {"timestamp": "2025-11-01T00:49:28.204523Z", "level": "INFO", "logger": "common.crypto", "message":
ap2_credential_provider_2  | [2025-11-01 00:49:28,202] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/credential_provider_did.json


ap2_credential_provider    | [2025-11-01 00:49:28,204] INFO in v2.common.base_agent: [Credential Provider] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—
ãŸ: credential_provider




ap2_credential_provider_2  | [2025-11-01 00:49:28,203] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp


ap2_credential_provider    | {"timestamp": "2025-11-01T00:49:28.204642Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 345}
ap2_credential_provider_2  | [2025-11-01 00:49:28,203] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/credential_provider_2_did.json




ap2_credential_provider_2  | [2025-11-01 00:49:28,203] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2
ap2_credential_provider    | {"timestamp": "2025-11-01T00:49:28.205199Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 367}
ap2_credential_provider    | [2025-11-01 00:49:28,205] INFO in v2.common.base_agent: [Credential Provider] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: credential_provider
ap2_credential_provider_2  | [2025-11-01 00:49:28,203] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/payment_processor_did.json


ap2_credential_provider    | [2025-11-01 00:49:28,205] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/shopping_agent_did.json


ap2_credential_provider_2  | [2025-11-01 00:49:28,204] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor

ap2_credential_provider    | [2025-11-01 00:49:28,205] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_credential_provider_2  | {"timestamp": "2025-11-01T00:49:28.204338Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider    | [2025-11-01 00:49:28,205] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/merchant_agent_did.json
ap2_credential_provider_2  | {"timestamp": "2025-11-01T00:49:28.204370Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.AttestationRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}


ap2_credential_provider_2  | [2025-11-01 00:49:28,210] INFO in v2.common.base_agent: [Credential Provider] Initialized: did:ap2:agent:credential_provider
ap2_credential_provider    | [2025-11-01 00:49:28,206] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent


ap2_credential_provider_2  | {"timestamp": "2025-11-01T00:49:28.215430Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Initialized", "module": "provider", "function": "__init__", "line": 151}
ap2_credential_provider    | [2025-11-01 00:49:28,206] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_credential_provider_2  | [2025-11-01 00:49:28,215] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)edential_provider_did.json

ap2_credential_provider_2  | INFO:     Started server process [1]mmon.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp


ap2_credential_provider    | [2025-11-01 00:49:28,206] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_credential_provider_2  | INFO:     Waiting for application startup.


ap2_credential_provider    | [2025-11-01 00:49:28,206] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²:
ap2_credential_provider_2  | {"timestamp": "2025-11-01T00:49:28.218280Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Running startup tasks...", "module": "provider", "function": "startup_event", "line": 145}
ap2_credential_provider    | [2025-11-01 00:49:28,207] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor
ap2_credential_provider    | {"timestamp": "2025-11-01T00:49:28.207517Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:49:28.207555Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.AttestationRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider    | [2025-11-01 00:49:28,226] INFO in v2.common.base_agent: [Credential Provider] Initialized: did:ap2:agent:credential_provider
ap2_credential_provider    | {"timestamp": "2025-11-01T00:49:28.238250Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Initialized", "module": "provider", "function": "__init__", "line": 151}
ap2_credential_provider    | [2025-11-01 00:49:28,238] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_credential_provider    | INFO:     Started server process [1]
ap2_credential_provider    | INFO:     Waiting for application startup.
ap2_credential_provider    | {"timestamp": "2025-11-01T00:49:28.250470Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Running startup tasks...", "module": "provider", "function": "startup_event", "line": 145}
ap2_credential_provider_2  | INFO:     Application startup complete.
ap2_credential_provider_2  | {"timestamp": "2025-11-01T00:49:28.279336Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Database initialized", "module": "provider", "function": "startup_event", "line": 149}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:49:28.281749Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Database initialized", "module": "provider", "function": "startup_event", "line": 149}
ap2_credential_provider    | INFO:     Application startup complete.
ap2_credential_provider    | INFO:     Uvicorn running on http://0.0.0.0:8003 (Press CTRL+C to quit)
ap2_credential_provider_2  | INFO:     Uvicorn running on http://0.0.0.0:8003 (Press CTRL+C to quit)
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:49:32.226469Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:49:32.240002Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1761958169365_f3l0q\n  user_id: usr_ee3014bbc51f4156\n  user_input: ã‚\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1058}
ap2_shopping_agent         | INFO:     172.67.69.85:37389 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:49:32.549849Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Created new session in DB: session_1761958169365_f3l0q", "module": "agent", "function": "_get_or_create_session", "line": 1965}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:49:32.550654Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1761958169365_f3l0q)", "module": "agent", "function": "event_generator", "line": 1073}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:49:32.555649Z", "level": "INFO", "logger": "agent", "message": "[Langfuse] Created new handler for session: session_1761958169365_f3l0q", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1643}
ap2_shopping_agent         | [2025-11-01 00:49:32,594] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: initial
ap2_shopping_agent         |   user_input: ã‚
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:49:35.153088Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=ask_intent", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:49:35.157488Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=ask_intent", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:49:37.513981Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:49:37.514913Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1761958169365_f3l0q\n  user_id: usr_ee3014bbc51f4156\n  user_input: ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºãŒã»ã—ã„ã€‚5000å††ä»¥å†…\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1058}
ap2_shopping_agent         | INFO:     172.67.69.85:37389 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:49:37.519410Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761958169365_f3l0q, step=ask_intent", "module": "agent", "function": "_get_or_create_session", "line": 1943}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:49:37.520681Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1761958169365_f3l0q)", "module": "agent", "function": "event_generator", "line": 1073}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:49:37.520878Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1761958169365_f3l0q", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1646}
ap2_shopping_agent         | [2025-11-01 00:49:37,548] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: ask_intent
ap2_shopping_agent         |   user_input: ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºãŒã»ã—ã„ã€‚5000å††ä»¥å†…
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-01 00:50:12,592] INFO in services.shopping_agent.langgraph_shopping_flow: [collect_intent_node] LLM result: {'intent': 'ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„', 'max_amount': 5000, 'keywords': ['ã‹ã‚ã„ã„', 'ã‚°ãƒƒã‚º', 'ãŠã—ã‚ƒã‚Œ']}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:12.593597Z", "level": "INFO", "logger": "agent", "message": "[_create_intent_mandate] Reconstructed intent: ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„ã€‚5000å††ä»¥å†…", "module": "agent", "function": "_create_intent_mandate", "line": 1733}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:12.593977Z", "level": "INFO", "logger": "agent", "message": "[_build_intent_mandate_from_session] Constructed natural_language_description: ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„ã€‚5000å††ä»¥å†…", "module": "agent", "function": "_build_intent_mandate_from_session", "line": 1812}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:12.594677Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] IntentMandate created (AP2-compliant): intent='ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„...', expiry=2025-11-01T01:50:12.593363Z", "module": "agent", "function": "_build_intent_mandate_from_session", "line": 1824}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:19.266683Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=intent_complete_ask_shipping", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:19.273160Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=intent_complete_ask_shipping", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:25.925790Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:25.934293Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1761958169365_f3l0q\n  user_id: usr_ee3014bbc51f4156\n  user_input: {\"recipient\":\"ã‚\",\"postal_code\":\"ã‚\",\"city\":\"ã‚\",\"region\":\"ã‚\",\"address_line1\":\"ã‚\",\"country\":\"ã‚\"}\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1058}
ap2_shopping_agent         | INFO:     172.67.69.85:32609 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:25.950299Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761958169365_f3l0q, step=intent_complete_ask_shipping", "module": "agent", "function": "_get_or_create_session", "line": 1943}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:25.951206Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1761958169365_f3l0q)", "module": "agent", "function": "event_generator", "line": 1073}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:25.951407Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1761958169365_f3l0q", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1646}
ap2_shopping_agent         | [2025-11-01 00:50:25,971] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: intent_complete_ask_shipping
ap2_shopping_agent         |   user_input: {"recipient":"ã‚","postal_code":"ã‚","city":"ã‚","region":"ã‚","address_line1":"ã‚","country":"ã‚"}
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-01 00:50:26,285] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] DEBUG: user_input='{"recipient":"ã‚","postal_code":"ã‚","city":"ã‚","region":"ã‚","address_line1":"ã‚","country":"ã‚"}', session['step']='select_cp', is_digit=False
ap2_shopping_agent         | [2025-11-01 00:50:26,286] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] Resolved CP from DID: did=did:ap2:cp:demo_cp, name=AP2 Demo Credential Provider, url=http://credential_provider:8003
ap2_shopping_agent         | [2025-11-01 00:50:26,287] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] Resolved CP from DID: did=did:ap2:cp:demo_cp_2, name=AP2 Demo Credential Provider 2, url=http://credential_provider_2:8003
ap2_shopping_agent         | [2025-11-01 00:50:26,287] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] AP2 Step 4: Presenting 2 Credential Providers to user
ap2_shopping_agent         |   User ID: usr_ee3014bbc51f4156
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:27.525438Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=select_cp", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:27.533833Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=select_cp", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.013123Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.014516Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1761958169365_f3l0q\n  user_id: usr_ee3014bbc51f4156\n  user_input: 1\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1058}
ap2_shopping_agent         | INFO:     172.67.69.85:61348 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.020423Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761958169365_f3l0q, step=select_cp", "module": "agent", "function": "_get_or_create_session", "line": 1943}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.021052Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1761958169365_f3l0q)", "module": "agent", "function": "event_generator", "line": 1073}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.021255Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1761958169365_f3l0q", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1646}
ap2_shopping_agent         | [2025-11-01 00:50:29,041] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: select_cp
ap2_shopping_agent         |   user_input: 1
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-01 00:50:29,045] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] DEBUG: user_input='1', session['step']='select_cp', is_digit=True
ap2_shopping_agent         | [2025-11-01 00:50:29,045] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] Resolved CP from DID: did=did:ap2:cp:demo_cp, name=AP2 Demo Credential Provider, url=http://credential_provider:8003
ap2_shopping_agent         | [2025-11-01 00:50:29,045] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] Resolved CP from DID: did=did:ap2:cp:demo_cp_2, name=AP2 Demo Credential Provider 2, url=http://credential_provider_2:8003
ap2_shopping_agent         | [2025-11-01 00:50:29,045] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] AP2 Step 4: User selected Credential Provider
ap2_shopping_agent         |   User ID: usr_ee3014bbc51f4156
ap2_shopping_agent         |   CP ID: did:ap2:cp:demo_cp
ap2_shopping_agent         |   CP Name: AP2 Demo Credential Provider
ap2_shopping_agent         | [2025-11-01 00:50:29,255] INFO in services.shopping_agent.langgraph_shopping_flow: [get_payment_methods_node] AP2 Step 6-7: Requesting payment methods from CP
ap2_shopping_agent         |   User ID: usr_ee3014bbc51f4156
ap2_shopping_agent         |   CP ID: did:ap2:cp:demo_cp
ap2_shopping_agent         |   CP URL: http://credential_provider:8003
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.257749Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Requesting payment methods from Credential Provider (http://credential_provider:8003) for user: usr_ee3014bbc51f4156", "module": "agent", "function": "_get_payment_methods_from_cp", "line": 2316}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.261011Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: GET http://credential_provider:8003/payment-methods", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.261495Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"GET\", \"url\": \"http://credential_provider:8003/payment-methods\", \"headers\": {}, \"body\": null}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:50:29.569821Z", "level": "INFO", "logger": "provider", "message": "[get_payment_methods] Retrieved 1 payment methods for user: usr_ee3014bbc51f4156", "module": "provider", "function": "get_payment_methods", "line": 631}
ap2_credential_provider    | INFO:     172.18.0.9:34006 - "GET /payment-methods?user_id=usr_ee3014bbc51f4156 HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.576076Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (317.37ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.576146Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:50:28 GMT\", \"server\": \"uvicorn\", \"content-length\": \"252\", \"content-type\": \"application/json\"}, \"body\": {\"user_id\": \"usr_ee3014bbc51f4156\", \"payment_methods\": [{\"id\": \"pm_e6367cd7\", \"type\": \"basic-card\", \"display_name\": \"Visaã‚«ãƒ¼ãƒ‰ (****1111)\", \"brand\": \"Visa\", \"last4\": \"1111\", \"requires_step_up\": false, \"billing_address\": {\"country\": \"JP\", \"postal_code\": \"111-1111\"}}]}, \"duration_ms\": 317.3692226409912}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.576201Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Retrieved 1 payment methods from Credential Provider", "module": "agent", "function": "_get_payment_methods_from_cp", "line": 2334}
ap2_shopping_agent         | [2025-11-01 00:50:29,576] INFO in services.shopping_agent.langgraph_shopping_flow: [get_payment_methods_node] AP2 Step 7: Received 1 payment methods from CP
ap2_shopping_agent         |   Payment Methods: ['pm_e6367cd7']
ap2_shopping_agent         | [2025-11-01 00:50:29,785] INFO in services.shopping_agent.langgraph_shopping_flow: [fetch_carts_node] AP2 Step 8-12: Fetching cart candidates from Merchant Agent
ap2_shopping_agent         | [2025-11-01 00:50:29,785] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Requesting cart candidates from Merchant Agent for IntentMandate: intent_a97064a3
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.788609Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 841}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.795433Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 797, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.IntentMandate\",\"id\":\"intent_a97064a3\",\"payload\":{\"intent_mandate\":{\"created_at\":\"2025-11-01T00:50:12.593363Z\",\"id\":\"intent_a97064a3\",\"intent_expiry\":\"2025-11-01T01:5", "module": "crypto", "function": "sign_a2a_message", "line": 845}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.795483Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 640}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.812673Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: shopping_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.813302Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:merchant_agent: ap2.mandates.IntentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.813491Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.mandates.IntentMandate\", \"peer\": \"did:ap2:agent:merchant_agent\", \"headers\": {\"message_id\": \"a2d45408-afbc-4891-af66-647e82665f25\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-01T00:50:29.785905Z\", \"nonce\": \"cc624e26345bfe79c092580578dbba04a14f46c27d44077b2d89303a35970833\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"intent_mandate\": {\"id\": \"intent_a97064a3\", \"type\": \"IntentMandate\", \"user_id\": \"usr_ee3014bbc51f4156\", \"user_cart_confirmation_required\": true, \"natural_language_description\": \"ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„ã€‚5000å††ä»¥å†…\", \"requires_refundability\": false, \"intent_expiry\": \"2025-11-01T01:50:12.593363Z\", \"created_at\": \"2025-11-01T00:50:12.593363Z\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_shopping_agent         | [2025-11-01 00:50:29,813] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Intent A2A message created: message_id=a2d45408-afbc-4891-af66-647e82665f25, intent_mandate_id=intent_a97064a3
ap2_shopping_agent         | [2025-11-01 00:50:29,813] INFO in services.shopping_agent.utils.merchant_integration:
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [ShoppingAgent â†’ MerchantAgent] A2Aãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
ap2_shopping_agent         |   URL: http://merchant_agent:8001/a2a/message
ap2_shopping_agent         |   ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID: a2d45408-afbc-4891-af66-647e82665f25
ap2_shopping_agent         |   ã‚¿ã‚¤ãƒ—: ap2.mandates.IntentMandate
ap2_shopping_agent         |   ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰: {
ap2_shopping_agent         |   "id": "intent_a97064a3",
ap2_shopping_agent         |   "type": "IntentMandate",
ap2_shopping_agent         |   "user_id": "usr_ee3014bbc51f4156",
ap2_shopping_agent         |   "user_cart_confirmation_required": true,
ap2_shopping_agent         |   "natural_language_description": "ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„ã€‚5000å††ä»¥å†…",
ap2_shopping_agent         |   "requires_refundability": false,
ap2_shopping_agent         |   "intent_expiry": "2025-11-01T01:50:12.593363Z",
ap2_shopping_agent         |   "created_at": "2025-11-01T00:50:12.593363Z"
ap2_shopping_agent         | }
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.815626Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent:8001/a2a/message", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:50:29.816006Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent:8001/a2a/message\", \"headers\": {}, \"body\": {\"header\": {\"message_id\": \"a2d45408-afbc-4891-af66-647e82665f25\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-01T00:50:29.785905Z\", \"nonce\": \"cc624e26345bfe79c092580578dbba04a14f46c27d44077b2d89303a35970833\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"7Wni+8kmBvpZUL6yneQNv8PafiOyHP3IsfwOT9gKDxJT9QK6RrYrzqVXWQnAB4GL6z2xvKpHPq4zL6aF+IiICA==\", \"publicKey\": \"LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUNvd0JRWURLMlZ3QXlFQSt4cHkrMkRqZ0FJcVBEUERmV0JLeExVd0NNL2pGdFZ6WlN3b3gyaGZtL0k9Ci0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLQo=\", \"kid\": \"did:ap2:agent:shopping_agent#key-2\", \"created\": \"2025-11-01T00:50:29.785905Z\", \"proofPurpose\": \"authentication\"}, \"signature\": null}, \"dataPart\": {\"@type\": \"ap2.mandates.IntentMandate\", \"id\": \"intent_a97064a3\", \"payload\": {\"intent_mandate\": {\"id\": \"intent_a97064a3\", \"type\": \"IntentMandate\", \"user_id\": \"usr_ee3014bbc51f4156\", \"user_cart_confirmation_required\": true, \"natural_language_description\": \"ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„ã€‚5000å††ä»¥å†…\", \"requires_refundability\": false, \"intent_expiry\": \"2025-11-01T01:50:12.593363Z\", \"created_at\": \"2025-11-01T00:50:12.593363Z\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"kind\": null, \"artifact\": null}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | [2025-11-01 00:50:29,891] INFO in v2.common.base_agent:
ap2_merchant_agent         | ================================================================================
ap2_merchant_agent         | [Merchant Agent] A2Aã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: POST /a2a/message
ap2_merchant_agent         |   å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ID=a2d45408-afbc-4891-af66-647e82665f25
ap2_merchant_agent         |   é€ä¿¡å…ƒ: did:ap2:agent:shopping_agent
ap2_merchant_agent         |   ã‚¿ã‚¤ãƒ—: ap2.mandates.IntentMandate
ap2_merchant_agent         | ================================================================================
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:29.895895Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message received to/from did:ap2:agent:shopping_agent: ap2.mandates.IntentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:29.896825Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"received\", \"message_type\": \"ap2.mandates.IntentMandate\", \"peer\": \"did:ap2:agent:shopping_agent\", \"headers\": {\"message_id\": \"a2d45408-afbc-4891-af66-647e82665f25\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-01T00:50:29.785905Z\", \"nonce\": \"cc624e26345bfe79c092580578dbba04a14f46c27d44077b2d89303a35970833\", \"schema_version\": \"0.2\"}, \"payload\": {\"intent_mandate\": {\"id\": \"intent_a97064a3\", \"type\": \"IntentMandate\", \"user_id\": \"usr_ee3014bbc51f4156\", \"user_cart_confirmation_required\": true, \"natural_language_description\": \"ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„ã€‚5000å††ä»¥å†…\", \"requires_refundability\": false, \"intent_expiry\": \"2025-11-01T01:50:12.593363Z\", \"created_at\": \"2025-11-01T00:50:12.593363Z\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:29.901145Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Nonce validation successful: nonce=cc624e26345bfe79...", "module": "a2a_handler", "function": "verify_message_signature", "line": 156}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:29.903926Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Using DID-resolved public key for verification: kid=did:ap2:agent:shopping_agent#key-2", "module": "a2a_handler", "function": "verify_message_signature", "line": 184}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:29.910081Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying A2A message signature", "module": "crypto", "function": "verify_a2a_message_signature", "line": 869}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:29.924792Z", "level": "DEBUG", "logger": "common.crypto", "message": "[VERIFY] Canonical JSON length: 797, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.IntentMandate\",\"id\":\"intent_a97064a3\",\"payload\":{\"intent_mandate\":{\"created_at\":\"2025-11-01T00:50:12.593363Z\",\"id\":\"intent_a97064a3\",\"intent_expiry\":\"2025-11-01T01:5", "module": "crypto", "function": "verify_a2a_message_signature", "line": 873}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:29.924855Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying signature (algorithm: ED25519)", "module": "crypto", "function": "verify_signature", "line": 703}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:29.937673Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto VERIFY: ED25519 (key: did:ap2:agent:shopping_agent#key-2) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:29.937923Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] proofç½²åæ¤œè¨¼æˆåŠŸ: sender=did:ap2:agent:shopping_agent, alg=ed25519, kid=did:ap2:agent:shopping_agent#key-2, public_key_source=DID-resolved", "module": "a2a_handler", "function": "verify_message_signature", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:29.938135Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2Aå‡¦ç†] ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè¡Œä¸­: type=ap2.mandates.IntentMandate, from=did:ap2:agent:shopping_agent", "module": "a2a_handler", "function": "handle_message", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:29.939766Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Received IntentMandate", "module": "intent_handler", "function": "handle_intent_mandate", "line": 32}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:29.939831Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Received IntentMandate with shipping_address (AP2 v0.1 compliant)", "module": "intent_handler", "function": "handle_intent_mandate", "line": 50}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:29.939861Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Searching products with intent: 'ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„ã€‚5000å††ä»¥å†…'", "module": "intent_handler", "function": "handle_intent_mandate", "line": 54}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:29.939895Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Using provided shipping address: ã‚", "module": "intent_handler", "function": "handle_intent_mandate", "line": 71}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:29.939939Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Using LangGraph AI engine for cart generation", "module": "intent_handler", "function": "handle_intent_mandate", "line": 76}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:29.949904Z", "level": "INFO", "logger": "langgraph_merchant", "message": "[Langfuse] Created new handler for session: 147ca572-5bf1-4e98-a382-772be2bd9c34", "module": "langgraph_merchant", "function": "create_cart_candidates", "line": 289}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:30.032691Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: initialize", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:30.032761Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"initialize\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\"}, \"arguments\": {\"protocolVersion\": \"2025-03-26\", \"clientInfo\": {\"name\": \"ap2_langgraph_client\", \"version\": \"1.0.0\"}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:30.033382Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:30.033445Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"initialize\", \"params\": {\"protocolVersion\": \"2025-03-26\", \"clientInfo\": {\"name\": \"ap2_langgraph_client\", \"version\": \"1.0.0\"}}, \"id\": 763099}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent_mcp     | INFO:     172.18.0.5:58568 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:30.212768Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (179.10ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:30.212903Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:50:29 GMT\", \"server\": \"uvicorn\", \"mcp-session-id\": \"d054f5e3-f3c8-4b9d-a04c-fe247466e84f\", \"content-length\": \"1145\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 763099, \"result\": {\"protocolVersion\": \"2025-03-26\", \"serverInfo\": {\"name\": \"merchant_agent_mcp\", \"version\": \"1.0.0\"}, \"capabilities\": {\"tools\": {\"search_products\": {\"description\": \"ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å•†å“ã‚’æ¤œç´¢\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"keywords\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ\"}, \"limit\": {\"type\": \"integer\", \"description\": \"æœ€å¤§æ¤œç´¢çµæžœæ•°\", \"default\": 20}}, \"required\": [\"keywords\"]}}, \"check_inventory\": {\"description\": \"åœ¨åº«çŠ¶æ³
ã‚’ç¢ºèª\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"product_ids\": {\"type\": \"array\", \"items\": {\"type\": \"integer\"}, \"description\": \"å•†å“IDãƒªã‚¹ãƒˆ\"}}, \"required\": [\"product_ids\"]}}, \"build_cart_mandates\": {\"description\": \"AP2æº–æ‹ ã®CartMandateã‚’æ§‹ç¯‰ï¼ˆæœªç½²åï¼‰\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"cart_plan\": {\"type\": \"object\", \"description\": \"ã‚«ãƒ¼ãƒˆãƒ—ãƒ©ãƒ³ï¼ˆoptimize_cartã®çµæžœï¼‰\"}, \"products\": {\"type\": \"array\", \"items\": {\"type\": \"object\"}, \"description\": \"å•†å“æƒ…å ±ãƒªã‚¹ãƒˆ\"}, \"shipping_address\": {\"type\": \"object\", \"description\": \"AP2æº–æ‹ ã®ContactAddress\"}}, \"required\": [\"cart_plan\", \"products\"]}}}}}}, \"duration_ms\": 179.10337448120117}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:30.214827Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: initialize - SUCCESS (182.01ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:30.214895Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"initialize\", \"result\": {\"protocolVersion\": \"2025-03-26\", \"serverInfo\": {\"name\": \"merchant_agent_mcp\", \"version\": \"1.0.0\"}, \"capabilities\": {\"tools\": {\"search_products\": {\"description\": \"ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å•†å“ã‚’æ¤œç´¢\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"keywords\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ\"}, \"limit\": {\"type\": \"integer\", \"description\": \"æœ€å¤§æ¤œç´¢çµæžœæ•°\", \"default\": 20}}, \"required\": [\"keywords\"]}}, \"check_inventory\": {\"description\": \"åœ¨åº«çŠ¶æ³ã‚’ç¢ºèª\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"product_ids\": {\"type\": \"array\", \"items\": {\"type\": \"integer\"}, \"description\": \"å•†å“IDãƒªã‚¹ãƒˆ\"}}, \"required\": [\"product_ids\"]}}, \"build_cart_mandates\": {\"description\": \"AP2æº–æ‹ ã®CartMandateã‚’æ§‹ç¯‰ï¼ˆæœªç½²åï¼‰\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"cart_plan\": {\"type\": \"object\", \"description\": \"ã‚«ãƒ¼ãƒˆãƒ—ãƒ©ãƒ³ï¼ˆoptimize_cartã®çµæžœï¼‰\"}, \"products\": {\"type\": \"array\", \"items\": {\"type\": \"object\"}, \"description\": \"å•†å“æƒ…å ±ãƒªã‚¹ãƒˆ\"}, \"shipping_address\": {\"type\": \"object\", \"description\": \"AP2æº–æ‹ ã®ContactAddress\"}}, \"required\": [\"cart_plan\", \"products\"]}}}}}, \"error\": null, \"duration_ms\": 182.0065975189209}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:30.214923Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Initialized session: d054f5e3-f3c8-4b9d-a04c-fe247466e84f", "module": "mcp_client", "function": "initialize", "line": 88}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:30.215012Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Server capabilities: {'tools': {'search_products': {'description': 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å•†å“ã‚’æ¤œç´¢', 'inputSchema': {'type': 'object', 'properties': {'keywords': {'type': 'array', 'items': {'type': 'string'}, 'description': 'æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹
ãƒˆ'}, 'limit': {'type': 'integer', 'description': 'æœ€å¤§æ¤œç´¢çµæžœæ•°', 'default': 20}}, 'required': ['keywords']}}, 'check_inventory': {'description': 'åœ¨åº«çŠ¶æ³ã‚’ç¢ºèª', 'inputSchema': {'type': 'object', 'properties': {'product_ids': {'type': 'array', 'items': {'type': 'integer'}, 'description': 'å•†å“IDãƒªã‚¹ãƒˆ'}}, 'required': ['product_ids']}}, 'build_cart_mandates': {'description': 'AP2æº–æ‹ ã®CartMandateã‚’æ§‹ç¯‰ï¼ˆæœªç½²åï¼‰', 'inputSchema': {'type': 'object', 'properties': {'cart_plan': {'type': 'object', 'description': 'ã‚«ãƒ¼ãƒˆãƒ—ãƒ©ãƒ³ï¼ˆoptimize_cartã®çµæžœï¼‰'}, 'products': {'type': 'array', 'items': {'type': 'object'}, 'description': 'å•†å“æƒ…å ±ãƒªã‚¹ãƒˆ'}, 'shipping_address': {'type': 'object', 'description': 'AP2æº–æ‹ ã®ContactAddress'}}, 'required': ['cart_plan', 'products']}}}}", "module": "mcp_client", "function": "initialize", "line": 89}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:50:30.215092Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.intent_node", "message": "[analyze_intent] MCP client initialized", "module": "intent_node", "function": "analyze_intent", "line": 35}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:00.514134Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.intent_node", "message": "[analyze_intent] LLM result: {'primary_need': 'ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’5000å††ä»¥å†…ã§è³¼å…¥ã—ãŸã„', 'budget_strategy': 'low', 'key_factors': ['ä¾¡æ ¼', 'ã‹ã‚ã„ã„'], 'search_keywords': ['ã‹ã‚ã„ã„', 'ã‚°ãƒƒã‚º', 'Tã‚·ãƒ£ãƒ„']}", "module": "intent_node", "function": "analyze_intent", "line": 124}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:00.531873Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:00.531971Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"d054f5e3-f3c8-4b9d-a04c-fe247466e84f\"}, \"arguments\": {\"name\": \"search_products\", \"arguments\": {\"keywords\": [\"ã‹ã‚ã„ã„\", \"ã‚°ãƒƒã‚º\", \"Tã‚·ãƒ£ãƒ„\"], \"limit\": 20}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:00.532270Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:00.532337Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"d054f5e3-f3c8-4b9d-a04c-fe247466e84f\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"search_products\", \"arguments\": {\"keywords\": [\"ã‹ã‚ã„ã„\", \"ã‚°ãƒƒã‚º\", \"Tã‚·ãƒ£ãƒ„\"], \"limit\": 20}}, \"id\": 51300}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent_mcp     | {"timestamp": "2025-11-01T00:51:00.558429Z", "level": "INFO", "logger": "main", "message": "[search_products] Searching with query: 'ã‹ã‚ã„ã„ ã‚°ãƒƒã‚º Tã‚·ãƒ£ãƒ„'", "module": "main", "function": "search_products", "line": 123}
ap2_meilisearch            | 2025-11-01T00:51:01.019261Z  INFO HTTP request{method=POST host="meilisearch:7700" route=/indexes/products/search query_parameters= user_agent=python-httpx/0.28.1 status_code=200}: meilisearch: close time.busy=16.6ms time.idle=36.5ms
ap2_merchant_agent_mcp     | {"timestamp": "2025-11-01T00:51:01.027973Z", "level": "INFO", "logger": "common.search_engine", "message": "[MeilisearchClient] Search 'ã‹ã‚ã„ã„ ã‚°ãƒƒã‚º Tã‚·ãƒ£ãƒ„' returned 6 products", "module": "search_engine", "function": "search", "line": 187}
ap2_merchant_agent_mcp     | {"timestamp": "2025-11-01T00:51:01.157543Z", "level": "INFO", "logger": "main", "message": "[search_products] Returned 6 products for keywords: ['ã‹ã‚ã„ã„', 'ã‚°ãƒƒã‚º', 'Tã‚·ãƒ£ãƒ„']", "module": "main", "function": "search_products", "line": 148}
ap2_merchant_agent_mcp     | INFO:     172.18.0.5:49158 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:01.160295Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (627.98ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:01.160426Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:51:00 GMT\", \"server\": \"uvicorn\", \"content-length\": \"3085\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 51300, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"products\\\": [\\n    {\\n      \\\"id\\\": \\\"3446cca8-fe68-4354-a518-63eb3e47d27f\\\",\\n      \\\"sku\\\": \\\"MUGI-KEYCHAIN-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\\\",\\n      \\\"description\\\": \\\"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\\\",\\n      \\\"price_cents\\\": 80000,\\n      \\\"price_jpy\\\": 800.0,\\n      \\\"inventory_count\\\": 100,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\\\",\\n      \\\"sku\\\": \\\"MUGI-CLOCK-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\\\",\\n      \\\"price_cents\\\": 350000,\\n      \\\"price_jpy\\\": 3500.0,\\n      \\\"inventory_count\\\": 30,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"cf08568b-8115-461c-aa7e-5a2e07bf4476\\\",\\n      \\\"sku\\\": \\\"MUGI-POUCH-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\\\",\\n      \\\"price_cents\\\": 95000,\\n      \\\"price_jpy\\\": 950.0,\\n      \\\"inventory_count\\\": 120,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"e534386f-c89b-4548-9734-78bd34958f88\\\",\\n      \\\"sku\\\": \\\"MUGI-MUG-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\\\",\\n      \\\"price_cents\\\": 120000,\\n      \\\"price_jpy\\\": 1200.0,\\n      \\\"inventory_count\\\": 80,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"eb0e5de8-679d-4445-8e64-a1d4d40097fd\\\",\\n      \\\"sku\\\": \\\"MUGI-SOCKS-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\\\",\\n      \\\"price_cents\\\": 85000,\\n      \\\"price_jpy\\\": 850.0,\\n      \\\"inventory_count\\\": 100,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"f0f41c9f-a31d-4a88-a180-96149a9057fc\\\",\\n      \\\"sku\\\": \\\"MUGI-PLATE-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\\\",\\n      \\\"price_cents\\\": 190000,\\n      \\\"price_jpy\\\": 1900.0,\\n      \\\"inventory_count\\\": 70,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    }\\n  ]\\n}\"}], \"isError\": false}}, \"duration_ms\": 627.9780864715576}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:01.160779Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (628.73ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:01.160986Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"products\\\": [\\n    {\\n      \\\"id\\\": \\\"3446cca8-fe68-4354-a518-63eb3e47d27f\\\",\\n      \\\"sku\\\": \\\"MUGI-KEYCHAIN-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\\\",\\n      \\\"description\\\": \\\"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\\\",\\n      \\\"price_cents\\\": 80000,\\n      \\\"price_jpy\\\": 800.0,\\n      \\\"inventory_count\\\": 100,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\\\",\\n      \\\"sku\\\": \\\"MUGI-CLOCK-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\\\",\\n      \\\"price_cents\\\": 350000,\\n      \\\"price_jpy\\\": 3500.0,\\n      \\\"inventory_count\\\": 30,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"cf08568b-8115-461c-aa7e-5a2e07bf4476\\\",\\n      \\\"sku\\\": \\\"MUGI-POUCH-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\\\",\\n      \\\"price_cents\\\": 95000,\\n      \\\"price_jpy\\\": 950.0,\\n      \\\"inventory_count\\\": 120,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"e534386f-c89b-4548-9734-78bd34958f88\\\",\\n      \\\"sku\\\": \\\"MUGI-MUG-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\\\",\\n      \\\"price_cents\\\": 120000,\\n      \\\"price_jpy\\\": 1200.0,\\n      \\\"inventory_count\\\": 80,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"eb0e5de8-679d-4445-8e64-a1d4d40097fd\\\",\\n      \\\"sku\\\": \\\"MUGI-SOCKS-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\\\",\\n      \\\"price_cents\\\": 85000,\\n      \\\"price_jpy\\\": 850.0,\\n      \\\"inventory_count\\\": 100,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"f0f41c9f-a31d-4a88-a180-96149a9057fc\\\",\\n      \\\"sku\\\": \\\"MUGI-PLATE-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆ
çš¿\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\\\",\\n      \\\"price_cents\\\": 190000,\\n      \\\"price_jpy\\\": 1900.0,\\n      \\\"inventory_count\\\": 70,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    }\\n  ]\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 628.7295818328857}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:01.161145Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Tool search_products executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:01.161217Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.search_node", "message": "[search_products] MCP returned 6 products", "module": "search_node", "function": "search_products", "line": 69}


ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:01.163223Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent_mcp     | {"timestamp": "2025-11-01T00:51:01.167188Z", "level": "INFO", "logger": "main", "message": "[check_inventory] Inventory: {'3446cca8-fe68-4354-a518-63eb3e47d27f': 100, '1530a7db-6b7a-458e-b7b9-f510f6fdaa89': 30, 'cf08568b-8115-461c-aa7e-5a2e07bf4476': 120, 'e534386f-c89b-4548-9734-78bd34958f88': 80, 'eb0e5de8-679d-4445-8e64-a1d4d40097fd': 100, 'f0f41c9f-a31d-4a88-a180-96149a9057fc': 70}", "module": "main", "function": "check_inventory", "line": 202}


ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:01.163257Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"d054f5e3-f3c8-4b9d-a04c-fe247466e84f\"}, \"arguments\": {\"name\": \"check_inventory\", \"arguments\": {\"product_ids\": [\"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"e534386f-c89b-4548-9734-78bd34958f88\", \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"f0f41c9f-a31d-4a88-a180-96149a9057fc\"]}}}", "module": "logger", "function": "log_mcp_request", "line": 294}


ap2_merchant_agent_mcp     | INFO:     172.18.0.5:49158 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:01.163570Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}


ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:01.163604Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"d054f5e3-f3c8-4b9d-a04c-fe247466e84f\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"check_inventory\", \"arguments\": {\"product_ids\": [\"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"e534386f-c89b-4548-9734-78bd34958f88\", \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"f0f41c9f-a31d-4a88-a180-96149a9057fc\"]}}, \"id\": 549093}}", "module": "logger", "function": "log_http_request", "line": 193}


ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:01.168104Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (4.50ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:01.168145Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:51:00 GMT\", \"server\": \"uvicorn\", \"content-length\": \"431\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 549093, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"inventory\\\": {\\n    \\\"3446cca8-fe68-4354-a518-63eb3e47d27f\\\": 100,\\n    \\\"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\\\": 30,\\n    \\\"cf08568b-8115-461c-aa7e-5a2e07bf4476\\\": 120,\\n    \\\"e534386f-c89b-4548-9734-78bd34958f88\\\": 80,\\n    \\\"eb0e5de8-679d-4445-8e64-a1d4d40097fd\\\": 100,\\n    \\\"f0f41c9f-a31d-4a88-a180-96149a9057fc\\\": 70\\n  }\\n}\"}], \"isError\": false}}, \"duration_ms\": 4.503011703491211}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:01.168337Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (5.01ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:01.168361Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"inventory\\\": {\\n    \\\"3446cca8-fe68-4354-a518-63eb3e47d27f\\\": 100,\\n    \\\"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\\\": 30,\\n    \\\"cf08568b-8115-461c-aa7e-5a2e07bf4476\\\": 120,\\n    \\\"e534386f-c89b-4548-9734-78bd34958f88\\\": 80,\\n    \\\"eb0e5de8-679d-4445-8e64-a1d4d40097fd\\\": 100,\\n    \\\"f0f41c9f-a31d-4a88-a180-96149a9057fc\\\": 70\\n  }\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 5.006551742553711}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:01.168380Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Tool check_inventory executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:51:01.168410Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.inventory_node", "message": "[check_inventory] MCP checked 6 products", "module": "inventory_node", "function": "check_inventory", "line": 62}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.578057Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.optimization_node", "message": "[optimize_cart] LLM generated 3 cart plans", "module": "optimization_node", "function": "optimize_cart", "line": 173}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.587058Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Creating 3 unsigned CartMandates...", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 66}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.588058Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.588225Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"d054f5e3-f3c8-4b9d-a04c-fe247466e84f\"}, \"arguments\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\", \"description\": \"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’4ç‚¹ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\", \"items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"quantity\": 1}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"quantity\": 1}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"quantity\": 1}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"quantity\": 1}]}, \"products\": [{\"id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"ã‚€ãŽ
ã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"sku\": \"MUGI-MUG-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.588797Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.588862Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"d054f5e3-f3c8-4b9d-a04c-fe247466e84f\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\", \"description\": \"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’4ç‚¹ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\", \"items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"quantity\": 1}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"quantity\": 1}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"quantity\": 1}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"quantity\": 1}]}, \"products\": [{\"id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"sku\": \"MUGI-MUG-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}, \"id\": 205947}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.665558Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (76.49ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent_mcp     | INFO:     172.18.0.5:56772 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.665682Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:52:43 GMT\", \"server\": \"uvicorn\", \"content-length\": \"4957\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 205947, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_7bda44e0\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_7bda44e0\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 800.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n     \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 950.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 850.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 1200.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 380.0,\\n             \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"é€æ–™\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"åˆè¨ˆ\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 4680.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-01T01:52:44.660702Z\\\",\\n      \\\"merchant_name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-01T00:52:44.660797Z\\\",\\n      \\\"cart_name\\\": \\\"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\\\",\\n      \\\"cart_description\\\": \\\"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’4ç‚¹ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"3446cca8-fe68-4354-a518-63eb3e47d27f\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\\\",\\n          \\\"description\\\": \\\"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"cf08568b-8115-461c-aa7e-5a2e07bf4476\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼æŸ„
ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 950.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 950.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"eb0e5de8-679d-4445-8e64-a1d4d40097fd\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"e534386f-c89b-4548-9734-78bd34958f88\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}}, \"duration_ms\": 76.48873329162598}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.666526Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (78.15ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.666677Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_7bda44e0\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_7bda44e0\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 800.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 950.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 850.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 1200.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 380.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"é€æ–™\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"åˆè¨ˆ\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 4680.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-01T01:52:44.660702Z\\\",\\n      \\\"merchant_name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-01T00:52:44.660797Z\\\",\\n      \\\"cart_name\\\": \\\"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\\\",\\n      \\\"cart_description\\\": \\\"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’4ç‚¹
ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"3446cca8-fe68-4354-a518-63eb3e47d27f\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\\\",\\n          \\\"description\\\": \\\"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"cf08568b-8115-461c-aa7e-5a2e07bf4476\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 950.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 950.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"eb0e5de8-679d-4445-8e64-a1d4d40097fd\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"e534386f-c89b-4548-9734-78bd34958f88\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Ž
æ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 78.14979553222656}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.666935Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Tool build_cart_mandates executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.667012Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Created unsigned CartMandate: cart_7bda44e0, plan=ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 94}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.667655Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.667714Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"d054f5e3-f3c8-4b9d-a04c-fe247466e84f\"}, \"arguments\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,650å††)\", \"description\": \"æ™‚è¨ˆã‚’å«ã‚€é«˜å“è³ªãªã‚¢ã‚¤ãƒ†ãƒ ã‚’3ç‚¹ã§ã‚«ãƒ¼ãƒˆã€‚äºˆç®—ã‚’å°‘ã—è¶…ãˆã‚‹ãŒã€ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’é‡è¦–ã€‚\", \"items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"quantity\": 1}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"quantity\": 1}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"quantity\": 1}]}, \"products\": [{\"id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢
ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"sku\": \"MUGI-MUG-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒ
ãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.667883Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.667938Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"d054f5e3-f3c8-4b9d-a04c-fe247466e84f\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,650å††)\", \"description\": \"æ™‚è¨ˆã‚’å«ã‚€é«˜å“è³ªãªã‚¢ã‚¤ãƒ†ãƒ ã‚’3ç‚¹ã§ã‚«ãƒ¼ãƒˆã€‚äºˆç®—ã‚’å°‘ã—è¶…ãˆã‚‹ãŒã€ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’é‡è¦–ã€‚\", \"items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"quantity\": 1}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"quantity\": 1}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"quantity\": 1}]}, \"products\": [{\"id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"sku\": \"MUGI-MUG-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}, \"id\": 680575}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.671168Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (3.22ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.671243Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:52:44 GMT\", \"server\": \"uvicorn\", \"content-length\": \"3891\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 680575, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_ccbab22a\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_ccbab22a\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 3500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 950.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 1200.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 565.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"åˆè¨ˆ\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 6215.0,\\n     \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-01T01:52:44.669646Z\\\",\\n      \\\"merchant_name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-01T00:52:44.669665Z\\\",\\n      \\\"cart_name\\\": \\\"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,650å††)\\\",\\n      \\\"cart_description\\\": \\\"æ™‚è¨ˆã‚’å«ã‚€é«˜å“è³ªãªã‚¢ã‚¤ãƒ†ãƒ ã‚’3ç‚¹ã§ã‚«ãƒ¼ãƒˆã€‚äºˆç®—ã‚’å°‘ã—è¶…ãˆã‚‹ãŒã€ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’é‡è¦–ã€‚\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"cf08568b-8115-461c-aa7e-5a2e07bf4476\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 950.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 950.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"e534386f-c89b-4548-9734-78bd34958f88\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}}, \"duration_ms\": 3.2203197479248047}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.671446Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (3.65ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.671500Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_ccbab22a\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_ccbab22a\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 3500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 950.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 1200.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 565.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"åˆè¨ˆ\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 6215.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-01T01:52:44.669646Z\\\",\\n      \\\"merchant_name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-01T00:52:44.669665Z\\\",\\n      \\\"cart_name\\\": \\\"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,650å††)\\\",\\n      \\\"cart_description\\\": \\\"æ™‚è¨ˆã‚’å«ã‚€é«˜å“è³ªãªã‚¢ã‚¤ãƒ†ãƒ ã‚’3ç‚¹ã§ã‚«ãƒ¼ãƒˆã€‚äºˆç®—ã‚’å°‘ã—è¶…ãˆã‚‹ãŒã€ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’é‡è¦–ã€‚\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 3500.0,\\n   \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"cf08568b-8115-461c-aa7e-5a2e07bf4476\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 950.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 950.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"e534386f-c89b-4548-9734-78bd34958f88\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n\\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 3.649473190307617}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.671647Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Tool build_cart_mandates executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.671736Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Created unsigned CartMandate: cart_ccbab22a, plan=é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,650å††)", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 94}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.672328Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.672384Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"d054f5e3-f3c8-4b9d-a04c-fe247466e84f\"}, \"arguments\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (1,650å††)\", \"description\": \"ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’2ç‚¹ã§ã‚·ãƒ³ãƒ—ãƒ«ã«ã€‚äºˆç®—å†…ã§æœ€å°é™ã®é¸æŠžã§ã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆã‚‹ã€‚\", \"items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"quantity\": 1}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"quantity\": 1}]}, \"products\": [{\"id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"sku\": \"MUGI-MUG-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ 
ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.672496Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent_mcp     | INFO:     172.18.0.5:56772 - "POST / HTTP/1.1" 200 OK


ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.672705Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"d054f5e3-f3c8-4b9d-a04c-fe247466e84f\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (1,650å††)\", \"description\": \"ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’2ç‚¹ã§ã‚·ãƒ³ãƒ—ãƒ«ã«ã€‚äºˆç®—å†…ã§æœ€å°é™ã®é¸æŠžã§ã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆã‚‹ã€‚\", \"items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"quantity\": 1}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"quantity\": 1}]}, \"products\": [{\"id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾
ã™ã€‚\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"sku\": \"MUGI-MUG-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹
ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"f0f41c9f-a31d-4a88-a180-96149a9057fc\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}, \"id\": 535806}}", "module": "logger", "function": "log_http_request", "line": 193}


ap2_merchant_agent_mcp     | INFO:     172.18.0.5:56772 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.675355Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (2.80ms)", "module": "logger", "function": "log_http_response", "line": 215}


ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.675409Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:52:44 GMT\", \"server\": \"uvicorn\", \"content-length\": \"3328\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 535806, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_fd700261\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_fd700261\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 800.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n     \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 850.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 165.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"é€æ–™\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"åˆè¨ˆ\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 2315.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-01T01:52:44.674220Z\\\",\\n      \\\"merchant_name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-01T00:52:44.674239Z\\\",\\n      \\\"cart_name\\\": \\\"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (1,650å††)\\\",\\n      \\\"cart_description\\\": \\\"ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’2ç‚¹ã§ã‚·ãƒ³ãƒ—ãƒ«ã«ã€‚äºˆç®—å†…ã§æœ€å°é™ã®é¸æŠžã§ã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆã‚‹ã€‚\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"3446cca8-fe68-4354-a518-63eb3e47d27f\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\\\",\\n          \\\"description\\\": \\\"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"eb0e5de8-679d-4445-8e64-a1d4d40097fd\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}}, \"duration_ms\": 2.7990341186523438}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.675738Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (3.20ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.675779Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_fd700261\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_fd700261\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 800.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 850.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 165.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"é€æ–™\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"åˆè¨ˆ\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 2315.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-01T01:52:44.674220Z\\\",\\n      \\\"merchant_name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-01T00:52:44.674239Z\\\",\\n      \\\"cart_name\\\": \\\"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (1,650å††)\\\",\\n      \\\"cart_description\\\": \\\"ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’2ç‚¹ã§ã‚·ãƒ³ãƒ—ãƒ«ã«ã€‚äºˆç®—å†…ã§æœ€å°é™ã®é¸æŠžã§ã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆã‚‹ã€‚\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"3446cca8-fe68-4354-a518-63eb3e47d27f\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\\\",\\n          \\\"description\\\": \\\"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"eb0e5de8-679d-4445-8e64-a1d4d40097fd\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 3.2036304473876953}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.675824Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Tool build_cart_mandates executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.675871Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Created unsigned CartMandate: cart_fd700261, plan=ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (1,650å††)", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 94}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.675895Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Created 3 unsigned CartMandates, sending to Merchant for signature...", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 116}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.676125Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Processing 3 CartMandates in parallel...", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 330}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.676992Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant:8002/sign/cart", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.677073Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant:8002/sign/cart\", \"headers\": {}, \"body\": {\"cart_mandate\": {\"contents\": {\"id\": \"cart_7bda44e0\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_7bda44e0\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 380.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.660702Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": null, \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.660797Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\", \"cart_description\": \"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’4ç‚¹ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.677972Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant:8002/sign/cart", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.678030Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant:8002/sign/cart\", \"headers\": {}, \"body\": {\"cart_mandate\": {\"contents\": {\"id\": \"cart_ccbab22a\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_ccbab22a\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 565.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 6215.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.669646Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": null, \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.669665Z\", \"cart_name\": \"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,650å††)\", \"cart_description\": \"æ™‚è¨ˆã‚’å«ã‚€é«˜å“è³ªãªã‚¢ã‚¤ãƒ†ãƒ ã‚’3ç‚¹ã§ã‚«ãƒ¼ãƒˆã€‚äºˆç®—ã‚’å°‘ã—è¶…ãˆã‚‹ãŒã€ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’é‡è¦–ã€‚\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.678494Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant:8002/sign/cart", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:44.678717Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant:8002/sign/cart\", \"headers\": {}, \"body\": {\"cart_mandate\": {\"contents\": {\"id\": \"cart_fd700261\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_fd700261\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 165.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.674220Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": null, \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.674239Z\", \"cart_name\": \"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (1,650å††)\", \"cart_description\": \"ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’2ç‚¹ã§ã‚·ãƒ³ãƒ—ãƒ«ã«ã€‚äºˆç®—å†…ã§æœ€å°é™ã®é¸æŠžã§ã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆã‚‹ã€‚\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant               | [2025-11-01 00:52:44,973] INFO in services.merchant.utils.validation_helpers: [Merchant] CartMandate validation passed: cart_7bda44e0
ap2_merchant               | [2025-11-01 00:52:44,988] INFO in services.merchant.utils.validation_helpers: [Merchant] CartMandate validation passed: cart_ccbab22a
ap2_merchant               | [2025-11-01 00:52:44,988] INFO in services.merchant.utils.validation_helpers: [Merchant] CartMandate validation passed: cart_fd700261
ap2_merchant               | [2025-11-01 00:52:44,988] INFO in services.merchant.utils.inventory_helpers: [Merchant] Inventory check passed for CartMandate: cart_7bda44e0
ap2_merchant               | {"timestamp": "2025-11-01T00:52:45.041622Z", "level": "INFO", "logger": "service", "message": "[_generate_merchant_authorization_jwt] Generated signed JWT for CartMandate: cart_id=None, alg=ES256, merchant_id=did:ap2:merchant:mugibo_merchant", "module": "service", "function": "_generate_merchant_authorization_jwt", "line": 812}
ap2_merchant               | [2025-11-01 00:52:45,108] INFO in services.merchant.utils.inventory_helpers: [Merchant] Inventory check passed for CartMandate: cart_ccbab22a
ap2_merchant               | {"timestamp": "2025-11-01T00:52:45.108597Z", "level": "INFO", "logger": "service", "message": "[_generate_merchant_authorization_jwt] Generated signed JWT for CartMandate: cart_id=None, alg=ES256, merchant_id=did:ap2:merchant:mugibo_merchant", "module": "service", "function": "_generate_merchant_authorization_jwt", "line": 812}
ap2_merchant               | [2025-11-01 00:52:45,110] INFO in services.merchant.utils.inventory_helpers: [Merchant] Inventory check passed for CartMandate: cart_fd700261
ap2_merchant               | {"timestamp": "2025-11-01T00:52:45.111102Z", "level": "INFO", "logger": "service", "message": "[_generate_merchant_authorization_jwt] Generated signed JWT for CartMandate: cart_id=None, alg=ES256, merchant_id=did:ap2:merchant:mugibo_merchant", "module": "service", "function": "_generate_merchant_authorization_jwt", "line": 812}
ap2_merchant               | {"timestamp": "2025-11-01T00:52:45.153448Z", "level": "INFO", "logger": "service", "message": "[Merchant] Created new CartMandate: cart_fd700261", "module": "service", "function": "sign_cart_mandate", "line": 218}
ap2_merchant               | {"timestamp": "2025-11-01T00:52:45.177820Z", "level": "INFO", "logger": "service", "message": "[Merchant] Auto-signed CartMandate: cart_fd700261 (with merchant_authorization JWT)", "module": "service", "function": "sign_cart_mandate", "line": 220}
ap2_merchant               | INFO:     172.18.0.5:33132 - "POST /sign/cart HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.189129Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (510.65ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.189257Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:52:44 GMT\", \"server\": \"uvicorn\", \"content-length\": \"2936\", \"content-type\": \"application/json\"}, \"body\": {\"signed_cart_mandate\": {\"contents\": {\"id\": \"cart_fd700261\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_fd700261\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 165.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.674220Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMmQwOTdlOWQwNmMzZGU5MjM5OTdjZDNmNTg3YzU2YjlhNmU4ZGZkYjIyOTY3NDAyYzcyYzQyNDI4MzE0MWQ0MyIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjMzMjA5ZDY2LWFiMzYtNDRmNy04MDZiLTE3NzM3MWZjZjViMyIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.5IiaoZIW-AIesRlC1WKTeSxkrf7wZbm_jotoFb5ZmKGKboJMTmefsYVrQUYRNRPbqeoDsg4XIcgG_HDd4iD3Kg\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.674239Z\", \"cart_name\": \"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (1,650å††)\", \"cart_description\": \"ã‹ã‚ã„ã„ã‚¢
ã‚¤ãƒ†ãƒ ã‚’2ç‚¹ã§ã‚·ãƒ³ãƒ—ãƒ«ã«ã€‚äºˆç®—å†…ã§æœ€å°é™ã®é¸æŠžã§ã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆã‚‹ã€‚\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMmQwOTdlOWQwNmMzZGU5MjM5OTdjZDNmNTg3YzU2YjlhNmU4ZGZkYjIyOTY3NDAyYzcyYzQyNDI4MzE0MWQ0MyIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjMzMjA5ZDY2LWFiMzYtNDRmNy04MDZiLTE3NzM3MWZjZjViMyIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.5IiaoZIW-AIesRlC1WKTeSxkrf7wZbm_jotoFb5ZmKGKboJMTmefsYVrQUYRNRPbqeoDsg4XIcgG_HDd4iD3Kg\"}, \"duration_ms\": 510.6494426727295}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.189911Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] CartMandate auto-signed: cart_fd700261, plan=ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (1,650å††)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 173}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.189982Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Built signed CartMandate for plan: ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (1,650å††)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 306}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.196135Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (519.08ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.196250Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:52:44 GMT\", \"server\": \"uvicorn\", \"content-length\": \"3817\", \"content-type\": \"application/json\"}, \"body\": {\"signed_cart_mandate\": {\"contents\": {\"id\": \"cart_7bda44e0\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_7bda44e0\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 380.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.660702Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiZmFhZjY1MDE2ZWJjMWNjMzBlNWI2YjE1Mzc0OGVmZjBjYTI5ZmI4YzdhZTNmMDIyOGExY2U2MWE2ZGI3YmNkNCIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjQ4Nzk1ODAwLTZkNjktNGY3Mi1iYmQ2LWI5YTUzOTdlZTQ3ZSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.ykO7qf1nOHJFpr1G82d5cizY0K_Tyj9JT9FmY9a7kwO8Lyt61kCU4mj6AZz-p-TSE5iFEDXloTVQhGpL0ANe_Q\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.660797Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\", \"cart_description\": \"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’4ç‚¹ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiZmFhZjY1MDE2ZWJjMWNjMzBlNWI2YjE1Mzc0OGVmZjBjYTI5ZmI4YzdhZTNmMDIyOGExY2U2MWE2ZGI3YmNkNCIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjQ4Nzk1ODAwLTZkNjktNGY3Mi1iYmQ2LWI5YTUzOTdlZTQ3ZSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.ykO7qf1nOHJFpr1G82d5cizY0K_Tyj9JT9FmY9a7kwO8Lyt61kCU4mj6AZz-p-TSE5iFEDXloTVQhGpL0ANe_Q\"}, \"duration_ms\": 519.078254699707}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.196487Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] CartMandate auto-signed: cart_7bda44e0, plan=ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 173}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.196546Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Built signed CartMandate for plan: ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 306}
ap2_merchant               | {"timestamp": "2025-11-01T00:52:45.194604Z", "level": "INFO", "logger": "service", "message": "[Merchant] Created new CartMandate: cart_7bda44e0", "module": "service", "function": "sign_cart_mandate", "line": 218}
ap2_merchant               | {"timestamp": "2025-11-01T00:52:45.194830Z", "level": "INFO", "logger": "service", "message": "[Merchant] Auto-signed CartMandate: cart_7bda44e0 (with merchant_authorization JWT)", "module": "service", "function": "sign_cart_mandate", "line": 220}
ap2_merchant               | INFO:     172.18.0.5:33110 - "POST /sign/cart HTTP/1.1" 200 OK
ap2_merchant               | {"timestamp": "2025-11-01T00:52:45.209852Z", "level": "INFO", "logger": "service", "message": "[Merchant] Created new CartMandate: cart_ccbab22a", "module": "service", "function": "sign_cart_mandate", "line": 218}
ap2_merchant               | {"timestamp": "2025-11-01T00:52:45.210112Z", "level": "INFO", "logger": "service", "message": "[Merchant] Auto-signed CartMandate: cart_ccbab22a (with merchant_authorization JWT)", "module": "service", "function": "sign_cart_mandate", "line": 220}
ap2_merchant               | INFO:     172.18.0.5:33126 - "POST /sign/cart HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.211180Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (533.14ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.211309Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:52:44 GMT\", \"server\": \"uvicorn\", \"content-length\": \"3272\", \"content-type\": \"application/json\"}, \"body\": {\"signed_cart_mandate\": {\"contents\": {\"id\": \"cart_ccbab22a\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_ccbab22a\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 565.0, \"currency\": \"JPY\"}, \"refund_period\":0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 6215.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.669646Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMTNmNGUyZDZmMGNmZDM1ODIwNTRmN2Y4MWQ5Y2FkODJlMWI4NWNiZTQ2OGYzNjA3NWRkZWVkYmIzNDdhOTE0ZCIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjRkNTk3MmZlLTI2MWUtNGZjOS1hMWIzLWUzMTIxMGU4YzBjMyIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.kTjb3ZmTA6Qviuw_otoDJ1Sfw266Cr_3hQ-CqB0xVYYsp-AdF5kuwCylM_nnKHm5NUjRd8L5utg1lEc27HiiRA\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.669665Z\", \"cart_name\": \"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,650å††)\", \"cart_description\": \"æ™‚è¨ˆ
ã‚’å«ã‚€é«˜å“è³ªãªã‚¢ã‚¤ãƒ†ãƒ ã‚’3ç‚¹ã§ã‚«ãƒ¼ãƒˆã€‚äºˆç®—ã‚’å°‘ã—è¶…ãˆã‚‹ãŒã€ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’é‡è¦–ã€‚\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMTNmNGUyZDZmMGNmZDM1ODIwNTRmN2Y4MWQ5Y2FkODJlMWI4NWNiZTQ2OGYzNjA3NWRkZWVkYmIzNDdhOTE0ZCIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjRkNTk3MmZlLTI2MWUtNGZjOS1hMWIzLWUzMTIxMGU4YzBjMyIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.kTjb3ZmTA6Qviuw_otoDJ1Sfw266Cr_3hQ-CqB0xVYYsp-AdF5kuwCylM_nnKHm5NUjRd8L5utg1lEc27HiiRA\"}, \"duration_ms\": 533.1437587738037}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.211531Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] CartMandate auto-signed: cart_ccbab22a, plan=é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,650å††)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 173}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.211568Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Built signed CartMandate for plan: é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,650å††)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 306}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.231028Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Parallel processing complete: 3 signed, 0 pending, 0 timeout, 0 rejected", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 353}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.231070Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Built 3 signed CartMandates (pending: 0, timeout: 0)", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 373}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.233850Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.ranking_node", "message": "[rank_and_select] Selected top 3 carts", "module": "ranking_node", "function": "rank_and_select", "line": 31}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.236471Z", "level": "INFO", "logger": "langgraph_merchant", "message": "[create_cart_candidates] 3 carts ready (pre-signed via MCP)", "module": "langgraph_merchant", "function": "create_cart_candidates", "line": 313}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.236877Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Generated 3 cart candidates", "module": "intent_handler", "function": "handle_intent_mandate", "line": 102}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.237016Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2Aå‡¦ç†] ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Œäº†: type=ap2.mandates.IntentMandate, result_type=ap2.responses.CartCandidates", "module": "a2a_handler", "function": "handle_message", "line": 336}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.239795Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 841}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.240544Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 7701, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.responses.CartCandidates\",\"id\":\"dc63b7c5-d122-40a6-9a9c-1eed1eccb37f\",\"payload\":{\"cart_candidates\":[{\"artifactId\":\"artifact_7545e48b\",\"name\":\"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—
ãƒ©ãƒ³ (3,800å††)\",\"parts\":[{\"d", "module": "crypto", "function": "sign_a2a_message", "line": 845}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.240858Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 640}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.250977Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: merchant_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.251845Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:shopping_agent: ap2.responses.CartCandidates", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:52:45.251959Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.responses.CartCandidates\", \"peer\": \"did:ap2:agent:shopping_agent\", \"headers\": {\"message_id\": \"87a36aca-3cc6-46c8-8120-a1f9cbbe6501\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:shopping_agent\", \"timestamp\": \"2025-11-01T00:52:45.237460Z\", \"nonce\": \"7114b977d1432f36ab1d85dc3d6ea62cf161daba9446347ad4206a26498fbe59\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"intent_mandate_id\": \"intent_a97064a3\", \"cart_candidates\": [{\"artifactId\": \"artifact_7545e48b\", \"name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_7bda44e0\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_7bda44e0\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 380.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.660702Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiZmFhZjY1MDE2ZWJjMWNjMzBlNWI2YjE1Mzc0OGVmZjBjYTI5ZmI4YzdhZTNmMDIyOGExY2U2MWE2ZGI3YmNkNCIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjQ4Nzk1ODAwLTZkNjktNGY3Mi1iYmQ2LWI5YTUzOTdlZTQ3ZSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.ykO7qf1nOHJFpr1G82d5cizY0K_Tyj9JT9FmY9a7kwO8Lyt61kCU4mj6AZz-p-TSE5iFEDXloTVQhGpL0ANe_Q\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.660797Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\", \"cart_description\": \"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’4ç‚¹ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}, {\"artifactId\": \"artifact_a3061b7e\", \"name\": \"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,650å††)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_ccbab22a\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_ccbab22a\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 565.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 6215.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.669646Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMTNmNGUyZDZmMGNmZDM1ODIwNTRmN2Y4MWQ5Y2FkODJlMWI4NWNiZTQ2OGYzNjA3NWRkZWVkYmIzNDdhOTE0ZCIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjRkNTk3MmZlLTI2MWUtNGZjOS1hMWIzLWUzMTIxMGU4YzBjMyIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.kTjb3ZmTA6Qviuw_otoDJ1Sfw266Cr_3hQ-CqB0xVYYsp-AdF5kuwCylM_nnKHm5NUjRd8L5utg1lEc27HiiRA\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.669665Z\", \"cart_name\": \"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,650å††)\", \"cart_description\": \"æ™‚è¨ˆã‚’å«ã‚€é«˜å“è³ªãªã‚¢ã‚¤ãƒ†ãƒ ã‚’3ç‚¹ã§ã‚«ãƒ¼ãƒˆã€‚äºˆç®—ã‚’å°‘ã—è¶…ãˆã‚‹ãŒã€ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’é‡è¦–ã€‚\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}, {\"artifactId\": \"artifact_353f75d6\", \"name\": \"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (1,650å††)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_fd700261\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_fd700261\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 165.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.674220Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMmQwOTdlOWQwNmMzZGU5MjM5OTdjZDNmNTg3YzU2YjlhNmU4ZGZkYjIyOTY3NDAyYzcyYzQyNDI4MzE0MWQ0MyIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjMzMjA5ZDY2LWFiMzYtNDRmNy04MDZiLTE3NzM3MWZjZjViMyIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.5IiaoZIW-AIesRlC1WKTeSxkrf7wZbm_jotoFb5ZmKGKboJMTmefsYVrQUYRNRPbqeoDsg4XIcgG_HDd4iD3Kg\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.674239Z\", \"cart_name\": \"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (1,650å††)\", \"cart_description\": \"ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’2ç‚¹ã§ã‚·ãƒ³ãƒ—ãƒ«ã«ã€‚äºˆç®—å†…ã§æœ€å°é™ã®é¸æŠžã§ã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆã‚‹ã€‚\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼
ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}], \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | [2025-11-01 00:52:45,252] INFO in v2.common.base_agent: [Merchant Agent] A2Aãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´: type=ap2.responses.CartCandidates, to=did:ap2:agent:shopping_agent
ap2_merchant_agent         | INFO:     172.18.0.9:59764 - "POST /a2a/message HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:45.281128Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (135464.38ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:45.282045Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:50:28 GMT\", \"server\": \"uvicorn\", \"content-length\": \"9618\", \"content-type\": \"application/json\"}, \"body\": {\"header\": {\"message_id\": \"87a36aca-3cc6-46c8-8120-a1f9cbbe6501\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:shopping_agent\", \"timestamp\": \"2025-11-01T00:52:45.237460Z\", \"nonce\": \"7114b977d1432f36ab1d85dc3d6ea62cf161daba9446347ad4206a26498fbe59\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"bp29N44to8RdpezxfxtwC1wWZgFl01NzHTIK92khLtCFtfanHmD5iCWcx2sjIeJXIgcr0Novn+r4aV4isi+5AQ==\", \"publicKey\": \"LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUNvd0JRWURLMlZ3QXlFQTZHQmRVRllXaHBZcUNtdjVUMGFsTGg3ckt4TzlHTkZLdnRabU5keWUyQk09Ci0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLQo=\", \"kid\": \"did:ap2:agent:merchant_agent#key-2\", \"created\": \"2025-11-01T00:52:45.237460Z\", \"proofPurpose\": \"authentication\"}, \"signature\": null}, \"dataPart\": {\"@type\": \"ap2.responses.CartCandidates\", \"id\": \"dc63b7c5-d122-40a6-9a9c-1eed1eccb37f\", \"payload\": {\"intent_mandate_id\": \"intent_a97064a3\", \"cart_candidates\": [{\"artifactId\": \"artifact_7545e48b\", \"name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_7bda44e0\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_7bda44e0\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 380.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.660702Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiZmFhZjY1MDE2ZWJjMWNjMzBlNWI2YjE1Mzc0OGVmZjBjYTI5ZmI4YzdhZTNmMDIyOGExY2U2MWE2ZGI3YmNkNCIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjQ4Nzk1ODAwLTZkNjktNGY3Mi1iYmQ2LWI5YTUzOTdlZTQ3ZSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.ykO7qf1nOHJFpr1G82d5cizY0K_Tyj9JT9FmY9a7kwO8Lyt61kCU4mj6AZz-p-TSE5iFEDXloTVQhGpL0ANe_Q\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.660797Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\", \"cart_description\": \"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’4ç‚¹ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}, {\"artifactId\": \"artifact_a3061b7e\", \"name\": \"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,650å††)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_ccbab22a\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_ccbab22a\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 565.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 6215.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.669646Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMTNmNGUyZDZmMGNmZDM1ODIwNTRmN2Y4MWQ5Y2FkODJlMWI4NWNiZTQ2OGYzNjA3NWRkZWVkYmIzNDdhOTE0ZCIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjRkNTk3MmZlLTI2MWUtNGZjOS1hMWIzLWUzMTIxMGU4YzBjMyIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.kTjb3ZmTA6Qviuw_otoDJ1Sfw266Cr_3hQ-CqB0xVYYsp-AdF5kuwCylM_nnKHm5NUjRd8L5utg1lEc27HiiRA\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.669665Z\", \"cart_name\": \"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,650å††)\", \"cart_description\": \"æ™‚è¨ˆã‚’å«ã‚€é«˜å“è³ªãªã‚¢ã‚¤ãƒ†ãƒ ã‚’3ç‚¹ã§ã‚«ãƒ¼ãƒˆã€‚äºˆç®—ã‚’å°‘ã—è¶…ãˆã‚‹ãŒã€ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’é‡è¦–ã€‚\", \"raw_items\": [{\"product_id\": \"1530a7db-6b7a-458e-b7b9-f510f6fdaa89\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}, {\"artifactId\": \"artifact_353f75d6\", \"name\": \"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (1,650å††)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_fd700261\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_fd700261\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 165.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.674220Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMmQwOTdlOWQwNmMzZGU5MjM5OTdjZDNmNTg3YzU2YjlhNmU4ZGZkYjIyOTY3NDAyYzcyYzQyNDI4MzE0MWQ0MyIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjMzMjA5ZDY2LWFiMzYtNDRmNy04MDZiLTE3NzM3MWZjZjViMyIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.5IiaoZIW-AIesRlC1WKTeSxkrf7wZbm_jotoFb5ZmKGKboJMTmefsYVrQUYRNRPbqeoDsg4XIcgG_HDd4iD3Kg\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.674239Z\", \"cart_name\": \"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (1,650å††)\", \"cart_description\": \"ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’2ç‚¹ã§ã‚·ãƒ³ãƒ—ãƒ«ã«ã€‚äºˆç®—å†…ã§æœ€å°é™ã®é¸æŠžã§ã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆã‚‹ã€‚\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}], \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"kind\": null, \"artifact\": null}}, \"duration_ms\": 135464.38241004944}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-01 00:52:45,287] INFO in services.shopping_agent.utils.merchant_integration:
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [ShoppingAgent â† MerchantAgent] A2Aãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡
ap2_shopping_agent         |   Status: 200
ap2_shopping_agent         |   Response Body: {
ap2_shopping_agent         |   "header": {
ap2_shopping_agent         |     "message_id": "87a36aca-3cc6-46c8-8120-a1f9cbbe6501",
ap2_shopping_agent         |     "sender": "did:ap2:agent:merchant_agent",
ap2_shopping_agent         |     "recipient": "did:ap2:agent:shopping_agent",
ap2_shopping_agent         |     "timestamp": "2025-11-01T00:52:45.237460Z",
ap2_shopping_agent         |     "nonce": "7114b977d1432f36ab1d85dc3d6ea62cf161daba9446347ad4206a26498fbe59",
ap2_shopping_agent         |     "schema_version": "0.2",
ap2_shopping_agent         |     "proof": {
ap2_shopping_agent         |       "algorithm": "ed25519",
ap2_shopping_agent         |       "signatureValue": "bp29N44to8RdpezxfxtwC1wWZgFl01NzHTIK92khLtCFtfanHmD5iCWcx2sjIeJXIgcr0Novn+r4aV4isi+5AQ==",
ap2_shopping_agent         |       "publicKey": "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUNvd0JRWURLMlZ3QXlFQTZHQmRVRllXaHBZcUNtdjVUMGFsTGg3ckt4TzlHTkZLdnRabU5keWUyQk09Ci0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLQo=",
ap2_shopping_agent         |       "kid": "did:ap2:agent:merchant_agent#key-2",
ap2_shopping_agent         |       "created": "2025-11-01T00:52:45.237460Z",
ap2_shopping_agent         |       "proofPurpose": "authentication"
ap2_shopping_agent         |     },
ap2_shopping_agent         |     "signature": null
ap2_shopping_agent         |   },
ap2_shopping_agent         |   "dataPart": {
ap2_shopping_agent         |     "@type": "ap2.responses.CartCandidates",
ap2_shopping_agent         |     "id": "dc63b7c5-d122-40a6-9a9c-1eed1eccb37f",
ap2_shopping_agent         |     "payload": {
ap2_shopping_agent         |       "intent_mandate_id": "intent_a9...
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [2025-11-01 00:52:45,288] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Received 3 cart candidates from Merchant Agent
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:46.068139Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=cart_selection", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:46.077277Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=cart_selection", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | INFO:     172.67.69.85:45553 - "OPTIONS /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:51.247138Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:51.247934Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1761958169365_f3l0q\n  user_id: usr_ee3014bbc51f4156\n  user_input: cart_7bda44e0\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1058}
ap2_shopping_agent         | INFO:     172.67.69.85:45553 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:51.251231Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761958169365_f3l0q, step=cart_selection", "module": "agent", "function": "_get_or_create_session", "line": 1943}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:51.251725Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1761958169365_f3l0q)", "module": "agent", "function": "event_generator", "line": 1073}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:51.251888Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1761958169365_f3l0q", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1646}
ap2_shopping_agent         | [2025-11-01 00:52:51,275] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: cart_selection
ap2_shopping_agent         |   user_input: cart_7bda44e0
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-01 00:52:51,322] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cart_node] Merchant authorization JWT verified: merchant=did:ap2:merchant:mugibo_merchant, cart_hash=faaf65016ebc1cc3...
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:51.361228Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=cart_signature_pending", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:51.370594Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=cart_signature_pending", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | INFO:     172.67.69.85:29074 - "OPTIONS /cart/submit-signature HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:54.174553Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:54.182561Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761958169365_f3l0q, step=cart_signature_pending", "module": "agent", "function": "_get_or_create_session", "line": 1943}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:54.185745Z", "level": "INFO", "logger": "agent", "message": "[submit_cart_signature] Received CartMandate signature: cart_id=None, session_id=session_1761958169365_f3l0q", "module": "agent", "function": "submit_cart_signature", "line": 1275}
ap2_shopping_agent         | [2025-11-01 00:52:54,186] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Verifying CartMandate WebAuthn signature: user_id=usr_ee3014bbc51f4156
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:54.186669Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://credential_provider:8003/verify/attestation", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:54.187062Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/verify/attestation\", \"headers\": {}, \"body\": {\"payment_mandate\": {\"contents\": {\"id\": \"cart_7bda44e0\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_7bda44e0\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 380, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 4680, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.660702Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiZmFhZjY1MDE2ZWJjMWNjMzBlNWI2YjE1Mzc0OGVmZjBjYTI5ZmI4YzdhZTNmMDIyOGExY2U2MWE2ZGI3YmNkNCIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjQ4Nzk1ODAwLTZkNjktNGY3Mi1iYmQ2LWI5YTUzOTdlZTQ3ZSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.ykO7qf1nOHJFpr1G82d5cizY0K_Tyj9JT9FmY9a7kwO8Lyt61kCU4mj6AZz-p-TSE5iFEDXloTVQhGpL0ANe_Q\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.660797Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\", \"cart_description\": \"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’4ç‚¹ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³
ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200, \"currency\": \"JPY\"}, \"image_url\": null}]}}, \"attestation\": {\"id\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"rawId\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"response\": {\"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlbmdlIjoiZXlKdFlXNWtZWFJsWDJsa0lqb2lZMkZ5ZEY4M1ltUmhORFJsTUNJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRrMU9ETTNNak15TW4wIiwib3JpZ2luIjoiaHR0cDovL2xvY2FsaG9zdDozMDAwIiwiY3Jvc3NPcmlnaW4iOmZhbHNlfQ\", \"authenticatorData\": \"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2MdAAAAAA\", \"signature\": \"MEUCIGQDJnF5BMmyOf0eZ-ckVtTTlK1uUKui66hV2HVnts2VAiEAkQCYr1WYY45fEBI_JQ3LnpoqZUAnn7NXVZzZktWwp5g\", \"userHandle\": \"usr_ee3014bbc51f4156\"}, \"type\": \"public-key\", \"attestation_type\": \"passkey\", \"challenge\": \"eyJtYW5kYXRlX2lkIjoiY2FydF83YmRhNDRlMCIsInRpbWVzdGFtcCI6MTc2MTk1ODM3MjMyMn0\"}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:52:54.383833Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] Found passkey: nMJrfBrkstu2zYV5...", "module": "provider", "function": "verify_attestation", "line": 531}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:52:54.384078Z", "level": "INFO", "logger": "provider", "message": "  User: usr_ee3014bbc51f4156", "module": "provider", "function": "verify_attestation", "line": 532}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:52:54.384111Z", "level": "INFO", "logger": "provider", "message": "  Counter: 0", "module": "provider", "function": "verify_attestation", "line": 533}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:52:54.385774Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Verifying WebAuthn authentication result", "module": "crypto", "function": "verify_webauthn_signature", "line": 1246}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:52:54.389369Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Client Data Type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1267}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:52:54.389459Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Origin: http://localhost:3000", "module": "crypto", "function": "verify_webauthn_signature", "line": 1268}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:52:54.389486Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Challenge matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1280}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:52:54.389519Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Authentication type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1287}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:52:54.390118Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "AuthenticatorData parsed: counter=0", "module": "crypto", "function": "verify_webauthn_signature", "line": 1300}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:52:54.390181Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Signature counter: 0 (AP2 compliant: replay attacks prevented by user_authorization nonce)", "module": "crypto", "function": "verify_webauthn_signature", "line": 1306}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:52:54.395862Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "RP ID Hash matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1319}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:52:54.424993Z", "level": "INFO", "logger": "v2.common.crypto", "message": "WebAuthn signature verified successfully", "module": "crypto", "function": "verify_webauthn_signature", "line": 1371}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:52:54.464440Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] Signature counter: 0 â†’ 0 (AP2æº–æ‹ : AuthenticatorãŒcounterã‚’å®Ÿè£…ã—ã¦ã„ãªã„å ´åˆã§ã‚‚ã€user_authorizationã®nonceã«ã‚ˆã‚Šãƒªãƒ—ãƒ¬ã‚¤æ”»æ’ƒã¯é˜²æ­¢ã•ã‚Œã¾ã™)", "module": "provider", "function": "verify_attestation", "line": 551}
ap2_credential_provider    | [2025-11-01 00:52:54,467] INFO in services.credential_provider.utils.token_helpers: [CredentialProvider] Generated attestation token for user: None
ap2_credential_provider    | {"timestamp": "2025-11-01T00:52:54.469208Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] No payment_method.token in mandate (likely IntentMandate signature), skipping Payment Network call", "module": "provider", "function": "verify_attestation", "line": 579}
ap2_credential_provider    | [2025-11-01 00:52:54,499] INFO in services.credential_provider.utils.token_helpers: [CredentialProvider] Saved attestation: user=unknown, verified=True, agent_token=None...
ap2_credential_provider    | INFO:     172.18.0.9:59814 - "POST /verify/attestation HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:54.518455Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (331.52ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | [2025-11-01 00:52:54,518] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Sent WebAuthn verification request to Credential Provider: user_id=usr_ee3014bbc51f4156
ap2_shopping_agent         | [2025-11-01 00:52:54,518] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] âœ… WebAuthn signature verified successfully: counter=0, attestation_type=passkey
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:54.518718Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:52:53 GMT\", \"server\": \"uvicorn\", \"content-length\": \"191\", \"content-type\": \"application/json\"}, \"body\": {\"verified\": true, \"token\": \"cred_token_d3070113_yE-lr6G3hdWKdHX6tdyDZRiI\", \"details\": {\"attestation_type\": \"passkey\", \"timestamp\": \"2025-11-01T00:52:54.499142+00:00\", \"counter\": 0, \"agent_token\": null}}, \"duration_ms\": 331.51721954345703}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:54.532547Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=cart_signature_pending", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:54.533009Z", "level": "INFO", "logger": "agent", "message": "[submit_cart_signature] CartMandate signed by user: cart_id=None, webauthn_assertion saved", "module": "agent", "function": "submit_cart_signature", "line": 1315}
ap2_shopping_agent         | INFO:     172.67.69.85:29074 - "POST /cart/submit-signature HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:54.567680Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:54.617376Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1761958169365_f3l0q\n  user_id: usr_ee3014bbc51f4156\n  user_input: _cart_signature_completed\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1058}
ap2_shopping_agent         | INFO:     172.67.69.85:29074 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:54.634964Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761958169365_f3l0q, step=cart_signature_pending", "module": "agent", "function": "_get_or_create_session", "line": 1943}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:54.635636Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1761958169365_f3l0q)", "module": "agent", "function": "event_generator", "line": 1073}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:54.636739Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1761958169365_f3l0q", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1646}
ap2_shopping_agent         | [2025-11-01 00:52:54,665] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: cart_signature_pending
ap2_shopping_agent         |   user_input: _cart_signature_completed
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-01 00:52:54,883] INFO in services.shopping_agent.langgraph_shopping_flow: [select_payment_method_node] AP2 Step 13-14: Presenting payment methods to user
ap2_shopping_agent         |   Available Methods: 1
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:55.462879Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=payment_method_selection", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:55.478434Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=payment_method_selection", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:56.934451Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:56.936886Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1761958169365_f3l0q\n  user_id: usr_ee3014bbc51f4156\n  user_input: 1\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1058}
ap2_shopping_agent         | INFO:     172.67.69.85:29074 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:56.944019Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761958169365_f3l0q, step=payment_method_selection", "module": "agent", "function": "_get_or_create_session", "line": 1943}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:56.944964Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1761958169365_f3l0q)", "module": "agent", "function": "event_generator", "line": 1073}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:56.945135Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1761958169365_f3l0q", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1646}
ap2_shopping_agent         | [2025-11-01 00:52:56,982] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: payment_method_selection
ap2_shopping_agent         |   user_input: 1
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:56.990842Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Requesting payment method tokenization for: pm_e6367cd7", "module": "agent", "function": "_tokenize_payment_method", "line": 2352}
ap2_shopping_agent         | [2025-11-01 00:52:56,990] INFO in services.shopping_agent.langgraph_shopping_flow: [select_payment_method_node] AP2 Step 15-18: Tokenizing payment method
ap2_shopping_agent         |   User ID: usr_ee3014bbc51f4156
ap2_shopping_agent         |   Payment Method ID: pm_e6367cd7
ap2_shopping_agent         |   CP URL: http://credential_provider:8003
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:56.991347Z", "level": "INFO", "logger": "agent", "message": "\n================================================================================\n[ShoppingAgent â†’ CredentialProvider] ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ãƒªã‚¯ã‚¨
ã‚¹ãƒˆé€ä¿¡\n  URL: http://credential_provider:8003/payment-methods/tokenize\n  User ID: usr_ee3014bbc51f4156\n  Payment Method ID: pm_e6367cd7\n================================================================================", "module": "agent", "function": "_tokenize_payment_method", "line": 2356}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:56.991750Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://credential_provider:8003/payment-methods/tokenize", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:56.991794Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/payment-methods/tokenize\", \"headers\": {}, \"body\": {\"user_id\": \"usr_ee3014bbc51f4156\", \"payment_method_id\": \"pm_e6367cd7\"}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | [2025-11-01 00:52:57,066] INFO in v2.common.redis_client: [RedisClient] Connected to Redis: redis://redis:6379/0
ap2_credential_provider    | {"timestamp": "2025-11-01T00:52:57.101867Z", "level": "INFO", "logger": "provider", "message": "[tokenize_payment_method] Generated secure token for payment method: pm_e6367cd7", "module": "provider", "function": "tokenize_payment_method", "line": 774}
ap2_credential_provider    | INFO:     172.18.0.9:59814 - "POST /payment-methods/tokenize HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:57.107185Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (115.37ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:57.107284Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:52:56 GMT\", \"server\": \"uvicorn\", \"content-length\": \"176\", \"content-type\": \"application/json\"}, \"body\": {\"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"payment_method_id\": \"pm_e6367cd7\", \"brand\": \"Visa\", \"last4\": \"1111\", \"type\": \"basic-card\", \"expires_at\": \"2025-11-01T01:07:57.055495Z\"}, \"duration_ms\": 115.36788940429688}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:57.107346Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent â† CredentialProvider] ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡: status=200", "module": "agent", "function": "_tokenize_payment_method", "line": 2376}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:57.107426Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Payment method tokenized: pm_e6367cd7 â†’ tok_204deed0_45AoJZ2...", "module": "agent", "function": "_tokenize_payment_method", "line": 2386}
ap2_shopping_agent         | [2025-11-01 00:52:57,107] INFO in services.shopping_agent.langgraph_shopping_flow: [select_payment_method_node] AP2 Step 17-18: Received tokenized payment method
ap2_shopping_agent         |   Token: tok_204deed0_45AoJZ2...
ap2_shopping_agent         | [2025-11-01 00:52:57,107] INFO in services.shopping_agent.utils.payment_helpers: [_extract_payment_amount_from_cart] CartMandate structure: has_contents=True, has_payment_request=True, has_details=True, has_total=True, total_amount={'value': 4680.0, 'currency': 'JPY'}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:57.109170Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://credential_provider:8003/passkey/get-public-key", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | [2025-11-01 00:52:57,109] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Retrieving public key from Credential Provider: credential_id=nMJrfBrkstu2zYV5..., user_id=usr_ee3014bbc51f4156
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:57.109220Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/passkey/get-public-key\", \"headers\": {}, \"body\": {\"credential_id\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"user_id\": \"usr_ee3014bbc51f4156\"}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_shopping_agent         | [2025-11-01 00:52:57,116] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] âœ… Public key retrieved: credential_id=nMJrfBrkstu2zYV5...
ap2_shopping_agent         | [2025-11-01 00:52:57,117] INFO in v2.common.user_authorization: [create_user_authorization_vp] WebAuthn challenge from assertion: eyJtYW5kYXRlX2lk...
ap2_credential_provider    | {"timestamp": "2025-11-01T00:52:57.114726Z", "level": "INFO", "logger": "provider", "message": "[get_passkey_public_key] Public key retrieved: credential_id=nMJrfBrkstu2zYV5..., user_id=usr_ee3014bbc51f4156", "module": "provider", "function": "get_passkey_public_key", "line": 1497}


ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:57.116855Z", "level": "INFO", "logger": "agent", "message": "HTTP Re
ap2_credential_provider    | INFO:     172.18.0.9:59814 - "POST /passkey/get-public-key HTTP/1.1" 200 OK

ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:57.116942Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:52:56 GMT\", \"server\": \"uvicorn\", \"content-length\": \"205\", \"content-type\": \"application/json\"}, \"body\": {\"credential_id\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"public_key_cose\": \"pQECAyYgASFYIM9xvjRy3D0Rcg+26M/ZDzL5QEALG++za+5+ItHAHMeUIlggDyZjU2j5igyJMFReu7a+Rb64akZWKEM4lfO+11oED1c=\", \"user_id\": \"usr_ee3014bbc51f4156\"}, \"duration_ms\": 7.553339004516602}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-01 00:52:57,119] INFO in v2.common.user_authorization: [create_user_authorization_vp] cart_hash: faaf65016ebc1cc3...
ap2_shopping_agent         | [2025-11-01 00:52:57,119] INFO in v2.common.user_authorization: [create_user_authorization_vp] payment_hash: 933e36bb67c0db59...
ap2_shopping_agent         | [2025-11-01 00:52:57,122] INFO in v2.common.user_authorization: [create_user_authorization_vp] Restored public key from COSE format (DB)
ap2_shopping_agent         | [2025-11-01 00:52:57,122] INFO in v2.common.user_authorization: [create_user_authorization_vp] cnf claim with JWK added to Issuer JWT
ap2_shopping_agent         | [2025-11-01 00:52:57,123] INFO in v2.common.user_authorization: [create_user_authorization_vp] Generated user_authorization VP: length=2408, cart_hash=faaf65016ebc1cc3..., payment_hash=933e36bb67c0db59...
ap2_shopping_agent         | [2025-11-01 00:52:57,123] INFO in services.shopping_agent.utils.payment_helpers: [_generate_user_authorization_for_payment] Generated user_authorization VP: length=2408
ap2_shopping_agent         | [2025-11-01 00:52:57,123] INFO in services.shopping_agent.utils.payment_helpers: [ShoppingAgent] transaction_type=human_present (WebAuthn assertion completed)
ap2_shopping_agent         | [2025-11-01 00:52:57,124] INFO in services.shopping_agent.utils.payment_helpers: [ShoppingAgent] Performing risk assessment...
ap2_shopping_agent         | [2025-11-01 00:52:57,125] WARNING in v2.common.risk_assessment: [RiskAssessmentEngine] Invalid amount value: 4680.0
ap2_shopping_agent         | [2025-11-01 00:52:57,126] WARNING in v2.common.risk_assessment: [RiskAssessmentEngine] Failed to parse amounts for constraint check
ap2_shopping_agent         | [2025-11-01 00:52:57,126] INFO in v2.common.risk_assessment: [RiskAssessmentEngine] Assessment completed: risk_score=2, recommendation=approve, fraud_indicators=[]
ap2_shopping_agent         | [2025-11-01 00:52:57,127] INFO in services.shopping_agent.utils.payment_helpers: [ShoppingAgent] Risk assessment completed: score=2, recommendation=approve, indicators=[]
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:57.127398Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] PaymentMandate created with user_authorization: has_user_auth=True", "module": "agent", "function": "_create_payment_mandate", "line": 2121}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:57.127478Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] PaymentMandate created: amount=4680.0 JPY, payment_method=Visa ****1111, token=tok_204deed0_45AoJZ2..., risk_score=2", "module": "agent", "function": "_create_payment_mandate", "line": 2126}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:57.242278Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=webauthn_signature_requested", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:52:57.247276Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=webauthn_signature_requested", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | INFO:     172.67.69.85:32525 - "OPTIONS /payment/submit-attestation HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:00.732126Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:00.735253Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] Verifying attestation for PaymentMandate: payment_9625d0e7", "module": "agent", "function": "submit_payment_attestation", "line": 1427}
ap2_shopping_agent         | [2025-11-01 00:53:00,735] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Verifying PaymentMandate attestation: payment_id=payment_9625d0e7
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:00.735965Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://credential_provider:8003/verify/attestation", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:00.736169Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/verify/attestation\", \"headers\": {}, \"body\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_9625d0e7\", \"payment_details_id\": \"order_677c5ec2\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-01T00:52:57.108248Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJWbE16QXhOR0ppWXpVeFpqUXhOVFlpTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMlZsTXpBeE5HSmlZelV4WmpReE5UWWlMQ0pwWVhRaU9qRTNOakU1TlRnek56Y3NJbVY0Y0NJNk1UYzJNVGsxT0RZM055d2libUptSWpveE56WXhPVFU0TXpjM0xDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaWVqTkhMVTVJVEdOUVVrWjVSRGRpYjNvNWExQk5kbXhCVVVGellqYzNUbkkzYmpScE1HTkJZM2cxVVNJc0lua2lPaUpFZVZwcVZUSnFOV2xuZVVwTlJsSmxkVGRoTFZKaU5qUmhhMXBYUzBWTk5HeG1UeTB4TVc5RlJERmpJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpPTFZseVlXTm5aVEpST1hoVFdFUnRORmR0TWpSdFFrTlhkRUppYW0xQ2MwWXhlVFZQWlRoNVdEbFZJaXdpYVdGMElqb3hOell4T1RVNE16YzNMQ0p6WkY5b1lYTm9Jam9pT1Rka05HVTVOMk5rWW1Jd1pEbG1ZekV5TkRFeVlqa3dNRFEyWWpRMk1URTRZak5tWlRoa1pqSXhOR1V6TnpnMU5EUmhZV0l3WmpOaE5tVTFORFF4TmlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2labUZoWmpZMU1ERTJaV0pqTVdOak16QmxOV0kyWWpFMU16YzBPR1ZtWmpCallUSTVabUk0WXpkaFpUTm1NREl5T0dFeFkyVTJNV0UyWkdJM1ltTmtOQ0lzSWprek0yVXpObUppTmpkak1HUmlOVGsxTURZeE5UTm1PV1ppWWprMVl6aGhZMlkyTW1SaE56UmtOelZtWW1VNVlqSXlNek16Wm1RMk1tVmpZMlpsTURZaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6Im5NSnJmQnJrc3R1MnpZVjUta2dpSXoycmluayIsInJhd0lkIjoibk1KcmZCcmtzdHUyellWNS1rZ2lJejJyaW5rIiwicmVzcG9uc2UiOnsiY2xpZW50RGF0YUpTT04iOiJleUowZVhCbElqb2lkMlZpWVhWMGFHNHVaMlYwSWl3aVkyaGhiR3hsYm1kbElqb2laWGxLZEZsWE5XdFpXRkpzV0RKc2EwbHFiMmxaTWtaNVpFWTRNMWx0VW1oT1JGSnNUVU5KYzBsdVVuQmlWMVo2WkVkR2RHTkRTVFpOVkdNeVRWUnJNVTlFVFROTmFrMTVUVzR3SWl3aWIzSnBaMmx1SWpvaWFIUjBjRG92TDJ4dlkyRnNhRzl6ZERvek1EQXdJaXdpWTNKdmMzTlBjbWxuYVc0aU9tWmhiSE5sZlEiLCJhdXRoZW50aWNhdG9yRGF0YSI6IlNaWU41WWdPakdoME5CY1BaSFpnVzRfa3JybWloakxIbVZ6enVvTWRsMk1kQUFBQUFBIiwic2lnbmF0dXJlIjoiTUVVQ0lHUURKbkY1Qk1teU9mMGVaLWNrVnRUVGxLMXVVS3VpNjZoVjJIVm50czJWQWlFQWtRQ1lyMVdZWTQ1ZkVCSV9KUTNMbnBvcVpVQW5uN05YVlp6Wmt0V3dwNWciLCJ1c2VySGFuZGxlIjoidXNyX2VlMzAxNGJiYzUxZjQxNTYifSwidHlwZSI6InB1YmxpYy1rZXkiLCJhdHRlc3RhdGlvbl90eXBlIjoicGFzc2tleSIsImNoYWxsZW5nZSI6ImV5SnRZVzVrWVhSbFgybGtJam9pWTJGeWRGODNZbVJoTkRSbE1DSXNJblJwYldWemRHRnRjQ0k2TVRjMk1UazFPRE0zTWpNeU1uMCJ9LCJjYXJ0X2hhc2giOiJmYWFmNjUwMTZlYmMxY2MzMGU1YjZiMTUzNzQ4ZWZmMGNhMjlmYjhjN2FlM2YwMjI4YTFjZTYxYTZkYjdiY2Q0IiwicGF5bWVudF9oYXNoIjoiOTMzZTM2YmI2N2MwZGI1OTUwNjE1M2Y5ZmJiOTVjOGFjZjYyZGE3NGQ3NWZiZTliMjIzMzNmZDYyZWNjZmUwNiJ9\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_9625d0e7\", \"cart_mandate_id\": \"cart_7bda44e0\", \"intent_mandate_id\": \"intent_a97064a3\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"attestation\": {\"id\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"rawId\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"response\": {\"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlbmdlIjoiZXlKdFlXNWtZWFJsWDJsa0lqb2ljR0Y1YldWdWRGODVOakkxWkRCbE55SXNJblJwYldWemRHRnRjQ0k2TVRjMk1UazFPRE0zT0RNeU1uMCIsIm9yaWdpbiI6Imh0dHA6Ly9sb2NhbGhvc3Q6MzAwMCIsImNyb3NzT3JpZ2luIjpmYWxzZX0\", \"authenticatorData\": \"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2MdAAAAAA\", \"signature\": \"MEQCICyg9rW4GbevqwjE_xGtMLfLG9Av6AEFICML_GyWUvDSAiBnHHQDBgx42vSIG4Un3MfJupwO7oeeadvYKj3kooUVdA\", \"userHandle\": \"usr_ee3014bbc51f4156\"}, \"type\": \"public-key\", \"attestation_type\": \"passkey\", \"challenge\": \"eyJtYW5kYXRlX2lkIjoicGF5bWVudF85NjI1ZDBlNyIsInRpbWVzdGFtcCI6MTc2MTk1ODM3ODMyMn0\"}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.778260Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] Found passkey: nMJrfBrkstu2zYV5...", "module": "provider", "function": "verify_attestation", "line": 531}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.778525Z", "level": "INFO", "logger": "provider", "message": "  User: usr_ee3014bbc51f4156", "module": "provider", "function": "verify_attestation", "line": 532}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.778557Z", "level": "INFO", "logger": "provider", "message": "  Counter: 0", "module": "provider", "function": "verify_attestation", "line": 533}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.778883Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Verifying WebAuthn authentication result", "module": "crypto", "function": "verify_webauthn_signature", "line": 1246}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.779138Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Client Data Type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1267}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.779167Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Origin: http://localhost:3000", "module": "crypto", "function": "verify_webauthn_signature", "line": 1268}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.779189Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Challenge matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1280}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.779236Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Authentication type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1287}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.779434Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "AuthenticatorData parsed: counter=0", "module": "crypto", "function": "verify_webauthn_signature", "line": 1300}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.779477Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Signature counter: 0 (AP2 compliant: replay attacks prevented by user_authorization nonce)", "module": "crypto", "function": "verify_webauthn_signature", "line": 1306}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.779797Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "RP ID Hash matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1319}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.782895Z", "level": "INFO", "logger": "v2.common.crypto", "message": "WebAuthn signature verified successfully", "module": "crypto", "function": "verify_webauthn_signature", "line": 1371}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.806026Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] Signature counter: 0 â†’ 0 (AP2æº–æ‹ : AuthenticatorãŒcounterã‚’å®Ÿè£…ã—ã¦ã„ãªã„å ´åˆã§ã‚‚ã€user_authorizationã®nonceã«ã‚ˆã‚Šãƒªãƒ—ãƒ¬ã‚¤æ”»æ’ƒã¯é˜²æ­¢ã•ã‚Œã¾ã™)", "module": "provider", "function": "verify_attestation", "line": 551}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.807167Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] PaymentMandate contains payment_method.token, calling Payment Network (Step 23)", "module": "provider", "function": "verify_attestation", "line": 570}
ap2_credential_provider    | [2025-11-01 00:53:00,806] INFO in services.credential_provider.utils.token_helpers: [CredentialProvider] Generated attestation token for user: usr_ee3014bbc51f4156
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.807598Z", "level": "INFO", "logger": "provider", "message": "[CredentialProvider] Requesting Agent Token from Payment Network: payment_mandate_id=payment_9625d0e7", "module": "provider", "function": "_request_agent_token_from_network", "line": 1808}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.808822Z", "level": "INFO", "logger": "provider", "message": "HTTP Request: POST http://payment_network:8005/network/tokenize", "module": "logger", "function": "log_http_request", "line": 182}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:00.808977Z", "level": "DEBUG", "logger": "provider", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://payment_network:8005/network/tokenize\", \"headers\": {}, \"body\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_9625d0e7\", \"payment_details_id\": \"order_677c5ec2\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-01T00:52:57.108248Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJWbE16QXhOR0ppWXpVeFpqUXhOVFlpTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMlZsTXpBeE5HSmlZelV4WmpReE5UWWlMQ0pwWVhRaU9qRTNOakU1TlRnek56Y3NJbVY0Y0NJNk1UYzJNVGsxT0RZM055d2libUptSWpveE56WXhPVFU0TXpjM0xDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaWVqTkhMVTVJVEdOUVVrWjVSRGRpYjNvNWExQk5kbXhCVVVGellqYzNUbkkzYmpScE1HTkJZM2cxVVNJc0lua2lPaUpFZVZwcVZUSnFOV2xuZVVwTlJsSmxkVGRoTFZKaU5qUmhhMXBYUzBWTk5HeG1UeTB4TVc5RlJERmpJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpPTFZseVlXTm5aVEpST1hoVFdFUnRORmR0TWpSdFFrTlhkRUppYW0xQ2MwWXhlVFZQWlRoNVdEbFZJaXdpYVdGMElqb3hOell4T1RVNE16YzNMQ0p6WkY5b1lYTm9Jam9pT1Rka05HVTVOMk5rWW1Jd1pEbG1ZekV5TkRFeVlqa3dNRFEyWWpRMk1URTRZak5tWlRoa1pqSXhOR1V6TnpnMU5EUmhZV0l3WmpOaE5tVTFORFF4TmlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2labUZoWmpZMU1ERTJaV0pqTVdOak16QmxOV0kyWWpFMU16YzBPR1ZtWmpCallUSTVabUk0WXpkaFpUTm1NREl5T0dFeFkyVTJNV0UyWkdJM1ltTmtOQ0lzSWprek0yVXpObUppTmpkak1HUmlOVGsxTURZeE5UTm1PV1ppWWprMVl6aGhZMlkyTW1SaE56UmtOelZtWW1VNVlqSXlNek16Wm1RMk1tVmpZMlpsTURZaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6Im5NSnJmQnJrc3R1MnpZVjUta2dpSXoycmluayIsInJhd0lkIjoibk1KcmZCcmtzdHUyellWNS1rZ2lJejJyaW5rIiwicmVzcG9uc2UiOnsiY2xpZW50RGF0YUpTT04iOiJleUowZVhCbElqb2lkMlZpWVhWMGFHNHVaMlYwSWl3aVkyaGhiR3hsYm1kbElqb2laWGxLZEZsWE5XdFpXRkpzV0RKc2EwbHFiMmxaTWtaNVpFWTRNMWx0VW1oT1JGSnNUVU5KYzBsdVVuQmlWMVo2WkVkR2RHTkRTVFpOVkdNeVRWUnJNVTlFVFROTmFrMTVUVzR3SWl3aWIzSnBaMmx1SWpvaWFIUjBjRG92TDJ4dlkyRnNhRzl6ZERvek1EQXdJaXdpWTNKdmMzTlBjbWxuYVc0aU9tWmhiSE5sZlEiLCJhdXRoZW50aWNhdG9yRGF0YSI6IlNaWU41WWdPakdoME5CY1BaSFpnVzRfa3JybWloakxIbVZ6enVvTWRsMk1kQUFBQUFBIiwic2lnbmF0dXJlIjoiTUVVQ0lHUURKbkY1Qk1teU9mMGVaLWNrVnRUVGxLMXVVS3VpNjZoVjJIVm50czJWQWlFQWtRQ1lyMVdZWTQ1ZkVCSV9KUTNMbnBvcVpVQW5uN05YVlp6Wmt0V3dwNWciLCJ1c2VySGFuZGxlIjoidXNyX2VlMzAxNGJiYzUxZjQxNTYifSwidHlwZSI6InB1YmxpYy1rZXkiLCJhdHRlc3RhdGlvbl90eXBlIjoicGFzc2tleSIsImNoYWxsZW5nZSI6ImV5SnRZVzVrWVhSbFgybGtJam9pWTJGeWRGODNZbVJoTkRSbE1DSXNJblJwYldWemRHRnRjQ0k2TVRjMk1UazFPRE0zTWpNeU1uMCJ9LCJjYXJ0X2hhc2giOiJmYWFmNjUwMTZlYmMxY2MzMGU1YjZiMTUzNzQ4ZWZmMGNhMjlmYjhjN2FlM2YwMjI4YTFjZTYxYTZkYjdiY2Q0IiwicGF5bWVudF9oYXNoIjoiOTMzZTM2YmI2N2MwZGI1OTUwNjE1M2Y5ZmJiOTVjOGFjZjYyZGE3NGQ3NWZiZTliMjIzMzNmZDYyZWNjZmUwNiJ9\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_9625d0e7\", \"cart_mandate_id\": \"cart_7bda44e0\", \"intent_mandate_id\": \"intent_a97064a3\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"attestation\": {\"id\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"rawId\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"response\": {\"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlbmdlIjoiZXlKdFlXNWtZWFJsWDJsa0lqb2ljR0Y1YldWdWRGODVOakkxWkRCbE55SXNJblJwYldWemRHRnRjQ0k2TVRjMk1UazFPRE0zT0RNeU1uMCIsIm9yaWdpbiI6Imh0dHA6Ly9sb2NhbGhvc3Q6MzAwMCIsImNyb3NzT3JpZ2luIjpmYWxzZX0\", \"authenticatorData\": \"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2MdAAAAAA\", \"signature\": \"MEQCICyg9rW4GbevqwjE_xGtMLfLG9Av6AEFICML_GyWUvDSAiBnHHQDBgx42vSIG4Un3MfJupwO7oeeadvYKj3kooUVdA\", \"userHandle\": \"usr_ee3014bbc51f4156\"}, \"type\": \"public-key\", \"attestation_type\": \"passkey\", \"challenge\": \"eyJtYW5kYXRlX2lkIjoicGF5bWVudF85NjI1ZDBlNyIsInRpbWVzdGFtcCI6MTc2MTk1ODM3ODMyMn0\"}, \"payment_method_token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"transaction_context\": {\"credential_provider_id\": \"did:ap2:agent:credential_provider\", \"timestamp\": \"2025-11-01T00:53:00.807662+00:00\"}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_payment_network        | [2025-11-01 00:53:00,946] INFO in network: [DemoPaymentNetwork] Received tokenization request: payment_mandate_id=payment_9625d0e7, payment_method_token=tok_204deed0_45AoJZ2...
ap2_payment_network        | [2025-11-01 00:53:00,961] INFO in common.redis_client: [RedisClient] Connected to Redis: redis://redis:6379/2
ap2_payment_network        | [2025-11-01 00:53:00,994] INFO in services.payment_network.utils.token_helpers: [DemoPaymentNetwork] Issued Agent Token (Redis): agent_tok_demopaymentnetwork_31a..., expires_at=2025-11-01T01:53:00.948530+00:00, ttl=3600s
ap2_payment_network        | INFO:     172.18.0.12:39100 - "POST /network/tokenize HTTP/1.1" 200 OK
ap2_credential_provider    | [2025-11-01 00:53:01,005] INFO in httpx: HTTP Request: POST http://payment_network:8005/network/tokenize "HTTP/1.1 200 OK"
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:01.008529Z", "level": "INFO", "logger": "provider", "message": "HTTP Response: 200 (200.70ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:01.008587Z", "level": "DEBUG", "logger": "provider", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:52:59 GMT\", \"server\": \"uvicorn\", \"content-length\": \"186\", \"content-type\": \"application/json\"}, \"body\": {\"agent_token\": \"agent_tok_demopaymentnetwork_31ac6b91_UCwVYUgYp8NcEhyk6x31Zq5t\", \"expires_at\": \"2025-11-01T01:53:00.948530Z\", \"network_name\": \"DemoPaymentNetwork\", \"token_type\": \"agent_token\"}, \"duration_ms\": 200.6978988647461}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:01.008620Z", "level": "INFO", "logger": "provider", "message": "[CredentialProvider] Received Agent Token from Payment Network: agent_tok_demopaymentnetwork_31a..., network_name=DemoPaymentNetwork", "module": "provider", "function": "_request_agent_token_from_network", "line": 1832}
ap2_credential_provider    | [2025-11-01 00:53:01,017] INFO in services.credential_provider.utils.token_helpers: [CredentialProvider] Saved attestation: user=usr_ee3014bbc51f4156, verified=True, agent_token=agent_tok_demopaymentnetwork_31a...
ap2_credential_provider    | INFO:     172.18.0.9:59814 - "POST /verify/attestation HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.023778Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (287.77ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.023868Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:53:00 GMT\", \"server\": \"uvicorn\", \"content-length\": \"251\", \"content-type\": \"application/json\"}, \"body\": {\"verified\": true, \"token\": \"cred_token_938e6af4_tn0KqlF5gMySu9WdtumavGy3\", \"details\": {\"attestation_type\": \"passkey\", \"timestamp\": \"2025-11-01T00:53:01.017905+00:00\", \"counter\": 0, \"agent_token\": \"agent_tok_demopaymentnetwork_31ac6b91_UCwVYUgYp8NcEhyk6x31Zq5t\"}}, \"duration_ms\": 287.7669334411621}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-01 00:53:01,023] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] âœ… PaymentMandate attestation verified: payment_id=payment_9625d0e7
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.023986Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] Attestation verified, processing payment...", "module": "agent", "function": "submit_payment_attestation", "line": 1447}
ap2_shopping_agent         | [2025-11-01 00:53:01,024] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Retrieving public key from Credential Provider: credential_id=nMJrfBrkstu2zYV5..., user_id=usr_ee3014bbc51f4156
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.024087Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://credential_provider:8003/passkey/get-public-key", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.024109Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/passkey/get-public-key\", \"headers\": {}, \"body\": {\"credential_id\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"user_id\": \"usr_ee3014bbc51f4156\"}}", "module": "logger", "function": "log_http_request", "line": 193}


ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:01.032142Z", "level": "INFO", "logger": "provider", "message": "[get_passkey_public_key] Public key retrieved: credential_id=nMJrfBrkstu2zYV5..., user_id=usr_ee3014bbc51f4156", "module": "provider", "function": "get_passkey_public_key", "line": 1497}
ap2_shopping_agent         | [2025-11-01 00:53:01,035] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] âœ… Public key retrieved: credential_id=nMJrfBrkstu2zYV5...


ap2_shopping_agent         | [2025-11-01 00:53:01,035] INFO in v2.common.user_authorization: [create_user_authorization_vp] WebAuthn challenge from assertion: eyJtYW5kYXRlX2lk...
ap2_credential_provider    | INFO:     172.18.0.9:59814 - "POST /passkey/get-public-key HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.035032Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (10.90ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.035071Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:53:00 GMT\", \"server\": \"uvicorn\", \"content-length\": \"205\", \"content-type\": \"application/json\"}, \"body\": {\"credential_id\": \"nMJrfBrkstu2zYV5-kgiIz2rink\", \"public_key_cose\": \"pQECAyYgASFYIM9xvjRy3D0Rcg+26M/ZDzL5QEALG++za+5+ItHAHMeUIlggDyZjU2j5igyJMFReu7a+Rb64akZWKEM4lfO+11oED1c=\", \"user_id\": \"usr_ee3014bbc51f4156\"}, \"duration_ms\": 10.90383529663086}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-01 00:53:01,035] INFO in v2.common.user_authorization: [create_user_authorization_vp] cart_hash: faaf65016ebc1cc3...
ap2_shopping_agent         | [2025-11-01 00:53:01,035] INFO in v2.common.user_authorization: [create_user_authorization_vp] payment_hash: 6ce3a8cdea8dedb9...
ap2_shopping_agent         | [2025-11-01 00:53:01,036] INFO in v2.common.user_authorization: [create_user_authorization_vp] Restored public key from COSE format (DB)
ap2_shopping_agent         | [2025-11-01 00:53:01,036] INFO in v2.common.user_authorization: [create_user_authorization_vp] cnf claim with JWK added to Issuer JWT
ap2_shopping_agent         | [2025-11-01 00:53:01,037] INFO in v2.common.user_authorization: [create_user_authorization_vp] Generated user_authorization VP: length=2419, cart_hash=faaf65016ebc1cc3..., payment_hash=6ce3a8cdea8dedb9...
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.037377Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] SD-JWT-VC user_authorization generated: user_id=usr_ee3014bbc51f4156, vp_length=2419", "module": "agent", "function": "submit_payment_attestation", "line": 1491}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.057283Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=webauthn_signature_requested", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.058262Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] PaymentMandate signed by user: payment_id=payment_9625d0e7, next_step=payment_execution", "module": "agent", "function": "submit_payment_attestation", "line": 1512}
ap2_shopping_agent         | INFO:     172.67.69.85:32525 - "POST /payment/submit-attestation HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.070581Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.072552Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1761958169365_f3l0q\n  user_id: usr_ee3014bbc51f4156\n  user_input: _payment_signature_completed\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1058}
ap2_shopping_agent         | INFO:     172.67.69.85:32525 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.086029Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1761958169365_f3l0q, step=webauthn_signature_requested", "module": "agent", "function": "_get_or_create_session", "line": 1943}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.086817Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1761958169365_f3l0q)", "module": "agent", "function": "event_generator", "line": 1073}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.086985Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1761958169365_f3l0q", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1646}
ap2_shopping_agent         | [2025-11-01 00:53:01,117] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: webauthn_signature_requested
ap2_shopping_agent         |   user_input: _payment_signature_completed
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-01 00:53:01,142] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Requesting payment processing via Merchant Agent for PaymentMandate: payment_9625d0e7
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.143877Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 841}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.145130Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 6380, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_9625d0e7\",\"payload\":{\"cart_mandate\":{\"_metadata\":{\"cart_description\":\"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’
4ç‚¹ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\",\"cart_name\":\"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,80", "module": "crypto", "function": "sign_a2a_message", "line": 845}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.145959Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 640}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.151441Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: shopping_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.151643Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:merchant_agent: ap2.mandates.PaymentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.151809Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.mandates.PaymentMandate\", \"peer\": \"did:ap2:agent:merchant_agent\", \"headers\": {\"message_id\": \"bede6aff-e3b4-4203-a153-f78735ce7b78\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-01T00:53:01.142849Z\", \"nonce\": \"2e766374554582c60e10823143ca1fbb5204214018914bad425233b75d7cfb5e\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_9625d0e7\", \"payment_details_id\": \"order_677c5ec2\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-01T00:52:57.108248Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJWbE16QXhOR0ppWXpVeFpqUXhOVFlpTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMlZsTXpBeE5HSmlZelV4WmpReE5UWWlMQ0pwWVhRaU9qRTNOakU1TlRnek9ERXNJbVY0Y0NJNk1UYzJNVGsxT0RZNE1Td2libUptSWpveE56WXhPVFU0TXpneExDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaWVqTkhMVTVJVEdOUVVrWjVSRGRpYjNvNWExQk5kbXhCVVVGellqYzNUbkkzYmpScE1HTkJZM2cxVVNJc0lua2lPaUpFZVZwcVZUSnFOV2xuZVVwTlJsSmxkVGRoTFZKaU5qUmhhMXBYUzBWTk5HeG1UeTB4TVc5RlJERmpJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUp6YUdFM2NIQlZZM2RGT1haYU1GRXhWRVozVUZVeFFYSnpaUzFqUjFwVGJHOHRUak00TTJFMmNYZEJJaXdpYVdGMElqb3hOell4T1RVNE16Z3hMQ0p6WkY5b1lYTm9Jam9pTm1Rek1qSXhPV1U1WW1WbU5qRTJNREprT1RRM056WTROMlE1Wmpaa05Ua3paVGMzWlRWa1pEbGhNRGd5TmprelptWmxZekl4WVdVd09XRXhaakl5WXlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2labUZoWmpZMU1ERTJaV0pqTVdOak16QmxOV0kyWWpFMU16YzBPR1ZtWmpCallUSTVabUk0WXpkaFpUTm1NREl5T0dFeFkyVTJNV0UyWkdJM1ltTmtOQ0lzSWpaalpUTmhPR05rWldFNFpHVmtZams1TjJWa01XUXdPR1kwWkRZek16VTBaVFV5TXpnNFpXRmhNVEprTURaa01UWmpPRE5tWkRBME4yUTRPR0V5WXpnaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6Im5NSnJmQnJrc3R1MnpZVjUta2dpSXoycmluayIsInJhd0lkIjoibk1KcmZCcmtzdHUyellWNS1rZ2lJejJyaW5rIiwicmVzcG9uc2UiOnsiY2xpZW50RGF0YUpTT04iOiJleUowZVhCbElqb2lkMlZpWVhWMGFHNHVaMlYwSWl3aVkyaGhiR3hsYm1kbElqb2laWGxLZEZsWE5XdFpXRkpzV0RKc2EwbHFiMmxqUjBZMVlsZFdkV1JHT0RWT2Fra3hXa1JDYkU1NVNYTkpibEp3WWxkV2VtUkhSblJqUTBrMlRWUmpNazFVYXpGUFJFMHpUMFJOZVUxdU1DSXNJbTl5YVdkcGJpSTZJbWgwZEhBNkx5OXNiMk5oYkdodmMzUTZNekF3TUNJc0ltTnliM056VDNKcFoybHVJanBtWVd4elpYMCIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVFDSUN5ZzlyVzRHYmV2cXdqRV94R3RNTGZMRzlBdjZBRUZJQ01MX0d5V1V2RFNBaUJuSEhRREJneDQydlNJRzRVbjNNZkp1cHdPN29lZWFkdllLajNrb29VVmRBIiwidXNlckhhbmRsZSI6InVzcl9lZTMwMTRiYmM1MWY0MTU2In0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY4NU5qSTFaREJsTnlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRrMU9ETTNPRE15TW4wIn0sImNhcnRfaGFzaCI6ImZhYWY2NTAxNmViYzFjYzMwZTViNmIxNTM3NDhlZmYwY2EyOWZiOGM3YWUzZjAyMjhhMWNlNjFhNmRiN2JjZDQiLCJwYXltZW50X2hhc2giOiI2Y2UzYThjZGVhOGRlZGI5OTdlZDFkMDhmNGQ2MzM1NGU1MjM4OGVhYTEyZDA2ZDE2YzgzZmQwNDdkODhhMmM4In0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_9625d0e7\", \"cart_mandate_id\": \"cart_7bda44e0\", \"intent_mandate_id\": \"intent_a97064a3\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_7bda44e0\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_7bda44e0\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 380.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.660702Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiZmFhZjY1MDE2ZWJjMWNjMzBlNWI2YjE1Mzc0OGVmZjBjYTI5ZmI4YzdhZTNmMDIyOGExY2U2MWE2ZGI3YmNkNCIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjQ4Nzk1ODAwLTZkNjktNGY3Mi1iYmQ2LWI5YTUzOTdlZTQ3ZSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.ykO7qf1nOHJFpr1G82d5cizY0K_Tyj9JT9FmY9a7kwO8Lyt61kCU4mj6AZz-p-TSE5iFEDXloTVQhGpL0ANe_Q\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.660797Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\", \"cart_description\": \"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤
ãƒ†ãƒ ã‚’4ç‚¹ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_shopping_agent         | [2025-11-01 00:53:01,151] INFO in services.shopping_agent.utils.merchant_integration:
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [ShoppingAgent â†’ MerchantAgent] A2Aãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼ˆPaymentRequestï¼‰
ap2_shopping_agent         |   URL: http://merchant_agent:8001/a2a/message
ap2_shopping_agent         |   ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID: bede6aff-e3b4-4203-a153-f78735ce7b78
ap2_shopping_agent         |   ã‚¿ã‚¤ãƒ—: ap2.mandates.PaymentMandate
ap2_shopping_agent         |   PaymentMandate ID: payment_9625d0e7
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.152895Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent:8001/a2a/message", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:01.152992Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent:8001/a2a/message\", \"headers\": {}, \"body\": {\"header\": {\"message_id\": \"bede6aff-e3b4-4203-a153-f78735ce7b78\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-01T00:53:01.142849Z\", \"nonce\": \"2e766374554582c60e10823143ca1fbb5204214018914bad425233b75d7cfb5e\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"CYJU13KUlPwEnWNDZ72K+q733EPL07AB7d1AJH+yBGGYO8V0Qzlnbsy7diPnENjj/rugML8sc4OCYL3+QAW/BA==\", \"publicKey\": \"LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUNvd0JRWURLMlZ3QXlFQSt4cHkrMkRqZ0FJcVBEUERmV0JLeExVd0NNL2pGdFZ6WlN3b3gyaGZtL0k9Ci0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLQo=\", \"kid\": \"did:ap2:agent:shopping_agent#key-2\", \"created\": \"2025-11-01T00:53:01.142849Z\", \"proofPurpose\": \"authentication\"}, \"signature\": null}, \"dataPart\": {\"@type\": \"ap2.mandates.PaymentMandate\", \"id\": \"payment_9625d0e7\", \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_9625d0e7\", \"payment_details_id\": \"order_677c5ec2\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-01T00:52:57.108248Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJWbE16QXhOR0ppWXpVeFpqUXhOVFlpTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMlZsTXpBeE5HSmlZelV4WmpReE5UWWlMQ0pwWVhRaU9qRTNOakU1TlRnek9ERXNJbVY0Y0NJNk1UYzJNVGsxT0RZNE1Td2libUptSWpveE56WXhPVFU0TXpneExDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaWVqTkhMVTVJVEdOUVVrWjVSRGRpYjNvNWExQk5kbXhCVVVGellqYzNUbkkzYmpScE1HTkJZM2cxVVNJc0lua2lPaUpFZVZwcVZUSnFOV2xuZVVwTlJsSmxkVGRoTFZKaU5qUmhhMXBYUzBWTk5HeG1UeTB4TVc5RlJERmpJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUp6YUdFM2NIQlZZM2RGT1haYU1GRXhWRVozVUZVeFFYSnpaUzFqUjFwVGJHOHRUak00TTJFMmNYZEJJaXdpYVdGMElqb3hOell4T1RVNE16Z3hMQ0p6WkY5b1lYTm9Jam9pTm1Rek1qSXhPV1U1WW1WbU5qRTJNREprT1RRM056WTROMlE1Wmpaa05Ua3paVGMzWlRWa1pEbGhNRGd5TmprelptWmxZekl4WVdVd09XRXhaakl5WXlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2labUZoWmpZMU1ERTJaV0pqTVdOak16QmxOV0kyWWpFMU16YzBPR1ZtWmpCallUSTVabUk0WXpkaFpUTm1NREl5T0dFeFkyVTJNV0UyWkdJM1ltTmtOQ0lzSWpaalpUTmhPR05rWldFNFpHVmtZams1TjJWa01XUXdPR1kwWkRZek16VTBaVFV5TXpnNFpXRmhNVEprTURaa01UWmpPRE5tWkRBME4yUTRPR0V5WXpnaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6Im5NSnJmQnJrc3R1MnpZVjUta2dpSXoycmluayIsInJhd0lkIjoibk1KcmZCcmtzdHUyellWNS1rZ2lJejJyaW5rIiwicmVzcG9uc2UiOnsiY2xpZW50RGF0YUpTT04iOiJleUowZVhCbElqb2lkMlZpWVhWMGFHNHVaMlYwSWl3aVkyaGhiR3hsYm1kbElqb2laWGxLZEZsWE5XdFpXRkpzV0RKc2EwbHFiMmxqUjBZMVlsZFdkV1JHT0RWT2Fra3hXa1JDYkU1NVNYTkpibEp3WWxkV2VtUkhSblJqUTBrMlRWUmpNazFVYXpGUFJFMHpUMFJOZVUxdU1DSXNJbTl5YVdkcGJpSTZJbWgwZEhBNkx5OXNiMk5oYkdodmMzUTZNekF3TUNJc0ltTnliM056VDNKcFoybHVJanBtWVd4elpYMCIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVFDSUN5ZzlyVzRHYmV2cXdqRV94R3RNTGZMRzlBdjZBRUZJQ01MX0d5V1V2RFNBaUJuSEhRREJneDQydlNJRzRVbjNNZkp1cHdPN29lZWFkdllLajNrb29VVmRBIiwidXNlckhhbmRsZSI6InVzcl9lZTMwMTRiYmM1MWY0MTU2In0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY4NU5qSTFaREJsTnlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRrMU9ETTNPRE15TW4wIn0sImNhcnRfaGFzaCI6ImZhYWY2NTAxNmViYzFjYzMwZTViNmIxNTM3NDhlZmYwY2EyOWZiOGM3YWUzZjAyMjhhMWNlNjFhNmRiN2JjZDQiLCJwYXltZW50X2hhc2giOiI2Y2UzYThjZGVhOGRlZGI5OTdlZDFkMDhmNGQ2MzM1NGU1MjM4OGVhYTEyZDA2ZDE2YzgzZmQwNDdkODhhMmM4In0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_9625d0e7\", \"cart_mandate_id\": \"cart_7bda44e0\", \"intent_mandate_id\": \"intent_a97064a3\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_7bda44e0\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_7bda44e0\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 380.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.660702Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiZmFhZjY1MDE2ZWJjMWNjMzBlNWI2YjE1Mzc0OGVmZjBjYTI5ZmI4YzdhZTNmMDIyOGExY2U2MWE2ZGI3YmNkNCIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjQ4Nzk1ODAwLTZkNjktNGY3Mi1iYmQ2LWI5YTUzOTdlZTQ3ZSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.ykO7qf1nOHJFpr1G82d5cizY0K_Tyj9JT9FmY9a7kwO8Lyt61kCU4mj6AZz-p-TSE5iFEDXloTVQhGpL0ANe_Q\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.660797Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\", \"cart_description\": \"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’4ç‚¹ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}, \"kind\": null, \"artifact\": null}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | [2025-11-01 00:53:01,173] INFO in v2.common.base_agent:
ap2_merchant_agent         | ================================================================================
ap2_merchant_agent         | [Merchant Agent] A2Aã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: POST /a2a/message
ap2_merchant_agent         |   å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ID=bede6aff-e3b4-4203-a153-f78735ce7b78
ap2_merchant_agent         |   é€ä¿¡å…ƒ: did:ap2:agent:shopping_agent
ap2_merchant_agent         |   ã‚¿ã‚¤ãƒ—: ap2.mandates.PaymentMandate
ap2_merchant_agent         | ================================================================================
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.173987Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message received to/from did:ap2:agent:shopping_agent: ap2.mandates.PaymentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.174752Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"received\", \"message_type\": \"ap2.mandates.PaymentMandate\", \"peer\": \"did:ap2:agent:shopping_agent\", \"headers\": {\"message_id\": \"bede6aff-e3b4-4203-a153-f78735ce7b78\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-01T00:53:01.142849Z\", \"nonce\": \"2e766374554582c60e10823143ca1fbb5204214018914bad425233b75d7cfb5e\", \"schema_version\": \"0.2\"}, \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_9625d0e7\", \"payment_details_id\": \"order_677c5ec2\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-01T00:52:57.108248Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJWbE16QXhOR0ppWXpVeFpqUXhOVFlpTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMlZsTXpBeE5HSmlZelV4WmpReE5UWWlMQ0pwWVhRaU9qRTNOakU1TlRnek9ERXNJbVY0Y0NJNk1UYzJNVGsxT0RZNE1Td2libUptSWpveE56WXhPVFU0TXpneExDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaWVqTkhMVTVJVEdOUVVrWjVSRGRpYjNvNWExQk5kbXhCVVVGellqYzNUbkkzYmpScE1HTkJZM2cxVVNJc0lua2lPaUpFZVZwcVZUSnFOV2xuZVVwTlJsSmxkVGRoTFZKaU5qUmhhMXBYUzBWTk5HeG1UeTB4TVc5RlJERmpJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUp6YUdFM2NIQlZZM2RGT1haYU1GRXhWRVozVUZVeFFYSnpaUzFqUjFwVGJHOHRUak00TTJFMmNYZEJJaXdpYVdGMElqb3hOell4T1RVNE16Z3hMQ0p6WkY5b1lYTm9Jam9pTm1Rek1qSXhPV1U1WW1WbU5qRTJNREprT1RRM056WTROMlE1Wmpaa05Ua3paVGMzWlRWa1pEbGhNRGd5TmprelptWmxZekl4WVdVd09XRXhaakl5WXlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2labUZoWmpZMU1ERTJaV0pqTVdOak16QmxOV0kyWWpFMU16YzBPR1ZtWmpCallUSTVabUk0WXpkaFpUTm1NREl5T0dFeFkyVTJNV0UyWkdJM1ltTmtOQ0lzSWpaalpUTmhPR05rWldFNFpHVmtZams1TjJWa01XUXdPR1kwWkRZek16VTBaVFV5TXpnNFpXRmhNVEprTURaa01UWmpPRE5tWkRBME4yUTRPR0V5WXpnaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6Im5NSnJmQnJrc3R1MnpZVjUta2dpSXoycmluayIsInJhd0lkIjoibk1KcmZCcmtzdHUyellWNS1rZ2lJejJyaW5rIiwicmVzcG9uc2UiOnsiY2xpZW50RGF0YUpTT04iOiJleUowZVhCbElqb2lkMlZpWVhWMGFHNHVaMlYwSWl3aVkyaGhiR3hsYm1kbElqb2laWGxLZEZsWE5XdFpXRkpzV0RKc2EwbHFiMmxqUjBZMVlsZFdkV1JHT0RWT2Fra3hXa1JDYkU1NVNYTkpibEp3WWxkV2VtUkhSblJqUTBrMlRWUmpNazFVYXpGUFJFMHpUMFJOZVUxdU1DSXNJbTl5YVdkcGJpSTZJbWgwZEhBNkx5OXNiMk5oYkdodmMzUTZNekF3TUNJc0ltTnliM056VDNKcFoybHVJanBtWVd4elpYMCIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVFDSUN5ZzlyVzRHYmV2cXdqRV94R3RNTGZMRzlBdjZBRUZJQ01MX0d5V1V2RFNBaUJuSEhRREJneDQydlNJRzRVbjNNZkp1cHdPN29lZWFkdllLajNrb29VVmRBIiwidXNlckhhbmRsZSI6InVzcl9lZTMwMTRiYmM1MWY0MTU2In0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY4NU5qSTFaREJsTnlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRrMU9ETTNPRE15TW4wIn0sImNhcnRfaGFzaCI6ImZhYWY2NTAxNmViYzFjYzMwZTViNmIxNTM3NDhlZmYwY2EyOWZiOGM3YWUzZjAyMjhhMWNlNjFhNmRiN2JjZDQiLCJwYXltZW50X2hhc2giOiI2Y2UzYThjZGVhOGRlZGI5OTdlZDFkMDhmNGQ2MzM1NGU1MjM4OGVhYTEyZDA2ZDE2YzgzZmQwNDdkODhhMmM4In0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_9625d0e7\", \"cart_mandate_id\": \"cart_7bda44e0\", \"intent_mandate_id\": \"intent_a97064a3\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_7bda44e0\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_7bda44e0\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 380.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.660702Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiZmFhZjY1MDE2ZWJjMWNjMzBlNWI2YjE1Mzc0OGVmZjBjYTI5ZmI4YzdhZTNmMDIyOGExY2U2MWE2ZGI3YmNkNCIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjQ4Nzk1ODAwLTZkNjktNGY3Mi1iYmQ2LWI5YTUzOTdlZTQ3ZSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.ykO7qf1nOHJFpr1G82d5cizY0K_Tyj9JT9FmY9a7kwO8Lyt61kCU4mj6AZz-p-TSE5iFEDXloTVQhGpL0ANe_Q\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.660797Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\", \"cart_description\": \"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’4ç‚¹ã§äºˆç®—
å†…ã‚’ç¢ºä¿ã€‚\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.175727Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Nonce validation successful: nonce=2e766374554582c6...", "module": "a2a_handler", "function": "verify_message_signature", "line": 156}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.176202Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Using DID-resolved public key for verification: kid=did:ap2:agent:shopping_agent#key-2", "module": "a2a_handler", "function": "verify_message_signature", "line": 184}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.177290Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying A2A message signature", "module": "crypto", "function": "verify_a2a_message_signature", "line": 869}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.178115Z", "level": "DEBUG", "logger": "common.crypto", "message": "[VERIFY] Canonical JSON length: 6380, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_9625d0e7\",\"payload\":{\"cart_mandate\":{\"_metadata\":{\"cart_description\":\"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ 
ã‚’4ç‚¹ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\",\"cart_name\":\"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,80", "module": "crypto", "function": "verify_a2a_message_signature", "line": 873}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.178393Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying signature (algorithm: ED25519)", "module": "crypto", "function": "verify_signature", "line": 703}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.179886Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto VERIFY: ED25519 (key: did:ap2:agent:shopping_agent#key-2) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.179944Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] proofç½²åæ¤œè¨¼æˆåŠŸ: sender=did:ap2:agent:shopping_agent, alg=ed25519, kid=did:ap2:agent:shopping_agent#key-2, public_key_source=DID-resolved", "module": "a2a_handler", "function": "verify_message_signature", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.180016Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2Aå‡¦ç†] ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè¡Œä¸­: type=ap2.mandates.PaymentMandate, from=did:ap2:agent:shopping_agent", "module": "a2a_handler", "function": "handle_message", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.180832Z", "level": "INFO", "logger": "handlers.payment_handler", "message": "[MerchantAgent] Received PaymentRequest from Shopping Agent", "module": "payment_handler", "function": "handle_payment_request", "line": 32}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.181042Z", "level": "INFO", "logger": "handlers.payment_handler", "message": "[MerchantAgent] Forwarding PaymentMandate to Payment Processor: payment_mandate_id=payment_9625d0e7", "module": "payment_handler", "function": "handle_payment_request", "line": 51}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.183266Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 841}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.183630Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 6383, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_9625d0e7\",\"payload\":{\"cart_mandate\":{\"_metadata\":{\"cart_description\":\"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’
4ç‚¹ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\",\"cart_name\":\"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,80", "module": "crypto", "function": "sign_a2a_message", "line": 845}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.183709Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 640}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.184756Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: merchant_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.184902Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:payment_processor: ap2.mandates.PaymentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.185056Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.mandates.PaymentMandate\", \"peer\": \"did:ap2:agent:payment_processor\", \"headers\": {\"message_id\": \"5c438031-9c10-4254-9ec4-4425493b2d24\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:payment_processor\", \"timestamp\": \"2025-11-01T00:53:01.181094Z\", \"nonce\": \"ee83329cbc236a609143020872ffed1efff2fc3158cd34ea23b60ae9f2a47e05\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_9625d0e7\", \"payment_details_id\": \"order_677c5ec2\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-01T00:52:57.108248Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJWbE16QXhOR0ppWXpVeFpqUXhOVFlpTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMlZsTXpBeE5HSmlZelV4WmpReE5UWWlMQ0pwWVhRaU9qRTNOakU1TlRnek9ERXNJbVY0Y0NJNk1UYzJNVGsxT0RZNE1Td2libUptSWpveE56WXhPVFU0TXpneExDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaWVqTkhMVTVJVEdOUVVrWjVSRGRpYjNvNWExQk5kbXhCVVVGellqYzNUbkkzYmpScE1HTkJZM2cxVVNJc0lua2lPaUpFZVZwcVZUSnFOV2xuZVVwTlJsSmxkVGRoTFZKaU5qUmhhMXBYUzBWTk5HeG1UeTB4TVc5RlJERmpJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUp6YUdFM2NIQlZZM2RGT1haYU1GRXhWRVozVUZVeFFYSnpaUzFqUjFwVGJHOHRUak00TTJFMmNYZEJJaXdpYVdGMElqb3hOell4T1RVNE16Z3hMQ0p6WkY5b1lYTm9Jam9pTm1Rek1qSXhPV1U1WW1WbU5qRTJNREprT1RRM056WTROMlE1Wmpaa05Ua3paVGMzWlRWa1pEbGhNRGd5TmprelptWmxZekl4WVdVd09XRXhaakl5WXlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2labUZoWmpZMU1ERTJaV0pqTVdOak16QmxOV0kyWWpFMU16YzBPR1ZtWmpCallUSTVabUk0WXpkaFpUTm1NREl5T0dFeFkyVTJNV0UyWkdJM1ltTmtOQ0lzSWpaalpUTmhPR05rWldFNFpHVmtZams1TjJWa01XUXdPR1kwWkRZek16VTBaVFV5TXpnNFpXRmhNVEprTURaa01UWmpPRE5tWkRBME4yUTRPR0V5WXpnaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6Im5NSnJmQnJrc3R1MnpZVjUta2dpSXoycmluayIsInJhd0lkIjoibk1KcmZCcmtzdHUyellWNS1rZ2lJejJyaW5rIiwicmVzcG9uc2UiOnsiY2xpZW50RGF0YUpTT04iOiJleUowZVhCbElqb2lkMlZpWVhWMGFHNHVaMlYwSWl3aVkyaGhiR3hsYm1kbElqb2laWGxLZEZsWE5XdFpXRkpzV0RKc2EwbHFiMmxqUjBZMVlsZFdkV1JHT0RWT2Fra3hXa1JDYkU1NVNYTkpibEp3WWxkV2VtUkhSblJqUTBrMlRWUmpNazFVYXpGUFJFMHpUMFJOZVUxdU1DSXNJbTl5YVdkcGJpSTZJbWgwZEhBNkx5OXNiMk5oYkdodmMzUTZNekF3TUNJc0ltTnliM056VDNKcFoybHVJanBtWVd4elpYMCIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVFDSUN5ZzlyVzRHYmV2cXdqRV94R3RNTGZMRzlBdjZBRUZJQ01MX0d5V1V2RFNBaUJuSEhRREJneDQydlNJRzRVbjNNZkp1cHdPN29lZWFkdllLajNrb29VVmRBIiwidXNlckhhbmRsZSI6InVzcl9lZTMwMTRiYmM1MWY0MTU2In0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY4NU5qSTFaREJsTnlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRrMU9ETTNPRE15TW4wIn0sImNhcnRfaGFzaCI6ImZhYWY2NTAxNmViYzFjYzMwZTViNmIxNTM3NDhlZmYwY2EyOWZiOGM3YWUzZjAyMjhhMWNlNjFhNmRiN2JjZDQiLCJwYXltZW50X2hhc2giOiI2Y2UzYThjZGVhOGRlZGI5OTdlZDFkMDhmNGQ2MzM1NGU1MjM4OGVhYTEyZDA2ZDE2YzgzZmQwNDdkODhhMmM4In0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_9625d0e7\", \"cart_mandate_id\": \"cart_7bda44e0\", \"intent_mandate_id\": \"intent_a97064a3\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_7bda44e0\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_7bda44e0\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 380.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.660702Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiZmFhZjY1MDE2ZWJjMWNjMzBlNWI2YjE1Mzc0OGVmZjBjYTI5ZmI4YzdhZTNmMDIyOGExY2U2MWE2ZGI3YmNkNCIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjQ4Nzk1ODAwLTZkNjktNGY3Mi1iYmQ2LWI5YTUzOTdlZTQ3ZSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.ykO7qf1nOHJFpr1G82d5cizY0K_Tyj9JT9FmY9a7kwO8Lyt61kCU4mj6AZz-p-TSE5iFEDXloTVQhGpL0ANe_Q\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.660797Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\", \"cart_description\": \"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„
ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’4ç‚¹ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.185311Z", "level": "INFO", "logger": "handlers.payment_handler", "message": "\n================================================================================\n[MerchantAgent â†’ PaymentProcessor] A2Aãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è»¢é€\n  URL: http://payment_processor:8004/a2a/message\n  ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID: 5c438031-9c10-4254-9ec4-4425493b2d24\n  ã‚¿
ã‚¤ãƒ—: ap2.mandates.PaymentMandate\n================================================================================", "module": "payment_handler", "function": "handle_payment_request", "line": 69}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.185938Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://payment_processor:8004/a2a/message", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:01.186423Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://payment_processor:8004/a2a/message\", \"headers\": {}, \"body\": {\"header\": {\"message_id\": \"5c438031-9c10-4254-9ec4-4425493b2d24\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:payment_processor\", \"timestamp\": \"2025-11-01T00:53:01.181094Z\", \"nonce\": \"ee83329cbc236a609143020872ffed1efff2fc3158cd34ea23b60ae9f2a47e05\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"CWdfTBQllFOeRMI7bjzoAu5hcrIwlsmjqyYOcGrVoZWo2Ex2jgPo5eCVh1ZkPM8eAyhu19pXg2+qL6jcFoydCQ==\", \"publicKey\": \"LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUNvd0JRWURLMlZ3QXlFQTZHQmRVRllXaHBZcUNtdjVUMGFsTGg3ckt4TzlHTkZLdnRabU5keWUyQk09Ci0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLQo=\", \"kid\": \"did:ap2:agent:merchant_agent#key-2\", \"created\": \"2025-11-01T00:53:01.181094Z\", \"proofPurpose\": \"authentication\"}, \"signature\": null}, \"dataPart\": {\"@type\": \"ap2.mandates.PaymentMandate\", \"id\": \"payment_9625d0e7\", \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_9625d0e7\", \"payment_details_id\": \"order_677c5ec2\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-01T00:52:57.108248Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJWbE16QXhOR0ppWXpVeFpqUXhOVFlpTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMlZsTXpBeE5HSmlZelV4WmpReE5UWWlMQ0pwWVhRaU9qRTNOakU1TlRnek9ERXNJbVY0Y0NJNk1UYzJNVGsxT0RZNE1Td2libUptSWpveE56WXhPVFU0TXpneExDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaWVqTkhMVTVJVEdOUVVrWjVSRGRpYjNvNWExQk5kbXhCVVVGellqYzNUbkkzYmpScE1HTkJZM2cxVVNJc0lua2lPaUpFZVZwcVZUSnFOV2xuZVVwTlJsSmxkVGRoTFZKaU5qUmhhMXBYUzBWTk5HeG1UeTB4TVc5RlJERmpJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUp6YUdFM2NIQlZZM2RGT1haYU1GRXhWRVozVUZVeFFYSnpaUzFqUjFwVGJHOHRUak00TTJFMmNYZEJJaXdpYVdGMElqb3hOell4T1RVNE16Z3hMQ0p6WkY5b1lYTm9Jam9pTm1Rek1qSXhPV1U1WW1WbU5qRTJNREprT1RRM056WTROMlE1Wmpaa05Ua3paVGMzWlRWa1pEbGhNRGd5TmprelptWmxZekl4WVdVd09XRXhaakl5WXlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2labUZoWmpZMU1ERTJaV0pqTVdOak16QmxOV0kyWWpFMU16YzBPR1ZtWmpCallUSTVabUk0WXpkaFpUTm1NREl5T0dFeFkyVTJNV0UyWkdJM1ltTmtOQ0lzSWpaalpUTmhPR05rWldFNFpHVmtZams1TjJWa01XUXdPR1kwWkRZek16VTBaVFV5TXpnNFpXRmhNVEprTURaa01UWmpPRE5tWkRBME4yUTRPR0V5WXpnaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6Im5NSnJmQnJrc3R1MnpZVjUta2dpSXoycmluayIsInJhd0lkIjoibk1KcmZCcmtzdHUyellWNS1rZ2lJejJyaW5rIiwicmVzcG9uc2UiOnsiY2xpZW50RGF0YUpTT04iOiJleUowZVhCbElqb2lkMlZpWVhWMGFHNHVaMlYwSWl3aVkyaGhiR3hsYm1kbElqb2laWGxLZEZsWE5XdFpXRkpzV0RKc2EwbHFiMmxqUjBZMVlsZFdkV1JHT0RWT2Fra3hXa1JDYkU1NVNYTkpibEp3WWxkV2VtUkhSblJqUTBrMlRWUmpNazFVYXpGUFJFMHpUMFJOZVUxdU1DSXNJbTl5YVdkcGJpSTZJbWgwZEhBNkx5OXNiMk5oYkdodmMzUTZNekF3TUNJc0ltTnliM056VDNKcFoybHVJanBtWVd4elpYMCIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVFDSUN5ZzlyVzRHYmV2cXdqRV94R3RNTGZMRzlBdjZBRUZJQ01MX0d5V1V2RFNBaUJuSEhRREJneDQydlNJRzRVbjNNZkp1cHdPN29lZWFkdllLajNrb29VVmRBIiwidXNlckhhbmRsZSI6InVzcl9lZTMwMTRiYmM1MWY0MTU2In0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY4NU5qSTFaREJsTnlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRrMU9ETTNPRE15TW4wIn0sImNhcnRfaGFzaCI6ImZhYWY2NTAxNmViYzFjYzMwZTViNmIxNTM3NDhlZmYwY2EyOWZiOGM3YWUzZjAyMjhhMWNlNjFhNmRiN2JjZDQiLCJwYXltZW50X2hhc2giOiI2Y2UzYThjZGVhOGRlZGI5OTdlZDFkMDhmNGQ2MzM1NGU1MjM4OGVhYTEyZDA2ZDE2YzgzZmQwNDdkODhhMmM4In0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_9625d0e7\", \"cart_mandate_id\": \"cart_7bda44e0\", \"intent_mandate_id\": \"intent_a97064a3\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_7bda44e0\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_7bda44e0\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 380.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.660702Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiZmFhZjY1MDE2ZWJjMWNjMzBlNWI2YjE1Mzc0OGVmZjBjYTI5ZmI4YzdhZTNmMDIyOGExY2U2MWE2ZGI3YmNkNCIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjQ4Nzk1ODAwLTZkNjktNGY3Mi1iYmQ2LWI5YTUzOTdlZTQ3ZSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.ykO7qf1nOHJFpr1G82d5cizY0K_Tyj9JT9FmY9a7kwO8Lyt61kCU4mj6AZz-p-TSE5iFEDXloTVQhGpL0ANe_Q\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.660797Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\", \"cart_description\": \"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’4ç‚¹ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}, \"kind\": null, \"artifact\": null}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_payment_processor      | [2025-11-01 00:53:01,507] INFO in v2.common.base_agent:
ap2_payment_processor      | ================================================================================
ap2_payment_processor      | [Payment Processor] A2Aã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: POST /a2a/message
ap2_payment_processor      |   å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ID=5c438031-9c10-4254-9ec4-4425493b2d24
ap2_payment_processor      |   é€ä¿¡å…ƒ: did:ap2:agent:merchant_agent
ap2_payment_processor      |   ã‚¿ã‚¤ãƒ—: ap2.mandates.PaymentMandate
ap2_payment_processor      | ================================================================================
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.514103Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message received to/from did:ap2:agent:merchant_agent: ap2.mandates.PaymentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.515386Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"received\", \"message_type\": \"ap2.mandates.PaymentMandate\", \"peer\": \"did:ap2:agent:merchant_agent\", \"headers\": {\"message_id\": \"5c438031-9c10-4254-9ec4-4425493b2d24\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:payment_processor\", \"timestamp\": \"2025-11-01T00:53:01.181094Z\", \"nonce\": \"ee83329cbc236a609143020872ffed1efff2fc3158cd34ea23b60ae9f2a47e05\", \"schema_version\": \"0.2\"}, \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_9625d0e7\", \"payment_details_id\": \"order_677c5ec2\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-01T00:52:57.108248Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJWbE16QXhOR0ppWXpVeFpqUXhOVFlpTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMlZsTXpBeE5HSmlZelV4WmpReE5UWWlMQ0pwWVhRaU9qRTNOakU1TlRnek9ERXNJbVY0Y0NJNk1UYzJNVGsxT0RZNE1Td2libUptSWpveE56WXhPVFU0TXpneExDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaWVqTkhMVTVJVEdOUVVrWjVSRGRpYjNvNWExQk5kbXhCVVVGellqYzNUbkkzYmpScE1HTkJZM2cxVVNJc0lua2lPaUpFZVZwcVZUSnFOV2xuZVVwTlJsSmxkVGRoTFZKaU5qUmhhMXBYUzBWTk5HeG1UeTB4TVc5RlJERmpJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUp6YUdFM2NIQlZZM2RGT1haYU1GRXhWRVozVUZVeFFYSnpaUzFqUjFwVGJHOHRUak00TTJFMmNYZEJJaXdpYVdGMElqb3hOell4T1RVNE16Z3hMQ0p6WkY5b1lYTm9Jam9pTm1Rek1qSXhPV1U1WW1WbU5qRTJNREprT1RRM056WTROMlE1Wmpaa05Ua3paVGMzWlRWa1pEbGhNRGd5TmprelptWmxZekl4WVdVd09XRXhaakl5WXlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2labUZoWmpZMU1ERTJaV0pqTVdOak16QmxOV0kyWWpFMU16YzBPR1ZtWmpCallUSTVabUk0WXpkaFpUTm1NREl5T0dFeFkyVTJNV0UyWkdJM1ltTmtOQ0lzSWpaalpUTmhPR05rWldFNFpHVmtZams1TjJWa01XUXdPR1kwWkRZek16VTBaVFV5TXpnNFpXRmhNVEprTURaa01UWmpPRE5tWkRBME4yUTRPR0V5WXpnaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6Im5NSnJmQnJrc3R1MnpZVjUta2dpSXoycmluayIsInJhd0lkIjoibk1KcmZCcmtzdHUyellWNS1rZ2lJejJyaW5rIiwicmVzcG9uc2UiOnsiY2xpZW50RGF0YUpTT04iOiJleUowZVhCbElqb2lkMlZpWVhWMGFHNHVaMlYwSWl3aVkyaGhiR3hsYm1kbElqb2laWGxLZEZsWE5XdFpXRkpzV0RKc2EwbHFiMmxqUjBZMVlsZFdkV1JHT0RWT2Fra3hXa1JDYkU1NVNYTkpibEp3WWxkV2VtUkhSblJqUTBrMlRWUmpNazFVYXpGUFJFMHpUMFJOZVUxdU1DSXNJbTl5YVdkcGJpSTZJbWgwZEhBNkx5OXNiMk5oYkdodmMzUTZNekF3TUNJc0ltTnliM056VDNKcFoybHVJanBtWVd4elpYMCIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVFDSUN5ZzlyVzRHYmV2cXdqRV94R3RNTGZMRzlBdjZBRUZJQ01MX0d5V1V2RFNBaUJuSEhRREJneDQydlNJRzRVbjNNZkp1cHdPN29lZWFkdllLajNrb29VVmRBIiwidXNlckhhbmRsZSI6InVzcl9lZTMwMTRiYmM1MWY0MTU2In0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY4NU5qSTFaREJsTnlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTVRrMU9ETTNPRE15TW4wIn0sImNhcnRfaGFzaCI6ImZhYWY2NTAxNmViYzFjYzMwZTViNmIxNTM3NDhlZmYwY2EyOWZiOGM3YWUzZjAyMjhhMWNlNjFhNmRiN2JjZDQiLCJwYXltZW50X2hhc2giOiI2Y2UzYThjZGVhOGRlZGI5OTdlZDFkMDhmNGQ2MzM1NGU1MjM4OGVhYTEyZDA2ZDE2YzgzZmQwNDdkODhhMmM4In0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_9625d0e7\", \"cart_mandate_id\": \"cart_7bda44e0\", \"intent_mandate_id\": \"intent_a97064a3\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_7bda44e0\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_7bda44e0\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 380.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-01T01:52:44.660702Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiZmFhZjY1MDE2ZWJjMWNjMzBlNWI2YjE1Mzc0OGVmZjBjYTI5ZmI4YzdhZTNmMDIyOGExY2U2MWE2ZGI3YmNkNCIsImV4cCI6MTc2MTk2MTk2NSwiaWF0IjoxNzYxOTU4MzY1LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjQ4Nzk1ODAwLTZkNjktNGY3Mi1iYmQ2LWI5YTUzOTdlZTQ3ZSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.ykO7qf1nOHJFpr1G82d5cizY0K_Tyj9JT9FmY9a7kwO8Lyt61kCU4mj6AZz-p-TSE5iFEDXloTVQhGpL0ANe_Q\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-01T00:52:44.660797Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,800å††)\", \"cart_description\": \"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’4ç‚¹ã§
äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\", \"raw_items\": [{\"product_id\": \"3446cca8-fe68-4354-a518-63eb3e47d27f\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"cf08568b-8115-461c-aa7e-5a2e07bf4476\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"eb0e5de8-679d-4445-8e64-a1d4d40097fd\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"e534386f-c89b-4548-9734-78bd34958f88\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.516445Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Nonce validation successful: nonce=ee83329cbc236a60...", "module": "a2a_handler", "function": "verify_message_signature", "line": 156}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.519364Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Using DID-resolved public key for verification: kid=did:ap2:agent:merchant_agent#key-2", "module": "a2a_handler", "function": "verify_message_signature", "line": 184}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.527931Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying A2A message signature", "module": "crypto", "function": "verify_a2a_message_signature", "line": 869}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.532881Z", "level": "DEBUG", "logger": "common.crypto", "message": "[VERIFY] Canonical JSON length: 6383, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_9625d0e7\",\"payload\":{\"cart_mandate\":{\"_metadata\":{\"cart_description\":\"ä¾¡æ ¼é‡è¦–ã§æœ€ã‚‚å¤šãã®å•†å“ã‚’åŽéŒ²ã€‚ã‹ã‚ã„ã„ã‚¢ã‚¤ãƒ†ãƒ 
ã‚’4ç‚¹ã§äºˆç®—å†…ã‚’ç¢ºä¿ã€‚\",\"cart_name\":\"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (3,80", "module": "crypto", "function": "verify_a2a_message_signature", "line": 873}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.533081Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying signature (algorithm: ED25519)", "module": "crypto", "function": "verify_signature", "line": 703}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.566424Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto VERIFY: ED25519 (key: did:ap2:agent:merchant_agent#key-2) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.566765Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] proofç½²åæ¤œè¨¼æˆåŠŸ: sender=did:ap2:agent:merchant_agent, alg=ed25519, kid=did:ap2:agent:merchant_agent#key-2, public_key_source=DID-resolved", "module": "a2a_handler", "function": "verify_message_signature", "line": 215}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.566818Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2Aå‡¦ç†] ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè¡Œä¸­: type=ap2.mandates.PaymentMandate, from=did:ap2:agent:merchant_agent", "module": "a2a_handler", "function": "handle_message", "line": 328}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.568615Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Received PaymentMandate", "module": "processor", "function": "handle_payment_mandate", "line": 366}
ap2_payment_processor      | [2025-11-01 00:53:01,569] INFO in services.payment_processor.utils.mandate_helpers: [PaymentProcessor] PaymentMandate validation passed: payment_9625d0e7, user_authorization present: eyJpc3N1ZXJfand0Ijoi...
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.569599Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Mandate chain validation: PaymentMandate(payment_9625d0e7) â†’ CartMandate(cart_7bda44e0)", "module": "processor", "function": "_validate_mandate_chain", "line": 631}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.571940Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Verifying SD-JWT-VC user_authorization: cart_hash=faaf65016ebc1cc3..., payment_hash=6ce3a8cdea8dedb9...", "module": "processor", "function": "_validate_mandate_chain", "line": 648}
ap2_payment_processor      | [2025-11-01 00:53:01,572] INFO in v2.common.user_authorization: [verify_user_authorization_vp] Decoded VP successfully
ap2_payment_processor      | [2025-11-01 00:53:01,572] INFO in v2.common.user_authorization: [verify_user_authorization_vp] Hash verification passed: cart_hash=faaf65016ebc1cc3..., payment_hash=6ce3a8cdea8dedb9...
ap2_payment_processor      | [2025-11-01 00:53:01,579] INFO in v2.common.user_authorization: [verify_user_authorization_vp] âœ“ WebAuthn signature verified successfully
ap2_payment_processor      | [2025-11-01 00:53:01,579] INFO in v2.common.user_authorization: [verify_user_authorization_vp] Key-binding JWT payload verified
ap2_payment_processor      | [2025-11-01 00:53:01,580] INFO in v2.common.user_authorization: [verify_user_authorization_vp] âœ“ VP verification passed
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.580189Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] âœ“ SD-JWT-VC user_authorization verified: cart_hash_match=True, payment_hash_match=True, webauthn_signature_verified=True", "module": "processor", "function": "_validate_mandate_chain", "line": 661}
ap2_payment_processor      | [2025-11-01 00:53:01,585] INFO in v2.common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/shopping_agent_did.json
ap2_payment_processor      | [2025-11-01 00:53:01,587] INFO in v2.common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²
: did:ap2:agent:shopping_agent
ap2_payment_processor      | [2025-11-01 00:53:01,587] INFO in v2.common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’
èª­ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/merchant_agent_did.json
ap2_payment_processor      | [2025-11-01 00:53:01,588] INFO in v2.common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²
: did:ap2:agent:merchant_agent
ap2_payment_processor      | [2025-11-01 00:53:01,588] INFO in v2.common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’
èª­ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/merchant_did.json
ap2_payment_processor      | [2025-11-01 00:53:01,588] INFO in v2.common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²
: did:ap2:merchant:mugibo_merchant
ap2_payment_processor      | [2025-11-01 00:53:01,589] INFO in v2.common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’
èª­ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/credential_provider_did.json
ap2_payment_processor      | [2025-11-01 00:53:01,589] INFO in v2.common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²
: did:ap2:cp:demo_cp
ap2_payment_processor      | [2025-11-01 00:53:01,589] INFO in v2.common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’
èª­ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_payment_processor      | [2025-11-01 00:53:01,590] INFO in v2.common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²
: did:ap2:cp:demo_cp_2
ap2_payment_processor      | [2025-11-01 00:53:01,590] INFO in v2.common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’
èª­ã¿è¾¼ã¿ä¸­: /app/v2/data/did_documents/payment_processor_did.json
ap2_payment_processor      | [2025-11-01 00:53:01,590] INFO in v2.common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²
: did:ap2:agent:payment_processor
ap2_payment_processor      | [2025-11-01 00:53:01,591] INFO in services.payment_processor.utils.jwt_helpers: [_verify_jwt_signature] âœ“ JWT signature verified successfully (RFC 7515 compliant)
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.591728Z", "level": "INFO", "logger": "processor", "message": "[_verify_merchant_authorization_jwt] JWT validation passed: iss=did:ap2:merchant:mugibo_merchant, exp=1761961965, jti=48795800-6d69-4f..., cart_hash=faaf65016ebc1cc3...", "module": "processor", "function": "_verify_merchant_authorization_jwt", "line": 573}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.591757Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] merchant_authorization JWT verified: iss=did:ap2:merchant:mugibo_merchant", "module": "processor", "function": "_validate_mandate_chain", "line": 685}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.591769Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] CartMandate hash in merchant_authorization: faaf65016ebc1cc3...", "module": "processor", "function": "_validate_mandate_chain", "line": 693}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.591940Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] âœ“ CartMandate hash verified (merchant_authorization): faaf65016ebc1cc3...", "module": "processor", "function": "_validate_mandate_chain", "line": 710}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.591962Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Mandate chain validation passed", "module": "processor", "function": "_validate_mandate_chain", "line": 742}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.593282Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Processing payment (mock): txn_fbd3ca2e4c30", "module": "processor", "function": "_process_payment_mock", "line": 761}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.593490Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Verifying credential with Credential Provider: token=tok_204deed0_45AoJZ2...", "module": "processor", "function": "_verify_credential_with_cp", "line": 876}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.596251Z", "level": "INFO", "logger": "processor", "message": "HTTP Request: POST http://credential_provider:8003/credentials/verify", "module": "logger", "function": "log_http_request", "line": 182}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.596279Z", "level": "DEBUG", "logger": "processor", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/credentials/verify\", \"headers\": {}, \"body\": {\"token\": \"tok_204deed0_45AoJZ2EXK0QnsopvMt7Uhbl\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:01.646666Z", "level": "INFO", "logger": "provider", "message": "[verify_credentials] Verifying token for payer: usr_ee3014bbc51f4156", "module": "provider", "function": "verify_credentials", "line": 1572}
ap2_credential_provider    | {"timestamp": "2025-11-01T00:53:01.649572Z", "level": "INFO", "logger": "provider", "message": "[verify_credentials] Token verified: payment_method_id=pm_e6367cd7, user_id=usr_ee3014bbc51f4156", "module": "provider", "function": "verify_credentials", "line": 1609}
ap2_credential_provider    | INFO:     172.18.0.8:52766 - "POST /credentials/verify HTTP/1.1" 200 OK
ap2_payment_processor      | [2025-11-01 00:53:01,653] INFO in httpx: HTTP Request: POST http://credential_provider:8003/credentials/verify "HTTP/1.1 200 OK"
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.656626Z", "level": "INFO", "logger": "processor", "message": "HTTP Response: 200 (60.51ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.656665Z", "level": "DEBUG", "logger": "processor", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:53:01 GMT\", \"server\": \"uvicorn\", \"content-length\": \"186\", \"content-type\": \"application/json\"}, \"body\": {\"verified\": true, \"credential_info\": {\"payment_method_id\": \"pm_e6367cd7\", \"type\": \"basic-card\", \"brand\": \"Visa\", \"last4\": \"1111\", \"holder_name\": \"Unknown\", \"expiry_month\": \"03\", \"expiry_year\": \"2029\"}}, \"duration_ms\": 60.51445007324219}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.656783Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Credential verification succeeded: payment_method_id=pm_e6367cd7", "module": "processor", "function": "_verify_credential_with_cp", "line": 911}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.656803Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Credential verified: pm_e6367cd7", "module": "processor", "function": "_process_payment_mock", "line": 784}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.656815Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Risk assessment: score=2, indicators=[]", "module": "processor", "function": "_process_payment_mock", "line": 799}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.656856Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Payment succeeded: txn_fbd3ca2e4c30, amount={'value': 4680.0, 'currency': 'JPY'}, risk_score=2", "module": "processor", "function": "_process_payment_mock", "line": 833}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.751657Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Transaction saved: txn_fbd3ca2e4c30", "module": "processor", "function": "_save_transaction", "line": 860}
ap2_payment_processor      | [2025-11-01 00:53:01,963] INFO in v2.common.receipt_generator: [ReceiptGenerator] Generating PDF receipt for transaction: txn_fbd3ca2e4c30
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.963099Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Generated user name for receipt: User usr_ee30 (payer_id: usr_ee3014bbc51f4156)", "module": "processor", "function": "_generate_receipt", "line": 1061}
ap2_payment_processor      | [2025-11-01 00:53:01,974] INFO in v2.common.receipt_generator: [ReceiptGenerator] PDF receipt generated successfully
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.975988Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Generated receipt PDF: /app/v2/data/receipts/txn_fbd3ca2e4c30.pdf", "module": "processor", "function": "_generate_receipt", "line": 1080}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.982795Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Receipt record saved to database: txn_fbd3ca2e4c30", "module": "processor", "function": "_generate_receipt", "line": 1099}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.983297Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Sending receipt notification to Credential Provider: transaction_id=txn_fbd3ca2e4c30, payer_id=usr_ee3014bbc51f4156", "module": "processor", "function": "_send_receipt_to_credential_provider", "line": 940}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.983463Z", "level": "INFO", "logger": "processor", "message": "HTTP Request: POST http://credential_provider:8003/receipts", "module": "logger", "function": "log_http_request", "line": 182}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:01.983496Z", "level": "DEBUG", "logger": "processor", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/receipts\", \"headers\": {}, \"body\": {\"transaction_id\": \"txn_fbd3ca2e4c30\", \"receipt_url\": \"http://localhost:8004/receipts/txn_fbd3ca2e4c30.pdf\", \"payer_id\": \"usr_ee3014bbc51f4156\", \"amount\": {\"value\": 4680.0, \"currency\": \"JPY\"}, \"timestamp\": \"2025-11-01T00:53:01.983432Z\"}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | [2025-11-01 00:53:02,000] INFO in services.credential_provider.utils.receipt_helpers: [CredentialProvider] Receipt received and stored to DB: transaction_id=txn_fbd3ca2e4c30, payer_id=usr_ee3014bbc51f4156, receipt_url=http://localhost:8004/receipts/txn_fbd3ca2e4c30.pdf
ap2_credential_provider    | INFO:     172.18.0.8:52766 - "POST /receipts HTTP/1.1" 200 OK
ap2_payment_processor      | [2025-11-01 00:53:02,002] INFO in httpx: HTTP Request: POST http://credential_provider:8003/receipts "HTTP/1.1 200 OK"
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:02.002391Z", "level": "INFO", "logger": "processor", "message": "HTTP Response: 200 (18.91ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:02.002429Z", "level": "DEBUG", "logger": "processor", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:53:01 GMT\", \"server\": \"uvicorn\", \"content-length\": \"97\", \"content-type\": \"application/json\"}, \"body\": {\"status\": \"received\", \"message\": \"Receipt stored successfully\", \"transaction_id\": \"txn_fbd3ca2e4c30\"}, \"duration_ms\": 18.909454345703125}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:02.002495Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Receipt notification sent successfully: transaction_id=txn_fbd3ca2e4c30, status=200", "module": "processor", "function": "_send_receipt_to_credential_provider", "line": 971}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:02.002549Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2Aå‡¦ç†] ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Œäº†: type=ap2.mandates.PaymentMandate, result_type=ap2.responses.PaymentResult", "module": "a2a_handler", "function": "handle_message", "line": 336}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:02.003720Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: payment_processor, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 841}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:02.003782Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 521, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.responses.PaymentResult\",\"id\":\"8e3b8144-9392-497c-ab2c-07b794404730\",\"payload\":{\"receipt_url\":\"http://localhost:8004/receipts/txn_fbd3ca2e4c30.pdf\",\"status\":\"captured\",\"trans", "module": "crypto", "function": "sign_a2a_message", "line": 845}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:02.003805Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: payment_processor, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 640}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:02.008564Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: payment_processor) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:02.009752Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:merchant_agent: ap2.responses.PaymentResult", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_payment_processor      | {"timestamp": "2025-11-01T00:53:02.009801Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.responses.PaymentResult\", \"peer\": \"did:ap2:agent:merchant_agent\", \"headers\": {\"message_id\": \"37979a9d-2d4f-48ac-b743-8a8376a785bc\", \"sender\": \"did:ap2:agent:payment_processor\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-01T00:53:02.002883Z\", \"nonce\": \"fd84a61db58fca23ff9b7810a2dcf81f184d4a1ba9fe13b5c080eef4097a6896\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"transaction_id\": \"txn_fbd3ca2e4c30\", \"status\": \"captured\", \"receipt_url\": \"http://localhost:8004/receipts/txn_fbd3ca2e4c30.pdf\"}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_payment_processor      | [2025-11-01 00:53:02,009] INFO in v2.common.base_agent: [Payment Processor] A2Aãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´: type=ap2.responses.PaymentResult, to=did:ap2:agent:merchant_agent
ap2_payment_processor      | INFO:     172.18.0.5:37002 - "POST /a2a/message HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:02.019809Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (866.88ms)", "module": "logger", "function": "log_http_response", "line": 215}


ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:02.017770Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (831.86ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:02.019856Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:53:00 GMT\", \"server\": \"uvicorn\", \"content-length\": \"985\", \"content-type\": \"application/json\"}, \"body\": {\"header\": {\"message_id\": \"530783cb-a486-4d6a-93f3-aa408f31d31b\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:shopping_agent\", \"timestamp\": \"2025-11-01T00:53:02.018098Z\", \"nonce\": \"e48d19eea3894fce5b1bea061652220670369689c547cc54ad75f264022fc1c5\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"hKw2Kb8r/VhU4NABr/r3nhbe/xfNJb9c8rmgG0bBf+D8wnIeNbBRBJ2Ih6RCwn6+03qXHfvhY6TjXndKkWp6DQ==\", \"publicKey\": \"LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUNvd0JRWURLMlZ3QXlFQTZHQmRVRllXaHBZcUNtdjVUMGFsTGg3ckt4TzlHTkZLdnRabU5keWUyQk09Ci0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLQo=\", \"kid\": \"did:ap2:agent:merchant_agent#key-2\", \"created\": \"2025-11-01T00:53:02.018098Z\", \"proofPurpose\": \"authentication\"}, \"signature\": null}, \"dataPart\": {\"@type\": \"ap2.responses.PaymentResult\", \"id\": \"8e3b8144-9392-497c-ab2c-07b794404730\", \"payload\": {\"transaction_id\": \"txn_fbd3ca2e4c30\", \"status\": \"captured\", \"receipt_url\": \"http://localhost:8004/receipts/txn_fbd3ca2e4c30.pdf\"}, \"kind\": null, \"artifact\": null}}, \"duration_ms\": 866.8839931488037}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-01 00:53:02,020] INFO in services.shopping_agent.utils.merchant_integration:



ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:02.017839Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sat, 01 Nov 2025 00:53:00 GMT\", \"server\": \"uvicorn\", \"content-length\": \"991\", \"content-type\": \"application/json\"}, \"body\": {\"header\": {\"message_id\": \"37979a9d-2d4f-48ac-b743-8a8376a785bc\", \"sender\": \"did:ap2:agent:payment_processor\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-01T00:53:02.002883Z\", \"nonce\": \"fd84a61db58fca23ff9b7810a2dcf81f184d4a1ba9fe13b5c080eef4097a6896\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"urOHAI+w5bo9bLf/vbOag5L7jJdXqeUgO9K8xnOFOhp2gKkLZnLmY0Mh9v8SaBibwVFuIUUHsUztOq8ttEsoCA==\", \"publicKey\": \"LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUNvd0JRWURLMlZ3QXlFQWYrMEZBcWlPZ3hXYTVFL3BRYU5XUXdMRnQ3cmtZeHlMSS9FUmpZakUzY2s9Ci0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLQo=\", \"kid\": \"did:ap2:agent:payment_processor#key-2\", \"created\": \"2025-11-01T00:53:02.002883Z\", \"proofPurpose\": \"authentication\"}, \"signature\": null}, \"dataPart\": {\"@type\": \"ap2.responses.PaymentResult\", \"id\": \"8e3b8144-9392-497c-ab2c-07b794404730\", \"payload\": {\"transaction_id\": \"txn_fbd3ca2e4c30\", \"status\": \"captured\", \"receipt_url\": \"http://localhost:8004/receipts/txn_fbd3ca2e4c30.pdf\"}, \"kind\": null, \"artifact\": null}}, \"duration_ms\": 831.8583965301514}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | ================================================================================




ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:02.017989Z", "level": "INFO", "logger": "handlers.payment_handler", "message": "\n================================================================================\n[MerchantAgent â† PaymentProcessor] A2Aãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡\n  Status: 200\n  Response Body: {\n  \"header\": {\n    \"message_id\": \"37979a9d-2d4f-48ac-b743-8a8376a785bc\",\n    \"sender\": \"did:ap2:agent:payment_processor\",\n    \"recipient\": \"did:ap2:agent:merchant_agent\",\n    \"timestamp\": \"2025-11-01T00:53:02.002883Z\",\n    \"nonce\": \"fd84a61db58fca23ff9b7810a2dcf81f184d4a1ba9fe13b5c080eef4097a6896\",\n    \"schema_version\": \"0.2\",\n    \"proof\": {\n      \"algorithm\": \"ed25519\",\n      \"signatureValue\": \"urOHAI+w5bo9bLf/vbOag5L7jJdXqeUgO9K8xnOFOhp2gKkLZnLmY0Mh9v8SaBibwVFuIUUHsUztOq8ttEsoCA==\",\n      \"publicKey\": \"LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUNvd0JRWURLMlZ3QXlFQWYrMEZBcWlPZ3hXYTVFL3BRYU5XUXdMRnQ3cmtZeHlMSS9FUmpZakUzY2s9Ci0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLQo=\",\n   \"kid\": \"did:ap2:agent:payment_processor#key-2\",\n      \"created\": \"2025-11-01T00:53:02.002883Z\",\n      \"proofPurpose\": \"authentication\"\n    },\n    \"signature\": null\n  },\n  \"dataPart\": {\n    \"@type\": \"ap2.responses.PaymentResult\",\n    \"id\": \"8e3b8144-9392-497c-ab2c-07b794404730\",\n    \"payload\": {\n      \"transaction_id\": \"txn_fbd3ca2e4c30\",\n      \"status\": \"captured\",\n      \"receipt_url\": \"http://localhost:8004/receipts/txn_fbd3ca2e4c30.pdf\"\n    },\n    \"kind\": null,\n    \"artifact\": null\n  }\n}\n================================================================================", "module": "payment_handler", "function": "handle_payment_request", "line": 86}


ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:02.018019Z", "level": "INFO", "logger": "handlers.payment_handler", "message": "[MerchantAgent] Payment processing completed, forwarding result to Shopping Agent", "module": "payment_handler", "function": "handle_payment_request", "line": 101}
ap2_shopping_agent         |   Status: 200
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:02.018071Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2Aå‡¦ç†] ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Œäº†: type=ap2.mandates.PaymentMandate, result_type=ap2.responses.PaymentResult", "module": "a2a_handler", "function": "handle_message", "line": 336}


ap2_shopping_agent         |   Response Type: ap2.responses.PaymentResult

ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:02.018174Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 841}
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:02.018235Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 518, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.responses.PaymentResult\",\"id\":\"8e3b8144-9392-497c-ab2c-07b794404730\",\"payload\":{\"receipt_url\":\"http://localhost:8004/receipts/txn_fbd3ca2e4c30.pdf\",\"status\":\"captured\",\"trans", "module": "crypto", "function": "sign_a2a_message", "line": 845}
ap2_shopping_agent         | ================================================================================
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:02.018252Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 640}
ap2_shopping_agent         | [2025-11-01 00:53:02,020] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Payment processing completed: status=captured


ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:02.018378Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: merchant_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}




ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:02.018403Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:shopping_agent: ap2.responses.PaymentResult", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_shopping_agent         | [2025-11-01 00:53:02,020] INFO in services.shopping_agent.langgraph_shopping_flow: [execute_payment_node] Payment successful: status=captured, transaction_id=txn_fbd3ca2e4c30
ap2_merchant_agent         | {"timestamp": "2025-11-01T00:53:02.018425Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.responses.PaymentResult\", \"peer\": \"did:ap2:agent:shopping_agent\", \"headers\": {\"message_id\": \"530783cb-a486-4d6a-93f3-aa408f31d31b\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:shopping_agent\", \"timestamp\": \"2025-11-01T00:53:02.018098Z\", \"nonce\": \"e48d19eea3894fce5b1bea061652220670369689c547cc54ad75f264022fc1c5\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"transaction_id\": \"txn_fbd3ca2e4c30\", \"status\": \"captured\", \"receipt_url\": \"http://localhost:8004/receipts/txn_fbd3ca2e4c30.pdf\"}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | [2025-11-01 00:53:02,018] INFO in v2.common.base_agent: [Merchant Agent] A2Aãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´: type=ap2.responses.PaymentResult, to=did:ap2:agent:shopping_agent
ap2_merchant_agent         | INFO:     172.18.0.9:55046 - "POST /a2a/message HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:02.121911Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=completed", "module": "agent", "function": "_update_session", "line": 1978}
ap2_shopping_agent         | {"timestamp": "2025-11-01T00:53:02.126882Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1761958169365_f3l0q, step=completed", "module": "agent", "function": "_update_session", "line": 1978}