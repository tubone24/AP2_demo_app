Attaching to ap2_credential_provider, ap2_credential_provider_2, ap2_frontend, ap2_init_keys, ap2_init_seeds, ap2_jaeger, ap2_meilisearch, ap2_merchant, ap2_merchant_agent, ap2_merchant_agent_mcp, ap2_payment_network, ap2_payment_processor, ap2_redis, ap2_shopping_agent, ap2_shopping_agent_mcp
ap2_meilisearch  |
ap2_meilisearch  | 888b     d888          d8b 888 d8b                                            888
ap2_meilisearch  | 8888b   d8888          Y8P 888 Y8P                                            888
ap2_meilisearch  | 88888b.d88888              888                                                888
ap2_meilisearch  | 888Y88888P888  .d88b.  888 888 888 .d8888b   .d88b.   8888b.  888d888 .d8888b 88888b.
ap2_meilisearch  | 888 Y888P 888 d8P  Y8b 888 888 888 88K      d8P  Y8b     "88b 888P"  d88P"    888 "88b
ap2_meilisearch  | 888  Y8P  888 88888888 888 888 888 "Y8888b. 88888888 .d888888 888    888      888  888
ap2_meilisearch  | 888   "   888 Y8b.     888 888 888      X88 Y8b.     888  888 888    Y88b.    888  888
ap2_meilisearch  | 888       888  "Y8888  888 888 888  88888P'  "Y8888  "Y888888 888     "Y8888P 888  888
ap2_meilisearch  |
ap2_meilisearch  | Config file path:    "none"
ap2_meilisearch  | Database path:               "./data.ms"
ap2_meilisearch  | Server listening on: "http://0.0.0.0:7700"
ap2_meilisearch  | Environment:         "development"
ap2_meilisearch  | Commit SHA:          "cfaac6f7ca55e91ec3cf40f8682f528cd8743562"
ap2_meilisearch  | Commit date:         "2024-11-14T15:55:14Z"
ap2_meilisearch  | Package version:     "1.11.3"
ap2_meilisearch  | Anonymous telemetry: "Disabled"
ap2_meilisearch  |
ap2_meilisearch  | A master key has been set. Requests to Meilisearch won't be authorized unless you provide an authentication key.
ap2_meilisearch  |
ap2_meilisearch  |
ap2_meilisearch  |  Meilisearch started with a master key considered unsafe for use in a production environment.
ap2_meilisearch  |
ap2_meilisearch  |  A master key of at least 16 bytes will be required when switching to a production environment.
ap2_meilisearch  |
ap2_meilisearch  |
ap2_meilisearch  | We generated a new secure master key for you (you can safely use this token):
ap2_meilisearch  |
ap2_meilisearch  | >> --master-key dg3cUJSHmbONTKxdPu26wJzOmzxRO1SHby-wD6zMVGw <<
ap2_meilisearch  |
ap2_meilisearch  | Restart Meilisearch with the argument above to use this new and secure master key.
ap2_meilisearch  |
ap2_meilisearch  | Check out Meilisearch Cloud! https://www.meilisearch.com/cloud?utm_campaign=oss&utm_source=engine&utm_medium=cli
ap2_meilisearch  | Documentation:                       https://www.meilisearch.com/docs
ap2_meilisearch  | Source code:                 https://github.com/meilisearch/meilisearch
ap2_meilisearch  | Discord:                     https://discord.meilisearch.com
ap2_meilisearch  |
ap2_meilisearch  | 2025-11-02T00:16:29.259414Z  INFO actix_server::builder: starting 8 workers
ap2_meilisearch  | 2025-11-02T00:16:29.260032Z  INFO actix_server::server: Actix runtime found; starting in Actix runtime
ap2_redis        | 1:C 02 Nov 2025 00:16:29.310 * oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
ap2_redis        | 1:C 02 Nov 2025 00:16:29.310 * Redis version=7.4.6, bits=64, commit=00000000, modified=0, pid=1, just started
ap2_redis        | 1:C 02 Nov 2025 00:16:29.311 * Configuration loaded
ap2_redis        | 1:M 02 Nov 2025 00:16:29.315 * monotonic clock: POSIX clock_gettime
ap2_redis        | 1:M 02 Nov 2025 00:16:29.333 * Running mode=standalone, port=6379.
ap2_redis        | 1:M 02 Nov 2025 00:16:29.335 * Server initialized
ap2_redis        | 1:M 02 Nov 2025 00:16:29.339 * Reading RDB base file on AOF loading...
ap2_redis        | 1:M 02 Nov 2025 00:16:29.340 * Loading RDB produced by version 7.4.6
ap2_redis        | 1:M 02 Nov 2025 00:16:29.340 * RDB age 173536 seconds
ap2_redis        | 1:M 02 Nov 2025 00:16:29.340 * RDB memory usage when created 0.94 Mb
ap2_redis        | 1:M 02 Nov 2025 00:16:29.340 * RDB is base AOF
ap2_redis        | 1:M 02 Nov 2025 00:16:29.340 * Done loading RDB, keys loaded: 0, keys expired: 0.
ap2_redis        | 1:M 02 Nov 2025 00:16:29.352 * DB loaded from base file appendonly.aof.1.base.rdb: 0.014 seconds
ap2_redis        | 1:M 02 Nov 2025 00:16:29.357 * DB loaded from incr file appendonly.aof.1.incr.aof: 0.005 seconds
ap2_redis        | 1:M 02 Nov 2025 00:16:29.357 * DB loaded from append only file: 0.019 seconds
ap2_redis        | 1:M 02 Nov 2025 00:16:29.360 * Opening AOF incr file appendonly.aof.1.incr.aof on server start
ap2_redis        | 1:M 02 Nov 2025 00:16:29.360 * Ready to accept connections tcp
ap2_jaeger       | 2025/11/02 00:16:29 maxprocs: Leaving GOMAXPROCS=8: CPU quota undefined
ap2_jaeger       |
ap2_jaeger       | *******************************************************************************
ap2_jaeger       |
ap2_jaeger       | 🛑  WARNING: End-of-life Notice for Jaeger v1
ap2_jaeger       |
ap2_jaeger       | You are currently running a v1 version of Jaeger, which is deprecated and will
ap2_jaeger       | reach end-of-life on December 31st, 2025. This means there will be no further
ap2_jaeger       | development, bug fixes, or security patches for v1 after this date.
ap2_jaeger       |
ap2_jaeger       | We strongly recommend migrating to Jaeger v2 for continued support and access
ap2_jaeger       | to new features.
ap2_jaeger       |
ap2_jaeger       | For detailed migration instructions, please refer to the official Jaeger
ap2_jaeger       | documentation:  https://www.jaegertracing.io/docs/latest/migration/
ap2_jaeger       |
ap2_jaeger       | Tracking issue: https://github.com/jaegertracing/jaeger/issues/6321
ap2_jaeger       |
ap2_jaeger       | 🛑  WARNING: End-of-life Notice for Jaeger v1
ap2_jaeger       |
ap2_jaeger       | *******************************************************************************
ap2_jaeger       | 2025/11/02 00:16:29 application version: git-commit=a204929483c734da6c54eaa75f3f7c322b3e886b, git-version=v1.74.0, build-date=2025-10-03T02:41:46Z
ap2_jaeger       | {"level":"info","ts":1762042589.641164,"caller":"flags/service.go:124","msg":"Mounting metrics handler on admin server","route":"/metrics"}
ap2_jaeger       | {"level":"info","ts":1762042589.6417134,"caller":"flags/service.go:130","msg":"Mounting expvar handler on admin server","route":"/debug/vars"}
ap2_jaeger       | {"level":"info","ts":1762042589.6911535,"caller":"flags/admin.go:106","msg":"Mounting health check on admin server","route":"/"}
ap2_jaeger       | {"level":"info","ts":1762042589.6944752,"caller":"flags/admin.go:123","msg":"Starting admin HTTP server"}
ap2_jaeger       | {"level":"info","ts":1762042589.7049143,"caller":"flags/admin.go:137","msg":"Admin server started","http.host-port":"[::]:14269","health-status":"unavailable"}
ap2_jaeger       | {"level":"info","ts":1762042589.715848,"caller":"grpc@v1.75.0/clientconn.go:176","msg":"[core] original dial target is: \"localhost:4317\""}
ap2_jaeger       | {"level":"info","ts":1762042589.7203956,"caller":"grpc@v1.75.0/clientconn.go:459","msg":"[core] [Channel #1]Channel created"}
ap2_jaeger       | {"level":"info","ts":1762042589.7204716,"caller":"grpc@v1.75.0/clientconn.go:207","msg":"[core] [Channel #1]parsed dial target is: resolver.Target{URL:url.URL{Scheme:\"dns\", Opaque:\"\", User:(*url.Userinfo)(nil), Host:\"\", Path:\"/localhost:4317\", RawPath:\"\", OmitHost:false, ForceQuery:false, RawQuery:\"\", Fragment:\"\", RawFragment:\"\"}}"}
ap2_jaeger       | {"level":"info","ts":1762042589.7204876,"caller":"grpc@v1.75.0/clientconn.go:208","msg":"[core] [Channel #1]Channel authority set to \"localhost:4317\""}
ap2_jaeger       | {"level":"info","ts":1762042589.724148,"caller":"memory/factory.go:75","msg":"Memory storage initialized","configuration":{"MaxTraces":0}}
ap2_jaeger       | {"level":"info","ts":1762042589.7662861,"caller":"grpc@v1.75.0/server.go:715","msg":"[core] [Server #2]Server created"}
ap2_jaeger       | {"level":"info","ts":1762042589.7686615,"caller":"server/grpc.go:75","msg":"Starting jaeger-collector gRPC server","grpc.host-port":"[::]:14250"}
ap2_jaeger       | {"level":"info","ts":1762042589.7687914,"caller":"server/http.go:37","msg":"Starting jaeger-collector HTTP server","host-port":":14268"}
ap2_jaeger       | {"level":"info","ts":1762042589.7696195,"caller":"app/collector.go:128","msg":"Not listening for Zipkin HTTP traffic, port not configured"}
ap2_jaeger       | {"level":"info","ts":1762042589.7733166,"caller":"handler/otlp_receiver.go:75","msg":"OTLP receiver status change","status":"StatusStarting"}
ap2_jaeger       | {"level":"info","ts":1762042589.773406,"caller":"grpc@v1.75.0/server.go:715","msg":"[core] [Server #4]Server created"}
ap2_jaeger       | {"level":"info","ts":1762042589.7734404,"caller":"otlpreceiver@v0.132.0/otlp.go:117","msg":"Starting GRPC server","endpoint":":4317"}
ap2_jaeger       | {"level":"info","ts":1762042589.77357,"caller":"otlpreceiver@v0.132.0/otlp.go:175","msg":"Starting HTTP server","endpoint":":4318"}
ap2_jaeger       | {"level":"info","ts":1762042589.7735915,"caller":"app/flags.go:168","msg":"Archive storage not initialized"}
ap2_jaeger       | {"level":"info","ts":1762042589.7905924,"caller":"grpc@v1.75.0/server.go:911","msg":"[core] [Server #4 ListenSocket #5]ListenSocket created"}
ap2_jaeger       | {"level":"info","ts":1762042589.7915006,"caller":"grpc@v1.75.0/server.go:715","msg":"[core] [Server #6]Server created"}
ap2_jaeger       | {"level":"info","ts":1762042589.7949297,"caller":"grpc@v1.75.0/server.go:911","msg":"[core] [Server #2 ListenSocket #3]ListenSocket created"}
ap2_jaeger       | {"level":"info","ts":1762042589.8050056,"caller":"app/static_handler.go:92","msg":"Using UI configuration","path":""}
ap2_jaeger       | {"level":"info","ts":1762042589.8065627,"caller":"app/server.go:258","msg":"Query server started","http_addr":"[::]:16686","grpc_addr":"[::]:16685"}
ap2_jaeger       | {"level":"info","ts":1762042589.8066204,"caller":"healthcheck/handler.go:117","msg":"Health Check state change","status":"ready"}
ap2_jaeger       | {"level":"info","ts":1762042589.8066719,"caller":"app/server.go:300","msg":"Starting GRPC server","port":16685,"addr":":16685"}
ap2_jaeger       | {"level":"info","ts":1762042589.806727,"caller":"grpc@v1.75.0/server.go:911","msg":"[core] [Server #6 ListenSocket #7]ListenSocket created"}
ap2_jaeger       | {"level":"info","ts":1762042589.8067613,"caller":"app/server.go:286","msg":"Starting HTTP server","port":16686,"addr":":16686"}
ap2_init_keys    | ================================================================================
ap2_init_keys    | AP2 エージェント キーペア初期化
ap2_init_keys    | ================================================================================
ap2_init_keys    |
ap2_init_keys    | キー保存先: /app/v2/keys
ap2_init_keys    | DID Document保存先: /app/v2/data/did_documents
ap2_init_keys    |
ap2_init_keys    | [Shopping Agent]
ap2_init_keys    |   🔑 ECDSA SECP256R1キーペアを生成中（JWT用）...
ap2_init_keys    |   🔒 ECDSA秘密鍵をAES-256-CBCで暗号化中...
ap2_init_keys    |   ✓ 秘密鍵を保存: /app/v2/keys/shopping_agent_private.pem
ap2_init_keys    |   ✓ 公開鍵を保存: /app/v2/keys/shopping_agent_public.pem
ap2_init_keys    |   🔑 Ed25519キーペアを生成中（A2A通信用）...
ap2_init_keys    |   🔒 Ed25519秘密鍵をAES-256-CBCで暗号化中...
ap2_init_keys    |   ✓ Ed25519秘密鍵を保存: /app/v2/keys/shopping_agent_ed25519_private.pem
ap2_init_keys    |   ✓ 公開鍵を保存: /app/v2/keys/shopping_agent_ed25519_public.pem
ap2_init_keys    |   📄 W3C準拠のDID Documentを生成中（ECDSA + Ed25519）...
ap2_init_keys    |   ✓ publicKeyMultibase生成: ECDSA=z2oAtKWnMsubf5MPr6Xq..., Ed25519=z6MkpL5YFLHxAcp6LSJb...
ap2_init_keys    |   ✓ DID Documentを保存: /app/v2/data/did_documents/shopping_agent_did.json
ap2_init_keys    |   ✅ 初期化完了: DID = did:ap2:agent:shopping_agent
ap2_init_keys    |
ap2_init_keys    | [Merchant Agent]
ap2_init_keys    |   🔑 ECDSA SECP256R1キーペアを生成中（JWT用）...
ap2_init_keys    |   🔒 ECDSA秘密鍵をAES-256-CBCで暗号化中...
ap2_init_keys    |   ✓ 秘密鍵を保存: /app/v2/keys/merchant_agent_private.pem
ap2_init_keys    |   ✓ 公開鍵を保存: /app/v2/keys/merchant_agent_public.pem
ap2_init_keys    |   🔑 Ed25519キーペアを生成中（A2A通信用）...
ap2_init_keys    |   🔒 Ed25519秘密鍵をAES-256-CBCで暗号化中...
ap2_init_keys    |   ✓ Ed25519秘密鍵を保存: /app/v2/keys/merchant_agent_ed25519_private.pem
ap2_init_keys    |   ✓ 公開鍵を保存: /app/v2/keys/merchant_agent_ed25519_public.pem
ap2_init_keys    |   📄 W3C準拠のDID Documentを生成中（ECDSA + Ed25519）...
ap2_init_keys    |   ✓ publicKeyMultibase生成: ECDSA=z2oAta9jvL9yuceSe7M9..., Ed25519=z6Mko44YAnz8G71TocDD...
ap2_init_keys    |   ✓ DID Documentを保存: /app/v2/data/did_documents/merchant_agent_did.json
ap2_init_keys    |   ✅ 初期化完了: DID = did:ap2:agent:merchant_agent
ap2_init_keys    |
ap2_init_keys    | [Merchant]
ap2_init_keys    |   🔑 ECDSA SECP256R1キーペアを生成中（JWT用）...
ap2_init_keys    |   🔒 ECDSA秘密鍵をAES-256-CBCで暗号化中...
ap2_init_keys    |   ✓ 秘密鍵を保存: /app/v2/keys/merchant_private.pem
ap2_init_keys    |   ✓ 公開鍵を保存: /app/v2/keys/merchant_public.pem
ap2_init_keys    |   🔑 Ed25519キーペアを生成中（A2A通信用）...
ap2_init_keys    |   🔒 Ed25519秘密鍵をAES-256-CBCで暗号化中...
ap2_init_keys    |   ✓ Ed25519秘密鍵を保存: /app/v2/keys/merchant_ed25519_private.pem
ap2_init_keys    |   ✓ 公開鍵を保存: /app/v2/keys/merchant_ed25519_public.pem
ap2_init_keys    |   📄 W3C準拠のDID Documentを生成中（ECDSA + Ed25519）...
ap2_init_keys    |   ✓ publicKeyMultibase生成: ECDSA=z2oAtRa9r3HZ27Jwfbwk..., Ed25519=z6MkkLugWrmU7dpSB6nC...
ap2_init_keys    |   ✓ DID Documentを保存: /app/v2/data/did_documents/merchant_did.json
ap2_init_keys    |   ✅ 初期化完了: DID = did:ap2:merchant:mugibo_merchant
ap2_init_keys    |
ap2_init_keys    | [Credential Provider]
ap2_init_keys    |   🔑 ECDSA SECP256R1キーペアを生成中（JWT用）...
ap2_init_keys    |   🔒 ECDSA秘密鍵をAES-256-CBCで暗号化中...
ap2_init_keys    |   ✓ 秘密鍵を保存: /app/v2/keys/credential_provider_private.pem
ap2_init_keys    |   ✓ 公開鍵を保存: /app/v2/keys/credential_provider_public.pem
ap2_init_keys    |   🔑 Ed25519キーペアを生成中（A2A通信用）...
ap2_init_keys    |   🔒 Ed25519秘密鍵をAES-256-CBCで暗号化中...
ap2_init_keys    |   ✓ Ed25519秘密鍵を保存: /app/v2/keys/credential_provider_ed25519_private.pem
ap2_init_keys    |   ✓ 公開鍵を保存: /app/v2/keys/credential_provider_ed25519_public.pem
ap2_init_keys    |   📄 W3C準拠のDID Documentを生成中（ECDSA + Ed25519）...
ap2_init_keys    |   ✓ publicKeyMultibase生成: ECDSA=z2oAtR1CErJqpXEkQuK1..., Ed25519=z6MkwVCJwJ1xQAcNF91x...
ap2_init_keys    |   ✓ DID Documentを保存: /app/v2/data/did_documents/credential_provider_did.json
ap2_init_keys    |   ✅ 初期化完了: DID = did:ap2:cp:demo_cp
ap2_init_keys    |
ap2_init_keys    | [Credential Provider 2]
ap2_init_keys    |   🔑 ECDSA SECP256R1キーペアを生成中（JWT用）...
ap2_init_keys    |   🔒 ECDSA秘密鍵をAES-256-CBCで暗号化中...
ap2_init_keys    |   ✓ 秘密鍵を保存: /app/v2/keys/credential_provider_2_private.pem
ap2_init_keys    |   ✓ 公開鍵を保存: /app/v2/keys/credential_provider_2_public.pem
ap2_init_keys    |   🔑 Ed25519キーペアを生成中（A2A通信用）...
ap2_init_keys    |   🔒 Ed25519秘密鍵をAES-256-CBCで暗号化中...
ap2_init_keys    |   ✓ Ed25519秘密鍵を保存: /app/v2/keys/credential_provider_2_ed25519_private.pem
ap2_init_keys    |   ✓ 公開鍵を保存: /app/v2/keys/credential_provider_2_ed25519_public.pem
ap2_init_keys    |   📄 W3C準拠のDID Documentを生成中（ECDSA + Ed25519）...
ap2_init_keys    |   ✓ publicKeyMultibase生成: ECDSA=z2oAtoWm6qgFXgbhMJE5..., Ed25519=z6MkhA71CffHfQ5GBL7Q...
ap2_init_keys    |   ✓ DID Documentを保存: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_init_keys    |   ✅ 初期化完了: DID = did:ap2:cp:demo_cp_2
ap2_init_keys    |
ap2_init_keys    | [Payment Processor]
ap2_init_keys    |   🔑 ECDSA SECP256R1キーペアを生成中（JWT用）...
ap2_init_keys    |   🔒 ECDSA秘密鍵をAES-256-CBCで暗号化中...
ap2_init_keys    |   ✓ 秘密鍵を保存: /app/v2/keys/payment_processor_private.pem
ap2_init_keys    |   ✓ 公開鍵を保存: /app/v2/keys/payment_processor_public.pem
ap2_init_keys    |   🔑 Ed25519キーペアを生成中（A2A通信用）...
ap2_init_keys    |   🔒 Ed25519秘密鍵をAES-256-CBCで暗号化中...
ap2_init_keys    |   ✓ Ed25519秘密鍵を保存: /app/v2/keys/payment_processor_ed25519_private.pem
ap2_init_keys    |   ✓ 公開鍵を保存: /app/v2/keys/payment_processor_ed25519_public.pem
ap2_init_keys    |   📄 W3C準拠のDID Documentを生成中（ECDSA + Ed25519）...
ap2_init_keys    |   ✓ publicKeyMultibase生成: ECDSA=z2oAtUoktDNKEfsDS5hf..., Ed25519=z6Mkrp3WoDtv4hEohzav...
ap2_init_keys    |   ✓ DID Documentを保存: /app/v2/data/did_documents/payment_processor_did.json
ap2_init_keys    |   ✅ 初期化完了: DID = did:ap2:agent:payment_processor
ap2_init_keys    |
ap2_init_keys    | ================================================================================
ap2_init_keys    | ✅ 全エージェントの初期化が完了しました
ap2_init_keys    | ================================================================================
ap2_init_keys    |
ap2_init_keys    | 次のステップ:
ap2_init_keys    |   1. docker-compose up -d でサービスを起動
ap2_init_keys    |   2. 各エージェントはキーを永続化ストレージから読み込みます
ap2_init_keys    |   3. DIDは再起動後も一貫して維持されます
ap2_init_keys    |
ap2_init_keys exited with code 0
ap2_init_seeds   | ================================================================================
ap2_init_seeds   | AP2 シードデータ投入 (AP2完全準拠)
ap2_init_seeds   | ================================================================================
ap2_init_seeds   |
ap2_init_seeds   | データ保存先: /app/v2/data
ap2_init_seeds   |
ap2_init_seeds   | AP2完全準拠のため、以下のデータのみ投入します：
ap2_init_seeds   |   ✅ 商品データ: Merchantが管理
ap2_init_seeds   |   ⚠️  ユーザーデータ: Passkey登録時に自動作成（フロントエンド）
ap2_init_seeds   |   ⚠️  支払い方法: Passkey登録後、ユーザーが登録（セキュリティ要件）
ap2_init_seeds   |
ap2_init_seeds   | [商品データ投入]
ap2_init_seeds   | データベース: sqlite+aiosqlite:////app/v2/data/merchant_agent.db
ap2_init_seeds   |   ✅ 作成: むぎぼーアクリルキーホルダー (¥800)
ap2_init_seeds   |   ✅ 作成: むぎぼー時計 (¥3500)
ap2_init_seeds   |   ✅ 作成: むぎぼーカレンダー (¥1500)
ap2_init_seeds   |   ✅ 作成: むぎぼーマグカップ (¥1200)
ap2_init_seeds   |   ✅ 作成: むぎぼーステッカー (¥500)
ap2_init_seeds   |   ✅ 作成: むぎぼーTシャツ (¥2800)
ap2_init_seeds   |   ✅ 作成: むぎぼートートバッグ (¥1800)
ap2_init_seeds   |   ✅ 作成: むぎぼーポーチ (¥950)
ap2_init_seeds   |   ✅ 作成: むぎぼーぬいぐるみ（S） (¥2200)
ap2_init_seeds   |   ✅ 作成: むぎぼーぬいぐるみ（L） (¥4800)
ap2_init_seeds   |   ✅ 作成: むぎぼーキャップ (¥2000)
ap2_init_seeds   |   ✅ 作成: むぎぼークッション (¥2500)
ap2_init_seeds   |   ✅ 作成: むぎぼーノート (¥700)
ap2_init_seeds   |   ✅ 作成: むぎぼーボールペン (¥600)
ap2_init_seeds   |   ✅ 作成: むぎぼーウォーターボトル (¥2400)
ap2_init_seeds   |   ✅ 作成: むぎぼー靴下 (¥850)
ap2_init_seeds   |   ✅ 作成: むぎぼーマウスパッド (¥900)
ap2_init_seeds   |   ✅ 作成: むぎぼースマホケース (¥1800)
ap2_init_seeds   |   ✅ 作成: むぎぼー折りたたみ傘 (¥2600)
ap2_init_seeds   |   ✅ 作成: むぎぼーエコバッグ (¥1200)
ap2_init_seeds   |   ✅ 作成: むぎぼーブランケット (¥3200)
ap2_init_seeds   |   ✅ 作成: むぎぼープレート皿 (¥1900)
ap2_init_seeds   |   ✅ 作成: むぎぼーパーカー (¥4500)
ap2_init_seeds   |   ✅ 作成: むぎぼーフェイスタオル (¥1300)
ap2_init_seeds   |   ✅ 作成: むぎぼーアロマキャンドル (¥2100)
ap2_init_seeds   |   ✅ 作成: むぎぼー抱き枕 (¥5500)
ap2_init_seeds   |   ✅ 作成: むぎぼーポスター (¥900)
ap2_init_seeds   |   ✅ 作成: むぎぼーニット帽 (¥1800)
ap2_init_seeds   |   ✅ 商品データ投入完了 (28件)
ap2_init_seeds   |
ap2_init_seeds   | ================================================================================
ap2_init_seeds   | ✅ 商品データの投入が完了しました (AP2完全準拠)
ap2_init_seeds   | ================================================================================
ap2_init_seeds   |
ap2_init_seeds   | 投入データサマリ:
ap2_init_seeds   |   - 商品: 28件 (merchant_agent.db)
ap2_init_seeds   |
ap2_init_seeds   | 次のステップ:
ap2_init_seeds   |   1. フロントエンド (http://localhost:3000) にアクセス
ap2_init_seeds   |   2. ユーザー登録 (/auth/register)
ap2_init_seeds   |   3. Passkey登録 (/auth/register-passkey)
ap2_init_seeds   |   4. 支払い方法登録（Passkey登録後に自動表示）
ap2_init_seeds   |
ap2_init_seeds exited with code 0
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-02T00:16:35.885111Z", "level": "INFO", "logger": "common.search_engine", "message": "[MeilisearchClient] Initialized: http://meilisearch:7700, index=products", "module": "search_engine", "function": "__init__", "line": 38}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-02T00:16:35.893733Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Initialized: merchant_agent_mcp v1.0.0", "module": "mcp_server", "function": "__init__", "line": 90}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-02T00:16:35.894112Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: search_products", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-02T00:16:35.894289Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: check_inventory", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-02T00:16:35.894354Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_cart_mandates", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:37.760320Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Initialized: shopping_agent_mcp v1.0.0", "module": "mcp_server", "function": "__init__", "line": 90}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:37.772503Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_intent_mandate", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:37.772692Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: request_cart_candidates", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:37.772782Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: select_and_sign_cart", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:37.772910Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: assess_payment_risk", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:37.773170Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_payment_mandate", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:37.773922Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: execute_payment", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-02T00:16:37.865151Z", "level": "INFO", "logger": "common.search_engine", "message": "[MeilisearchClient] Initialized: http://meilisearch:7700, index=products", "module": "search_engine", "function": "__init__", "line": 38}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-02T00:16:37.879635Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Initialized: merchant_agent_mcp v1.0.0", "module": "mcp_server", "function": "__init__", "line": 90}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-02T00:16:37.880174Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: search_products", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-02T00:16:37.880218Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: check_inventory", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-02T00:16:37.880244Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_cart_mandates", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | INFO:     Started server process [1]
ap2_merchant_agent_mcp  | INFO:     Waiting for application startup.
ap2_merchant_agent_mcp  | INFO:     Application startup complete.
ap2_merchant_agent_mcp  | INFO:     Uvicorn running on http://0.0.0.0:8011 (Press CTRL+C to quit)
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:39.680163Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Initialized: shopping_agent_mcp v1.0.0", "module": "mcp_server", "function": "__init__", "line": 90}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:39.682658Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_intent_mandate", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:39.682831Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: request_cart_candidates", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:39.682908Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: select_and_sign_cart", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:39.682974Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: assess_payment_risk", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:39.683044Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_payment_mandate", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:39.683107Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: execute_payment", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | INFO:     Started server process [1]
ap2_shopping_agent_mcp  | INFO:     Waiting for application startup.
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:39.749018Z", "level": "INFO", "logger": "main", "message": "[Shopping Agent MCP] Starting up...", "module": "main", "function": "lifespan", "line": 404}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:41.932018Z", "level": "INFO", "logger": "main", "message": "[Shopping Agent MCP] Database initialized", "module": "main", "function": "lifespan", "line": 408}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:41.999363Z", "level": "INFO", "logger": "main", "message": "[Startup] KeyManager initialized with keys_directory=/app/v2/keys", "module": "main", "function": "lifespan", "line": 415}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:41.999636Z", "level": "INFO", "logger": "main", "message": "[Startup] Extracted key_id=shopping_agent from AGENT_ID=did:ap2:agent:shopping_agent", "module": "main", "function": "lifespan", "line": 419}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:42.000336Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:42.042493Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:42.042579Z", "level": "INFO", "logger": "main", "message": "[Startup] ED25519 private key loaded for shopping_agent", "module": "main", "function": "lifespan", "line": 425}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:42.042621Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:42.050905Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:42.050986Z", "level": "INFO", "logger": "main", "message": "[Startup] ECDSA private key loaded for shopping_agent", "module": "main", "function": "lifespan", "line": 433}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:42.051063Z", "level": "INFO", "logger": "main", "message": "[Startup] SignatureManager initialized", "module": "main", "function": "lifespan", "line": 443}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:42.092941Z", "level": "INFO", "logger": "main", "message": "[Startup] A2AMessageHandler initialized with key_id: shopping_agent", "module": "main", "function": "lifespan", "line": 451}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:42.093276Z", "level": "INFO", "logger": "main", "message": "[Startup] RiskAssessmentEngine initialized", "module": "main", "function": "lifespan", "line": 455}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T00:16:42.093333Z", "level": "INFO", "logger": "main", "message": "[Shopping Agent MCP] Startup complete", "module": "main", "function": "lifespan", "line": 457}
ap2_shopping_agent_mcp  | INFO:     Application startup complete.
ap2_shopping_agent_mcp  | INFO:     Uvicorn running on http://0.0.0.0:8010 (Press CTRL+C to quit)
ap2_frontend            |    ▲ Next.js 15.5.5
ap2_frontend            |    - Local:        http://localhost:3000
ap2_frontend            |    - Network:      http://0.0.0.0:3000
ap2_frontend            |
ap2_frontend            |  ✓ Starting...
ap2_frontend            |  ✓ Ready in 862ms
ap2_payment_network     | [2025-11-02 00:16:51,943] INFO in network: [DemoPaymentNetwork] Payment Network Service initialized
ap2_payment_network     |   Redis URL: redis://redis:6379/2
ap2_payment_network     |   Token Store: RedisベースのKVストア（TTL管理対応）
ap2_payment_network     | [2025-11-02 00:16:52,983] INFO in network: [DemoPaymentNetwork] Payment Network Service initialized
ap2_payment_network     |   Redis URL: redis://redis:6379/2
ap2_payment_network     |   Token Store: RedisベースのKVストア（TTL管理対応）
ap2_payment_network     | INFO:     Started server process [1]
ap2_payment_network     | INFO:     Waiting for application startup.
ap2_payment_network     | INFO:     Application startup complete.
ap2_payment_network     | INFO:     Uvicorn running on http://0.0.0.0:8005 (Press CTRL+C to quit)
ap2_merchant            | [2025-11-02 00:16:56,023] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_merchant            | [2025-11-02 00:16:56,024] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_merchant            |   Service Name: merchant
ap2_merchant            |   OTLP Endpoint: http://jaeger:4317
ap2_merchant            |   Insecure: True
ap2_merchant            | [2025-11-02 00:16:56,281] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: merchant
ap2_merchant            | [2025-11-02 00:16:56,289] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant            | [2025-11-02 00:16:56,290] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant'. Adding OTLP exporter to existing provider.
ap2_merchant            | [2025-11-02 00:16:56,304] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant            | [2025-11-02 00:16:56,314] INFO in v2.common.base_agent: [Merchant] OpenTelemetry distributed tracing enabled (service: merchant, manual instrumentation only)
ap2_merchant            | {"timestamp": "2025-11-02T00:16:56.576343Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_merchant            | [2025-11-02 00:16:56,683] INFO in v2.common.base_agent: [Merchant] ✓ ECDSA鍵を読み込みました: merchant
ap2_merchant            | {"timestamp": "2025-11-02T00:16:56.683792Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_merchant            | {"timestamp": "2025-11-02T00:16:56.684027Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_merchant            | {"timestamp": "2025-11-02T00:16:56.729123Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_merchant            | [2025-11-02 00:16:56,729] INFO in v2.common.base_agent: [Merchant] ✓ Ed25519鍵を読み込みました: merchant
ap2_merchant            | [2025-11-02 00:16:56,737] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_merchant            | [2025-11-02 00:16:56,761] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_merchant            | [2025-11-02 00:16:56,762] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant            | [2025-11-02 00:16:56,775] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_merchant            | [2025-11-02 00:16:56,775] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_did.json
ap2_merchant            | [2025-11-02 00:16:56,781] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_merchant            | [2025-11-02 00:16:56,782] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_merchant            | [2025-11-02 00:16:56,791] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_merchant            | [2025-11-02 00:16:56,791] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_merchant            | [2025-11-02 00:16:56,798] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_merchant            | [2025-11-02 00:16:56,800] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant            | [2025-11-02 00:16:56,806] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_merchant            | {"timestamp": "2025-11-02T00:16:56.807342Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.CartMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant            | [2025-11-02 00:16:56,907] INFO in v2.common.base_agent: [Merchant] Initialized: did:ap2:merchant
ap2_payment_processor   | [2025-11-02 00:16:57,854] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_payment_processor   | [2025-11-02 00:16:57,855] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_payment_processor   |   Service Name: payment_processor
ap2_payment_processor   |   OTLP Endpoint: http://jaeger:4317
ap2_payment_processor   |   Insecure: True
ap2_payment_processor   | [2025-11-02 00:16:57,948] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: payment_processor
ap2_payment_processor   | [2025-11-02 00:16:57,950] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_payment_processor   | [2025-11-02 00:16:57,950] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='payment_processor'. Adding OTLP exporter to existing provider.
ap2_payment_processor   | [2025-11-02 00:16:57,952] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_payment_processor   | [2025-11-02 00:16:57,952] INFO in v2.common.base_agent: [Payment Processor] OpenTelemetry distributed tracing enabled (service: payment_processor, manual instrumentation only)
ap2_merchant            | {"timestamp": "2025-11-02T00:16:58.013902Z", "level": "INFO", "logger": "service", "message": "[Merchant] Initialized", "module": "service", "function": "__init__", "line": 118}
ap2_merchant            | [2025-11-02 00:16:58,017] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_payment_processor   | {"timestamp": "2025-11-02T00:16:58.041471Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: payment_processor (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_payment_processor   | {"timestamp": "2025-11-02T00:16:58.087153Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_payment_processor   | {"timestamp": "2025-11-02T00:16:58.087346Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: payment_processor (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_payment_processor   | [2025-11-02 00:16:58,087] INFO in v2.common.base_agent: [Payment Processor] ✓ ECDSA鍵を読み込みました: payment_processor
ap2_payment_processor   | {"timestamp": "2025-11-02T00:16:58.092920Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_payment_processor   | [2025-11-02 00:16:58,092] INFO in v2.common.base_agent: [Payment Processor] ✓ Ed25519鍵を読み込みました
: payment_processor
ap2_payment_processor   | [2025-11-02 00:16:58,093] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_payment_processor   | [2025-11-02 00:16:58,104] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_payment_processor   | [2025-11-02 00:16:58,104] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_payment_processor   | [2025-11-02 00:16:58,105] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_payment_processor   | [2025-11-02 00:16:58,105] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_did.json
ap2_payment_processor   | [2025-11-02 00:16:58,106] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_payment_processor   | [2025-11-02 00:16:58,106] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_payment_processor   | [2025-11-02 00:16:58,107] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_payment_processor   | [2025-11-02 00:16:58,107] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_payment_processor   | [2025-11-02 00:16:58,108] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_payment_processor   | [2025-11-02 00:16:58,108] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_payment_processor   | [2025-11-02 00:16:58,108] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_payment_processor   | {"timestamp": "2025-11-02T00:16:58.109187Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_payment_processor   | [2025-11-02 00:16:58,129] INFO in v2.common.base_agent: [Payment Processor] Initialized: did:ap2:agent:payment_processor
ap2_shopping_agent      | [2025-11-02 00:16:58,447] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_shopping_agent      | [2025-11-02 00:16:58,451] INFO in v2.common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_shopping_agent      |   Service Name: shopping_agent
ap2_shopping_agent      |   OTLP Endpoint: http://jaeger:4317
ap2_shopping_agent      |   Insecure: True
ap2_shopping_agent      | [2025-11-02 00:16:58,611] INFO in v2.common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: shopping_agent
ap2_shopping_agent      | [2025-11-02 00:16:58,611] INFO in v2.common.base_agent: [Shopping Agent] OpenTelemetry distributed tracing enabled (service: shopping_agent, manual instrumentation only)
ap2_merchant            | [2025-11-02 00:16:58,677] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant            | [2025-11-02 00:16:58,751] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant'. Adding OTLP exporter to existing provider.
ap2_merchant            | [2025-11-02 00:16:58,786] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant            | [2025-11-02 00:16:58,879] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant            | [2025-11-02 00:16:58,881] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant'. Adding OTLP exporter to existing provider.
ap2_merchant            | [2025-11-02 00:16:58,882] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant            | [2025-11-02 00:16:58,897] INFO in v2.common.base_agent: [Merchant] OpenTelemetry distributed tracing enabled (service: merchant, manual instrumentation only)
ap2_merchant            | {"timestamp": "2025-11-02T00:16:58.898304Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_merchant            | {"timestamp": "2025-11-02T00:16:58.928816Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_merchant            | {"timestamp": "2025-11-02T00:16:58.929288Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_merchant            | [2025-11-02 00:16:58,929] INFO in v2.common.base_agent: [Merchant] ✓ ECDSA鍵を読み込みました: merchant
ap2_merchant            | [2025-11-02 00:16:58,935] INFO in v2.common.base_agent: [Merchant] ✓ Ed25519鍵を読み込みました: merchant
ap2_merchant            | [2025-11-02 00:16:58,935] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_merchant            | {"timestamp": "2025-11-02T00:16:58.934966Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_merchant            | [2025-11-02 00:16:58,950] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_merchant            | [2025-11-02 00:16:58,950] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant            | [2025-11-02 00:16:58,960] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_merchant            | [2025-11-02 00:16:58,960] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_did.json
ap2_merchant            | [2025-11-02 00:16:58,966] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_merchant            | [2025-11-02 00:16:58,967] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_merchant            | [2025-11-02 00:16:58,979] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_merchant            | [2025-11-02 00:16:58,979] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_merchant            | [2025-11-02 00:16:58,998] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_merchant            | [2025-11-02 00:16:58,998] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant            | [2025-11-02 00:16:59,019] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_merchant            | {"timestamp": "2025-11-02T00:16:59.022929Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.CartMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | {"timestamp": "2025-11-02T00:16:59.076253Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_merchant            | [2025-11-02 00:16:59,145] INFO in v2.common.base_agent: [Merchant] Initialized: did:ap2:merchant
ap2_merchant            | {"timestamp": "2025-11-02T00:16:59.153460Z", "level": "INFO", "logger": "service", "message": "[Merchant] Initialized", "module": "service", "function": "__init__", "line": 118}
ap2_merchant            | [2025-11-02 00:16:59,168] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_merchant            | INFO:     Started server process [1]
ap2_merchant            | INFO:     Waiting for application startup.
ap2_merchant            | {"timestamp": "2025-11-02T00:16:59.186150Z", "level": "INFO", "logger": "service", "message": "[Merchant] Running startup tasks...", "module": "service", "function": "startup_event", "line": 102}
ap2_shopping_agent      | {"timestamp": "2025-11-02T00:16:59.215765Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_shopping_agent      | {"timestamp": "2025-11-02T00:16:59.218033Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_shopping_agent      | [2025-11-02 00:16:59,215] INFO in v2.common.base_agent: [Shopping Agent] ✓ ECDSA鍵を読み込みました: shopping_agent
ap2_shopping_agent      | [2025-11-02 00:16:59,229] INFO in v2.common.base_agent: [Shopping Agent] ✓ Ed25519鍵を読み込みました: shopping_agent
ap2_shopping_agent      | {"timestamp": "2025-11-02T00:16:59.229072Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_shopping_agent      | [2025-11-02 00:16:59,232] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_shopping_agent      | [2025-11-02 00:16:59,243] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_shopping_agent      | [2025-11-02 00:16:59,244] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_shopping_agent      | [2025-11-02 00:16:59,249] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_shopping_agent      | [2025-11-02 00:16:59,249] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_did.json
ap2_shopping_agent      | [2025-11-02 00:16:59,270] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_shopping_agent      | [2025-11-02 00:16:59,270] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_shopping_agent      | [2025-11-02 00:16:59,281] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_shopping_agent      | [2025-11-02 00:16:59,281] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_shopping_agent      | [2025-11-02 00:16:59,286] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_shopping_agent      | [2025-11-02 00:16:59,286] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_shopping_agent      | [2025-11-02 00:16:59,291] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_shopping_agent      | {"timestamp": "2025-11-02T00:16:59.294833Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.CartMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | {"timestamp": "2025-11-02T00:16:59.295113Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.responses.ProductList", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | {"timestamp": "2025-11-02T00:16:59.295134Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.responses.SignatureResponse", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_payment_processor   | {"timestamp": "2025-11-02T00:16:59.301254Z", "level": "INFO", "logger": "processor", "message": "[Payment Processor] Initialized", "module": "processor", "function": "__init__", "line": 102}
ap2_payment_processor   | [2025-11-02 00:16:59,311] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_shopping_agent      | [2025-11-02 00:16:59,402] INFO in v2.common.base_agent: [Shopping Agent] Initialized: did:ap2:agent:shopping_agent
ap2_shopping_agent      | [2025-11-02 00:16:59,873] INFO in v2.common.risk_assessment: [RiskAssessmentEngine] Initialized (database_mode=enabled)
ap2_payment_processor   | [2025-11-02 00:16:59,977] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_payment_processor   | [2025-11-02 00:16:59,977] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='payment_processor'. Adding OTLP exporter to existing provider.
ap2_payment_processor   | [2025-11-02 00:16:59,999] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_payment_processor   | [2025-11-02 00:17:00,000] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_payment_processor   | [2025-11-02 00:17:00,000] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='payment_processor'. Adding OTLP exporter to existing provider.
ap2_payment_processor   | [2025-11-02 00:17:00,003] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_payment_processor   | [2025-11-02 00:17:00,004] INFO in v2.common.base_agent: [Payment Processor] OpenTelemetry distributed tracing enabled (service: payment_processor, manual instrumentation only)
ap2_payment_processor   | {"timestamp": "2025-11-02T00:17:00.004884Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: payment_processor (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_payment_processor   | {"timestamp": "2025-11-02T00:17:00.021822Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_payment_processor   | {"timestamp": "2025-11-02T00:17:00.022067Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: payment_processor (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_payment_processor   | [2025-11-02 00:17:00,021] INFO in v2.common.base_agent: [Payment Processor] ✓ ECDSA鍵を読み込みました: payment_processor
ap2_payment_processor   | [2025-11-02 00:17:00,033] INFO in v2.common.base_agent: [Payment Processor] ✓ Ed25519鍵を読み込みました
: payment_processor
ap2_payment_processor   | [2025-11-02 00:17:00,033] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_payment_processor   | {"timestamp": "2025-11-02T00:17:00.033203Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_payment_processor   | [2025-11-02 00:17:00,043] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_payment_processor   | [2025-11-02 00:17:00,043] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_payment_processor   | [2025-11-02 00:17:00,052] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_payment_processor   | [2025-11-02 00:17:00,052] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/merchant_did.json
ap2_payment_processor   | [2025-11-02 00:17:00,055] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_payment_processor   | [2025-11-02 00:17:00,055] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_payment_processor   | [2025-11-02 00:17:00,059] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_payment_processor   | [2025-11-02 00:17:00,059] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_payment_processor   | [2025-11-02 00:17:00,067] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_payment_processor   | [2025-11-02 00:17:00,068] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込
み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_payment_processor   | {"timestamp": "2025-11-02T00:17:00.070111Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_payment_processor   | [2025-11-02 00:17:00,069] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_payment_processor   | [2025-11-02 00:17:00,133] INFO in v2.common.base_agent: [Payment Processor] Initialized: did:ap2:agent:payment_processor
ap2_payment_processor   | [2025-11-02 00:17:00,197] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_payment_processor   | {"timestamp": "2025-11-02T00:17:00.196654Z", "level": "INFO", "logger": "processor", "message": "[Payment Processor] Initialized", "module": "processor", "function": "__init__", "line": 102}
ap2_payment_processor   | INFO:     Started server process [1]
ap2_payment_processor   | INFO:     Waiting for application startup.
ap2_payment_processor   | {"timestamp": "2025-11-02T00:17:00.201835Z", "level": "INFO", "logger": "processor", "message": "[Payment Processor] Running startup tasks...", "module": "processor", "function": "startup_event", "line": 96}
ap2_merchant            | {"timestamp": "2025-11-02T00:17:01.295071Z", "level": "INFO", "logger": "service", "message": "[Merchant] Database initialized", "module": "service", "function": "startup_event", "line": 106}
ap2_merchant            |
ap2_merchant            | ============================================================
ap2_merchant            | 商品データ投入中...
ap2_merchant            | ============================================================
ap2_merchant            |   ✅ 作成: むぎぼーアクリルキーホルダー (¥800)
ap2_merchant            |   ✅ 作成: むぎぼー時計 (¥3,500)
ap2_merchant            |   ✅ 作成: むぎぼーカレンダー (¥1,500)
ap2_merchant            |   ✅ 作成: むぎぼーマグカップ (¥1,200)
ap2_merchant            |   ✅ 作成: むぎぼーステッカー (¥500)
ap2_merchant            |   ✅ 作成: むぎぼーTシャツ (¥2,800)
ap2_merchant            |   ✅ 作成: むぎぼートートバッグ (¥1,800)
ap2_payment_processor   | INFO:     Application startup complete.
ap2_payment_processor   | {"timestamp": "2025-11-02T00:17:03.100893Z", "level": "INFO", "logger": "processor", "message": "[Payment Processor] Database initialized", "module": "processor", "function": "startup_event", "line": 100}
ap2_payment_processor   | INFO:     Uvicorn running on http://0.0.0.0:8004 (Press CTRL+C to quit)
ap2_merchant            |   ✅ 作成: むぎぼーポーチ (¥950)
ap2_merchant            |   ✅ 作成: むぎぼーぬいぐるみ（S） (¥2,200)
ap2_merchant            |   ✅ 作成: むぎぼーぬいぐるみ（L） (¥4,800)
ap2_merchant            |   ✅ 作成: むぎぼーキャップ (¥2,000)
ap2_merchant            |   ✅ 作成: むぎぼークッション (¥2,500)
ap2_merchant            |   ✅ 作成: むぎぼーノート (¥700)
ap2_merchant            |   ✅ 作成: むぎぼーボールペン (¥600)
ap2_merchant            |   ✅ 作成: むぎぼーウォーターボトル (¥2,400)
ap2_merchant            |   ✅ 作成: むぎぼー靴下 (¥850)
ap2_merchant            |   ✅ 作成: むぎぼーマウスパッド (¥900)
ap2_merchant            |   ✅ 作成: むぎぼースマホケース (¥1,800)
ap2_merchant            |   ✅ 作成: むぎぼー折りたたみ傘 (¥2,600)
ap2_credential_provider  | [2025-11-02 00:17:04,078] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_credential_provider  | [2025-11-02 00:17:04,078] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_credential_provider  |   Service Name: credential_provider
ap2_credential_provider  |   OTLP Endpoint: http://jaeger:4317
ap2_credential_provider  |   Insecure: True
ap2_merchant             |   ✅ 作成: むぎぼーエコバッグ (¥1,200)
ap2_credential_provider  | [2025-11-02 00:17:04,227] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: credential_provider
ap2_credential_provider  | [2025-11-02 00:17:04,230] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider  | [2025-11-02 00:17:04,231] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider'. Adding OTLP exporter to existing provider.
ap2_credential_provider_2  | [2025-11-02 00:17:04,221] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_credential_provider_2  | [2025-11-02 00:17:04,221] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_credential_provider_2  |   Service Name: credential_provider_2
ap2_credential_provider_2  |   OTLP Endpoint: http://jaeger:4317
ap2_credential_provider_2  |   Insecure: True
ap2_credential_provider    | [2025-11-02 00:17:04,233] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider    | [2025-11-02 00:17:04,233] INFO in v2.common.base_agent: [Credential Provider] OpenTelemetry distributed tracing enabled (service: credential_provider, manual instrumentation only)
ap2_merchant               |   ✅ 作成: むぎぼーブランケット (¥3,200)
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:04.272536Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_credential_provider_2  | [2025-11-02 00:17:04,286] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: credential_provider_2
ap2_merchant               |   ✅ 作成: むぎぼープレート皿 (¥1,900)
ap2_credential_provider_2  | [2025-11-02 00:17:04,288] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider_2  | [2025-11-02 00:17:04,288] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider_2'. Adding OTLP exporter to existing provider.
ap2_credential_provider_2  | [2025-11-02 00:17:04,290] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider_2  | [2025-11-02 00:17:04,292] INFO in v2.common.base_agent: [Credential Provider] OpenTelemetry distributed tracing enabled (service: credential_provider_2, manual instrumentation only)
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:04.320163Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_credential_provider    | [2025-11-02 00:17:04,324] INFO in v2.common.base_agent: [Credential Provider] ✓ ECDSA鍵を読み込みまし
た: credential_provider
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:04.324278Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_credential_provider_2  | {"timestamp": "2025-11-02T00:17:04.322726Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_credential_provider    | [2025-11-02 00:17:04,334] INFO in v2.common.base_agent: [Credential Provider] ✓ Ed25519鍵を読み込みました: credential_provider
ap2_credential_provider    | [2025-11-02 00:17:04,335] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:04.334780Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_merchant               |   ✅ 作成: むぎぼーパーカー (¥4,500)
ap2_credential_provider    | [2025-11-02 00:17:04,342] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_credential_provider    | [2025-11-02 00:17:04,342] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_credential_provider_2  | [2025-11-02 00:17:04,350] INFO in v2.common.base_agent: [Credential Provider] ✓ ECDSA鍵を読み込みまし
た: credential_provider
ap2_credential_provider_2  | {"timestamp": "2025-11-02T00:17:04.350402Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_credential_provider_2  | {"timestamp": "2025-11-02T00:17:04.350540Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_credential_provider    | [2025-11-02 00:17:04,354] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_credential_provider    | [2025-11-02 00:17:04,354] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_credential_provider_2  | {"timestamp": "2025-11-02T00:17:04.356196Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_credential_provider_2  | [2025-11-02 00:17:04,356] INFO in v2.common.base_agent: [Credential Provider] ✓ Ed25519鍵を読み込みま
した: credential_provider
ap2_credential_provider_2  | [2025-11-02 00:17:04,356] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_credential_provider    | [2025-11-02 00:17:04,358] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_credential_provider    | [2025-11-02 00:17:04,358] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_credential_provider    | [2025-11-02 00:17:04,369] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_credential_provider    | [2025-11-02 00:17:04,369] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_credential_provider_2  | [2025-11-02 00:17:04,364] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_credential_provider_2  | [2025-11-02 00:17:04,365] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_credential_provider    | [2025-11-02 00:17:04,378] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_credential_provider    | [2025-11-02 00:17:04,378] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:04.384675Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:04.384744Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.AttestationRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider    | [2025-11-02 00:17:04,383] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_credential_provider_2  | [2025-11-02 00:17:04,399] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_credential_provider_2  | [2025-11-02 00:17:04,406] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_credential_provider_2  | [2025-11-02 00:17:04,441] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_credential_provider    | [2025-11-02 00:17:04,447] INFO in v2.common.base_agent: [Credential Provider] Initialized: did:ap2:agent:credential_provider
ap2_credential_provider_2  | [2025-11-02 00:17:04,441] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_credential_provider_2  | [2025-11-02 00:17:04,468] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_credential_provider_2  | [2025-11-02 00:17:04,469] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_credential_provider_2  | [2025-11-02 00:17:04,481] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_credential_provider_2  | [2025-11-02 00:17:04,485] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_credential_provider_2  | [2025-11-02 00:17:04,527] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_credential_provider_2  | {"timestamp": "2025-11-02T00:17:04.528166Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider_2  | {"timestamp": "2025-11-02T00:17:04.528327Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.AttestationRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant               |   ✅ 作成: むぎぼーフェイスタオル (¥1,300)
ap2_credential_provider_2  | [2025-11-02 00:17:04,604] INFO in v2.common.base_agent: [Credential Provider] Initialized: did:ap2:agent:credential_provider
ap2_merchant               |   ✅ 作成: むぎぼーアロマキャンドル (¥2,100)
ap2_merchant               |   ✅ 作成: むぎぼー抱き枕 (¥5,500)
ap2_merchant               |   ✅ 作成: むぎぼーポスター (¥900)
ap2_merchant               |   ✅ 作成: むぎぼーニット帽 (¥1,800)
ap2_merchant               |
ap2_merchant               | ✅ 商品データ投入完了 (28件)
ap2_merchant               |
ap2_merchant               | ============================================================
ap2_merchant               | ユーザーデータ投入中...
ap2_merchant               | ============================================================
ap2_merchant               |   ✅ 作成: 山田太郎 (yamada@example.com)
ap2_merchant               |   ✅ 作成: 佐藤花子 (sato@example.com)
ap2_merchant               |
ap2_merchant               | ✅ ユーザーデータ投入完了 (2件)
ap2_merchant               | {"timestamp": "2025-11-02T00:17:05.306627Z", "level": "INFO", "logger": "service", "message": "[Merchant] Sample data seeded successfully", "module": "service", "function": "startup_event", "line": 114}
ap2_merchant               | INFO:     Application startup complete.
ap2_merchant               | INFO:     Uvicorn running on http://0.0.0.0:8002 (Press CTRL+C to quit)
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:05.568013Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Initialized", "module": "provider", "function": "__init__", "line": 151}
ap2_credential_provider    | [2025-11-02 00:17:05,618] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_credential_provider_2  | {"timestamp": "2025-11-02T00:17:05.745588Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Initialized", "module": "provider", "function": "__init__", "line": 151}
ap2_credential_provider_2  | [2025-11-02 00:17:05,796] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_credential_provider    | [2025-11-02 00:17:06,563] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider    | [2025-11-02 00:17:06,564] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider'. Adding OTLP exporter to existing provider.
ap2_credential_provider_2  | [2025-11-02 00:17:06,559] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider_2  | [2025-11-02 00:17:06,560] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider_2'. Adding OTLP exporter to existing provider.
ap2_credential_provider_2  | [2025-11-02 00:17:06,574] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider    | [2025-11-02 00:17:06,580] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider_2  | [2025-11-02 00:17:06,582] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider_2  | [2025-11-02 00:17:06,582] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider_2'. Adding OTLP exporter to existing provider.
ap2_credential_provider_2  | [2025-11-02 00:17:06,585] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider_2  | [2025-11-02 00:17:06,585] INFO in v2.common.base_agent: [Credential Provider] OpenTelemetry distributed tracing enabled (service: credential_provider_2, manual instrumentation only)
ap2_credential_provider    | [2025-11-02 00:17:06,590] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider_2  | {"timestamp": "2025-11-02T00:17:06.597737Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}


ap2_credential_provider    | [2025-11-02 00:17:06,591] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider'. Adding OTLP exporter to existing provider.
ap2_credential_provider    | [2025-11-02 00:17:06,601] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider    | [2025-11-02 00:17:06,601] INFO in v2.common.base_agent: [Credential Provider] OpenTelemetry distributed tracing enabled (service: credential_provider, manual instrumentation only)
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:06.601757Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_credential_provider_2  | {"timestamp": "2025-11-02T00:17:06.607132Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_credential_provider_2  | {"timestamp": "2025-11-02T00:17:06.607259Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_credential_provider_2  | [2025-11-02 00:17:06,607] INFO in v2.common.base_agent: [Credential Provider] ✓ ECDSA鍵を読み込みました: credential_provider
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:06.616427Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:06.616565Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_credential_provider    | [2025-11-02 00:17:06,616] INFO in v2.common.base_agent: [Credential Provider] ✓ ECDSA鍵を読み込みました: credential_provider
ap2_credential_provider_2  | {"timestamp": "2025-11-02T00:17:06.613727Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_credential_provider_2  | [2025-11-02 00:17:06,618] INFO in v2.common.base_agent: [Credential Provider] ✓ Ed25519鍵を読み込みま
した: credential_provider
ap2_credential_provider_2  | [2025-11-02 00:17:06,620] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_credential_provider    | [2025-11-02 00:17:06,628] INFO in v2.common.base_agent: [Credential Provider] ✓ Ed25519鍵を読み込みま
した: credential_provider
ap2_credential_provider    | [2025-11-02 00:17:06,631] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:06.628786Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_credential_provider_2  | [2025-11-02 00:17:06,651] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_credential_provider_2  | [2025-11-02 00:17:06,651] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_credential_provider    | [2025-11-02 00:17:06,654] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_credential_provider    | [2025-11-02 00:17:06,655] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_credential_provider_2  | [2025-11-02 00:17:06,669] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_credential_provider_2  | [2025-11-02 00:17:06,669] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_credential_provider    | [2025-11-02 00:17:06,666] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_credential_provider    | [2025-11-02 00:17:06,668] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_credential_provider    | [2025-11-02 00:17:06,682] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_credential_provider    | [2025-11-02 00:17:06,710] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_credential_provider    | [2025-11-02 00:17:06,724] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_credential_provider    | [2025-11-02 00:17:06,725] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_credential_provider    | [2025-11-02 00:17:06,730] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_credential_provider    | [2025-11-02 00:17:06,730] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_credential_provider_2  | [2025-11-02 00:17:06,677] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_credential_provider_2  | [2025-11-02 00:17:06,728] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_credential_provider_2  | [2025-11-02 00:17:06,733] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp


ap2_credential_provider    | [2025-11-02 00:17:06,733] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_credential_provider_2  | [2025-11-02 00:17:06,733] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:06.734159Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:06.734206Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.AttestationRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider_2  | [2025-11-02 00:17:06,740] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_credential_provider_2  | [2025-11-02 00:17:06,741] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_credential_provider_2  | [2025-11-02 00:17:06,758] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_credential_provider_2  | {"timestamp": "2025-11-02T00:17:06.767213Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider_2  | {"timestamp": "2025-11-02T00:17:06.767300Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.AttestationRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider    | [2025-11-02 00:17:06,808] INFO in v2.common.base_agent: [Credential Provider] Initialized: did:ap2:agent:credential_provider
ap2_credential_provider_2  | [2025-11-02 00:17:06,819] INFO in v2.common.base_agent: [Credential Provider] Initialized: did:ap2:agent:credential_provider
ap2_credential_provider_2  | {"timestamp": "2025-11-02T00:17:06.839050Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Initialized", "module": "provider", "function": "__init__", "line": 151}
ap2_credential_provider_2  | [2025-11-02 00:17:06,839] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_credential_provider_2  | INFO:     Started server process [1]
ap2_credential_provider_2  | INFO:     Waiting for application startup.
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:06.841159Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Initialized", "module": "provider", "function": "__init__", "line": 151}
ap2_credential_provider    | [2025-11-02 00:17:06,843] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_credential_provider    | INFO:     Started server process [1]
ap2_credential_provider    | INFO:     Waiting for application startup.
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:06.845612Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Running startup tasks...", "module": "provider", "function": "startup_event", "line": 145}
ap2_credential_provider_2  | {"timestamp": "2025-11-02T00:17:06.856193Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Running startup tasks...", "module": "provider", "function": "startup_event", "line": 145}
ap2_credential_provider    | INFO:     Application startup complete.
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:07.775202Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Database initialized", "module": "provider", "function": "startup_event", "line": 149}
ap2_credential_provider    | INFO:     Uvicorn running on http://0.0.0.0:8003 (Press CTRL+C to quit)
ap2_credential_provider_2  | {"timestamp": "2025-11-02T00:17:07.823651Z", "level": "INFO", "logger": "provider", "message": "[Credential Provider] Database initialized", "module": "provider", "function": "startup_event", "line": 149}
ap2_credential_provider_2  | INFO:     Application startup complete.
ap2_credential_provider_2  | INFO:     Uvicorn running on http://0.0.0.0:8003 (Press CTRL+C to quit)
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:09.468773Z", "level": "INFO", "logger": "langgraph_merchant", "message": "[Langfuse] Tracing enabled", "module": "langgraph_merchant", "function": "<module>", "line": 83}
ap2_merchant_agent         | [2025-11-02 00:17:09,555] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant_agent         | [2025-11-02 00:17:09,556] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant_agent'. Adding OTLP exporter to existing provider.
ap2_merchant_agent         | [2025-11-02 00:17:10,254] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant_agent         | [2025-11-02 00:17:10,255] INFO in v2.common.base_agent: [Merchant Agent] OpenTelemetry distributed tracing enabled (service: merchant_agent, manual instrumentation only)
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:10.378809Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:10.495890Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:10.496824Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_merchant_agent         | [2025-11-02 00:17:10,496] INFO in v2.common.base_agent: [Merchant Agent] ✓ ECDSA鍵を読み込みました: merchant_agent
ap2_merchant_agent         | [2025-11-02 00:17:10,523] INFO in v2.common.base_agent: [Merchant Agent] ✓ Ed25519鍵を読み込みました
: merchant_agent
ap2_merchant_agent         | [2025-11-02 00:17:10,523] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:10.522978Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_merchant_agent         | [2025-11-02 00:17:10,534] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_merchant_agent         | [2025-11-02 00:17:10,541] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant_agent         | [2025-11-02 00:17:10,556] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_merchant_agent         | [2025-11-02 00:17:10,557] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_merchant_agent         | [2025-11-02 00:17:10,594] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_merchant_agent         | [2025-11-02 00:17:10,615] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_merchant_agent         | [2025-11-02 00:17:10,624] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_merchant_agent         | [2025-11-02 00:17:10,625] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:10.666547Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.IntentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:10.666697Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.ProductSearch", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:10.666749Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.CartRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:10.666902Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.CartSelection", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:10.666944Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent         | [2025-11-02 00:17:10,665] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_merchant_agent         | [2025-11-02 00:17:10,665] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant_agent         | [2025-11-02 00:17:10,666] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_merchant_agent         | [2025-11-02 00:17:10,713] INFO in v2.common.base_agent: [Merchant Agent] Initialized: did:ap2:agent:merchant_agent
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:10.955479Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Initialized (AI Mode: True)", "module": "agent", "function": "__init__", "line": 163}
ap2_shopping_agent         | [2025-11-02 00:17:10,992] INFO in services.shopping_agent.langgraph_shopping_flow: [Langfuse] Shopping Agent tracing enabled
ap2_merchant_agent         | [2025-11-02 00:17:11,466] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant_agent         | [2025-11-02 00:17:11,469] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant_agent'. Adding OTLP exporter to existing provider.
ap2_merchant_agent         | [2025-11-02 00:17:11,492] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant_agent         | [2025-11-02 00:17:11,492] INFO in v2.common.base_agent: [Merchant Agent] OpenTelemetry distributed tracing enabled (service: merchant_agent, manual instrumentation only)
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:11.500665Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_merchant_agent         | [2025-11-02 00:17:11,509] INFO in v2.common.base_agent: [Merchant Agent] ✓ ECDSA鍵を読み込みました: merchant_agent
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:11.509482Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:11.509608Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:11.516254Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_merchant_agent         | [2025-11-02 00:17:11,517] INFO in v2.common.base_agent: [Merchant Agent] ✓ Ed25519鍵を読み込みました
: merchant_agent
ap2_merchant_agent         | [2025-11-02 00:17:11,519] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_merchant_agent         | [2025-11-02 00:17:11,531] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_merchant_agent         | [2025-11-02 00:17:11,531] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_merchant_agent         | [2025-11-02 00:17:11,533] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_merchant_agent         | [2025-11-02 00:17:11,533] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_merchant_agent         | [2025-11-02 00:17:11,539] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_merchant_agent         | [2025-11-02 00:17:11,540] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_merchant_agent         | [2025-11-02 00:17:11,546] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_merchant_agent         | [2025-11-02 00:17:11,546] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_merchant_agent         | [2025-11-02 00:17:11,586] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_merchant_agent         | [2025-11-02 00:17:11,586] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:11.593099Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.IntentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:11.593143Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.ProductSearch", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:11.593164Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.CartRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:11.593403Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.CartSelection", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:11.593421Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent         | [2025-11-02 00:17:11,592] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_merchant_agent         | [2025-11-02 00:17:11,634] INFO in v2.common.base_agent: [Merchant Agent] Initialized: did:ap2:agent:merchant_agent
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:11.661284Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Initialized (AI Mode: True)", "module": "agent", "function": "__init__", "line": 163}
ap2_merchant_agent         | INFO:     Started server process [1]
ap2_merchant_agent         | INFO:     Waiting for application startup.
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:11.665279Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Running startup tasks...", "module": "agent", "function": "startup_event", "line": 111}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:11.756679Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Database initialized", "module": "agent", "function": "startup_event", "line": 115}
ap2_merchant_agent         |
ap2_merchant_agent         | ============================================================
ap2_merchant_agent         | 商品データ投入中...
ap2_merchant_agent         | ============================================================
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーアクリルキーホルダー (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼー時計 (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーカレンダー (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーマグカップ (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーステッカー (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーTシャツ (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼートートバッグ (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーポーチ (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーぬいぐるみ（S） (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーぬいぐるみ（L） (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーキャップ (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼークッション (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーノート (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーボールペン (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーウォーターボトル (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼー靴下 (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーマウスパッド (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼースマホケース (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼー折りたたみ傘 (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーエコバッグ (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーブランケット (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼープレート皿 (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーパーカー (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーフェイスタオル (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーアロマキャンドル (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼー抱き枕 (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーポスター (既存)
ap2_merchant_agent         |   ⏭️  スキップ: むぎぼーニット帽 (既存)
ap2_merchant_agent         |
ap2_merchant_agent         | ✅ 商品データ投入完了 (28件)
ap2_merchant_agent         |
ap2_merchant_agent         | ============================================================
ap2_merchant_agent         | ユーザーデータ投入中...
ap2_merchant_agent         | ============================================================
ap2_merchant_agent         |   ✅ 作成: 山田太郎 (yamada@example.com)
ap2_merchant_agent         |   ✅ 作成: 佐藤花子 (sato@example.com)
ap2_merchant_agent         |
ap2_merchant_agent         | ✅ ユーザーデータ投入完了 (2件)
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:12.296730Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Sample data seeded successfully", "module": "agent", "function": "startup_event", "line": 121}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:12.297960Z", "level": "INFO", "logger": "v2.common.search_engine", "message": "[MeilisearchClient] Initialized: http://meilisearch:7700, index=products", "module": "search_engine", "function": "__init__", "line": 38}
ap2_meilisearch            | 2025-11-02T00:17:12.759311Z  INFO HTTP request{method=POST host="meilisearch:7700" route=/indexes query_parameters= user_agent=python-httpx/0.28.1 status_code=202}: meilisearch: close time.busy=13.8ms time.idle=18.1ms
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:12.777651Z", "level": "INFO", "logger": "v2.common.search_engine", "message": "[MeilisearchClient] Index already exists: products", "module": "search_engine", "function": "create_index", "line": 65}
ap2_meilisearch            | 2025-11-02T00:17:12.781184Z ERROR index_scheduler: Batch failed Index `products` already exists.
ap2_meilisearch            | 2025-11-02T00:17:12.832879Z  INFO HTTP request{method=PATCH host="meilisearch:7700" route=/indexes/products/settings query_parameters= user_agent=python-httpx/0.28.1 status_code=202}: meilisearch: close time.busy=14.0ms time.idle=12.6ms
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:12.835565Z", "level": "INFO", "logger": "v2.common.search_engine", "message": "[MeilisearchClient] Index configured: products", "module": "search_engine", "function": "configure_index", "line": 115}
ap2_meilisearch            | 2025-11-02T00:17:12.848824Z  INFO index_scheduler: A batch of tasks was successfully completed with 1 successful tasks and 0 failed tasks.
ap2_meilisearch            | 2025-11-02T00:17:12.871109Z  INFO HTTP request{method=DELETE host="meilisearch:7700" route=/indexes/products/documents query_parameters= user_agent=python-httpx/0.28.1 status_code=202}: meilisearch: close time.busy=1.45ms time.idle=7.60ms
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:12.872865Z", "level": "INFO", "logger": "v2.common.search_engine", "message": "[MeilisearchClient] Cleared index: products", "module": "search_engine", "function": "clear_index", "line": 239}
ap2_meilisearch            | 2025-11-02T00:17:12.898162Z  INFO index_scheduler: A batch of tasks was successfully completed with 1 successful tasks and 0 failed tasks.
ap2_meilisearch            | 2025-11-02T00:17:13.001419Z  INFO HTTP request{method=POST host="meilisearch:7700" route=/indexes/products/documents query_parameters= user_agent=python-httpx/0.28.1 status_code=202}: meilisearch: close time.busy=6.25ms time.idle=31.3ms
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:13.003682Z", "level": "INFO", "logger": "v2.common.search_engine", "message": "[MeilisearchClient] Added 28 documents, taskUid=7", "module": "search_engine", "function": "add_documents", "line": 144}
ap2_merchant_agent         | [2025-11-02 00:17:13,003] INFO in utils.product_helpers: [_sync_products_to_meilisearch] Synced 28 products to Meilisearch
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:13.007808Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] Meilisearch synchronized", "module": "agent", "function": "startup_event", "line": 129}
ap2_shopping_agent         | [2025-11-02 00:17:13,203] INFO in services.shopping_agent.langgraph_shopping_flow: [LangGraph Shopping Flow] LLM initialized: ai/qwen3 at http://host.docker.internal:12434/engines/llama.cpp/v1
ap2_shopping_agent         | [2025-11-02 00:17:13,239] INFO in services.shopping_agent.langgraph_shopping_flow: [create_shopping_flow_graph] LangGraph shopping flow compiled successfully (14 nodes, AP2 compliant, with checkpointer for trace continuity)
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:13.241577Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] LangGraph shopping flow graph initialized successfully (12 nodes)", "module": "agent", "function": "__init__", "line": 241}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:13.242527Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] Initialized with database-backed risk assessment", "module": "agent", "function": "__init__", "line": 268}
ap2_shopping_agent         | [2025-11-02 00:17:13,798] INFO in v2.common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_shopping_agent         | [2025-11-02 00:17:13,799] INFO in v2.common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='shopping_agent'. Adding OTLP exporter to existing provider.
ap2_shopping_agent         | [2025-11-02 00:17:13,841] INFO in v2.common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_shopping_agent         | [2025-11-02 00:17:13,842] INFO in v2.common.base_agent: [Shopping Agent] OpenTelemetry distributed tracing enabled (service: shopping_agent, manual instrumentation only)
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:13.845662Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:13.860409Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_shopping_agent         | [2025-11-02 00:17:13,860] INFO in v2.common.base_agent: [Shopping Agent] ✓ ECDSA鍵を読み込みました: shopping_agent
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:13.861184Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:13.876647Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_shopping_agent         | [2025-11-02 00:17:13,876] INFO in v2.common.base_agent: [Shopping Agent] ✓ Ed25519鍵を読み込みました
: shopping_agent
ap2_shopping_agent         | [2025-11-02 00:17:13,878] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_shopping_agent         | [2025-11-02 00:17:13,890] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:shopping_agent
ap2_shopping_agent         | [2025-11-02 00:17:13,890] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_shopping_agent         | [2025-11-02 00:17:13,896] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:merchant_agent
ap2_shopping_agent         | [2025-11-02 00:17:13,896] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_shopping_agent         | [2025-11-02 00:17:13,898] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:merchant:mugibo_merchant
ap2_shopping_agent         | [2025-11-02 00:17:13,899] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_shopping_agent         | [2025-11-02 00:17:13,904] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp
ap2_shopping_agent         | [2025-11-02 00:17:13,904] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_shopping_agent         | [2025-11-02 00:17:13,911] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:cp:demo_cp_2
ap2_shopping_agent         | [2025-11-02 00:17:13,912] INFO in common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読
み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_shopping_agent         | [2025-11-02 00:17:13,918] INFO in common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録: did:ap2:agent:payment_processor
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:13.920103Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.CartMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:13.920529Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.responses.ProductList", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:13.920562Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.responses.SignatureResponse", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent         | [2025-11-02 00:17:13,970] INFO in v2.common.base_agent: [Shopping Agent] Initialized: did:ap2:agent:shopping_agent
ap2_shopping_agent         | [2025-11-02 00:17:14,014] INFO in v2.common.risk_assessment: [RiskAssessmentEngine] Initialized (database_mode=enabled)
ap2_shopping_agent         | [2025-11-02 00:17:14,018] INFO in services.shopping_agent.langgraph_shopping_flow: [LangGraph Shopping Flow] LLM initialized: ai/qwen3 at http://host.docker.internal:12434/engines/llama.cpp/v1
ap2_shopping_agent         | [2025-11-02 00:17:14,038] INFO in services.shopping_agent.langgraph_shopping_flow: [create_shopping_flow_graph] LangGraph shopping flow compiled successfully (14 nodes, AP2 compliant, with checkpointer for trace continuity)
ap2_shopping_agent         | INFO:     Started server process [1]
ap2_shopping_agent         | INFO:     Waiting for application startup.
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:14.038505Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] LangGraph shopping flow graph initialized successfully (12 nodes)", "module": "agent", "function": "__init__", "line": 241}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:14.038765Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] Initialized with database-backed risk assessment", "module": "agent", "function": "__init__", "line": 268}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:14.040566Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] Running startup tasks...", "module": "agent", "function": "startup_event", "line": 262}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:14.091998Z", "level": "INFO", "logger": "agent", "message": "[Shopping Agent] Database initialized", "module": "agent", "function": "startup_event", "line": 266}
ap2_shopping_agent         | INFO:     Application startup complete.
ap2_shopping_agent         | INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:14.495154Z", "level": "INFO", "logger": "langgraph_merchant", "message": "[MerchantLangGraphAgent] LLM initialized with DMR: http://host.docker.internal:12434/engines/llama.cpp/v1, model: ai/qwen3", "module": "langgraph_merchant", "function": "__init__", "line": 178}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:14.508220Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Initialized: http://merchant_agent_mcp:8011", "module": "mcp_client", "function": "__init__", "line": 65}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:14.529094Z", "level": "INFO", "logger": "langgraph_merchant", "message": "[MerchantLangGraphAgent] Initialized with LLM: ai/qwen3, MCP: http://merchant_agent_mcp:8011", "module": "langgraph_merchant", "function": "__init__", "line": 196}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:17:14.529851Z", "level": "INFO", "logger": "agent", "message": "[Merchant Agent] LangGraph AI engine initialized", "module": "agent", "function": "startup_event", "line": 143}
ap2_merchant_agent         | INFO:     Application startup complete.
ap2_merchant_agent         | INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
ap2_meilisearch            | 2025-11-02T00:17:20.156999Z  INFO index_scheduler::batch: document indexing done indexing_result=DocumentAdditionResult { indexed_documents: 28, number_of_documents: 28 } processed_in=7.161780087s
ap2_meilisearch            | 2025-11-02T00:17:20.160882Z  INFO index_scheduler: A batch of tasks was successfully completed with 1 successful tasks and 0 failed tasks.
ap2_shopping_agent         | INFO:     172.67.69.85:47402 - "OPTIONS /auth/register HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:29.811483Z", "level": "INFO", "logger": "agent", "message": "[register_user] Validating password strength for email=tubone24@example.com", "module": "agent", "function": "register_user", "line": 365}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:29.819746Z", "level": "INFO", "logger": "agent", "message": "[register_user] Hashing password for email=tubone24@example.com", "module": "agent", "function": "register_user", "line": 369}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:29.983379Z", "level": "INFO", "logger": "agent", "message": "[register_user] Password hashed successfully (length=97)", "module": "agent", "function": "register_user", "line": 371}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:30.034378Z", "level": "INFO", "logger": "agent", "message": "[register_user] Creating user with data: id=usr_cdb4ec851bcf4f73, email=tubone24@example.com, hashed_password_len=97", "module": "agent", "function": "register_user", "line": 391}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:30.056954Z", "level": "INFO", "logger": "agent", "message": "[Auth] User registered: user_id=usr_cdb4ec851bcf4f73, email=tubone24@example.com", "module": "agent", "function": "register_user", "line": 394}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:17:30.059529Z", "level": "INFO", "logger": "v2.common.auth", "message": "[Auth] Created JWT token: user_id=usr_cdb4ec851bcf4f73, expires=2025-11-03T00:17:30.057089+00:00", "module": "auth", "function": "create_access_token", "line": 173}
ap2_shopping_agent         | INFO:     172.67.69.85:47402 - "POST /auth/register HTTP/1.1" 200 OK
ap2_credential_provider    | INFO:     172.67.69.85:58558 - "OPTIONS /register/passkey/challenge HTTP/1.1" 200 OK
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:38.808349Z", "level": "INFO", "logger": "provider", "message": "[register_passkey_challenge] Generated challenge for user_id=usr_cdb4ec851bcf4f73", "module": "provider", "function": "register_passkey_challenge", "line": 264}
ap2_credential_provider    | [2025-11-02 00:17:38,810] INFO in v2.common.redis_client: [RedisClient] Connected to Redis: redis://redis:6379/0
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:38.839731Z", "level": "INFO", "logger": "provider", "message": "[register_passkey_challenge] Saved challenge to Redis KV (TTL: 60s)", "module": "provider", "function": "register_passkey_challenge", "line": 280}
ap2_credential_provider    | INFO:     172.67.69.85:29793 - "POST /register/passkey/challenge HTTP/1.1" 200 OK
ap2_credential_provider    | INFO:     172.67.69.85:48790 - "OPTIONS /register/passkey HTTP/1.1" 200 OK
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:42.498953Z", "level": "INFO", "logger": "provider", "message": "[register_passkey] Registering passkey for user: usr_cdb4ec851bcf4f73", "module": "provider", "function": "register_passkey", "line": 346}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:42.507404Z", "level": "INFO", "logger": "provider", "message": "[register_passkey] Challenge verified and deleted: mxTz93QqtmgveJEE...", "module": "provider", "function": "register_passkey", "line": 387}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:42.511926Z", "level": "INFO", "logger": "provider", "message": "[register_passkey] COSE key length: 77 bytes", "module": "provider", "function": "register_passkey", "line": 434}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:42.513038Z", "level": "INFO", "logger": "provider", "message": "[register_passkey] COSE key dict: {1: 2, 3: -7, -1: 1, -2: b'\\xe9\\xde=?z\\xeej)\\xb2\\x11\\xa5\\xee\\xd4\\xe8\\xe7s&2A?m\\x8e\\xbfY\\x9b\\xaed\\xb1\\xd2Y\\x96+', -3: b'&>\\xd4p\\xf7\\xe1\\xd0\\xc6\\x90\\xa4\\xdc@\\xe5\\xb8&\\xb5\\x93\\xd3Z/\\x18T\\xfe1\\xe0/\"\\xbe\\xaf\\x11\\x144'}", "module": "provider", "function": "register_passkey", "line": 435}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:42.513141Z", "level": "INFO", "logger": "provider", "message": "[register_passkey] Extracted public key from attestationObject", "module": "provider", "function": "register_passkey", "line": 437}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:42.615353Z", "level": "INFO", "logger": "provider", "message": "[register_passkey] User created: usr_cdb4ec851bcf4f73", "module": "provider", "function": "register_passkey", "line": 470}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:17:42.617360Z", "level": "INFO", "logger": "provider", "message": "[register_passkey] Passkey registered: dCDQdGlqx50G-UFW...", "module": "provider", "function": "register_passkey", "line": 474}
ap2_credential_provider    | INFO:     172.67.69.85:57009 - "POST /register/passkey HTTP/1.1" 200 OK
ap2_credential_provider    | INFO:     172.67.69.85:46544 - "OPTIONS /payment-methods HTTP/1.1" 200 OK
ap2_credential_provider    | {"timestamp": "2025-11-02T00:18:00.188435Z", "level": "INFO", "logger": "provider", "message": "[add_payment_method] Saved payment method to DB: pm_f4745ec2 for user: usr_cdb4ec851bcf4f73", "module": "provider", "function": "add_payment_method", "line": 710}
ap2_credential_provider    | INFO:     172.67.69.85:46544 - "POST /payment-methods HTTP/1.1" 200 OK
ap2_shopping_agent         | INFO:     172.67.69.85:28760 - "OPTIONS /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:18:03.624868Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:18:03.627110Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1762042681770_6b8nz\n  user_id: usr_cdb4ec851bcf4f73\n  user_input: a\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1102}
ap2_shopping_agent         | INFO:     172.67.69.85:28760 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:18:03.753446Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Created new session in DB: session_1762042681770_6b8nz", "module": "agent", "function": "_get_or_create_session", "line": 2009}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:18:03.753987Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1762042681770_6b8nz)", "module": "agent", "function": "event_generator", "line": 1117}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:18:03.755862Z", "level": "INFO", "logger": "agent", "message": "[Langfuse] Created new handler for session: session_1762042681770_6b8nz", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1687}
ap2_shopping_agent         | [2025-11-02 00:18:03,779] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: initial
ap2_shopping_agent         |   user_input: a
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:18:06.377997Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=ask_intent", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:18:06.387634Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=ask_intent", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:18:12.114295Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:18:12.116169Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1762042681770_6b8nz\n  user_id: usr_cdb4ec851bcf4f73\n  user_input: かわいいグッズがほしい。5000円以内\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1102}
ap2_shopping_agent         | INFO:     172.67.69.85:38358 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:18:12.121956Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1762042681770_6b8nz, step=ask_intent", "module": "agent", "function": "_get_or_create_session", "line": 1987}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:18:12.122741Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1762042681770_6b8nz)", "module": "agent", "function": "event_generator", "line": 1117}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:18:12.122973Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1762042681770_6b8nz", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1690}
ap2_shopping_agent         | [2025-11-02 00:18:12,139] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: ask_intent
ap2_shopping_agent         |   user_input: かわいいグッズがほしい。5000円以内
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-02 00:19:09,875] INFO in services.shopping_agent.langgraph_shopping_flow: [collect_intent_node] LLM result: {'intent': 'かわいいグッズを購入したい', 'max_amount': 5000, 'keywords': ['かわいい', 'グッズ']}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:19:09.876801Z", "level": "INFO", "logger": "agent", "message": "[_create_intent_mandate] Reconstructed intent: かわいいグッズを購入したい。5000円以内", "module": "agent", "function": "_create_intent_mandate", "line": 1777}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:19:09.877655Z", "level": "INFO", "logger": "agent", "message": "[_build_intent_mandate_from_session] Constructed natural_language_description: かわいいグッズを購入したい。5000円以内", "module": "agent", "function": "_build_intent_mandate_from_session", "line": 1856}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:19:09.878406Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] IntentMandate created (AP2-compliant): intent='かわいいグッズを購入したい...', expiry=2025-11-02T01:19:09.876355Z", "module": "agent", "function": "_build_intent_mandate_from_session", "line": 1868}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:19:16.520111Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=intent_complete_ask_shipping", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:19:16.523618Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=intent_complete_ask_shipping", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:36.947433Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:36.950596Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1762042681770_6b8nz\n  user_id: usr_cdb4ec851bcf4f73\n  user_input: {\"recipient\":\"あ\",\"postal_code\":\"あ\",\"city\":\"あ\",\"region\":\"あ\",\"address_line1\":\"あ\",\"country\":\"あ\"}\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1102}
ap2_shopping_agent         | INFO:     172.67.69.85:20036 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:36.958632Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1762042681770_6b8nz, step=intent_complete_ask_shipping", "module": "agent", "function": "_get_or_create_session", "line": 1987}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:36.959284Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1762042681770_6b8nz)", "module": "agent", "function": "event_generator", "line": 1117}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:36.959456Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1762042681770_6b8nz", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1690}
ap2_shopping_agent         | [2025-11-02 00:20:36,985] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: intent_complete_ask_shipping
ap2_shopping_agent         |   user_input: {"recipient":"あ","postal_code":"あ","city":"あ","region":"あ","address_line1":"あ","country":"あ"}
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-02 00:20:37,295] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] DEBUG: user_input='{"recipient":"あ","postal_code":"あ","city":"あ","region":"あ","address_line1":"あ","country":"あ"}', session['step']='select_cp', is_digit=False
ap2_shopping_agent         | [2025-11-02 00:20:37,298] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] Resolved CP from DID: did=did:ap2:cp:demo_cp, name=AP2 Demo Credential Provider, url=http://credential_provider:8003
ap2_shopping_agent         | [2025-11-02 00:20:37,298] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] Resolved CP from DID: did=did:ap2:cp:demo_cp_2, name=AP2 Demo Credential Provider 2, url=http://credential_provider_2:8003
ap2_shopping_agent         | [2025-11-02 00:20:37,298] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] AP2 Step 4: Presenting 2 Credential Providers to user
ap2_shopping_agent         |   User ID: usr_cdb4ec851bcf4f73
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:38.642121Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=select_cp", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:38.689734Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=select_cp", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.281289Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.286595Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1762042681770_6b8nz\n  user_id: usr_cdb4ec851bcf4f73\n  user_input: 1\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1102}
ap2_shopping_agent         | INFO:     172.67.69.85:25982 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.292081Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1762042681770_6b8nz, step=select_cp", "module": "agent", "function": "_get_or_create_session", "line": 1987}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.293609Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1762042681770_6b8nz)", "module": "agent", "function": "event_generator", "line": 1117}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.294021Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1762042681770_6b8nz", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1690}
ap2_shopping_agent         | [2025-11-02 00:20:39,298] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: select_cp
ap2_shopping_agent         |   user_input: 1
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-02 00:20:39,317] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] DEBUG: user_input='1', session['step']='select_cp', is_digit=True
ap2_shopping_agent         | [2025-11-02 00:20:39,317] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] Resolved CP from DID: did=did:ap2:cp:demo_cp, name=AP2 Demo Credential Provider, url=http://credential_provider:8003
ap2_shopping_agent         | [2025-11-02 00:20:39,317] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] Resolved CP from DID: did=did:ap2:cp:demo_cp_2, name=AP2 Demo Credential Provider 2, url=http://credential_provider_2:8003
ap2_shopping_agent         | [2025-11-02 00:20:39,317] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] AP2 Step 4: User selected Credential Provider
ap2_shopping_agent         |   User ID: usr_cdb4ec851bcf4f73
ap2_shopping_agent         |   CP ID: did:ap2:cp:demo_cp
ap2_shopping_agent         |   CP Name: AP2 Demo Credential Provider
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.533286Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Requesting payment methods from Credential Provider (http://credential_provider:8003) for user: usr_cdb4ec851bcf4f73", "module": "agent", "function": "_get_payment_methods_from_cp", "line": 2360}
ap2_shopping_agent         | [2025-11-02 00:20:39,532] INFO in services.shopping_agent.langgraph_shopping_flow: [get_payment_methods_node] AP2 Step 6-7: Requesting payment methods from CP
ap2_shopping_agent         |   User ID: usr_cdb4ec851bcf4f73
ap2_shopping_agent         |   CP ID: did:ap2:cp:demo_cp
ap2_shopping_agent         |   CP URL: http://credential_provider:8003
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.538860Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: GET http://credential_provider:8003/payment-methods", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.539149Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"GET\", \"url\": \"http://credential_provider:8003/payment-methods\", \"headers\": {}, \"body\": null}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:20:39.687787Z", "level": "INFO", "logger": "provider", "message": "[get_payment_methods] Retrieved 1 payment methods for user: usr_cdb4ec851bcf4f73", "module": "provider", "function": "get_payment_methods", "line": 675}
ap2_credential_provider    | INFO:     172.18.0.10:51986 - "GET /payment-methods?user_id=usr_cdb4ec851bcf4f73 HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.693120Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (154.82ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.693194Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:20:38 GMT\", \"server\": \"uvicorn\", \"content-length\": \"252\", \"content-type\": \"application/json\"}, \"body\": {\"user_id\": \"usr_cdb4ec851bcf4f73\", \"payment_methods\": [{\"id\": \"pm_f4745ec2\", \"type\": \"basic-card\", \"display_name\": \"Visaカード (****1111)\", \"brand\": \"Visa\", \"last4\": \"1111\", \"requires_step_up\": false, \"billing_address\": {\"country\": \"JP\", \"postal_code\": \"111-1111\"}}]}, \"duration_ms\": 154.82139587402344}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.693454Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Retrieved 1 payment methods from Credential Provider", "module": "agent", "function": "_get_payment_methods_from_cp", "line": 2378}
ap2_shopping_agent         | [2025-11-02 00:20:39,693] INFO in services.shopping_agent.langgraph_shopping_flow: [get_payment_methods_node] AP2 Step 7: Received 1 payment methods from CP
ap2_shopping_agent         |   Payment Methods: ['pm_f4745ec2']
ap2_shopping_agent         | [2025-11-02 00:20:39,900] INFO in services.shopping_agent.langgraph_shopping_flow: [fetch_carts_node] AP2 Step 8-12: Fetching cart candidates from Merchant Agent
ap2_shopping_agent         | [2025-11-02 00:20:39,900] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Requesting cart candidates from Merchant Agent for IntentMandate: intent_76e80f2f
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.905174Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 995}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.923689Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 797, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.IntentMandate\",\"id\":\"intent_76e80f2f\",\"payload\":{\"intent_mandate\":{\"created_at\":\"2025-11-02T00:19:09.876355Z\",\"id\":\"intent_76e80f2f\",\"intent_expiry\":\"2025-11-02T01:1", "module": "crypto", "function": "sign_a2a_message", "line": 999}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.924787Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 794}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.963363Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: shopping_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_shopping_agent         | [2025-11-02 00:20:39,967] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Intent A2A message created: message_id=ea8eb1be-3a04-4639-91b3-4da367888da2, intent_mandate_id=intent_76e80f2f
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.966929Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:merchant_agent: ap2.mandates.IntentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.967228Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.mandates.IntentMandate\", \"peer\": \"did:ap2:agent:merchant_agent\", \"headers\": {\"message_id\": \"ea8eb1be-3a04-4639-91b3-4da367888da2\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-02T00:20:39.901280Z\", \"nonce\": \"900ea5d7a2af628c6f5066f1d5e06aba36cfc3960f753c644d9dc47821d2f04b\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"intent_mandate\": {\"id\": \"intent_76e80f2f\", \"type\": \"IntentMandate\", \"user_id\": \"usr_cdb4ec851bcf4f73\", \"user_cart_confirmation_required\": true, \"natural_language_description\": \"かわいいグッズを購入したい。5000円以内\", \"requires_refundability\": false, \"intent_expiry\": \"2025-11-02T01:19:09.876355Z\", \"created_at\": \"2025-11-02T00:19:09.876355Z\"}, \"shipping_address\": {\"recipient\": \"あ\", \"postal_code\": \"あ\", \"city\": \"あ\", \"region\": \"あ\", \"address_line1\": \"あ\", \"country\": \"あ\"}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_shopping_agent         | [2025-11-02 00:20:39,967] INFO in services.shopping_agent.utils.merchant_integration:
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [ShoppingAgent → MerchantAgent] A2Aメッセージ送信
ap2_shopping_agent         |   URL: http://merchant_agent:8001/a2a/message
ap2_shopping_agent         |   メッセージID: ea8eb1be-3a04-4639-91b3-4da367888da2
ap2_shopping_agent         |   タイプ: ap2.mandates.IntentMandate
ap2_shopping_agent         |   ペイロード: {
ap2_shopping_agent         |   "id": "intent_76e80f2f",
ap2_shopping_agent         |   "type": "IntentMandate",
ap2_shopping_agent         |   "user_id": "usr_cdb4ec851bcf4f73",
ap2_shopping_agent         |   "user_cart_confirmation_required": true,
ap2_shopping_agent         |   "natural_language_description": "かわいいグッズを購入したい。5000円以内",
ap2_shopping_agent         |   "requires_refundability": false,
ap2_shopping_agent         |   "intent_expiry": "2025-11-02T01:19:09.876355Z",
ap2_shopping_agent         |   "created_at": "2025-11-02T00:19:09.876355Z"
ap2_shopping_agent         | }
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.971342Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent:8001/a2a/message", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:20:39.971414Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent:8001/a2a/message\", \"headers\": {}, \"body\": {\"header\": {\"message_id\": \"ea8eb1be-3a04-4639-91b3-4da367888da2\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-02T00:20:39.901280Z\", \"nonce\": \"900ea5d7a2af628c6f5066f1d5e06aba36cfc3960f753c644d9dc47821d2f04b\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"r1Cc0VBZgXUH/lhAvhrduiy8ygWiD2VX6LZtrufVkPmpOvwvqtUwlgqL68sGXuKNFOILNNbIp1ATCQwj9LSyAg==\", \"publicKeyMultibase\": \"z6MkpL5YFLHxAcp6LSJboXQ3nBnNGrQ4TiZRmWBZamPo7t8x\", \"kid\": \"did:ap2:agent:shopping_agent#key-2\", \"created\": \"2025-11-02T00:20:39.901280Z\", \"proofPurpose\": \"authentication\"}}, \"dataPart\": {\"@type\": \"ap2.mandates.IntentMandate\", \"id\": \"intent_76e80f2f\", \"payload\": {\"intent_mandate\": {\"id\": \"intent_76e80f2f\", \"type\": \"IntentMandate\", \"user_id\": \"usr_cdb4ec851bcf4f73\", \"user_cart_confirmation_required\": true, \"natural_language_description\": \"かわいいグッズを購入したい。5000円以内\", \"requires_refundability\": false, \"intent_expiry\": \"2025-11-02T01:19:09.876355Z\", \"created_at\": \"2025-11-02T00:19:09.876355Z\"}, \"shipping_address\": {\"recipient\": \"あ\", \"postal_code\": \"あ\", \"city\": \"あ\", \"region\": \"あ\", \"address_line1\": \"あ\", \"country\": \"あ\"}}, \"kind\": null, \"artifact\": null}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | [2025-11-02 00:20:40,146] INFO in v2.common.base_agent:
ap2_merchant_agent         | ================================================================================
ap2_merchant_agent         | [Merchant Agent] A2Aエンドポイント: POST /a2a/message
ap2_merchant_agent         |   受信メッセージ: ID=ea8eb1be-3a04-4639-91b3-4da367888da2
ap2_merchant_agent         |   送信元: did:ap2:agent:shopping_agent
ap2_merchant_agent         |   タイプ: ap2.mandates.IntentMandate
ap2_merchant_agent         | ================================================================================
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.168499Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message received to/from did:ap2:agent:shopping_agent: ap2.mandates.IntentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.171737Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"received\", \"message_type\": \"ap2.mandates.IntentMandate\", \"peer\": \"did:ap2:agent:shopping_agent\", \"headers\": {\"message_id\": \"ea8eb1be-3a04-4639-91b3-4da367888da2\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-02T00:20:39.901280Z\", \"nonce\": \"900ea5d7a2af628c6f5066f1d5e06aba36cfc3960f753c644d9dc47821d2f04b\", \"schema_version\": \"0.2\"}, \"payload\": {\"intent_mandate\": {\"id\": \"intent_76e80f2f\", \"type\": \"IntentMandate\", \"user_id\": \"usr_cdb4ec851bcf4f73\", \"user_cart_confirmation_required\": true, \"natural_language_description\": \"かわいいグッズを購入したい。5000円以内\", \"requires_refundability\": false, \"intent_expiry\": \"2025-11-02T01:19:09.876355Z\", \"created_at\": \"2025-11-02T00:19:09.876355Z\"}, \"shipping_address\": {\"recipient\": \"あ\", \"postal_code\": \"あ\", \"city\": \"あ\", \"region\": \"あ\", \"address_line1\": \"あ\", \"country\": \"あ\"}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.175025Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Nonce validation successful: nonce=900ea5d7a2af628c...", "module": "a2a_handler", "function": "verify_message_signature", "line": 156}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.223074Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Using DID-resolved public key for verification: kid=did:ap2:agent:shopping_agent#key-2", "module": "a2a_handler", "function": "verify_message_signature", "line": 190}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.237732Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying A2A message signature", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1023}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.249394Z", "level": "DEBUG", "logger": "common.crypto", "message": "[VERIFY] Canonical JSON length: 797, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.IntentMandate\",\"id\":\"intent_76e80f2f\",\"payload\":{\"intent_mandate\":{\"created_at\":\"2025-11-02T00:19:09.876355Z\",\"id\":\"intent_76e80f2f\",\"intent_expiry\":\"2025-11-02T01:1", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1027}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.249429Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying signature (algorithm: ED25519)", "module": "crypto", "function": "verify_signature", "line": 857}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.263885Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto VERIFY: ED25519 (key: did:ap2:agent:shopping_agent#key-2) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.264320Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] proof署名検証成功: sender=did:ap2:agent:shopping_agent, alg=ed25519, kid=did:ap2:agent:shopping_agent#key-2, public_key_source=DID-resolved", "module": "a2a_handler", "function": "verify_message_signature", "line": 221}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.264824Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2A処理] ハンドラー実行中: type=ap2.mandates.IntentMandate, from=did:ap2:agent:shopping_agent", "module": "a2a_handler", "function": "handle_message", "line": 299}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.267253Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Received IntentMandate", "module": "intent_handler", "function": "handle_intent_mandate", "line": 32}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.267413Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Received IntentMandate with shipping_address (AP2 v0.1 compliant)", "module": "intent_handler", "function": "handle_intent_mandate", "line": 50}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.267892Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Searching products with intent: 'かわいいグッズを購入したい。5000円以内'", "module": "intent_handler", "function": "handle_intent_mandate", "line": 54}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.267988Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Using provided shipping address: あ", "module": "intent_handler", "function": "handle_intent_mandate", "line": 71}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.268250Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Using LangGraph AI engine for cart generation", "module": "intent_handler", "function": "handle_intent_mandate", "line": 76}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.296652Z", "level": "INFO", "logger": "langgraph_merchant", "message": "[Langfuse] Created new handler for session: 674e22c2-4d3d-4d50-a972-9edb157d272d", "module": "langgraph_merchant", "function": "create_cart_candidates", "line": 289}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.423079Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: initialize", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.423159Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"initialize\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\"}, \"arguments\": {\"protocolVersion\": \"2025-03-26\", \"clientInfo\": {\"name\": \"ap2_langgraph_client\", \"version\": \"1.0.0\"}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.424784Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:40.424822Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"initialize\", \"params\": {\"protocolVersion\": \"2025-03-26\", \"clientInfo\": {\"name\": \"ap2_langgraph_client\", \"version\": \"1.0.0\"}}, \"id\": 521434}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent_mcp     | INFO:     172.18.0.8:54670 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:41.110879Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (686.10ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:41.111400Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:20:40 GMT\", \"server\": \"uvicorn\", \"mcp-session-id\": \"2ade50e5-f2ae-439c-becb-0ba97bd1a161\", \"content-length\": \"1145\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 521434, \"result\": {\"protocolVersion\": \"2025-03-26\", \"serverInfo\": {\"name\": \"merchant_agent_mcp\", \"version\": \"1.0.0\"}, \"capabilities\": {\"tools\": {\"search_products\": {\"description\": \"データベースから商品を検索\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"keywords\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"検索キーワードリスト\"}, \"limit\": {\"type\": \"integer\", \"description\": \"最大検索結果数\", \"default\": 20}}, \"required\": [\"keywords\"]}}, \"check_inventory\": {\"description\": \"在庫状況
を確認\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"product_ids\": {\"type\": \"array\", \"items\": {\"type\": \"integer\"}, \"description\": \"商品IDリスト\"}}, \"required\": [\"product_ids\"]}}, \"build_cart_mandates\": {\"description\": \"AP2準拠のCartMandateを構築（未署名）\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"cart_plan\": {\"type\": \"object\", \"description\": \"カートプラン（optimize_cartの結果）\"}, \"products\": {\"type\": \"array\", \"items\": {\"type\": \"object\"}, \"description\": \"商品情報リスト\"}, \"shipping_address\": {\"type\": \"object\", \"description\": \"AP2準拠のContactAddress\"}}, \"required\": [\"cart_plan\", \"products\"]}}}}}}, \"duration_ms\": 686.0997676849365}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:41.116043Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: initialize - SUCCESS (692.84ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:41.116270Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"initialize\", \"result\": {\"protocolVersion\": \"2025-03-26\", \"serverInfo\": {\"name\": \"merchant_agent_mcp\", \"version\": \"1.0.0\"}, \"capabilities\": {\"tools\": {\"search_products\": {\"description\": \"データベースから商品を検索\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"keywords\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"検索キーワードリスト\"}, \"limit\": {\"type\": \"integer\", \"description\": \"最大検索結果数\", \"default\": 20}}, \"required\": [\"keywords\"]}}, \"check_inventory\": {\"description\": \"在庫状況を確認\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"product_ids\": {\"type\": \"array\", \"items\": {\"type\": \"integer\"}, \"description\": \"商品IDリスト\"}}, \"required\": [\"product_ids\"]}}, \"build_cart_mandates\": {\"description\": \"AP2準拠のCartMandateを構築（未署名）\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"cart_plan\": {\"type\": \"object\", \"description\": \"カートプラン（optimize_cartの結果）\"}, \"products\": {\"type\": \"array\", \"items\": {\"type\": \"object\"}, \"description\": \"商品情報リスト\"}, \"shipping_address\": {\"type\": \"object\", \"description\": \"AP2準拠のContactAddress\"}}, \"required\": [\"cart_plan\", \"products\"]}}}}}, \"error\": null, \"duration_ms\": 692.842960357666}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:41.116297Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Initialized session: 2ade50e5-f2ae-439c-becb-0ba97bd1a161", "module": "mcp_client", "function": "initialize", "line": 88}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:41.116379Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Server capabilities: {'tools': {'search_products': {'description': 'データベースから商品を検索', 'inputSchema': {'type': 'object', 'properties': {'keywords': {'type': 'array', 'items': {'type': 'string'}, 'description': '検索キーワードリス
ト'}, 'limit': {'type': 'integer', 'description': '最大検索結果数', 'default': 20}}, 'required': ['keywords']}}, 'check_inventory': {'description': '在庫状況を確認', 'inputSchema': {'type': 'object', 'properties': {'product_ids': {'type': 'array', 'items': {'type': 'integer'}, 'description': '商品IDリスト'}}, 'required': ['product_ids']}}, 'build_cart_mandates': {'description': 'AP2準拠のCartMandateを構築（未署名）', 'inputSchema': {'type': 'object', 'properties': {'cart_plan': {'type': 'object', 'description': 'カートプラン（optimize_cartの結果）'}, 'products': {'type': 'array', 'items': {'type': 'object'}, 'description': '商品情報リスト'}, 'shipping_address': {'type': 'object', 'description': 'AP2準拠のContactAddress'}}, 'required': ['cart_plan', 'products']}}}}", "module": "mcp_client", "function": "initialize", "line": 89}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:20:41.117062Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.intent_node", "message": "[analyze_intent] MCP client initialized", "module": "intent_node", "function": "analyze_intent", "line": 35}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:40.136735Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.intent_node", "message": "[analyze_intent] LLM result: {'primary_need': 'かわいいグッズを購入したい', 'budget_strategy': 'low', 'key_factors': ['価格', 'かわいい'], 'search_keywords': ['かわいい', 'グッズ', '安価']}", "module": "intent_node", "function": "analyze_intent", "line": 124}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:40.174938Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:40.175937Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"2ade50e5-f2ae-439c-becb-0ba97bd1a161\"}, \"arguments\": {\"name\": \"search_products\", \"arguments\": {\"keywords\": [\"かわいい\", \"グッズ\", \"安価\"], \"limit\": 20}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:40.177176Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:40.177264Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"2ade50e5-f2ae-439c-becb-0ba97bd1a161\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"search_products\", \"arguments\": {\"keywords\": [\"かわいい\", \"グッズ\", \"安価\"], \"limit\": 20}}, \"id\": 387151}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent_mcp     | {"timestamp": "2025-11-02T00:21:40.257588Z", "level": "INFO", "logger": "main", "message": "[search_products] Searching with query: 'かわいい グッズ 安価'", "module": "main", "function": "search_products", "line": 123}
ap2_meilisearch            | 2025-11-02T00:21:41.032295Z  INFO HTTP request{method=POST host="meilisearch:7700" route=/indexes/products/search query_parameters= user_agent=python-httpx/0.28.1 status_code=200}: meilisearch: close time.busy=27.0ms time.idle=42.5ms
ap2_merchant_agent_mcp     | {"timestamp": "2025-11-02T00:21:41.061492Z", "level": "INFO", "logger": "common.search_engine", "message": "[MeilisearchClient] Search 'かわいい グッズ 安価' returned 6 products", "module": "search_engine", "function": "search", "line": 187}
ap2_merchant_agent_mcp     | {"timestamp": "2025-11-02T00:21:41.356529Z", "level": "INFO", "logger": "main", "message": "[search_products] Returned 6 products for keywords: ['かわいい', 'グッズ', '安価']", "module": "main", "function": "search_products", "line": 148}
ap2_merchant_agent_mcp     | INFO:     172.18.0.8:50276 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:41.386951Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (1208.60ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:41.387456Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:21:39 GMT\", \"server\": \"uvicorn\", \"content-length\": \"3086\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 387151, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"products\\\": [\\n    {\\n      \\\"id\\\": \\\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\\\",\\n      \\\"sku\\\": \\\"MUGI-KEYCHAIN-001\\\",\\n      \\\"name\\\": \\\"むぎぼーアクリルキーホルダー\\\",\\n      \\\"description\\\": \\\"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\\\",\\n      \\\"price_cents\\\": 80000,\\n      \\\"price_jpy\\\": 800.0,\\n      \\\"inventory_count\\\": 100,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"9f58d67c-5c45-4cd4-bf10-73f06647c234\\\",\\n      \\\"sku\\\": \\\"MUGI-CLOCK-001\\\",\\n      \\\"name\\\": \\\"むぎぼー時計\\\",\\n      \\\"description\\\": \\\"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\\\",\\n      \\\"price_cents\\\": 350000,\\n      \\\"price_jpy\\\": 3500.0,\\n      \\\"inventory_count\\\": 30,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"2faf8370-ada4-45d4-812c-ef5818d526b5\\\",\\n      \\\"sku\\\": \\\"MUGI-POUCH-001\\\",\\n      \\\"name\\\": \\\"むぎぼーポーチ\\\",\\n      \\\"description\\\": \\\"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\\\",\\n      \\\"price_cents\\\": 95000,\\n      \\\"price_jpy\\\": 950.0,\\n      \\\"inventory_count\\\": 120,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"1d9f08d9-51a9-491e-810b-f0e225ef4f59\\\",\\n      \\\"sku\\\": \\\"MUGI-MUG-001\\\",\\n      \\\"name\\\": \\\"むぎぼーマグカップ\\\",\\n      \\\"description\\\": \\\"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\\\",\\n      \\\"price_cents\\\": 120000,\\n      \\\"price_jpy\\\": 1200.0,\\n      \\\"inventory_count\\\": 80,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"c688d6ef-615f-43f7-87ce-05568ae4e63c\\\",\\n      \\\"sku\\\": \\\"MUGI-SOCKS-001\\\",\\n      \\\"name\\\": \\\"むぎぼー靴下\\\",\\n      \\\"description\\\": \\\"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\\\",\\n      \\\"price_cents\\\": 85000,\\n      \\\"price_jpy\\\": 850.0,\\n      \\\"inventory_count\\\": 100,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"6a169d3a-ca5a-4575-a08b-3fb659c628ed\\\",\\n      \\\"sku\\\": \\\"MUGI-PLATE-001\\\",\\n      \\\"name\\\": \\\"むぎぼープレート皿\\\",\\n      \\\"description\\\": \\\"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\\\",\\n      \\\"price_cents\\\": 190000,\\n      \\\"price_jpy\\\": 1900.0,\\n      \\\"inventory_count\\\": 70,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    }\\n  ]\\n}\"}], \"isError\": false}}, \"duration_ms\": 1208.6033821105957}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:41.396812Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (1220.50ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:41.397290Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"products\\\": [\\n    {\\n      \\\"id\\\": \\\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\\\",\\n      \\\"sku\\\": \\\"MUGI-KEYCHAIN-001\\\",\\n      \\\"name\\\": \\\"むぎぼーアクリルキーホルダー\\\",\\n      \\\"description\\\": \\\"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\\\",\\n      \\\"price_cents\\\": 80000,\\n      \\\"price_jpy\\\": 800.0,\\n      \\\"inventory_count\\\": 100,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"9f58d67c-5c45-4cd4-bf10-73f06647c234\\\",\\n      \\\"sku\\\": \\\"MUGI-CLOCK-001\\\",\\n      \\\"name\\\": \\\"むぎぼー時計\\\",\\n      \\\"description\\\": \\\"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\\\",\\n      \\\"price_cents\\\": 350000,\\n      \\\"price_jpy\\\": 3500.0,\\n      \\\"inventory_count\\\": 30,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"2faf8370-ada4-45d4-812c-ef5818d526b5\\\",\\n      \\\"sku\\\": \\\"MUGI-POUCH-001\\\",\\n      \\\"name\\\": \\\"むぎぼーポーチ\\\",\\n      \\\"description\\\": \\\"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\\\",\\n      \\\"price_cents\\\": 95000,\\n      \\\"price_jpy\\\": 950.0,\\n      \\\"inventory_count\\\": 120,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"1d9f08d9-51a9-491e-810b-f0e225ef4f59\\\",\\n      \\\"sku\\\": \\\"MUGI-MUG-001\\\",\\n      \\\"name\\\": \\\"むぎぼーマグカップ\\\",\\n      \\\"description\\\": \\\"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\\\",\\n      \\\"price_cents\\\": 120000,\\n      \\\"price_jpy\\\": 1200.0,\\n      \\\"inventory_count\\\": 80,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"c688d6ef-615f-43f7-87ce-05568ae4e63c\\\",\\n      \\\"sku\\\": \\\"MUGI-SOCKS-001\\\",\\n      \\\"name\\\": \\\"むぎぼー靴下\\\",\\n      \\\"description\\\": \\\"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\\\",\\n      \\\"price_cents\\\": 85000,\\n      \\\"price_jpy\\\": 850.0,\\n      \\\"inventory_count\\\": 100,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"6a169d3a-ca5a-4575-a08b-3fb659c628ed\\\",\\n      \\\"sku\\\": \\\"MUGI-PLATE-001\\\",\\n      \\\"name\\\": \\\"むぎぼープレート
皿\\\",\\n      \\\"description\\\": \\\"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\\\",\\n      \\\"price_cents\\\": 190000,\\n      \\\"price_jpy\\\": 1900.0,\\n      \\\"inventory_count\\\": 70,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    }\\n  ]\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 1220.499038696289}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:41.398292Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Tool search_products executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:41.398575Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.search_node", "message": "[search_products] MCP returned 6 products", "module": "search_node", "function": "search_products", "line": 69}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:41.418779Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:41.418885Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"2ade50e5-f2ae-439c-becb-0ba97bd1a161\"}, \"arguments\": {\"name\": \"check_inventory\", \"arguments\": {\"product_ids\": [\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\"]}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:41.420853Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:41.420910Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"2ade50e5-f2ae-439c-becb-0ba97bd1a161\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"check_inventory\", \"arguments\": {\"product_ids\": [\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\"]}}, \"id\": 349988}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent_mcp     | {"timestamp": "2025-11-02T00:21:41.562976Z", "level": "INFO", "logger": "main", "message": "[check_inventory] Inventory: {'286acdd4-d1c1-4860-b06a-f87d2f916a8d': 100, '9f58d67c-5c45-4cd4-bf10-73f06647c234': 30, '2faf8370-ada4-45d4-812c-ef5818d526b5': 120, '1d9f08d9-51a9-491e-810b-f0e225ef4f59': 80, 'c688d6ef-615f-43f7-87ce-05568ae4e63c': 100, '6a169d3a-ca5a-4575-a08b-3fb659c628ed': 70}", "module": "main", "function": "check_inventory", "line": 202}
ap2_merchant_agent_mcp     | INFO:     172.18.0.8:50276 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:41.569625Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (148.74ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:41.569707Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:21:40 GMT\", \"server\": \"uvicorn\", \"content-length\": \"431\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 349988, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"inventory\\\": {\\n    \\\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\\\": 100,\\n    \\\"9f58d67c-5c45-4cd4-bf10-73f06647c234\\\": 30,\\n    \\\"2faf8370-ada4-45d4-812c-ef5818d526b5\\\": 120,\\n    \\\"1d9f08d9-51a9-491e-810b-f0e225ef4f59\\\": 80,\\n    \\\"c688d6ef-615f-43f7-87ce-05568ae4e63c\\\": 100,\\n    \\\"6a169d3a-ca5a-4575-a08b-3fb659c628ed\\\": 70\\n  }\\n}\"}], \"isError\": false}}, \"duration_ms\": 148.73909950256348}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:41.569970Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (151.01ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:41.570213Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"inventory\\\": {\\n    \\\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\\\": 100,\\n    \\\"9f58d67c-5c45-4cd4-bf10-73f06647c234\\\": 30,\\n    \\\"2faf8370-ada4-45d4-812c-ef5818d526b5\\\": 120,\\n    \\\"1d9f08d9-51a9-491e-810b-f0e225ef4f59\\\": 80,\\n    \\\"c688d6ef-615f-43f7-87ce-05568ae4e63c\\\": 100,\\n    \\\"6a169d3a-ca5a-4575-a08b-3fb659c628ed\\\": 70\\n  }\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 151.00622177124023}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:41.570281Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Tool check_inventory executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:21:41.570332Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.inventory_node", "message": "[check_inventory] MCP checked 6 products", "module": "inventory_node", "function": "check_inventory", "line": 62}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.591286Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.optimization_node", "message": "[optimize_cart] LLM generated 3 cart plans", "module": "optimization_node", "function": "optimize_cart", "line": 173}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.608994Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Creating 3 unsigned CartMandates...", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 66}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.610522Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.610677Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"2ade50e5-f2ae-439c-becb-0ba97bd1a161\"}, \"arguments\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"コスパ最強プラン (1,650円)\", \"description\": \"価格重視で最安値のキーホルダーと靴下を組み合わせたプラン。かわいさと予算を両立させます。\", \"items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"quantity\": 1}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"quantity\": 1}]}, \"products\": [{\"id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"むぎぼーポーチ\", \"description\": \"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"sku\": \"MUGI-MUG-001\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。
毎日のティータイムが楽しくなります。\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.611280Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.611353Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"2ade50e5-f2ae-439c-becb-0ba97bd1a161\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"コスパ最強プラン (1,650円)\", \"description\": \"価格重視で最安値のキーホルダーと靴下を組み合わせたプラン。かわいさと予算を両立させます。\", \"items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"quantity\": 1}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"quantity\": 1}]}, \"products\": [{\"id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチ
に付けて持ち歩けます。\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"むぎぼーポーチ\", \"description\": \"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"sku\": \"MUGI-MUG-001\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼー
がプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}, \"id\": 308101}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent_mcp     | INFO:     172.18.0.8:58604 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.681863Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (70.73ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.682103Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:23:02 GMT\", \"server\": \"uvicorn\", \"content-length\": \"3354\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 308101, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_6f651c06\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_6f651c06\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"むぎぼーアクリルキーホルダー\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 800.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n     \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"むぎぼー靴下\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 850.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"消費税（10%）\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 165.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"送料\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"合計\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 2315.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-02T01:23:03.669414Z\\\",\\n      \\\"merchant_name\\\": \\\"むぎぼーショップ\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-02T00:23:03.669856Z\\\",\\n      \\\"cart_name\\\": \\\"コスパ最強プラン (1,650円)\\\",\\n      \\\"cart_description\\\": \\\"価格重視で最安値のキーホルダーと靴下を組み合わせたプラン。かわいさと予算を両立させます。\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\\\",\\n          \\\"name\\\": \\\"むぎぼーアクリルキーホルダー\\\",\\n          \\\"description\\\": \\\"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"c688d6ef-615f-43f7-87ce-05568ae4e63c\\\",\\n          \\\"name\\\": \\\"むぎぼー靴下\\\",\\n          \\\"description\\\": \\\"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}}, \"duration_ms\": 70.72973251342773}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.682952Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (72.08ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.683157Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_6f651c06\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_6f651c06\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"むぎぼーアクリルキーホルダー\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 800.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"むぎぼー靴下\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 850.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"消費税（10%）\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 165.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"送料\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"合計\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 2315.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-02T01:23:03.669414Z\\\",\\n      \\\"merchant_name\\\": \\\"むぎぼーショップ\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-02T00:23:03.669856Z\\\",\\n      \\\"cart_name\\\": \\\"コスパ最強プラン (1,650円)\\\",\\n      \\\"cart_description\\\": \\\"価格重視で最安値のキーホルダーと靴下を組み合わせたプラン。かわいさと予算を両立させます。\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\\\",\\n          \\\"name\\\": \\\"むぎぼーアクリルキーホルダー\\\",\\n          \\\"description\\\": \\\"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"c688d6ef-615f-43f7-87ce-05568ae4e63c\\\",\\n          \\\"name\\\": \\\"むぎぼー靴下\\\",\\n          \\\"description\\\": \\\"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 72.08442687988281}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.683239Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Tool build_cart_mandates executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.683408Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Created unsigned CartMandate: cart_6f651c06, plan=コスパ最強プラン (1,650円)", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 94}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.684661Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.684748Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"2ade50e5-f2ae-439c-becb-0ba97bd1a161\"}, \"arguments\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"高品質プラン (2,150円)\", \"description\": \"かわいさを重視してポーチとマグカップを組み合わせたプラン。品質とデザインのバランスが良いです。\", \"items\": [{\"product_id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"quantity\": 1}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"quantity\": 1}]}, \"products\": [{\"id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"むぎぼーポーチ\", \"description\": \"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"sku\": \"MUGI-MUG-001\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ
。毎日のティータイムが楽しくなります。\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}}", "module": "logger", "function": "log_mcp_request", "line": 294}


ap2_merchant_agent_mcp     | INFO:     172.18.0.8:58604 - "POST / HTTP/1.1" 200 OK


ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.685733Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}


ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.685889Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"2ade50e5-f2ae-439c-becb-0ba97bd1a161\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"高品質プラン (2,150円)\", \"description\": \"かわいさを重視してポーチとマグカップを組み合わせたプラン。品質とデザインのバランスが良いです。\", \"items\": [{\"product_id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"quantity\": 1}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"quantity\": 1}]}, \"products\": [{\"id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポー
チに付けて持ち歩けます。\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"むぎぼーポーチ\", \"description\": \"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"sku\": \"MUGI-MUG-001\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼ
ーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}, \"id\": 655757}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent_mcp     | INFO:     172.18.0.8:58604 - "POST / HTTP/1.1" 200 OK

ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.694790Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (9.03ms)", "module": "logger", "function": "log_http_response", "line": 215}


ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.694860Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:23:02 GMT\", \"server\": \"uvicorn\", \"content-length\": \"3342\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 655757, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_b4c7c36f\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_b4c7c36f\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"むぎぼーポーチ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 950.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"むぎぼーマグカップ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 1200.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"消費税（10%）\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 215.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"送料\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"合計\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 2865.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-02T01:23:03.692384Z\\\",\\n      \\\"merchant_name\\\": \\\"むぎぼーショップ\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-02T00:23:03.692405Z\\\",\\n      \\\"cart_name\\\": \\\"高品質プラン (2,150円)\\\",\\n      \\\"cart_description\\\": \\\"かわいさを重視してポーチとマグカップを組み合わせたプラン。品質とデザインのバランスが良いです。\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"2faf8370-ada4-45d4-812c-ef5818d526b5\\\",\\n          \\\"name\\\": \\\"むぎぼーポーチ\\\",\\n          \\\"description\\\": \\\"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\":{\\n            \\\"value\\\": 950.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 950.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"1d9f08d9-51a9-491e-810b-f0e225ef4f59\\\",\\n          \\\"name\\\": \\\"むぎぼーマグカップ\\\",\\n          \\\"description\\\": \\\"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}}, \"duration_ms\": 9.031057357788086}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.695572Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (10.78ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.695609Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_b4c7c36f\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_b4c7c36f\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"むぎぼーポーチ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 950.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"むぎぼーマグカップ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 1200.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"消費税（10%）\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 215.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"送料\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"合計\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 2865.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-02T01:23:03.692384Z\\\",\\n      \\\"merchant_name\\\": \\\"むぎぼーショップ\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-02T00:23:03.692405Z\\\",\\n      \\\"cart_name\\\": \\\"高品質プラン (2,150円)\\\",\\n      \\\"cart_description\\\": \\\"かわいさを重視してポーチとマグカップを組み合わせたプラン。品質とデザインのバランスが良いです。\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"2faf8370-ada4-45d4-812c-ef5818d526b5\\\",\\n          \\\"name\\\": \\\"むぎぼーポーチ\\\",\\n          \\\"description\\\": \\\"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 950.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 950.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"1d9f08d9-51a9-491e-810b-f0e225ef4f59\\\",\\n          \\\"name\\\": \\\"むぎぼーマグカップ\\\",\\n          \\\"description\\\": \\\"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 10.780096054077148}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.695728Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Tool build_cart_mandates executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.695756Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Created unsigned CartMandate: cart_b4c7c36f, plan=高品質プラン (2,150円)", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 94}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.696017Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.696096Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"2ade50e5-f2ae-439c-becb-0ba97bd1a161\"}, \"arguments\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"シンプルプラン (800円)\", \"description\": \"予算を抑えたい方におすすめのキーホルダー単品プラン。かわいらしさを最大限に活かした1点です。\", \"items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"quantity\": 1}]}, \"products\": [{\"id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"むぎぼーポーチ\", \"description\": \"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"sku\": \"MUGI-MUG-001\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.696575Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.696691Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"2ade50e5-f2ae-439c-becb-0ba97bd1a161\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"シンプルプラン (800円)\", \"description\": \"予算を抑えたい方におすすめのキーホルダー単品プラン。かわいらしさを最大限に活かした1点です。\", \"items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"quantity\": 1}]}, \"products\": [{\"id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"むぎぼー時計\", \"description\": \"むぎぼーデザインのかわいい壁掛け時計。お部屋を明るく彩ります。\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"むぎぼーポーチ\", \"description\": \"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"sku\": \"MUGI-MUG-001\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"むぎぼープレート皿\", \"description\": \"むぎぼーが中央に描かれた陶器プレート。食卓をかわいく演出。\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": null}}, \"id\": 924193}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.701171Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (4.53ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.701237Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:23:02 GMT\", \"server\": \"uvicorn\", \"content-length\": \"2563\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 924193, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_70dda49a\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_70dda49a\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"むぎぼーアクリルキーホルダー\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 800.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n     \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"消費税（10%）\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 80.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"送料\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"合計\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 1380.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-02T01:23:03.698740Z\\\",\\n      \\\"merchant_name\\\": \\\"むぎぼーショップ\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-02T00:23:03.698753Z\\\",\\n      \\\"cart_name\\\": \\\"シンプルプラン (800円)\\\",\\n      \\\"cart_description\\\": \\\"予算を抑えたい方におすすめのキーホルダー単品プラン。かわいらしさを最大限に活かした1点です。\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\\\",\\n          \\\"name\\\": \\\"むぎぼーアクリルキーホルダー\\\",\\n          \\\"description\\\": \\\"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}}, \"duration_ms\": 4.525661468505859}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.701610Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (5.32ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.701669Z", "level": "DEBUG", "logger": "v2.common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_70dda49a\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_70dda49a\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"むぎぼーアクリルキーホルダー\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 800.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"消費税（10%）\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 80.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"送料\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"合計\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 1380.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"shipping_address\\\": null\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-02T01:23:03.698740Z\\\",\\n      \\\"merchant_name\\\": \\\"むぎぼーショップ\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": null,\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-02T00:23:03.698753Z\\\",\\n      \\\"cart_name\\\": \\\"シンプルプラン (800円)\\\",\\n      \\\"cart_description\\\": \\\"予算を抑えたい方におすすめのキーホルダー単品プラン。かわいらしさを最大限に活かした1点です。\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\\\",\\n          \\\"name\\\": \\\"むぎぼーアクリルキーホルダー\\\",\\n          \\\"description\\\": \\\"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 5.324363708496094}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.701728Z", "level": "INFO", "logger": "v2.common.mcp_client", "message": "[MCPClient] Tool build_cart_mandates executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.701751Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Created unsigned CartMandate: cart_70dda49a, plan=シンプルプラン (800円)", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 94}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.701777Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Created 3 unsigned CartMandates, sending to Merchant for signature...", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 116}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.702150Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Processing 3 CartMandates in parallel...", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 330}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.702877Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant:8002/sign/cart", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.702942Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant:8002/sign/cart\", \"headers\": {}, \"body\": {\"cart_mandate\": {\"contents\": {\"id\": \"cart_6f651c06\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_6f651c06\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼー靴下\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 165.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.669414Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": null, \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.669856Z\", \"cart_name\": \"コスパ最強プラン (1,650円)\", \"cart_description\": \"価格重視で最安値のキーホルダーと靴下を組み合わせたプラン。かわいさと予算を両立させます。\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.703371Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant:8002/sign/cart", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.703457Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant:8002/sign/cart\", \"headers\": {}, \"body\": {\"cart_mandate\": {\"contents\": {\"id\": \"cart_b4c7c36f\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_b4c7c36f\", \"display_items\": [{\"label\": \"むぎぼーポーチ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼーマグカップ\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 215.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2865.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.692384Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": null, \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.692405Z\", \"cart_name\": \"高品質プラン (2,150円)\", \"cart_description\": \"かわいさを重視してポーチとマグカップを組み合わせたプラン。品質とデザインのバランスが良いです。\", \"raw_items\": [{\"product_id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"name\": \"むぎぼーポーチ\", \"description\": \"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.703698Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant:8002/sign/cart", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:03.703762Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant:8002/sign/cart\", \"headers\": {}, \"body\": {\"cart_mandate\": {\"contents\": {\"id\": \"cart_70dda49a\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_70dda49a\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 80.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 1380.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.698740Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": null, \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.698753Z\", \"cart_name\": \"シンプルプラン (800円)\", \"cart_description\": \"予算を抑えたい方におすすめのキーホルダー単品プラン。かわいらしさを最大限に活かした1点です。\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant               | [2025-11-02 00:23:04,233] INFO in services.merchant.utils.validation_helpers: [Merchant] CartMandate validation passed: cart_b4c7c36f
ap2_merchant               | [2025-11-02 00:23:04,285] INFO in services.merchant.utils.validation_helpers: [Merchant] CartMandate validation passed: cart_6f651c06
ap2_merchant               | [2025-11-02 00:23:04,286] INFO in services.merchant.utils.validation_helpers: [Merchant] CartMandate validation passed: cart_70dda49a
ap2_merchant               | [2025-11-02 00:23:04,287] INFO in services.merchant.utils.inventory_helpers: [Merchant] Inventory check passed for CartMandate: cart_b4c7c36f
ap2_merchant               | {"timestamp": "2025-11-02T00:23:04.446124Z", "level": "INFO", "logger": "service", "message": "[_generate_merchant_authorization_jwt] Generated signed JWT for CartMandate: cart_id=None, alg=ES256, merchant_id=did:ap2:merchant:mugibo_merchant", "module": "service", "function": "_generate_merchant_authorization_jwt", "line": 856}
ap2_merchant               | [2025-11-02 00:23:04,543] INFO in services.merchant.utils.inventory_helpers: [Merchant] Inventory check passed for CartMandate: cart_6f651c06
ap2_merchant               | {"timestamp": "2025-11-02T00:23:04.544270Z", "level": "INFO", "logger": "service", "message": "[_generate_merchant_authorization_jwt] Generated signed JWT for CartMandate: cart_id=None, alg=ES256, merchant_id=did:ap2:merchant:mugibo_merchant", "module": "service", "function": "_generate_merchant_authorization_jwt", "line": 856}
ap2_merchant               | [2025-11-02 00:23:04,549] INFO in services.merchant.utils.inventory_helpers: [Merchant] Inventory check passed for CartMandate: cart_70dda49a
ap2_merchant               | {"timestamp": "2025-11-02T00:23:04.551003Z", "level": "INFO", "logger": "service", "message": "[_generate_merchant_authorization_jwt] Generated signed JWT for CartMandate: cart_id=None, alg=ES256, merchant_id=did:ap2:merchant:mugibo_merchant", "module": "service", "function": "_generate_merchant_authorization_jwt", "line": 856}
ap2_merchant               | {"timestamp": "2025-11-02T00:23:04.608791Z", "level": "INFO", "logger": "service", "message": "[Merchant] Created new CartMandate: cart_b4c7c36f", "module": "service", "function": "sign_cart_mandate", "line": 262}
ap2_merchant               | {"timestamp": "2025-11-02T00:23:04.609867Z", "level": "INFO", "logger": "service", "message": "[Merchant] Auto-signed CartMandate: cart_b4c7c36f (with merchant_authorization JWT)", "module": "service", "function": "sign_cart_mandate", "line": 264}
ap2_merchant               | INFO:     172.18.0.8:50468 - "POST /sign/cart HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.634387Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (930.52ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.634719Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:23:03 GMT\", \"server\": \"uvicorn\", \"content-length\": \"2950\", \"content-type\": \"application/json\"}, \"body\": {\"signed_cart_mandate\": {\"contents\": {\"id\": \"cart_b4c7c36f\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_b4c7c36f\", \"display_items\": [{\"label\": \"むぎぼーポーチ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼーマグカップ\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 215.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2865.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.692384Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiYmI0MTNkYTlmNTc4YmJjZTdmNWJkNGM5OTgwMDY5Mzc3ZGYxZWIzMzljMjdkNmMxZGYxNjQ2MTBkMTIzYWRkYyIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjkxYTUyMDNkLTg3NDAtNGM0Yi04YWZiLThiNTY2MDZiZWE1YSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.zFiY6pJZYoqQ-viT8U8ZRVIXsX8l2jyw-FseXtzikMMxLLoTG4MvVhE35yATQPjMQygzpyOdP7EBYogIk6FGFA\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.692405Z\", \"cart_name\": \"高品質プラン (2,150円)\", \"cart_description\": \"かわいさを重視して
ポーチとマグカップを組み合わせたプラン。品質とデザインのバランスが良いです。\", \"raw_items\": [{\"product_id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"name\": \"むぎぼーポーチ\", \"description\": \"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiYmI0MTNkYTlmNTc4YmJjZTdmNWJkNGM5OTgwMDY5Mzc3ZGYxZWIzMzljMjdkNmMxZGYxNjQ2MTBkMTIzYWRkYyIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjkxYTUyMDNkLTg3NDAtNGM0Yi04YWZiLThiNTY2MDZiZWE1YSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.zFiY6pJZYoqQ-viT8U8ZRVIXsX8l2jyw-FseXtzikMMxLLoTG4MvVhE35yATQPjMQygzpyOdP7EBYogIk6FGFA\"}, \"duration_ms\": 930.5179119110107}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.635759Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] CartMandate auto-signed: cart_b4c7c36f, plan=高品質プラン (2,150円)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 173}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.635923Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Built signed CartMandate for plan: 高品質プラン (2,150円)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 306}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.643086Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (940.14ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant               | {"timestamp": "2025-11-02T00:23:04.639152Z", "level": "INFO", "logger": "service", "message": "[Merchant] Created new CartMandate: cart_6f651c06", "module": "service", "function": "sign_cart_mandate", "line": 262}


ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.643200Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:23:03 GMT\", \"server\": \"uvicorn\", \"content-length\": \"2962\", \"content-type\": \"application/json\"}, \"body\": {\"signed_cart_mandate\": {\"contents\": {\"id\": \"cart_6f651c06\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_6f651c06\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼー靴下\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 165.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.669414Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRkNWRiYmJlLWIzMTUtNGIzYi05NDU3LTk1MDc2YWY1MWQzMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9HMgj89sDLXHUsoAo3fzJx7SFPzWRcZbwqWRgNFNLzJT9502pxwGgqEJOmoIHKCB1NVHvtf3PMxffijmp-oiBw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.669856Z\", \"cart_name\": \"コスパ最強プラン (1,650円)\", \"cart_description\": \"価格重視
で最安値のキーホルダーと靴下を組み合わせたプラン。かわいさと予算を両立させます。\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRkNWRiYmJlLWIzMTUtNGIzYi05NDU3LTk1MDc2YWY1MWQzMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9HMgj89sDLXHUsoAo3fzJx7SFPzWRcZbwqWRgNFNLzJT9502pxwGgqEJOmoIHKCB1NVHvtf3PMxffijmp-oiBw\"}, \"duration_ms\": 940.136194229126}", "module": "logger", "function": "log_http_response", "line": 226}



ap2_merchant               | {"timestamp": "2025-11-02T00:23:04.640449Z", "level": "INFO", "logger": "service", "message": "[Merchant] Auto-signed CartMandate: cart_6f651c06 (with merchant_authorization JWT)", "module": "service", "function": "sign_cart_mandate", "line": 264}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.643549Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] CartMandate auto-signed: cart_6f651c06, plan=コスパ最強プラン (1,650円)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 173}
ap2_merchant               | INFO:     172.18.0.8:50472 - "POST /sign/cart HTTP/1.1" 200 OK
ap2_merchant               | {"timestamp": "2025-11-02T00:23:04.644012Z", "level": "INFO", "logger": "service", "message": "[Merchant] Created new CartMandate: cart_70dda49a", "module": "service", "function": "sign_cart_mandate", "line": 262}



ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.643656Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Built signed CartMandate for plan: コスパ最強プラン (1,650円)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 306}
ap2_merchant               | {"timestamp": "2025-11-02T00:23:04.644664Z", "level": "INFO", "logger": "service", "message": "[Merchant] Auto-signed CartMandate: cart_70dda49a (with merchant_authorization JWT)", "module": "service", "function": "sign_cart_mandate", "line": 264}


ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.646243Z", "level": "INFO", "logger": "agent", "message": "HTTP Re
ap2_merchant               | INFO:     172.18.0.8:50482 - "POST /sign/cart HTTP/1.1" 200 OK


ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.646334Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:23:03 GMT\", \"server\": \"uvicorn\", \"content-length\": \"2545\", \"content-type\": \"application/json\"}, \"body\": {\"signed_cart_mandate\": {\"contents\": {\"id\": \"cart_70dda49a\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_70dda49a\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 80.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 1380.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.698740Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiY2QxNGY5ODJhYzNhZDNjMzA1NzUxOGM0NWE0ZGVhNzFkMTQ1MjY0YWNkZDQ2ZmFhNGI1OThmNTk4ODlhYzVhNiIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjBlMjdjMmRlLTc4ZmYtNDJkMC1iNTc5LWVkYTcwOTFhOWI4ZCIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0._UljwTFRm2hJYNNKTJVXHEE9egnkFsoI829Be_RGTb_-OaORUjD2BvmfnVF6V-Y9atDopYtDgp3t1zoMLoQmaQ\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.698753Z\", \"cart_name\": \"シンプルプラン (800円)\", \"cart_description\": \"予算を抑えたい方におすすめのキーホルダー単品プラン。かわいらしさを最大限に活かした1点です。\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiY2QxNGY5ODJhYzNhZDNjMzA1NzUxOGM0NWE0ZGVhNzFkMTQ1MjY0YWNkZDQ2ZmFhNGI1OThmNTk4ODlhYzVhNiIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjBlMjdjMmRlLTc4ZmYtNDJkMC1iNTc5LWVkYTcwOTFhOWI4ZCIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0._UljwTFRm2hJYNNKTJVXHEE9egnkFsoI829Be_RGTb_-OaORUjD2BvmfnVF6V-Y9atDopYtDgp3t1zoMLoQmaQ\"}, \"duration_ms\": 942.493200302124}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.646561Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] CartMandate auto-signed: cart_70dda49a, plan=シンプルプラン (800円)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 173}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.646608Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Built signed CartMandate for plan: シンプルプラン (800円)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 306}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.647097Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Parallel processing complete: 3 signed, 0 pending, 0 timeout, 0 rejected", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 353}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.647132Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Built 3 signed CartMandates (pending: 0, timeout: 0)", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 373}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.652112Z", "level": "INFO", "logger": "v2.services.merchant_agent.nodes.ranking_node", "message": "[rank_and_select] Selected top 3 carts", "module": "ranking_node", "function": "rank_and_select", "line": 31}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.655833Z", "level": "INFO", "logger": "langgraph_merchant", "message": "[create_cart_candidates] 3 carts ready (pre-signed via MCP)", "module": "langgraph_merchant", "function": "create_cart_candidates", "line": 313}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.656162Z", "level": "INFO", "logger": "handlers.intent_handler", "message": "[MerchantAgent] Generated 3 cart candidates", "module": "intent_handler", "function": "handle_intent_mandate", "line": 102}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.657432Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2A処理] ハンドラー完了: type=ap2.mandates.IntentMandate, result_type=ap2.responses.CartCandidates", "module": "a2a_handler", "function": "handle_message", "line": 307}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.661688Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 995}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.662806Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 6484, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.responses.CartCandidates\",\"id\":\"58f71282-b7fd-4ec0-ad8b-76132d20bd14\",\"payload\":{\"cart_candidates\":[{\"artifactId\":\"artifact_c4c46e89\",\"name\":\"コスパ最強プラ
ン (1,650円)\",\"parts\":[{\"da", "module": "crypto", "function": "sign_a2a_message", "line": 999}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.663075Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 794}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.669326Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: merchant_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.671948Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:shopping_agent: ap2.responses.CartCandidates", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:04.672414Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.responses.CartCandidates\", \"peer\": \"did:ap2:agent:shopping_agent\", \"headers\": {\"message_id\": \"74be8d18-d99e-40a3-9b26-3e552df785d5\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:shopping_agent\", \"timestamp\": \"2025-11-02T00:23:04.658989Z\", \"nonce\": \"9c9467a8f406fd6763f867cac405c7b0cbcab9243245ca316945b490dbf8202d\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"intent_mandate_id\": \"intent_76e80f2f\", \"cart_candidates\": [{\"artifactId\": \"artifact_c4c46e89\", \"name\": \"コスパ最強プラン (1,650円)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_6f651c06\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_6f651c06\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼー靴下\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 165.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.669414Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRkNWRiYmJlLWIzMTUtNGIzYi05NDU3LTk1MDc2YWY1MWQzMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9HMgj89sDLXHUsoAo3fzJx7SFPzWRcZbwqWRgNFNLzJT9502pxwGgqEJOmoIHKCB1NVHvtf3PMxffijmp-oiBw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.669856Z\", \"cart_name\": \"コスパ最強プラン (1,650円)\", \"cart_description\": \"価格重視で最安値のキーホルダーと靴下を組み合わせたプラン。かわいさと予算を両立させます。\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"む
ぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}, {\"artifactId\": \"artifact_80182825\", \"name\": \"高品質プラン (2,150円)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_b4c7c36f\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_b4c7c36f\", \"display_items\": [{\"label\": \"むぎぼーポーチ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼーマグカップ\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 215.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2865.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.692384Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiYmI0MTNkYTlmNTc4YmJjZTdmNWJkNGM5OTgwMDY5Mzc3ZGYxZWIzMzljMjdkNmMxZGYxNjQ2MTBkMTIzYWRkYyIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjkxYTUyMDNkLTg3NDAtNGM0Yi04YWZiLThiNTY2MDZiZWE1YSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.zFiY6pJZYoqQ-viT8U8ZRVIXsX8l2jyw-FseXtzikMMxLLoTG4MvVhE35yATQPjMQygzpyOdP7EBYogIk6FGFA\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.692405Z\", \"cart_name\": \"高品質プラン (2,150円)\", \"cart_description\": \"かわいさを重視してポーチとマグカップを組み合わせたプラン。品質とデザインのバランスが良いです。\", \"raw_items\": [{\"product_id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"name\": \"むぎぼーポーチ\", \"description\": \"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}, {\"artifactId\": \"artifact_943fcf33\", \"name\": \"シンプルプラン (800円)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_70dda49a\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_70dda49a\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 80.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 1380.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.698740Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiY2QxNGY5ODJhYzNhZDNjMzA1NzUxOGM0NWE0ZGVhNzFkMTQ1MjY0YWNkZDQ2ZmFhNGI1OThmNTk4ODlhYzVhNiIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjBlMjdjMmRlLTc4ZmYtNDJkMC1iNTc5LWVkYTcwOTFhOWI4ZCIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0._UljwTFRm2hJYNNKTJVXHEE9egnkFsoI829Be_RGTb_-OaORUjD2BvmfnVF6V-Y9atDopYtDgp3t1zoMLoQmaQ\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.698753Z\", \"cart_name\": \"シンプルプラン (800円)\", \"cart_description\": \"予算を抑えたい方におすすめのキーホルダー単品プラン。かわいらしさを最大限に活かした1点です。\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}], \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"merchant_name\": \"むぎぼーショッ
プ\"}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | [2025-11-02 00:23:04,673] INFO in v2.common.base_agent: [Merchant Agent] A2Aレスポンス返却: type=ap2.responses.CartCandidates, to=did:ap2:agent:shopping_agent
ap2_merchant_agent         | INFO:     172.18.0.10:57222 - "POST /a2a/message HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:04.737154Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (144760.39ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:04.740123Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:20:39 GMT\", \"server\": \"uvicorn\", \"content-length\": \"7933\", \"content-type\": \"application/json\"}, \"body\": {\"header\": {\"message_id\": \"74be8d18-d99e-40a3-9b26-3e552df785d5\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:shopping_agent\", \"timestamp\": \"2025-11-02T00:23:04.658989Z\", \"nonce\": \"9c9467a8f406fd6763f867cac405c7b0cbcab9243245ca316945b490dbf8202d\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"baGVJeZHHJ1RF14VVALNQdBZAslawk212jqqZ/a9Xf7Oc68pdcZGF0PoT5GTRhB0tyd20kR7d6oVMm1gEuuVAw==\", \"publicKeyMultibase\": \"z6Mko44YAnz8G71TocDDKoBqg86BJTxnqLN86UvGcpjxP47t\", \"kid\": \"did:ap2:agent:merchant_agent#key-2\", \"created\": \"2025-11-02T00:23:04.658989Z\", \"proofPurpose\": \"authentication\"}}, \"dataPart\": {\"@type\": \"ap2.responses.CartCandidates\", \"id\": \"58f71282-b7fd-4ec0-ad8b-76132d20bd14\", \"payload\": {\"intent_mandate_id\": \"intent_76e80f2f\", \"cart_candidates\": [{\"artifactId\": \"artifact_c4c46e89\", \"name\": \"コスパ最強プラン (1,650円)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_6f651c06\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_6f651c06\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼー靴下\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 165.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\":\"合計\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.669414Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRkNWRiYmJlLWIzMTUtNGIzYi05NDU3LTk1MDc2YWY1MWQzMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9HMgj89sDLXHUsoAo3fzJx7SFPzWRcZbwqWRgNFNLzJT9502pxwGgqEJOmoIHKCB1NVHvtf3PMxffijmp-oiBw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.669856Z\", \"cart_name\": \"コスパ最強プラン (1,650円)\", \"cart_description\": \"価格重視で最安値のキーホルダ
ーと靴下を組み合わせたプラン。かわいさと予算を両立させます。\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}, {\"artifactId\": \"artifact_80182825\", \"name\": \"高品質プラン (2,150円)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_b4c7c36f\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_b4c7c36f\", \"display_items\": [{\"label\": \"むぎぼーポーチ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼーマグカップ\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 215.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2865.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.692384Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiYmI0MTNkYTlmNTc4YmJjZTdmNWJkNGM5OTgwMDY5Mzc3ZGYxZWIzMzljMjdkNmMxZGYxNjQ2MTBkMTIzYWRkYyIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjkxYTUyMDNkLTg3NDAtNGM0Yi04YWZiLThiNTY2MDZiZWE1YSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.zFiY6pJZYoqQ-viT8U8ZRVIXsX8l2jyw-FseXtzikMMxLLoTG4MvVhE35yATQPjMQygzpyOdP7EBYogIk6FGFA\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.692405Z\", \"cart_name\": \"高品質プラン (2,150円)\", \"cart_description\": \"かわいさを重視してポーチとマグカップを組み合わせたプラン。品質とデザインのバランスが良いです。\", \"raw_items\": [{\"product_id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"name\": \"むぎぼーポーチ\", \"description\": \"むぎぼー柄のかわいいポーチ。小物入れやペンケースとして使えます。\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"name\": \"むぎぼーマグカップ\", \"description\": \"むぎぼーがプリントされたかわいいマグカップ。毎日のティータイムが楽しくなります。\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}, {\"artifactId\": \"artifact_943fcf33\", \"name\": \"シンプルプラン (800円)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_70dda49a\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_70dda49a\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 80.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 1380.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.698740Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiY2QxNGY5ODJhYzNhZDNjMzA1NzUxOGM0NWE0ZGVhNzFkMTQ1MjY0YWNkZDQ2ZmFhNGI1OThmNTk4ODlhYzVhNiIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjBlMjdjMmRlLTc4ZmYtNDJkMC1iNTc5LWVkYTcwOTFhOWI4ZCIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0._UljwTFRm2hJYNNKTJVXHEE9egnkFsoI829Be_RGTb_-OaORUjD2BvmfnVF6V-Y9atDopYtDgp3t1zoMLoQmaQ\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.698753Z\", \"cart_name\": \"シンプルプラン (800円)\", \"cart_description\": \"予算を抑えたい方におすすめのキーホルダー単品プラン。かわ
いらしさを最大限に活かした1点です。\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}], \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"merchant_name\": \"むぎぼーショップ\"}, \"kind\": null, \"artifact\": null}}, \"duration_ms\": 144760.39218902588}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-02 00:23:04,749] INFO in services.shopping_agent.utils.merchant_integration:
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [ShoppingAgent ← MerchantAgent] A2Aレスポンス受信
ap2_shopping_agent         |   Status: 200
ap2_shopping_agent         |   Response Body: {
ap2_shopping_agent         |   "header": {
ap2_shopping_agent         |     "message_id": "74be8d18-d99e-40a3-9b26-3e552df785d5",
ap2_shopping_agent         |     "sender": "did:ap2:agent:merchant_agent",
ap2_shopping_agent         |     "recipient": "did:ap2:agent:shopping_agent",
ap2_shopping_agent         |     "timestamp": "2025-11-02T00:23:04.658989Z",
ap2_shopping_agent         |     "nonce": "9c9467a8f406fd6763f867cac405c7b0cbcab9243245ca316945b490dbf8202d",
ap2_shopping_agent         |     "schema_version": "0.2",
ap2_shopping_agent         |     "proof": {
ap2_shopping_agent         |       "algorithm": "ed25519",
ap2_shopping_agent         |       "signatureValue": "baGVJeZHHJ1RF14VVALNQdBZAslawk212jqqZ/a9Xf7Oc68pdcZGF0PoT5GTRhB0tyd20kR7d6oVMm1gEuuVAw==",
ap2_shopping_agent         |       "publicKeyMultibase": "z6Mko44YAnz8G71TocDDKoBqg86BJTxnqLN86UvGcpjxP47t",
ap2_shopping_agent         |       "kid": "did:ap2:agent:merchant_agent#key-2",
ap2_shopping_agent         |       "created": "2025-11-02T00:23:04.658989Z",
ap2_shopping_agent         |       "proofPurpose": "authentication"
ap2_shopping_agent         |     }
ap2_shopping_agent         |   },
ap2_shopping_agent         |   "dataPart": {
ap2_shopping_agent         |     "@type": "ap2.responses.CartCandidates",
ap2_shopping_agent         |     "id": "58f71282-b7fd-4ec0-ad8b-76132d20bd14",
ap2_shopping_agent         |     "payload": {
ap2_shopping_agent         |       "intent_mandate_id": "intent_76e80f2f",
ap2_shopping_agent         |       "cart_candidates": [
ap2_shopping_agent         |         {
ap2_shopping_agent         |           "artifactId": "artifact_c4c46e89",
ap2_shopping_agent         |           "name": "コスパ最強プラン...
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [2025-11-02 00:23:04,749] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Received 3 cart candidates from Merchant Agent
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:05.595060Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=cart_selection", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:05.607114Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=cart_selection", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:09.696477Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:09.700840Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1762042681770_6b8nz\n  user_id: usr_cdb4ec851bcf4f73\n  user_input: cart_6f651c06\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1102}
ap2_shopping_agent         | INFO:     172.67.69.85:24268 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:09.710003Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1762042681770_6b8nz, step=cart_selection", "module": "agent", "function": "_get_or_create_session", "line": 1987}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:09.711206Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1762042681770_6b8nz)", "module": "agent", "function": "event_generator", "line": 1117}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:09.711487Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1762042681770_6b8nz", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1690}
ap2_shopping_agent         | [2025-11-02 00:23:09,746] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: cart_selection
ap2_shopping_agent         |   user_input: cart_6f651c06
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-02 00:23:09,836] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cart_node] Merchant authorization JWT verified: merchant=did:ap2:merchant:mugibo_merchant, cart_hash=72fc7ad62509d73f...
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:09.884356Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=cart_signature_pending", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:09.895723Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=cart_signature_pending", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | INFO:     172.67.69.85:24268 - "OPTIONS /cart/submit-signature HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:12.735093Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:12.744645Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1762042681770_6b8nz, step=cart_signature_pending", "module": "agent", "function": "_get_or_create_session", "line": 1987}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:12.745755Z", "level": "INFO", "logger": "agent", "message": "[submit_cart_signature] Received CartMandate signature: cart_id=None, session_id=session_1762042681770_6b8nz", "module": "agent", "function": "submit_cart_signature", "line": 1319}
ap2_shopping_agent         | [2025-11-02 00:23:12,747] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Verifying CartMandate WebAuthn signature: user_id=usr_cdb4ec851bcf4f73
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:12.749716Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://credential_provider:8003/verify/attestation", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:12.750064Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/verify/attestation\", \"headers\": {}, \"body\": {\"payment_mandate\": {\"contents\": {\"id\": \"cart_6f651c06\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_6f651c06\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼー靴下\", \"amount\": {\"value\": 850, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 165, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2315, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.669414Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRkNWRiYmJlLWIzMTUtNGIzYi05NDU3LTk1MDc2YWY1MWQzMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9HMgj89sDLXHUsoAo3fzJx7SFPzWRcZbwqWRgNFNLzJT9502pxwGgqEJOmoIHKCB1NVHvtf3PMxffijmp-oiBw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.669856Z\", \"cart_name\": \"コスパ最強プラン (1,650円)\", \"cart_description\": \"価格重視で最安値のキーホルダーと靴下を組み合わせたプラン。かわいさと予算を両立させます。\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"quantity\": 1, \"unit_price\": {\"value\": 850, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850, \"currency\": \"JPY\"}, \"image_url\": null}]}}, \"attestation\": {\"id\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"rawId\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"response\": {\"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlbmdlIjoiZXlKdFlXNWtZWFJsWDJsa0lqb2lZMkZ5ZEY4MlpqWTFNV013TmlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTWpBME1qazVNRGMzT0gwIiwib3JpZ2luIjoiaHR0cDovL2xvY2FsaG9zdDozMDAwIiwiY3Jvc3NPcmlnaW4iOmZhbHNlfQ\", \"authenticatorData\": \"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2MdAAAAAA\", \"signature\": \"MEYCIQCCq-F7BKn2x0IDOjazpF5qjhRRO7JXPTMFP0fUAT5GXgIhAIlQAKBCoWRnc8FoqlYjPREkS5HkOyk5Y7JFlnygt4-w\", \"userHandle\": \"usr_cdb4ec851bcf4f73\"}, \"type\": \"public-key\", \"attestation_type\": \"passkey\", \"challenge\": \"eyJtYW5kYXRlX2lkIjoiY2FydF82ZjY1MWMwNiIsInRpbWVzdGFtcCI6MTc2MjA0Mjk5MDc3OH0\"}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:12.881667Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] Found passkey: dCDQdGlqx50G-UFW...", "module": "provider", "function": "verify_attestation", "line": 575}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:12.882050Z", "level": "INFO", "logger": "provider", "message": "  User: usr_cdb4ec851bcf4f73", "module": "provider", "function": "verify_attestation", "line": 576}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:12.882092Z", "level": "INFO", "logger": "provider", "message": "  Counter: 0", "module": "provider", "function": "verify_attestation", "line": 577}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:12.884607Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Verifying WebAuthn authentication result", "module": "crypto", "function": "verify_webauthn_signature", "line": 1400}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:12.886232Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Client Data Type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1421}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:12.886277Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Origin: http://localhost:3000", "module": "crypto", "function": "verify_webauthn_signature", "line": 1422}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:12.886321Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Challenge matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1434}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:12.886363Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Authentication type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1441}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:12.887356Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "AuthenticatorData parsed: counter=0", "module": "crypto", "function": "verify_webauthn_signature", "line": 1454}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:12.887380Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Signature counter: 0 (AP2 compliant: replay attacks prevented by user_authorization nonce)", "module": "crypto", "function": "verify_webauthn_signature", "line": 1460}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:12.890559Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "RP ID Hash matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1473}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:12.943592Z", "level": "INFO", "logger": "v2.common.crypto", "message": "WebAuthn signature verified successfully", "module": "crypto", "function": "verify_webauthn_signature", "line": 1525}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:12.967999Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] Signature counter: 0 → 0 (AP2準拠: Authenticatorがcounterを実装していない場合でも、user_authorizationのnonceによりリプレイ攻撃は防止されます)", "module": "provider", "function": "verify_attestation", "line": 595}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:12.971947Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] No payment_method.token in mandate (likely IntentMandate signature), skipping Payment Network call", "module": "provider", "function": "verify_attestation", "line": 623}
ap2_credential_provider    | [2025-11-02 00:23:12,970] INFO in services.credential_provider.utils.token_helpers: [CredentialProvider] Generated attestation token for user: None
ap2_credential_provider    | [2025-11-02 00:23:13,011] INFO in services.credential_provider.utils.token_helpers: [CredentialProvider] Saved attestation: user=unknown, verified=True, agent_token=None...
ap2_credential_provider    | INFO:     172.18.0.10:33616 - "POST /verify/attestation HTTP/1.1" 200 OK
ap2_shopping_agent         | [2025-11-02 00:23:13,044] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Sent WebAuthn verification request to Credential Provider: user_id=usr_cdb4ec851bcf4f73
ap2_shopping_agent         | [2025-11-02 00:23:13,044] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] ✅ WebAuthn signature verified successfully: counter=0, attestation_type=passkey
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:13.044200Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (294.32ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:13.044362Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:23:12 GMT\", \"server\": \"uvicorn\", \"content-length\": \"191\", \"content-type\": \"application/json\"}, \"body\": {\"verified\": true, \"token\": \"cred_token_9f275c63_Ar7TkQO7efT6WNE4uKyuL3i3\", \"details\": {\"attestation_type\": \"passkey\", \"timestamp\": \"2025-11-02T00:23:13.011198+00:00\", \"counter\": 0, \"agent_token\": null}}, \"duration_ms\": 294.3246364593506}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:13.067538Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=cart_signature_pending", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:13.068316Z", "level": "INFO", "logger": "agent", "message": "[submit_cart_signature] CartMandate signed by user: cart_id=None, webauthn_assertion saved", "module": "agent", "function": "submit_cart_signature", "line": 1359}
ap2_shopping_agent         | INFO:     172.67.69.85:24268 - "POST /cart/submit-signature HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:13.096398Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:13.097688Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1762042681770_6b8nz\n  user_id: usr_cdb4ec851bcf4f73\n  user_input: _cart_signature_completed\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1102}
ap2_shopping_agent         | INFO:     172.67.69.85:24268 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:13.112618Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1762042681770_6b8nz, step=cart_signature_pending", "module": "agent", "function": "_get_or_create_session", "line": 1987}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:13.113736Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1762042681770_6b8nz)", "module": "agent", "function": "event_generator", "line": 1117}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:13.114082Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1762042681770_6b8nz", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1690}
ap2_shopping_agent         | [2025-11-02 00:23:13,152] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: cart_signature_pending
ap2_shopping_agent         |   user_input: _cart_signature_completed
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-02 00:23:13,401] INFO in services.shopping_agent.langgraph_shopping_flow: [select_payment_method_node] AP2 Step 13-14: Presenting payment methods to user
ap2_shopping_agent         |   Available Methods: 1
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:14.041524Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=payment_method_selection", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:14.053994Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=payment_method_selection", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:14.997368Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.001220Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1762042681770_6b8nz\n  user_id: usr_cdb4ec851bcf4f73\n  user_input: 1\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1102}
ap2_shopping_agent         | INFO:     172.67.69.85:27064 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.019263Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1762042681770_6b8nz, step=payment_method_selection", "module": "agent", "function": "_get_or_create_session", "line": 1987}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.020073Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1762042681770_6b8nz)", "module": "agent", "function": "event_generator", "line": 1117}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.021837Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1762042681770_6b8nz", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1690}
ap2_shopping_agent         | [2025-11-02 00:23:15,061] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: payment_method_selection
ap2_shopping_agent         |   user_input: 1
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-02 00:23:15,069] INFO in services.shopping_agent.langgraph_shopping_flow: [select_payment_method_node] AP2 Step 15-18: Tokenizing payment method
ap2_shopping_agent         |   User ID: usr_cdb4ec851bcf4f73
ap2_shopping_agent         |   Payment Method ID: pm_f4745ec2
ap2_shopping_agent         |   CP URL: http://credential_provider:8003
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.071485Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Requesting payment method tokenization for: pm_f4745ec2", "module": "agent", "function": "_tokenize_payment_method", "line": 2396}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.071972Z", "level": "INFO", "logger": "agent", "message": "\n================================================================================\n[ShoppingAgent → CredentialProvider] トークン化リクエスト送信\n  URL: http://credential_provider:8003/payment-methods/tokenize\n  User ID: usr_cdb4ec851bcf4f73\n  Payment Method ID: pm_f4745ec2\n================================================================================", "module": "agent", "function": "_tokenize_payment_method", "line": 2400}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.072772Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://credential_provider:8003/payment-methods/tokenize", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.072831Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/payment-methods/tokenize\", \"headers\": {}, \"body\": {\"user_id\": \"usr_cdb4ec851bcf4f73\", \"payment_method_id\": \"pm_f4745ec2\"}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:15.166864Z", "level": "INFO", "logger": "provider", "message": "[tokenize_payment_method] Generated secure token for payment method: pm_f4745ec2", "module": "provider", "function": "tokenize_payment_method", "line": 818}
ap2_credential_provider    | INFO:     172.18.0.10:33616 - "POST /payment-methods/tokenize HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.172856Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (100.04ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.172935Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:23:14 GMT\", \"server\": \"uvicorn\", \"content-length\": \"176\", \"content-type\": \"application/json\"}, \"body\": {\"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"payment_method_id\": \"pm_f4745ec2\", \"brand\": \"Visa\", \"last4\": \"1111\", \"type\": \"basic-card\", \"expires_at\": \"2025-11-02T00:38:15.152206Z\"}, \"duration_ms\": 100.03805160522461}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.172983Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent ← CredentialProvider] トークン化レスポンス受信: status=200", "module": "agent", "function": "_tokenize_payment_method", "line": 2420}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.173023Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Payment method tokenized: pm_f4745ec2 → tok_3244e30f_jRYXCTj...", "module": "agent", "function": "_tokenize_payment_method", "line": 2430}
ap2_shopping_agent         | [2025-11-02 00:23:15,173] INFO in services.shopping_agent.langgraph_shopping_flow: [select_payment_method_node] AP2 Step 17-18: Received tokenized payment method
ap2_shopping_agent         |   Token: tok_3244e30f_jRYXCTj...
ap2_shopping_agent         | [2025-11-02 00:23:15,173] INFO in services.shopping_agent.utils.payment_helpers: [_extract_payment_amount_from_cart] CartMandate structure: has_contents=True, has_payment_request=True, has_details=True, has_total=True, total_amount={'value': 2315.0, 'currency': 'JPY'}
ap2_shopping_agent         | [2025-11-02 00:23:15,174] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Retrieving public key from Credential Provider: credential_id=dCDQdGlqx50G-UFW..., user_id=usr_cdb4ec851bcf4f73
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.174842Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://credential_provider:8003/passkey/get-public-key", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.174896Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/passkey/get-public-key\", \"headers\": {}, \"body\": {\"credential_id\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"user_id\": \"usr_cdb4ec851bcf4f73\"}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:15.186927Z", "level": "INFO", "logger": "provider", "message": "[get_passkey_public_key] Public key retrieved: credential_id=dCDQdGlqx50G-UFW..., user_id=usr_cdb4ec851bcf4f73", "module": "provider", "function": "get_passkey_public_key", "line": 1541}
ap2_credential_provider    | INFO:     172.18.0.10:33616 - "POST /passkey/get-public-key HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.188438Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (13.56ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.188482Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:23:14 GMT\", \"server\": \"uvicorn\", \"content-length\": \"212\", \"content-type\": \"application/json\"}, \"body\": {\"credential_id\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"public_key_cose\": \"pQECAyYgASFYIOnePT967mopshGl7tTo53MmMkE/bY6/WZuuZLHSWZYrIlggJj7UcPfh0MaQpNxA5bgmtZPTWi8YVP4x4C8ivq8RFDQ=\", \"user_id\": \"usr_cdb4ec851bcf4f73\"}, \"duration_ms\": 13.564586639404297}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-02 00:23:15,188] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] ✅ Public key retrieved: credential_id=dCDQdGlqx50G-UFW...
ap2_shopping_agent         | [2025-11-02 00:23:15,189] INFO in v2.common.user_authorization: [create_user_authorization_vp] WebAuthn challenge from assertion: eyJtYW5kYXRlX2lk...
ap2_shopping_agent         | [2025-11-02 00:23:15,189] INFO in v2.common.user_authorization: [create_user_authorization_vp] cart_hash: 72fc7ad62509d73f...
ap2_shopping_agent         | [2025-11-02 00:23:15,189] INFO in v2.common.user_authorization: [create_user_authorization_vp] payment_hash: 11d871264efdfe66...
ap2_shopping_agent         | [2025-11-02 00:23:15,199] INFO in v2.common.user_authorization: [create_user_authorization_vp] Restored public key from COSE format (DB)
ap2_shopping_agent         | [2025-11-02 00:23:15,200] INFO in v2.common.user_authorization: [create_user_authorization_vp] cnf claim with JWK added to Issuer JWT
ap2_shopping_agent         | [2025-11-02 00:23:15,201] INFO in v2.common.user_authorization: [create_user_authorization_vp] Generated user_authorization VP: length=2428, cart_hash=72fc7ad62509d73f..., payment_hash=11d871264efdfe66...
ap2_shopping_agent         | [2025-11-02 00:23:15,201] INFO in services.shopping_agent.utils.payment_helpers: [_generate_user_authorization_for_payment] Generated user_authorization VP: length=2428
ap2_shopping_agent         | [2025-11-02 00:23:15,202] INFO in services.shopping_agent.utils.payment_helpers: [ShoppingAgent] transaction_type=human_present (WebAuthn assertion completed)
ap2_shopping_agent         | [2025-11-02 00:23:15,202] INFO in services.shopping_agent.utils.payment_helpers: [ShoppingAgent] Performing risk assessment...
ap2_shopping_agent         | [2025-11-02 00:23:15,203] WARNING in v2.common.risk_assessment: [RiskAssessmentEngine] Invalid amount value: 2315.0
ap2_shopping_agent         | [2025-11-02 00:23:15,203] WARNING in v2.common.risk_assessment: [RiskAssessmentEngine] Failed to parse amounts for constraint check
ap2_shopping_agent         | [2025-11-02 00:23:15,206] INFO in v2.common.risk_assessment: [RiskAssessmentEngine] Assessment completed: risk_score=2, recommendation=approve, fraud_indicators=[]
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.207240Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] PaymentMandate created with user_authorization: has_user_auth=True", "module": "agent", "function": "_create_payment_mandate", "line": 2165}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.207282Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] PaymentMandate created: amount=2315.0 JPY, payment_method=Visa ****1111, token=tok_3244e30f_jRYXCTj..., risk_score=2", "module": "agent", "function": "_create_payment_mandate", "line": 2170}
ap2_shopping_agent         | [2025-11-02 00:23:15,207] INFO in services.shopping_agent.utils.payment_helpers: [ShoppingAgent] Risk assessment completed: score=2, recommendation=approve, indicators=[]
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.268144Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=webauthn_signature_requested", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:15.284208Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=webauthn_signature_requested", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | INFO:     172.67.69.85:27064 - "OPTIONS /payment/submit-attestation HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:18.547395Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:18.556138Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] Verifying attestation for PaymentMandate: payment_e915afc6", "module": "agent", "function": "submit_payment_attestation", "line": 1471}
ap2_shopping_agent         | [2025-11-02 00:23:18,556] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Verifying PaymentMandate attestation: payment_id=payment_e915afc6
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:18.558157Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://credential_provider:8003/verify/attestation", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:18.558563Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/verify/attestation\", \"headers\": {}, \"body\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_e915afc6\", \"payment_details_id\": \"order_1d731e48\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-02T00:23:15.173881Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJOa1lqUmxZemcxTVdKalpqUm1Oek1pTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMk5rWWpSbFl6ZzFNV0pqWmpSbU56TWlMQ0pwWVhRaU9qRTNOakl3TkRJNU9UVXNJbVY0Y0NJNk1UYzJNakEwTXpJNU5Td2libUptSWpveE56WXlNRFF5T1RrMUxDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaU5tUTBPVkF6Y25WaGFXMTVSV0ZZZFRGUGFtNWplVmw1VVZRNWRHcHlPVnB0TmpWcmMyUktXbXhwY3lJc0lua2lPaUpLYWpkVlkxQm1hREJOWVZGd1RuaEJOV0puYlhSYVVGUlhhVGhaVmxBMGVEUkRPR2wyY1RoU1JrUlJJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpuWkU5Nk0wc3lOR3BVYjBwRU1VNWZPRTUxUjA1QmVrOUNORUppUXpGeGRYaFFSbTlsTUhWVFozQlpJaXdpYVdGMElqb3hOell5TURReU9UazFMQ0p6WkY5b1lYTm9Jam9pTVdNM05tRm1ZMlkyWlRSaVl6bG1NR1JsWVRZNE1HRTBZVFZrTkRSaE9HRTJOVEExTnpsbFlUa3pNamc0TUdNNU5UazJNMlJoWXpBellqRXhaamN3TXlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lOekptWXpkaFpEWXlOVEE1WkRjelpqRmxPRE5sWVdNd1ltWXlZVFJoWmpkbFpUVTBZVFEzTm1FelltVXpOV1V4TkRaallUQTJaRFUxWkdVMllXVmpaU0lzSWpFeFpEZzNNVEkyTkdWbVpHWmxOalkwWW1NeE9EZzBZMkV4TVRrM1lXSTFOamcxT0dWak9EWmpZekZrT1dSbFptTmhNelJqWVRneVl6SmxOamhqTTJVaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyYXdJZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybFpNa1o1WkVZNE1scHFXVEZOVjAxM1RtbEpjMGx1VW5CaVYxWjZaRWRHZEdORFNUWk5WR015VFdwQk1FMXFhelZOUkdNelQwZ3dJaXdpYjNKcFoybHVJam9pYUhSMGNEb3ZMMnh2WTJGc2FHOXpkRG96TURBd0lpd2lZM0p2YzNOUGNtbG5hVzRpT21aaGJITmxmUSIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVlDSVFDQ3EtRjdCS24yeDBJRE9qYXpwRjVxamhSUk83SlhQVE1GUDBmVUFUNUdYZ0loQUlsUUFLQkNvV1JuYzhGb3FsWWpQUkVrUzVIa095azVZN0pGbG55Z3Q0LXciLCJ1c2VySGFuZGxlIjoidXNyX2NkYjRlYzg1MWJjZjRmNzMifSwidHlwZSI6InB1YmxpYy1rZXkiLCJhdHRlc3RhdGlvbl90eXBlIjoicGFzc2tleSIsImNoYWxsZW5nZSI6ImV5SnRZVzVrWVhSbFgybGtJam9pWTJGeWRGODJaalkxTVdNd05pSXNJblJwYldWemRHRnRjQ0k2TVRjMk1qQTBNams1TURjM09IMCJ9LCJjYXJ0X2hhc2giOiI3MmZjN2FkNjI1MDlkNzNmMWU4M2VhYzBiZjJhNGFmN2VlNTRhNDc2YTNiZTM1ZTE0NmNhMDZkNTVkZTZhZWNlIiwicGF5bWVudF9oYXNoIjoiMTFkODcxMjY0ZWZkZmU2NjRiYzE4ODRjYTExOTdhYjU2ODU4ZWM4NmNjMWQ5ZGVmY2EzNGNhODJjMmU2OGMzZSJ9\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_e915afc6\", \"cart_mandate_id\": \"cart_6f651c06\", \"intent_mandate_id\": \"intent_76e80f2f\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"attestation\": {\"id\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"rawId\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"response\": {\"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlbmdlIjoiZXlKdFlXNWtZWFJsWDJsa0lqb2ljR0Y1YldWdWRGOWxPVEUxWVdaak5pSXNJblJwYldWemRHRnRjQ0k2TVRjMk1qQTBNams1TmpZME1YMCIsIm9yaWdpbiI6Imh0dHA6Ly9sb2NhbGhvc3Q6MzAwMCIsImNyb3NzT3JpZ2luIjpmYWxzZX0\", \"authenticatorData\": \"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2MdAAAAAA\", \"signature\": \"MEQCIHuhiaPNPNOq3x1kWq8TPLgqtJ4U5Qz2wtmTxKx_aqVbAiBkSnbes02SWU6UBEi4Z9o2X87r0uAFDOxduuPTebDbkg\", \"userHandle\": \"usr_cdb4ec851bcf4f73\"}, \"type\": \"public-key\", \"attestation_type\": \"passkey\", \"challenge\": \"eyJtYW5kYXRlX2lkIjoicGF5bWVudF9lOTE1YWZjNiIsInRpbWVzdGFtcCI6MTc2MjA0Mjk5NjY0MX0\"}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.638610Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] Found passkey: dCDQdGlqx50G-UFW...", "module": "provider", "function": "verify_attestation", "line": 575}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.639172Z", "level": "INFO", "logger": "provider", "message": "  User: usr_cdb4ec851bcf4f73", "module": "provider", "function": "verify_attestation", "line": 576}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.639221Z", "level": "INFO", "logger": "provider", "message": "  Counter: 0", "module": "provider", "function": "verify_attestation", "line": 577}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.639517Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Verifying WebAuthn authentication result", "module": "crypto", "function": "verify_webauthn_signature", "line": 1400}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.639900Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Client Data Type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1421}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.639930Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Origin: http://localhost:3000", "module": "crypto", "function": "verify_webauthn_signature", "line": 1422}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.639952Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Challenge matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1434}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.640017Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "Authentication type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1441}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.640334Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "AuthenticatorData parsed: counter=0", "module": "crypto", "function": "verify_webauthn_signature", "line": 1454}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.640360Z", "level": "INFO", "logger": "v2.common.crypto", "message": "Signature counter: 0 (AP2 compliant: replay attacks prevented by user_authorization nonce)", "module": "crypto", "function": "verify_webauthn_signature", "line": 1460}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.640543Z", "level": "DEBUG", "logger": "v2.common.crypto", "message": "RP ID Hash matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1473}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.646723Z", "level": "INFO", "logger": "v2.common.crypto", "message": "WebAuthn signature verified successfully", "module": "crypto", "function": "verify_webauthn_signature", "line": 1525}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.655275Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] Signature counter: 0 → 0 (AP2準拠: Authenticatorがcounterを実装していない場合でも、user_authorizationのnonceによりリプレイ攻撃は防止されます)", "module": "provider", "function": "verify_attestation", "line": 595}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.655846Z", "level": "INFO", "logger": "provider", "message": "[verify_attestation] PaymentMandate contains payment_method.token, calling Payment Network (Step 23)", "module": "provider", "function": "verify_attestation", "line": 614}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.655902Z", "level": "INFO", "logger": "provider", "message": "[CredentialProvider] Requesting Agent Token from Payment Network: payment_mandate_id=payment_e915afc6", "module": "provider", "function": "_request_agent_token_from_network", "line": 1852}
ap2_credential_provider    | [2025-11-02 00:23:18,655] INFO in services.credential_provider.utils.token_helpers: [CredentialProvider] Generated attestation token for user: usr_cdb4ec851bcf4f73
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.656219Z", "level": "INFO", "logger": "provider", "message": "HTTP Request: POST http://payment_network:8005/network/tokenize", "module": "logger", "function": "log_http_request", "line": 182}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:18.656760Z", "level": "DEBUG", "logger": "provider", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://payment_network:8005/network/tokenize\", \"headers\": {}, \"body\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_e915afc6\", \"payment_details_id\": \"order_1d731e48\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-02T00:23:15.173881Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJOa1lqUmxZemcxTVdKalpqUm1Oek1pTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMk5rWWpSbFl6ZzFNV0pqWmpSbU56TWlMQ0pwWVhRaU9qRTNOakl3TkRJNU9UVXNJbVY0Y0NJNk1UYzJNakEwTXpJNU5Td2libUptSWpveE56WXlNRFF5T1RrMUxDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaU5tUTBPVkF6Y25WaGFXMTVSV0ZZZFRGUGFtNWplVmw1VVZRNWRHcHlPVnB0TmpWcmMyUktXbXhwY3lJc0lua2lPaUpLYWpkVlkxQm1hREJOWVZGd1RuaEJOV0puYlhSYVVGUlhhVGhaVmxBMGVEUkRPR2wyY1RoU1JrUlJJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpuWkU5Nk0wc3lOR3BVYjBwRU1VNWZPRTUxUjA1QmVrOUNORUppUXpGeGRYaFFSbTlsTUhWVFozQlpJaXdpYVdGMElqb3hOell5TURReU9UazFMQ0p6WkY5b1lYTm9Jam9pTVdNM05tRm1ZMlkyWlRSaVl6bG1NR1JsWVRZNE1HRTBZVFZrTkRSaE9HRTJOVEExTnpsbFlUa3pNamc0TUdNNU5UazJNMlJoWXpBellqRXhaamN3TXlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lOekptWXpkaFpEWXlOVEE1WkRjelpqRmxPRE5sWVdNd1ltWXlZVFJoWmpkbFpUVTBZVFEzTm1FelltVXpOV1V4TkRaallUQTJaRFUxWkdVMllXVmpaU0lzSWpFeFpEZzNNVEkyTkdWbVpHWmxOalkwWW1NeE9EZzBZMkV4TVRrM1lXSTFOamcxT0dWak9EWmpZekZrT1dSbFptTmhNelJqWVRneVl6SmxOamhqTTJVaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyYXdJZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybFpNa1o1WkVZNE1scHFXVEZOVjAxM1RtbEpjMGx1VW5CaVYxWjZaRWRHZEdORFNUWk5WR015VFdwQk1FMXFhelZOUkdNelQwZ3dJaXdpYjNKcFoybHVJam9pYUhSMGNEb3ZMMnh2WTJGc2FHOXpkRG96TURBd0lpd2lZM0p2YzNOUGNtbG5hVzRpT21aaGJITmxmUSIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVlDSVFDQ3EtRjdCS24yeDBJRE9qYXpwRjVxamhSUk83SlhQVE1GUDBmVUFUNUdYZ0loQUlsUUFLQkNvV1JuYzhGb3FsWWpQUkVrUzVIa095azVZN0pGbG55Z3Q0LXciLCJ1c2VySGFuZGxlIjoidXNyX2NkYjRlYzg1MWJjZjRmNzMifSwidHlwZSI6InB1YmxpYy1rZXkiLCJhdHRlc3RhdGlvbl90eXBlIjoicGFzc2tleSIsImNoYWxsZW5nZSI6ImV5SnRZVzVrWVhSbFgybGtJam9pWTJGeWRGODJaalkxTVdNd05pSXNJblJwYldWemRHRnRjQ0k2TVRjMk1qQTBNams1TURjM09IMCJ9LCJjYXJ0X2hhc2giOiI3MmZjN2FkNjI1MDlkNzNmMWU4M2VhYzBiZjJhNGFmN2VlNTRhNDc2YTNiZTM1ZTE0NmNhMDZkNTVkZTZhZWNlIiwicGF5bWVudF9oYXNoIjoiMTFkODcxMjY0ZWZkZmU2NjRiYzE4ODRjYTExOTdhYjU2ODU4ZWM4NmNjMWQ5ZGVmY2EzNGNhODJjMmU2OGMzZSJ9\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_e915afc6\", \"cart_mandate_id\": \"cart_6f651c06\", \"intent_mandate_id\": \"intent_76e80f2f\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"attestation\": {\"id\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"rawId\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"response\": {\"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlbmdlIjoiZXlKdFlXNWtZWFJsWDJsa0lqb2ljR0Y1YldWdWRGOWxPVEUxWVdaak5pSXNJblJwYldWemRHRnRjQ0k2TVRjMk1qQTBNams1TmpZME1YMCIsIm9yaWdpbiI6Imh0dHA6Ly9sb2NhbGhvc3Q6MzAwMCIsImNyb3NzT3JpZ2luIjpmYWxzZX0\", \"authenticatorData\": \"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2MdAAAAAA\", \"signature\": \"MEQCIHuhiaPNPNOq3x1kWq8TPLgqtJ4U5Qz2wtmTxKx_aqVbAiBkSnbes02SWU6UBEi4Z9o2X87r0uAFDOxduuPTebDbkg\", \"userHandle\": \"usr_cdb4ec851bcf4f73\"}, \"type\": \"public-key\", \"attestation_type\": \"passkey\", \"challenge\": \"eyJtYW5kYXRlX2lkIjoicGF5bWVudF9lOTE1YWZjNiIsInRpbWVzdGFtcCI6MTc2MjA0Mjk5NjY0MX0\"}, \"payment_method_token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"transaction_context\": {\"credential_provider_id\": \"did:ap2:agent:credential_provider\", \"timestamp\": \"2025-11-02T00:23:18.655928+00:00\"}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_payment_network        | [2025-11-02 00:23:18,827] INFO in network: [DemoPaymentNetwork] Received tokenization request: payment_mandate_id=payment_e915afc6, payment_method_token=tok_3244e30f_jRYXCTj...
ap2_payment_network        | [2025-11-02 00:23:18,892] INFO in common.redis_client: [RedisClient] Connected to Redis: redis://redis:6379/2
ap2_payment_network        | [2025-11-02 00:23:18,953] INFO in services.payment_network.utils.token_helpers: [DemoPaymentNetwork] Issued Agent Token (Redis): agent_tok_demopaymentnetwork_d27..., expires_at=2025-11-02T01:23:18.833384+00:00, ttl=3600s
ap2_payment_network        | INFO:     172.18.0.12:56518 - "POST /network/tokenize HTTP/1.1" 200 OK
ap2_credential_provider    | [2025-11-02 00:23:18,996] INFO in httpx: HTTP Request: POST http://payment_network:8005/network/tokenize "HTTP/1.1 200 OK"
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:19.003108Z", "level": "INFO", "logger": "provider", "message": "HTTP Response: 200 (346.71ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:19.005214Z", "level": "DEBUG", "logger": "provider", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:23:17 GMT\", \"server\": \"uvicorn\", \"content-length\": \"186\", \"content-type\": \"application/json\"}, \"body\": {\"agent_token\": \"agent_tok_demopaymentnetwork_d27f5aaf_9fvCCqg5K0J_yFF-EU66BM6y\", \"expires_at\": \"2025-11-02T01:23:18.833384Z\", \"network_name\": \"DemoPaymentNetwork\", \"token_type\": \"agent_token\"}, \"duration_ms\": 346.7116355895996}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:19.005271Z", "level": "INFO", "logger": "provider", "message": "[CredentialProvider] Received Agent Token from Payment Network: agent_tok_demopaymentnetwork_d27..., network_name=DemoPaymentNetwork", "module": "provider", "function": "_request_agent_token_from_network", "line": 1876}
ap2_credential_provider    | [2025-11-02 00:23:19,061] INFO in services.credential_provider.utils.token_helpers: [CredentialProvider] Saved attestation: user=usr_cdb4ec851bcf4f73, verified=True, agent_token=agent_tok_demopaymentnetwork_d27...
ap2_credential_provider    | INFO:     172.18.0.10:33616 - "POST /verify/attestation HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.079745Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (520.97ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.080044Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:23:17 GMT\", \"server\": \"uvicorn\", \"content-length\": \"251\", \"content-type\": \"application/json\"}, \"body\": {\"verified\": true, \"token\": \"cred_token_c1ccbb2f_r9RDwlpCoE5p7L2OAsrHtFbi\", \"details\": {\"attestation_type\": \"passkey\", \"timestamp\": \"2025-11-02T00:23:19.061810+00:00\", \"counter\": 0, \"agent_token\": \"agent_tok_demopaymentnetwork_d27f5aaf_9fvCCqg5K0J_yFF-EU66BM6y\"}}, \"duration_ms\": 520.9689140319824}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.080333Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] Attestation verified, processing payment...", "module": "agent", "function": "submit_payment_attestation", "line": 1491}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.080512Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://credential_provider:8003/passkey/get-public-key", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.080550Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/passkey/get-public-key\", \"headers\": {}, \"body\": {\"credential_id\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"user_id\": \"usr_cdb4ec851bcf4f73\"}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_shopping_agent         | [2025-11-02 00:23:19,080] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] ✅ PaymentMandate attestation verified: payment_id=payment_e915afc6
ap2_shopping_agent         | [2025-11-02 00:23:19,080] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Retrieving public key from Credential Provider: credential_id=dCDQdGlqx50G-UFW..., user_id=usr_cdb4ec851bcf4f73
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:19.091147Z", "level": "INFO", "logger": "provider", "message": "[get_passkey_public_key] Public key retrieved: credential_id=dCDQdGlqx50G-UFW..., user_id=usr_cdb4ec851bcf4f73", "module": "provider", "function": "get_passkey_public_key", "line": 1541}
ap2_credential_provider    | INFO:     172.18.0.10:33616 - "POST /passkey/get-public-key HTTP/1.1" 200 OK
ap2_shopping_agent         | [2025-11-02 00:23:19,099] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] ✅ Public key retrieved: credential_id=dCDQdGlqx50G-UFW...
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.099745Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (19.08ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.099877Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:23:18 GMT\", \"server\": \"uvicorn\", \"content-length\": \"212\", \"content-type\": \"application/json\"}, \"body\": {\"credential_id\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"public_key_cose\": \"pQECAyYgASFYIOnePT967mopshGl7tTo53MmMkE/bY6/WZuuZLHSWZYrIlggJj7UcPfh0MaQpNxA5bgmtZPTWi8YVP4x4C8ivq8RFDQ=\", \"user_id\": \"usr_cdb4ec851bcf4f73\"}, \"duration_ms\": 19.081830978393555}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-02 00:23:19,100] INFO in v2.common.user_authorization: [create_user_authorization_vp] WebAuthn challenge from assertion: eyJtYW5kYXRlX2lk...
ap2_shopping_agent         | [2025-11-02 00:23:19,102] INFO in v2.common.user_authorization: [create_user_authorization_vp] cart_hash: 72fc7ad62509d73f...
ap2_shopping_agent         | [2025-11-02 00:23:19,102] INFO in v2.common.user_authorization: [create_user_authorization_vp] payment_hash: f41dfb0331d8a358...
ap2_shopping_agent         | [2025-11-02 00:23:19,104] INFO in v2.common.user_authorization: [create_user_authorization_vp] Restored public key from COSE format (DB)
ap2_shopping_agent         | [2025-11-02 00:23:19,105] INFO in v2.common.user_authorization: [create_user_authorization_vp] cnf claim with JWK added to Issuer JWT
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.106928Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] SD-JWT-VC user_authorization generated: user_id=usr_cdb4ec851bcf4f73, vp_length=2438", "module": "agent", "function": "submit_payment_attestation", "line": 1535}
ap2_shopping_agent         | [2025-11-02 00:23:19,106] INFO in v2.common.user_authorization: [create_user_authorization_vp] Generated user_authorization VP: length=2438, cart_hash=72fc7ad62509d73f..., payment_hash=f41dfb0331d8a358...
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.152827Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=webauthn_signature_requested", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.153755Z", "level": "INFO", "logger": "agent", "message": "[submit_payment_attestation] PaymentMandate signed by user: payment_id=payment_e915afc6, next_step=payment_execution", "module": "agent", "function": "submit_payment_attestation", "line": 1556}
ap2_shopping_agent         | INFO:     172.67.69.85:27064 - "POST /payment/submit-attestation HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.202972Z", "level": "DEBUG", "logger": "v2.common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.204410Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Received request\n  session_id: session_1762042681770_6b8nz\n  user_id: usr_cdb4ec851bcf4f73\n  user_input: _payment_signature_completed\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1102}
ap2_shopping_agent         | INFO:     172.67.69.85:27064 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.213978Z", "level": "INFO", "logger": "agent", "message": "[ShoppingAgent] Loaded session from DB: session_1762042681770_6b8nz, step=webauthn_signature_requested", "module": "agent", "function": "_get_or_create_session", "line": 1987}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.216708Z", "level": "INFO", "logger": "agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1762042681770_6b8nz)", "module": "agent", "function": "event_generator", "line": 1117}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.217830Z", "level": "DEBUG", "logger": "agent", "message": "[Langfuse] Reusing existing handler for session: session_1762042681770_6b8nz", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1690}
ap2_shopping_agent         | [2025-11-02 00:23:19,242] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: webauthn_signature_requested
ap2_shopping_agent         |   user_input: _payment_signature_completed
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-02 00:23:19,274] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Requesting payment processing via Merchant Agent for PaymentMandate: payment_e915afc6
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.277860Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 995}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.279160Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 5746, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_e915afc6\",\"payload\":{\"cart_mandate\":{\"_metadata\":{\"cart_description\":\"価格重視で最安値のキーホルダーと靴下を組み合わせた
プラン。かわいさと予算を両立させます。\",\"cart_name\":\"コスパ最強プ", "module": "crypto", "function": "sign_a2a_message", "line": 999}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.279412Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 794}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.284265Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: shopping_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.285359Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:merchant_agent: ap2.mandates.PaymentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.285491Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.mandates.PaymentMandate\", \"peer\": \"did:ap2:agent:merchant_agent\", \"headers\": {\"message_id\": \"f1651fa0-2673-4b81-81e4-32158524ce57\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-02T00:23:19.274803Z\", \"nonce\": \"8751fcc0cddd8fb236a121ce6b6fd2609ac891ecbef59c233306efe5dd91cea7\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_e915afc6\", \"payment_details_id\": \"order_1d731e48\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-02T00:23:15.173881Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJOa1lqUmxZemcxTVdKalpqUm1Oek1pTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMk5rWWpSbFl6ZzFNV0pqWmpSbU56TWlMQ0pwWVhRaU9qRTNOakl3TkRJNU9Ua3NJbVY0Y0NJNk1UYzJNakEwTXpJNU9Td2libUptSWpveE56WXlNRFF5T1RrNUxDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaU5tUTBPVkF6Y25WaGFXMTVSV0ZZZFRGUGFtNWplVmw1VVZRNWRHcHlPVnB0TmpWcmMyUktXbXhwY3lJc0lua2lPaUpLYWpkVlkxQm1hREJOWVZGd1RuaEJOV0puYlhSYVVGUlhhVGhaVmxBMGVEUkRPR2wyY1RoU1JrUlJJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpxVEVsdFdXRnZUVVV6ZEdaNFNFZHJka1ZOVUZjdFpIRlpVMGhJV0ZRMGVsaENPRFpwTmpCR1NsQk5JaXdpYVdGMElqb3hOell5TURReU9UazVMQ0p6WkY5b1lYTm9Jam9pWVdJd1lUazNOV0UwWWpWa01tRm1PREZpWlRRd09HUmpZV1l5TnpjME5HSmtPVGhpWVdRelkyUXhOalUxT0daaVl6Tm1ZbVl5TnpBek5ETmtOVEprT1NJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lOekptWXpkaFpEWXlOVEE1WkRjelpqRmxPRE5sWVdNd1ltWXlZVFJoWmpkbFpUVTBZVFEzTm1FelltVXpOV1V4TkRaallUQTJaRFUxWkdVMllXVmpaU0lzSW1ZME1XUm1ZakF6TXpGa09HRXpOVGhsTURrM01ETXpORGt5TW1ZMk1XSmhPV016WVdFd01EUTROamd5T1RCbVpUUTBOVEF3T0Rsa01tVmxZekUxTVdVaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyYXdJZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybGpSMFkxWWxkV2RXUkdPV3hQVkVVeFdWZGFhazVwU1hOSmJsSndZbGRXZW1SSFJuUmpRMGsyVFZSak1rMXFRVEJOYW1zMVRtcFpNRTFZTUNJc0ltOXlhV2RwYmlJNkltaDBkSEE2THk5c2IyTmhiR2h2YzNRNk16QXdNQ0lzSW1OeWIzTnpUM0pwWjJsdUlqcG1ZV3h6WlgwIiwiYXV0aGVudGljYXRvckRhdGEiOiJTWllONVlnT2pHaDBOQmNQWkhaZ1c0X2tycm1paGpMSG1Wenp1b01kbDJNZEFBQUFBQSIsInNpZ25hdHVyZSI6Ik1FUUNJSHVoaWFQTlBOT3EzeDFrV3E4VFBMZ3F0SjRVNVF6Mnd0bVR4S3hfYXFWYkFpQmtTbmJlczAyU1dVNlVCRWk0WjlvMlg4N3IwdUFGRE94ZHV1UFRlYkRia2ciLCJ1c2VySGFuZGxlIjoidXNyX2NkYjRlYzg1MWJjZjRmNzMifSwidHlwZSI6InB1YmxpYy1rZXkiLCJhdHRlc3RhdGlvbl90eXBlIjoicGFzc2tleSIsImNoYWxsZW5nZSI6ImV5SnRZVzVrWVhSbFgybGtJam9pY0dGNWJXVnVkRjlsT1RFMVlXWmpOaUlzSW5ScGJXVnpkR0Z0Y0NJNk1UYzJNakEwTWprNU5qWTBNWDAifSwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsInBheW1lbnRfaGFzaCI6ImY0MWRmYjAzMzFkOGEzNThlMDk3MDMzNDkyMmY2MWJhOWMzYWEwMDQ4NjgyOTBmZTQ0NTAwODlkMmVlYzE1MWUifQ\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_e915afc6\", \"cart_mandate_id\": \"cart_6f651c06\", \"intent_mandate_id\": \"intent_76e80f2f\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_6f651c06\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_6f651c06\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼー靴下\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 165.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.669414Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRkNWRiYmJlLWIzMTUtNGIzYi05NDU3LTk1MDc2YWY1MWQzMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9HMgj89sDLXHUsoAo3fzJx7SFPzWRcZbwqWRgNFNLzJT9502pxwGgqEJOmoIHKCB1NVHvtf3PMxffijmp-oiBw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.669856Z\", \"cart_name\": \"コスパ最強プラン (1,650円)\", \"cart_description\": \"価格重視で最安値のキーホルダーと靴下を組み合わせたプラン。かわいさと予算を両立させます。\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホル
ダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_shopping_agent         | [2025-11-02 00:23:19,285] INFO in services.shopping_agent.utils.merchant_integration:
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [ShoppingAgent → MerchantAgent] A2Aメッセージ送信（PaymentRequest）
ap2_shopping_agent         |   URL: http://merchant_agent:8001/a2a/message
ap2_shopping_agent         |   メッセージID: f1651fa0-2673-4b81-81e4-32158524ce57
ap2_shopping_agent         |   タイプ: ap2.mandates.PaymentMandate
ap2_shopping_agent         |   PaymentMandate ID: payment_e915afc6
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.287531Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://merchant_agent:8001/a2a/message", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:19.287668Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent:8001/a2a/message\", \"headers\": {}, \"body\": {\"header\": {\"message_id\": \"f1651fa0-2673-4b81-81e4-32158524ce57\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-02T00:23:19.274803Z\", \"nonce\": \"8751fcc0cddd8fb236a121ce6b6fd2609ac891ecbef59c233306efe5dd91cea7\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"vBPhcEpLk9vi6wRXFT7tbrHEkD7gxVC2WUN0FtmPrtPx736V5EIjgxvzbHIzYCBqpBtqwSEnX6ZteG//ZLdMDg==\", \"publicKeyMultibase\": \"z6MkpL5YFLHxAcp6LSJboXQ3nBnNGrQ4TiZRmWBZamPo7t8x\", \"kid\": \"did:ap2:agent:shopping_agent#key-2\", \"created\": \"2025-11-02T00:23:19.274803Z\", \"proofPurpose\": \"authentication\"}}, \"dataPart\": {\"@type\": \"ap2.mandates.PaymentMandate\", \"id\": \"payment_e915afc6\", \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_e915afc6\", \"payment_details_id\": \"order_1d731e48\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-02T00:23:15.173881Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJOa1lqUmxZemcxTVdKalpqUm1Oek1pTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMk5rWWpSbFl6ZzFNV0pqWmpSbU56TWlMQ0pwWVhRaU9qRTNOakl3TkRJNU9Ua3NJbVY0Y0NJNk1UYzJNakEwTXpJNU9Td2libUptSWpveE56WXlNRFF5T1RrNUxDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaU5tUTBPVkF6Y25WaGFXMTVSV0ZZZFRGUGFtNWplVmw1VVZRNWRHcHlPVnB0TmpWcmMyUktXbXhwY3lJc0lua2lPaUpLYWpkVlkxQm1hREJOWVZGd1RuaEJOV0puYlhSYVVGUlhhVGhaVmxBMGVEUkRPR2wyY1RoU1JrUlJJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpxVEVsdFdXRnZUVVV6ZEdaNFNFZHJka1ZOVUZjdFpIRlpVMGhJV0ZRMGVsaENPRFpwTmpCR1NsQk5JaXdpYVdGMElqb3hOell5TURReU9UazVMQ0p6WkY5b1lYTm9Jam9pWVdJd1lUazNOV0UwWWpWa01tRm1PREZpWlRRd09HUmpZV1l5TnpjME5HSmtPVGhpWVdRelkyUXhOalUxT0daaVl6Tm1ZbVl5TnpBek5ETmtOVEprT1NJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lOekptWXpkaFpEWXlOVEE1WkRjelpqRmxPRE5sWVdNd1ltWXlZVFJoWmpkbFpUVTBZVFEzTm1FelltVXpOV1V4TkRaallUQTJaRFUxWkdVMllXVmpaU0lzSW1ZME1XUm1ZakF6TXpGa09HRXpOVGhsTURrM01ETXpORGt5TW1ZMk1XSmhPV016WVdFd01EUTROamd5T1RCbVpUUTBOVEF3T0Rsa01tVmxZekUxTVdVaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyYXdJZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybGpSMFkxWWxkV2RXUkdPV3hQVkVVeFdWZGFhazVwU1hOSmJsSndZbGRXZW1SSFJuUmpRMGsyVFZSak1rMXFRVEJOYW1zMVRtcFpNRTFZTUNJc0ltOXlhV2RwYmlJNkltaDBkSEE2THk5c2IyTmhiR2h2YzNRNk16QXdNQ0lzSW1OeWIzTnpUM0pwWjJsdUlqcG1ZV3h6WlgwIiwiYXV0aGVudGljYXRvckRhdGEiOiJTWllONVlnT2pHaDBOQmNQWkhaZ1c0X2tycm1paGpMSG1Wenp1b01kbDJNZEFBQUFBQSIsInNpZ25hdHVyZSI6Ik1FUUNJSHVoaWFQTlBOT3EzeDFrV3E4VFBMZ3F0SjRVNVF6Mnd0bVR4S3hfYXFWYkFpQmtTbmJlczAyU1dVNlVCRWk0WjlvMlg4N3IwdUFGRE94ZHV1UFRlYkRia2ciLCJ1c2VySGFuZGxlIjoidXNyX2NkYjRlYzg1MWJjZjRmNzMifSwidHlwZSI6InB1YmxpYy1rZXkiLCJhdHRlc3RhdGlvbl90eXBlIjoicGFzc2tleSIsImNoYWxsZW5nZSI6ImV5SnRZVzVrWVhSbFgybGtJam9pY0dGNWJXVnVkRjlsT1RFMVlXWmpOaUlzSW5ScGJXVnpkR0Z0Y0NJNk1UYzJNakEwTWprNU5qWTBNWDAifSwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsInBheW1lbnRfaGFzaCI6ImY0MWRmYjAzMzFkOGEzNThlMDk3MDMzNDkyMmY2MWJhOWMzYWEwMDQ4NjgyOTBmZTQ0NTAwODlkMmVlYzE1MWUifQ\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_e915afc6\", \"cart_mandate_id\": \"cart_6f651c06\", \"intent_mandate_id\": \"intent_76e80f2f\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_6f651c06\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_6f651c06\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼー靴下\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 165.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.669414Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRkNWRiYmJlLWIzMTUtNGIzYi05NDU3LTk1MDc2YWY1MWQzMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9HMgj89sDLXHUsoAo3fzJx7SFPzWRcZbwqWRgNFNLzJT9502pxwGgqEJOmoIHKCB1NVHvtf3PMxffijmp-oiBw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.669856Z\", \"cart_name\": \"コスパ最強プラン (1,650円)\", \"cart_description\": \"価格重視で最安値のキーホルダーと靴下を組み合わせたプラン。かわいさと予算を両立させます。\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}, \"kind\": null, \"artifact\": null}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | [2025-11-02 00:23:19,325] INFO in v2.common.base_agent:
ap2_merchant_agent         | ================================================================================
ap2_merchant_agent         | [Merchant Agent] A2Aエンドポイント: POST /a2a/message
ap2_merchant_agent         |   受信メッセージ: ID=f1651fa0-2673-4b81-81e4-32158524ce57
ap2_merchant_agent         |   送信元: did:ap2:agent:shopping_agent
ap2_merchant_agent         |   タイプ: ap2.mandates.PaymentMandate
ap2_merchant_agent         | ================================================================================
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.331252Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message received to/from did:ap2:agent:shopping_agent: ap2.mandates.PaymentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.333817Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"received\", \"message_type\": \"ap2.mandates.PaymentMandate\", \"peer\": \"did:ap2:agent:shopping_agent\", \"headers\": {\"message_id\": \"f1651fa0-2673-4b81-81e4-32158524ce57\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-02T00:23:19.274803Z\", \"nonce\": \"8751fcc0cddd8fb236a121ce6b6fd2609ac891ecbef59c233306efe5dd91cea7\", \"schema_version\": \"0.2\"}, \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_e915afc6\", \"payment_details_id\": \"order_1d731e48\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-02T00:23:15.173881Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJOa1lqUmxZemcxTVdKalpqUm1Oek1pTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMk5rWWpSbFl6ZzFNV0pqWmpSbU56TWlMQ0pwWVhRaU9qRTNOakl3TkRJNU9Ua3NJbVY0Y0NJNk1UYzJNakEwTXpJNU9Td2libUptSWpveE56WXlNRFF5T1RrNUxDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaU5tUTBPVkF6Y25WaGFXMTVSV0ZZZFRGUGFtNWplVmw1VVZRNWRHcHlPVnB0TmpWcmMyUktXbXhwY3lJc0lua2lPaUpLYWpkVlkxQm1hREJOWVZGd1RuaEJOV0puYlhSYVVGUlhhVGhaVmxBMGVEUkRPR2wyY1RoU1JrUlJJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpxVEVsdFdXRnZUVVV6ZEdaNFNFZHJka1ZOVUZjdFpIRlpVMGhJV0ZRMGVsaENPRFpwTmpCR1NsQk5JaXdpYVdGMElqb3hOell5TURReU9UazVMQ0p6WkY5b1lYTm9Jam9pWVdJd1lUazNOV0UwWWpWa01tRm1PREZpWlRRd09HUmpZV1l5TnpjME5HSmtPVGhpWVdRelkyUXhOalUxT0daaVl6Tm1ZbVl5TnpBek5ETmtOVEprT1NJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lOekptWXpkaFpEWXlOVEE1WkRjelpqRmxPRE5sWVdNd1ltWXlZVFJoWmpkbFpUVTBZVFEzTm1FelltVXpOV1V4TkRaallUQTJaRFUxWkdVMllXVmpaU0lzSW1ZME1XUm1ZakF6TXpGa09HRXpOVGhsTURrM01ETXpORGt5TW1ZMk1XSmhPV016WVdFd01EUTROamd5T1RCbVpUUTBOVEF3T0Rsa01tVmxZekUxTVdVaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyYXdJZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybGpSMFkxWWxkV2RXUkdPV3hQVkVVeFdWZGFhazVwU1hOSmJsSndZbGRXZW1SSFJuUmpRMGsyVFZSak1rMXFRVEJOYW1zMVRtcFpNRTFZTUNJc0ltOXlhV2RwYmlJNkltaDBkSEE2THk5c2IyTmhiR2h2YzNRNk16QXdNQ0lzSW1OeWIzTnpUM0pwWjJsdUlqcG1ZV3h6WlgwIiwiYXV0aGVudGljYXRvckRhdGEiOiJTWllONVlnT2pHaDBOQmNQWkhaZ1c0X2tycm1paGpMSG1Wenp1b01kbDJNZEFBQUFBQSIsInNpZ25hdHVyZSI6Ik1FUUNJSHVoaWFQTlBOT3EzeDFrV3E4VFBMZ3F0SjRVNVF6Mnd0bVR4S3hfYXFWYkFpQmtTbmJlczAyU1dVNlVCRWk0WjlvMlg4N3IwdUFGRE94ZHV1UFRlYkRia2ciLCJ1c2VySGFuZGxlIjoidXNyX2NkYjRlYzg1MWJjZjRmNzMifSwidHlwZSI6InB1YmxpYy1rZXkiLCJhdHRlc3RhdGlvbl90eXBlIjoicGFzc2tleSIsImNoYWxsZW5nZSI6ImV5SnRZVzVrWVhSbFgybGtJam9pY0dGNWJXVnVkRjlsT1RFMVlXWmpOaUlzSW5ScGJXVnpkR0Z0Y0NJNk1UYzJNakEwTWprNU5qWTBNWDAifSwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsInBheW1lbnRfaGFzaCI6ImY0MWRmYjAzMzFkOGEzNThlMDk3MDMzNDkyMmY2MWJhOWMzYWEwMDQ4NjgyOTBmZTQ0NTAwODlkMmVlYzE1MWUifQ\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_e915afc6\", \"cart_mandate_id\": \"cart_6f651c06\", \"intent_mandate_id\": \"intent_76e80f2f\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_6f651c06\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_6f651c06\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼー靴下\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 165.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.669414Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRkNWRiYmJlLWIzMTUtNGIzYi05NDU3LTk1MDc2YWY1MWQzMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9HMgj89sDLXHUsoAo3fzJx7SFPzWRcZbwqWRgNFNLzJT9502pxwGgqEJOmoIHKCB1NVHvtf3PMxffijmp-oiBw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.669856Z\", \"cart_name\": \"コスパ最強プラン (1,650円)\", \"cart_description\": \"価格重視で最安値のキーホルダーと靴下を組み合わせたプラン。かわいさと予算を両立させます。\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグや
ポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.344448Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Nonce validation successful: nonce=8751fcc0cddd8fb2...", "module": "a2a_handler", "function": "verify_message_signature", "line": 156}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.353596Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Using DID-resolved public key for verification: kid=did:ap2:agent:shopping_agent#key-2", "module": "a2a_handler", "function": "verify_message_signature", "line": 190}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.359431Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying A2A message signature", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1023}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.360654Z", "level": "DEBUG", "logger": "common.crypto", "message": "[VERIFY] Canonical JSON length: 5746, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_e915afc6\",\"payload\":{\"cart_mandate\":{\"_metadata\":{\"cart_description\":\"価格重視で最安値のキーホルダーと靴下を組み合わせ
たプラン。かわいさと予算を両立させます。\",\"cart_name\":\"コスパ最強プ", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1027}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.360753Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying signature (algorithm: ED25519)", "module": "crypto", "function": "verify_signature", "line": 857}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.364712Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto VERIFY: ED25519 (key: did:ap2:agent:shopping_agent#key-2) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.365434Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] proof署名検証成功: sender=did:ap2:agent:shopping_agent, alg=ed25519, kid=did:ap2:agent:shopping_agent#key-2, public_key_source=DID-resolved", "module": "a2a_handler", "function": "verify_message_signature", "line": 221}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.367038Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2A処理] ハンドラー実行中: type=ap2.mandates.PaymentMandate, from=did:ap2:agent:shopping_agent", "module": "a2a_handler", "function": "handle_message", "line": 299}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.368932Z", "level": "INFO", "logger": "handlers.payment_handler", "message": "[MerchantAgent] Received PaymentRequest from Shopping Agent", "module": "payment_handler", "function": "handle_payment_request", "line": 32}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.369420Z", "level": "INFO", "logger": "handlers.payment_handler", "message": "[MerchantAgent] Forwarding PaymentMandate to Payment Processor: payment_mandate_id=payment_e915afc6", "module": "payment_handler", "function": "handle_payment_request", "line": 51}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.375048Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 995}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.376852Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 5749, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_e915afc6\",\"payload\":{\"cart_mandate\":{\"_metadata\":{\"cart_description\":\"価格重視で最安値のキーホルダーと靴下を組み合わせた
プラン。かわいさと予算を両立させます。\",\"cart_name\":\"コスパ最強プ", "module": "crypto", "function": "sign_a2a_message", "line": 999}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.378863Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 794}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.380419Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: merchant_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.384447Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:payment_processor: ap2.mandates.PaymentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.385114Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.mandates.PaymentMandate\", \"peer\": \"did:ap2:agent:payment_processor\", \"headers\": {\"message_id\": \"f26cc37c-5cb2-400b-83af-c1c272ae0869\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:payment_processor\", \"timestamp\": \"2025-11-02T00:23:19.369698Z\", \"nonce\": \"ab4e2a66595c667dc730fd00e391963a8a78cd63b9274a45a2586a5585a6400b\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_e915afc6\", \"payment_details_id\": \"order_1d731e48\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-02T00:23:15.173881Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJOa1lqUmxZemcxTVdKalpqUm1Oek1pTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMk5rWWpSbFl6ZzFNV0pqWmpSbU56TWlMQ0pwWVhRaU9qRTNOakl3TkRJNU9Ua3NJbVY0Y0NJNk1UYzJNakEwTXpJNU9Td2libUptSWpveE56WXlNRFF5T1RrNUxDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaU5tUTBPVkF6Y25WaGFXMTVSV0ZZZFRGUGFtNWplVmw1VVZRNWRHcHlPVnB0TmpWcmMyUktXbXhwY3lJc0lua2lPaUpLYWpkVlkxQm1hREJOWVZGd1RuaEJOV0puYlhSYVVGUlhhVGhaVmxBMGVEUkRPR2wyY1RoU1JrUlJJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpxVEVsdFdXRnZUVVV6ZEdaNFNFZHJka1ZOVUZjdFpIRlpVMGhJV0ZRMGVsaENPRFpwTmpCR1NsQk5JaXdpYVdGMElqb3hOell5TURReU9UazVMQ0p6WkY5b1lYTm9Jam9pWVdJd1lUazNOV0UwWWpWa01tRm1PREZpWlRRd09HUmpZV1l5TnpjME5HSmtPVGhpWVdRelkyUXhOalUxT0daaVl6Tm1ZbVl5TnpBek5ETmtOVEprT1NJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lOekptWXpkaFpEWXlOVEE1WkRjelpqRmxPRE5sWVdNd1ltWXlZVFJoWmpkbFpUVTBZVFEzTm1FelltVXpOV1V4TkRaallUQTJaRFUxWkdVMllXVmpaU0lzSW1ZME1XUm1ZakF6TXpGa09HRXpOVGhsTURrM01ETXpORGt5TW1ZMk1XSmhPV016WVdFd01EUTROamd5T1RCbVpUUTBOVEF3T0Rsa01tVmxZekUxTVdVaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyYXdJZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybGpSMFkxWWxkV2RXUkdPV3hQVkVVeFdWZGFhazVwU1hOSmJsSndZbGRXZW1SSFJuUmpRMGsyVFZSak1rMXFRVEJOYW1zMVRtcFpNRTFZTUNJc0ltOXlhV2RwYmlJNkltaDBkSEE2THk5c2IyTmhiR2h2YzNRNk16QXdNQ0lzSW1OeWIzTnpUM0pwWjJsdUlqcG1ZV3h6WlgwIiwiYXV0aGVudGljYXRvckRhdGEiOiJTWllONVlnT2pHaDBOQmNQWkhaZ1c0X2tycm1paGpMSG1Wenp1b01kbDJNZEFBQUFBQSIsInNpZ25hdHVyZSI6Ik1FUUNJSHVoaWFQTlBOT3EzeDFrV3E4VFBMZ3F0SjRVNVF6Mnd0bVR4S3hfYXFWYkFpQmtTbmJlczAyU1dVNlVCRWk0WjlvMlg4N3IwdUFGRE94ZHV1UFRlYkRia2ciLCJ1c2VySGFuZGxlIjoidXNyX2NkYjRlYzg1MWJjZjRmNzMifSwidHlwZSI6InB1YmxpYy1rZXkiLCJhdHRlc3RhdGlvbl90eXBlIjoicGFzc2tleSIsImNoYWxsZW5nZSI6ImV5SnRZVzVrWVhSbFgybGtJam9pY0dGNWJXVnVkRjlsT1RFMVlXWmpOaUlzSW5ScGJXVnpkR0Z0Y0NJNk1UYzJNakEwTWprNU5qWTBNWDAifSwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsInBheW1lbnRfaGFzaCI6ImY0MWRmYjAzMzFkOGEzNThlMDk3MDMzNDkyMmY2MWJhOWMzYWEwMDQ4NjgyOTBmZTQ0NTAwODlkMmVlYzE1MWUifQ\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_e915afc6\", \"cart_mandate_id\": \"cart_6f651c06\", \"intent_mandate_id\": \"intent_76e80f2f\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_6f651c06\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_6f651c06\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼー靴下\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 165.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.669414Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRkNWRiYmJlLWIzMTUtNGIzYi05NDU3LTk1MDc2YWY1MWQzMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9HMgj89sDLXHUsoAo3fzJx7SFPzWRcZbwqWRgNFNLzJT9502pxwGgqEJOmoIHKCB1NVHvtf3PMxffijmp-oiBw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.669856Z\", \"cart_name\": \"コスパ最強プラン (1,650円)\", \"cart_description\": \"価格重視で最安値のキーホルダーと靴下を組み合わせたプラン。かわいさと予算を両立させます。\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキ
ーホルダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.385339Z", "level": "INFO", "logger": "handlers.payment_handler", "message": "\n================================================================================\n[MerchantAgent → PaymentProcessor] A2Aメッセージ転送\n  URL: http://payment_processor:8004/a2a/message\n  メッセージID: f26cc37c-5cb2-400b-83af-c1c272ae0869\n  タ
イプ: ap2.mandates.PaymentMandate\n================================================================================", "module": "payment_handler", "function": "handle_payment_request", "line": 69}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.389101Z", "level": "INFO", "logger": "agent", "message": "HTTP Request: POST http://payment_processor:8004/a2a/message", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:19.389300Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://payment_processor:8004/a2a/message\", \"headers\": {}, \"body\": {\"header\": {\"message_id\": \"f26cc37c-5cb2-400b-83af-c1c272ae0869\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:payment_processor\", \"timestamp\": \"2025-11-02T00:23:19.369698Z\", \"nonce\": \"ab4e2a66595c667dc730fd00e391963a8a78cd63b9274a45a2586a5585a6400b\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"69r7uTDtPfl6ziqEoLWhjDRchKNOtxSUCaGyVQg4WhRjKBcJujwoeIN+xIEpVvMbt9Cfphwb27KsTgCRpPEwBw==\", \"publicKeyMultibase\": \"z6Mko44YAnz8G71TocDDKoBqg86BJTxnqLN86UvGcpjxP47t\", \"kid\": \"did:ap2:agent:merchant_agent#key-2\", \"created\": \"2025-11-02T00:23:19.369698Z\", \"proofPurpose\": \"authentication\"}}, \"dataPart\": {\"@type\": \"ap2.mandates.PaymentMandate\", \"id\": \"payment_e915afc6\", \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_e915afc6\", \"payment_details_id\": \"order_1d731e48\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-02T00:23:15.173881Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJOa1lqUmxZemcxTVdKalpqUm1Oek1pTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMk5rWWpSbFl6ZzFNV0pqWmpSbU56TWlMQ0pwWVhRaU9qRTNOakl3TkRJNU9Ua3NJbVY0Y0NJNk1UYzJNakEwTXpJNU9Td2libUptSWpveE56WXlNRFF5T1RrNUxDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaU5tUTBPVkF6Y25WaGFXMTVSV0ZZZFRGUGFtNWplVmw1VVZRNWRHcHlPVnB0TmpWcmMyUktXbXhwY3lJc0lua2lPaUpLYWpkVlkxQm1hREJOWVZGd1RuaEJOV0puYlhSYVVGUlhhVGhaVmxBMGVEUkRPR2wyY1RoU1JrUlJJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpxVEVsdFdXRnZUVVV6ZEdaNFNFZHJka1ZOVUZjdFpIRlpVMGhJV0ZRMGVsaENPRFpwTmpCR1NsQk5JaXdpYVdGMElqb3hOell5TURReU9UazVMQ0p6WkY5b1lYTm9Jam9pWVdJd1lUazNOV0UwWWpWa01tRm1PREZpWlRRd09HUmpZV1l5TnpjME5HSmtPVGhpWVdRelkyUXhOalUxT0daaVl6Tm1ZbVl5TnpBek5ETmtOVEprT1NJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lOekptWXpkaFpEWXlOVEE1WkRjelpqRmxPRE5sWVdNd1ltWXlZVFJoWmpkbFpUVTBZVFEzTm1FelltVXpOV1V4TkRaallUQTJaRFUxWkdVMllXVmpaU0lzSW1ZME1XUm1ZakF6TXpGa09HRXpOVGhsTURrM01ETXpORGt5TW1ZMk1XSmhPV016WVdFd01EUTROamd5T1RCbVpUUTBOVEF3T0Rsa01tVmxZekUxTVdVaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyYXdJZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybGpSMFkxWWxkV2RXUkdPV3hQVkVVeFdWZGFhazVwU1hOSmJsSndZbGRXZW1SSFJuUmpRMGsyVFZSak1rMXFRVEJOYW1zMVRtcFpNRTFZTUNJc0ltOXlhV2RwYmlJNkltaDBkSEE2THk5c2IyTmhiR2h2YzNRNk16QXdNQ0lzSW1OeWIzTnpUM0pwWjJsdUlqcG1ZV3h6WlgwIiwiYXV0aGVudGljYXRvckRhdGEiOiJTWllONVlnT2pHaDBOQmNQWkhaZ1c0X2tycm1paGpMSG1Wenp1b01kbDJNZEFBQUFBQSIsInNpZ25hdHVyZSI6Ik1FUUNJSHVoaWFQTlBOT3EzeDFrV3E4VFBMZ3F0SjRVNVF6Mnd0bVR4S3hfYXFWYkFpQmtTbmJlczAyU1dVNlVCRWk0WjlvMlg4N3IwdUFGRE94ZHV1UFRlYkRia2ciLCJ1c2VySGFuZGxlIjoidXNyX2NkYjRlYzg1MWJjZjRmNzMifSwidHlwZSI6InB1YmxpYy1rZXkiLCJhdHRlc3RhdGlvbl90eXBlIjoicGFzc2tleSIsImNoYWxsZW5nZSI6ImV5SnRZVzVrWVhSbFgybGtJam9pY0dGNWJXVnVkRjlsT1RFMVlXWmpOaUlzSW5ScGJXVnpkR0Z0Y0NJNk1UYzJNakEwTWprNU5qWTBNWDAifSwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsInBheW1lbnRfaGFzaCI6ImY0MWRmYjAzMzFkOGEzNThlMDk3MDMzNDkyMmY2MWJhOWMzYWEwMDQ4NjgyOTBmZTQ0NTAwODlkMmVlYzE1MWUifQ\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_e915afc6\", \"cart_mandate_id\": \"cart_6f651c06\", \"intent_mandate_id\": \"intent_76e80f2f\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_6f651c06\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_6f651c06\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼー靴下\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 165.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.669414Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRkNWRiYmJlLWIzMTUtNGIzYi05NDU3LTk1MDc2YWY1MWQzMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9HMgj89sDLXHUsoAo3fzJx7SFPzWRcZbwqWRgNFNLzJT9502pxwGgqEJOmoIHKCB1NVHvtf3PMxffijmp-oiBw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.669856Z\", \"cart_name\": \"コスパ最強プラン (1,650円)\", \"cart_description\": \"価格重視で最安値のキーホルダーと靴下を組み合わせたプラン。かわいさと予算を両立させます。\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグやポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}, \"kind\": null, \"artifact\": null}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_payment_processor      | [2025-11-02 00:23:19,933] INFO in v2.common.base_agent:
ap2_payment_processor      | ================================================================================
ap2_payment_processor      | [Payment Processor] A2Aエンドポイント: POST /a2a/message
ap2_payment_processor      |   受信メッセージ: ID=f26cc37c-5cb2-400b-83af-c1c272ae0869
ap2_payment_processor      |   送信元: did:ap2:agent:merchant_agent
ap2_payment_processor      |   タイプ: ap2.mandates.PaymentMandate
ap2_payment_processor      | ================================================================================
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:19.937228Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message received to/from did:ap2:agent:merchant_agent: ap2.mandates.PaymentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:19.938017Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"received\", \"message_type\": \"ap2.mandates.PaymentMandate\", \"peer\": \"did:ap2:agent:merchant_agent\", \"headers\": {\"message_id\": \"f26cc37c-5cb2-400b-83af-c1c272ae0869\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:payment_processor\", \"timestamp\": \"2025-11-02T00:23:19.369698Z\", \"nonce\": \"ab4e2a66595c667dc730fd00e391963a8a78cd63b9274a45a2586a5585a6400b\", \"schema_version\": \"0.2\"}, \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_e915afc6\", \"payment_details_id\": \"order_1d731e48\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-02T00:23:15.173881Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJOa1lqUmxZemcxTVdKalpqUm1Oek1pTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMk5rWWpSbFl6ZzFNV0pqWmpSbU56TWlMQ0pwWVhRaU9qRTNOakl3TkRJNU9Ua3NJbVY0Y0NJNk1UYzJNakEwTXpJNU9Td2libUptSWpveE56WXlNRFF5T1RrNUxDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaU5tUTBPVkF6Y25WaGFXMTVSV0ZZZFRGUGFtNWplVmw1VVZRNWRHcHlPVnB0TmpWcmMyUktXbXhwY3lJc0lua2lPaUpLYWpkVlkxQm1hREJOWVZGd1RuaEJOV0puYlhSYVVGUlhhVGhaVmxBMGVEUkRPR2wyY1RoU1JrUlJJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpxVEVsdFdXRnZUVVV6ZEdaNFNFZHJka1ZOVUZjdFpIRlpVMGhJV0ZRMGVsaENPRFpwTmpCR1NsQk5JaXdpYVdGMElqb3hOell5TURReU9UazVMQ0p6WkY5b1lYTm9Jam9pWVdJd1lUazNOV0UwWWpWa01tRm1PREZpWlRRd09HUmpZV1l5TnpjME5HSmtPVGhpWVdRelkyUXhOalUxT0daaVl6Tm1ZbVl5TnpBek5ETmtOVEprT1NJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lOekptWXpkaFpEWXlOVEE1WkRjelpqRmxPRE5sWVdNd1ltWXlZVFJoWmpkbFpUVTBZVFEzTm1FelltVXpOV1V4TkRaallUQTJaRFUxWkdVMllXVmpaU0lzSW1ZME1XUm1ZakF6TXpGa09HRXpOVGhsTURrM01ETXpORGt5TW1ZMk1XSmhPV016WVdFd01EUTROamd5T1RCbVpUUTBOVEF3T0Rsa01tVmxZekUxTVdVaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyYXdJZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybGpSMFkxWWxkV2RXUkdPV3hQVkVVeFdWZGFhazVwU1hOSmJsSndZbGRXZW1SSFJuUmpRMGsyVFZSak1rMXFRVEJOYW1zMVRtcFpNRTFZTUNJc0ltOXlhV2RwYmlJNkltaDBkSEE2THk5c2IyTmhiR2h2YzNRNk16QXdNQ0lzSW1OeWIzTnpUM0pwWjJsdUlqcG1ZV3h6WlgwIiwiYXV0aGVudGljYXRvckRhdGEiOiJTWllONVlnT2pHaDBOQmNQWkhaZ1c0X2tycm1paGpMSG1Wenp1b01kbDJNZEFBQUFBQSIsInNpZ25hdHVyZSI6Ik1FUUNJSHVoaWFQTlBOT3EzeDFrV3E4VFBMZ3F0SjRVNVF6Mnd0bVR4S3hfYXFWYkFpQmtTbmJlczAyU1dVNlVCRWk0WjlvMlg4N3IwdUFGRE94ZHV1UFRlYkRia2ciLCJ1c2VySGFuZGxlIjoidXNyX2NkYjRlYzg1MWJjZjRmNzMifSwidHlwZSI6InB1YmxpYy1rZXkiLCJhdHRlc3RhdGlvbl90eXBlIjoicGFzc2tleSIsImNoYWxsZW5nZSI6ImV5SnRZVzVrWVhSbFgybGtJam9pY0dGNWJXVnVkRjlsT1RFMVlXWmpOaUlzSW5ScGJXVnpkR0Z0Y0NJNk1UYzJNakEwTWprNU5qWTBNWDAifSwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsInBheW1lbnRfaGFzaCI6ImY0MWRmYjAzMzFkOGEzNThlMDk3MDMzNDkyMmY2MWJhOWMzYWEwMDQ4NjgyOTBmZTQ0NTAwODlkMmVlYzE1MWUifQ\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_e915afc6\", \"cart_mandate_id\": \"cart_6f651c06\", \"intent_mandate_id\": \"intent_76e80f2f\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_6f651c06\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [], \"details\": {\"id\": \"cart_6f651c06\", \"display_items\": [{\"label\": \"むぎぼーアクリルキーホルダー\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"むぎぼー靴下\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"消費税（10%）\", \"amount\": {\"value\": 165.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"送料\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"合計\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}}, \"shipping_address\": null}, \"cart_expiry\": \"2025-11-02T01:23:03.669414Z\", \"merchant_name\": \"むぎぼーショップ\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNzJmYzdhZDYyNTA5ZDczZjFlODNlYWMwYmYyYTRhZjdlZTU0YTQ3NmEzYmUzNWUxNDZjYTA2ZDU1ZGU2YWVjZSIsImV4cCI6MTc2MjA0NjU4NCwiaWF0IjoxNzYyMDQyOTg0LCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRkNWRiYmJlLWIzMTUtNGIzYi05NDU3LTk1MDc2YWY1MWQzMSIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.9HMgj89sDLXHUsoAo3fzJx7SFPzWRcZbwqWRgNFNLzJT9502pxwGgqEJOmoIHKCB1NVHvtf3PMxffijmp-oiBw\", \"_metadata\": {\"intent_mandate_id\": null, \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T00:23:03.669856Z\", \"cart_name\": \"コスパ最強プラン (1,650円)\", \"cart_description\": \"価格重視で最安値のキーホルダーと靴下を組み合わせたプラン。かわいさと予算を両立させます。\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"むぎぼーアクリルキーホルダー\", \"description\": \"かわいいむぎぼーのアクリルキーホルダー。バッグ
やポーチに付けて持ち歩けます。\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"むぎぼー靴下\", \"description\": \"むぎぼーがワンポイントで入ったかわいい靴下。やわらかい履き心地。\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:19.938801Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Nonce validation successful: nonce=ab4e2a66595c667d...", "module": "a2a_handler", "function": "verify_message_signature", "line": 156}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:19.988052Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] Using DID-resolved public key for verification: kid=did:ap2:agent:merchant_agent#key-2", "module": "a2a_handler", "function": "verify_message_signature", "line": 190}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:19.995521Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying A2A message signature", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1023}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.007015Z", "level": "DEBUG", "logger": "common.crypto", "message": "[VERIFY] Canonical JSON length: 5749, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_e915afc6\",\"payload\":{\"cart_mandate\":{\"_metadata\":{\"cart_description\":\"価格重視で最安値のキーホルダーと靴下を組み合わせ
たプラン。かわいさと予算を両立させます。\",\"cart_name\":\"コスパ最強プ", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1027}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.007368Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying signature (algorithm: ED25519)", "module": "crypto", "function": "verify_signature", "line": 857}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.037963Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto VERIFY: ED25519 (key: did:ap2:agent:merchant_agent#key-2) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.038390Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2AHandler] proof署名検証成功: sender=did:ap2:agent:merchant_agent, alg=ed25519, kid=did:ap2:agent:merchant_agent#key-2, public_key_source=DID-resolved", "module": "a2a_handler", "function": "verify_message_signature", "line": 221}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.038465Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2A処理] ハンドラー実行中: type=ap2.mandates.PaymentMandate, from=did:ap2:agent:merchant_agent", "module": "a2a_handler", "function": "handle_message", "line": 299}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.039330Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Received PaymentMandate", "module": "processor", "function": "handle_payment_mandate", "line": 410}
ap2_payment_processor      | [2025-11-02 00:23:20,040] INFO in services.payment_processor.utils.mandate_helpers: [PaymentProcessor] PaymentMandate validation passed: payment_e915afc6, user_authorization present: eyJpc3N1ZXJfand0Ijoi...
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.040923Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Mandate chain validation: PaymentMandate(payment_e915afc6) → CartMandate(cart_6f651c06)", "module": "processor", "function": "_validate_mandate_chain", "line": 675}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.044189Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Verifying SD-JWT-VC user_authorization: cart_hash=72fc7ad62509d73f..., payment_hash=f41dfb0331d8a358...", "module": "processor", "function": "_validate_mandate_chain", "line": 692}
ap2_payment_processor      | [2025-11-02 00:23:20,044] INFO in v2.common.user_authorization: [verify_user_authorization_vp] Decoded VP successfully
ap2_payment_processor      | [2025-11-02 00:23:20,044] INFO in v2.common.user_authorization: [verify_user_authorization_vp] Hash verification passed: cart_hash=72fc7ad62509d73f..., payment_hash=f41dfb0331d8a358...
ap2_payment_processor      | [2025-11-02 00:23:20,053] INFO in v2.common.user_authorization: [verify_user_authorization_vp] ✓ WebAuthn signature verified successfully
ap2_payment_processor      | [2025-11-02 00:23:20,053] INFO in v2.common.user_authorization: [verify_user_authorization_vp] Key-binding JWT payload verified
ap2_payment_processor      | [2025-11-02 00:23:20,053] INFO in v2.common.user_authorization: [verify_user_authorization_vp] ✓ VP verification passed
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.053318Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] ✓ SD-JWT-VC user_authorization verified: cart_hash_match=True, payment_hash_match=True, webauthn_signature_verified=True", "module": "processor", "function": "_validate_mandate_chain", "line": 705}
ap2_payment_processor      | [2025-11-02 00:23:20,060] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを読み込み中: /app/v2/data/did_documents/shopping_agent_did.json
ap2_payment_processor      | [2025-11-02 00:23:20,062] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録
: did:ap2:agent:shopping_agent
ap2_payment_processor      | [2025-11-02 00:23:20,062] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを
読み込み中: /app/v2/data/did_documents/merchant_agent_did.json
ap2_payment_processor      | [2025-11-02 00:23:20,062] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録
: did:ap2:agent:merchant_agent
ap2_payment_processor      | [2025-11-02 00:23:20,062] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを
読み込み中: /app/v2/data/did_documents/merchant_did.json
ap2_payment_processor      | [2025-11-02 00:23:20,062] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録
: did:ap2:merchant:mugibo_merchant
ap2_payment_processor      | [2025-11-02 00:23:20,063] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを
読み込み中: /app/v2/data/did_documents/credential_provider_did.json
ap2_payment_processor      | [2025-11-02 00:23:20,063] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録
: did:ap2:cp:demo_cp
ap2_payment_processor      | [2025-11-02 00:23:20,063] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを
読み込み中: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_payment_processor      | [2025-11-02 00:23:20,063] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録
: did:ap2:cp:demo_cp_2
ap2_payment_processor      | [2025-11-02 00:23:20,064] INFO in v2.common.did_resolver: [DIDResolver] 永続化されたDIDドキュメントを
読み込み中: /app/v2/data/did_documents/payment_processor_did.json
ap2_payment_processor      | [2025-11-02 00:23:20,064] INFO in v2.common.did_resolver: [DIDResolver] ✓ 永続化DIDドキュメントを登録
: did:ap2:agent:payment_processor
ap2_payment_processor      | [2025-11-02 00:23:20,066] INFO in services.payment_processor.utils.jwt_helpers: [_verify_jwt_signature] ✓ JWT signature verified successfully (RFC 7515 compliant)
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.066606Z", "level": "INFO", "logger": "processor", "message": "[_verify_merchant_authorization_jwt] JWT validation passed: iss=did:ap2:merchant:mugibo_merchant, exp=1762046584, jti=dd5dbbbe-b315-4b..., cart_hash=72fc7ad62509d73f...", "module": "processor", "function": "_verify_merchant_authorization_jwt", "line": 617}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.066646Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] merchant_authorization JWT verified: iss=did:ap2:merchant:mugibo_merchant", "module": "processor", "function": "_validate_mandate_chain", "line": 729}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.066664Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] CartMandate hash in merchant_authorization: 72fc7ad62509d73f...", "module": "processor", "function": "_validate_mandate_chain", "line": 737}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.066792Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] ✓ CartMandate hash verified (merchant_authorization): 72fc7ad62509d73f...", "module": "processor", "function": "_validate_mandate_chain", "line": 754}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.066812Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Mandate chain validation passed", "module": "processor", "function": "_validate_mandate_chain", "line": 786}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.067608Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Processing payment (mock): txn_74086acc7a82", "module": "processor", "function": "_process_payment_mock", "line": 805}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.067835Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Verifying credential with Credential Provider: token=tok_3244e30f_jRYXCTj...", "module": "processor", "function": "_verify_credential_with_cp", "line": 920}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.071783Z", "level": "INFO", "logger": "processor", "message": "HTTP Request: POST http://credential_provider:8003/credentials/verify", "module": "logger", "function": "log_http_request", "line": 182}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.071812Z", "level": "DEBUG", "logger": "processor", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/credentials/verify\", \"headers\": {}, \"body\": {\"token\": \"tok_3244e30f_jRYXCTjH94U2rIYVSkXtBCXe\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:20.151352Z", "level": "INFO", "logger": "provider", "message": "[verify_credentials] Verifying token for payer: usr_cdb4ec851bcf4f73", "module": "provider", "function": "verify_credentials", "line": 1616}
ap2_credential_provider    | {"timestamp": "2025-11-02T00:23:20.153922Z", "level": "INFO", "logger": "provider", "message": "[verify_credentials] Token verified: payment_method_id=pm_f4745ec2, user_id=usr_cdb4ec851bcf4f73", "module": "provider", "function": "verify_credentials", "line": 1653}
ap2_credential_provider    | INFO:     172.18.0.7:36528 - "POST /credentials/verify HTTP/1.1" 200 OK
ap2_payment_processor      | [2025-11-02 00:23:20,159] INFO in httpx: HTTP Request: POST http://credential_provider:8003/credentials/verify "HTTP/1.1 200 OK"
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.162652Z", "level": "INFO", "logger": "processor", "message": "HTTP Response: 200 (90.80ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.162718Z", "level": "DEBUG", "logger": "processor", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:23:19 GMT\", \"server\": \"uvicorn\", \"content-length\": \"186\", \"content-type\": \"application/json\"}, \"body\": {\"verified\": true, \"credential_info\": {\"payment_method_id\": \"pm_f4745ec2\", \"type\": \"basic-card\", \"brand\": \"Visa\", \"last4\": \"1111\", \"holder_name\": \"Unknown\", \"expiry_month\": \"02\", \"expiry_year\": \"2028\"}}, \"duration_ms\": 90.79647064208984}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.163147Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Credential verification succeeded: payment_method_id=pm_f4745ec2", "module": "processor", "function": "_verify_credential_with_cp", "line": 955}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.163168Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Credential verified: pm_f4745ec2", "module": "processor", "function": "_process_payment_mock", "line": 828}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.163185Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Risk assessment: score=2, indicators=[]", "module": "processor", "function": "_process_payment_mock", "line": 843}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.163383Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Payment succeeded: txn_74086acc7a82, amount={'value': 2315.0, 'currency': 'JPY'}, risk_score=2", "module": "processor", "function": "_process_payment_mock", "line": 877}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.331148Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Transaction saved: txn_74086acc7a82", "module": "processor", "function": "_save_transaction", "line": 904}
ap2_payment_processor      | [2025-11-02 00:23:20,719] INFO in v2.common.receipt_generator: [ReceiptGenerator] Generating PDF receipt for transaction: txn_74086acc7a82
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.719362Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Generated user name for receipt: User usr_cdb4 (payer_id: usr_cdb4ec851bcf4f73)", "module": "processor", "function": "_generate_receipt", "line": 1105}
ap2_payment_processor      | [2025-11-02 00:23:20,725] INFO in v2.common.receipt_generator: [ReceiptGenerator] PDF receipt generated successfully
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.727884Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Generated receipt PDF: /app/v2/data/receipts/txn_74086acc7a82.pdf", "module": "processor", "function": "_generate_receipt", "line": 1124}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.737364Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Receipt record saved to database: txn_74086acc7a82", "module": "processor", "function": "_generate_receipt", "line": 1143}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.737871Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Sending receipt notification to Credential Provider: transaction_id=txn_74086acc7a82, payer_id=usr_cdb4ec851bcf4f73", "module": "processor", "function": "_send_receipt_to_credential_provider", "line": 984}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.738082Z", "level": "INFO", "logger": "processor", "message": "HTTP Request: POST http://credential_provider:8003/receipts", "module": "logger", "function": "log_http_request", "line": 182}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.738128Z", "level": "DEBUG", "logger": "processor", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/receipts\", \"headers\": {}, \"body\": {\"transaction_id\": \"txn_74086acc7a82\", \"receipt_url\": \"http://localhost:8004/receipts/txn_74086acc7a82.pdf\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"amount\": {\"value\": 2315.0, \"currency\": \"JPY\"}, \"timestamp\": \"2025-11-02T00:23:20.738049Z\"}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | [2025-11-02 00:23:20,760] INFO in services.credential_provider.utils.receipt_helpers: [CredentialProvider] Receipt received and stored to DB: transaction_id=txn_74086acc7a82, payer_id=usr_cdb4ec851bcf4f73, receipt_url=http://localhost:8004/receipts/txn_74086acc7a82.pdf
ap2_credential_provider    | INFO:     172.18.0.7:36528 - "POST /receipts HTTP/1.1" 200 OK
ap2_payment_processor      | [2025-11-02 00:23:20,762] INFO in httpx: HTTP Request: POST http://credential_provider:8003/receipts "HTTP/1.1 200 OK"
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.762854Z", "level": "INFO", "logger": "processor", "message": "HTTP Response: 200 (24.75ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.762899Z", "level": "DEBUG", "logger": "processor", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:23:19 GMT\", \"server\": \"uvicorn\", \"content-length\": \"97\", \"content-type\": \"application/json\"}, \"body\": {\"status\": \"received\", \"message\": \"Receipt stored successfully\", \"transaction_id\": \"txn_74086acc7a82\"}, \"duration_ms\": 24.750947952270508}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.762986Z", "level": "INFO", "logger": "processor", "message": "[PaymentProcessor] Receipt notification sent successfully: transaction_id=txn_74086acc7a82, status=200", "module": "processor", "function": "_send_receipt_to_credential_provider", "line": 1015}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.763383Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2A処理] ハンドラー完了: type=ap2.mandates.PaymentMandate, result_type=ap2.responses.PaymentResult", "module": "a2a_handler", "function": "handle_message", "line": 307}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.765525Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: payment_processor, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 995}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.765608Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 521, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.responses.PaymentResult\",\"id\":\"495a8137-7673-4701-b1cd-1912604e4ee4\",\"payload\":{\"receipt_url\":\"http://localhost:8004/receipts/txn_74086acc7a82.pdf\",\"status\":\"captured\",\"trans", "module": "crypto", "function": "sign_a2a_message", "line": 999}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.765659Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: payment_processor, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 794}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.766076Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: payment_processor) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.769045Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:merchant_agent: ap2.responses.PaymentResult", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_payment_processor      | {"timestamp": "2025-11-02T00:23:20.769090Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.responses.PaymentResult\", \"peer\": \"did:ap2:agent:merchant_agent\", \"headers\": {\"message_id\": \"1880caa4-578d-4fbd-bb73-4af16bd365d4\", \"sender\": \"did:ap2:agent:payment_processor\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-02T00:23:20.763580Z\", \"nonce\": \"a480b028c7f0bffc49ca0808c3044f168799d3635d3eaec1df63c113644859bb\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"transaction_id\": \"txn_74086acc7a82\", \"status\": \"captured\", \"receipt_url\": \"http://localhost:8004/receipts/txn_74086acc7a82.pdf\"}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_payment_processor      | [2025-11-02 00:23:20,769] INFO in v2.common.base_agent: [Payment Processor] A2Aレスポンス返却: type=ap2.responses.PaymentResult, to=did:ap2:agent:merchant_agent
ap2_payment_processor      | INFO:     172.18.0.8:56960 - "POST /a2a/message HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:20.784006Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (1394.89ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:20.784383Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:23:19 GMT\", \"server\": \"uvicorn\", \"content-length\": \"879\", \"content-type\": \"application/json\"}, \"body\": {\"header\": {\"message_id\": \"1880caa4-578d-4fbd-bb73-4af16bd365d4\", \"sender\": \"did:ap2:agent:payment_processor\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-02T00:23:20.763580Z\", \"nonce\": \"a480b028c7f0bffc49ca0808c3044f168799d3635d3eaec1df63c113644859bb\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"7mK9mrOrCesnerkJzlqefxRDg0lSdiC04n1ajYOQyDTHxwg7fXIHuzR8iaNp4d4/kPvcx2sSgv89J8FGAF+9Aw==\", \"publicKeyMultibase\": \"z6Mkrp3WoDtv4hEohzavLc3A1Dt1aD1HtSCkpQR3ay98ZLYv\", \"kid\": \"did:ap2:agent:payment_processor#key-2\", \"created\": \"2025-11-02T00:23:20.763580Z\", \"proofPurpose\": \"authentication\"}}, \"dataPart\": {\"@type\": \"ap2.responses.PaymentResult\", \"id\": \"495a8137-7673-4701-b1cd-1912604e4ee4\", \"payload\": {\"transaction_id\": \"txn_74086acc7a82\", \"status\": \"captured\", \"receipt_url\": \"http://localhost:8004/receipts/txn_74086acc7a82.pdf\"}, \"kind\": null, \"artifact\": null}}, \"duration_ms\": 1394.890546798706}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:20.785335Z", "level": "INFO", "logger": "handlers.payment_handler", "message": "\n================================================================================\n[MerchantAgent ← PaymentProcessor] A2Aレスポンス受信\n  Status: 200\n  Response Body: {\n  \"header\": {\n    \"message_id\": \"1880caa4-578d-4fbd-bb73-4af16bd365d4\",\n    \"sender\": \"did:ap2:agent:payment_processor\",\n    \"recipient\": \"did:ap2:agent:merchant_agent\",\n    \"timestamp\": \"2025-11-02T00:23:20.763580Z\",\n    \"nonce\": \"a480b028c7f0bffc49ca0808c3044f168799d3635d3eaec1df63c113644859bb\",\n    \"schema_version\": \"0.2\",\n    \"proof\": {\n      \"algorithm\": \"ed25519\",\n      \"signatureValue\": \"7mK9mrOrCesnerkJzlqefxRDg0lSdiC04n1ajYOQyDTHxwg7fXIHuzR8iaNp4d4/kPvcx2sSgv89J8FGAF+9Aw==\",\n      \"publicKeyMultibase\": \"z6Mkrp3WoDtv4hEohzavLc3A1Dt1aD1HtSCkpQR3ay98ZLYv\",\n      \"kid\": \"did:ap2:agent:payment_processor#key-2\",\n      \"created\": \"2025-11-02T00:23:20.763580Z\",\n      \"proofPurpose\": \"authentication\"\n    }\n  },\n  \"dataPart\": {\n    \"@type\": \"ap2.responses.PaymentResult\",\n    \"id\": \"495a8137-7673-4701-b1cd-1912604e4ee4\",\n    \"payload\": {\n      \"transaction_id\": \"txn_74086acc7a82\",\n      \"status\": \"captured\",\n      \"receipt_url\": \"http://localhost:8004/receipts/txn_74086acc7a82.pdf\"\n    },\n    \"kind\": null,\n    \"artifact\": null\n  }\n}\n================================================================================", "module": "payment_handler", "function": "handle_payment_request", "line": 86}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:20.785573Z", "level": "INFO", "logger": "handlers.payment_handler", "message": "[MerchantAgent] Payment processing completed, forwarding result to Shopping Agent", "module": "payment_handler", "function": "handle_payment_request", "line": 101}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:20.785798Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "[A2A処理] ハンドラー完了: type=ap2.mandates.PaymentMandate, result_type=ap2.responses.PaymentResult", "module": "a2a_handler", "function": "handle_message", "line": 307}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:20.788578Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 995}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:20.788700Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 518, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.responses.PaymentResult\",\"id\":\"495a8137-7673-4701-b1cd-1912604e4ee4\",\"payload\":{\"receipt_url\":\"http://localhost:8004/receipts/txn_74086acc7a82.pdf\",\"status\":\"captured\",\"trans", "module": "crypto", "function": "sign_a2a_message", "line": 999}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:20.788722Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 794}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:20.789053Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: merchant_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:20.789147Z", "level": "INFO", "logger": "v2.common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:shopping_agent: ap2.responses.PaymentResult", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | {"timestamp": "2025-11-02T00:23:20.789170Z", "level": "DEBUG", "logger": "v2.common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.responses.PaymentResult\", \"peer\": \"did:ap2:agent:shopping_agent\", \"headers\": {\"message_id\": \"8595efff-32d0-4741-b842-b5ecbf42d36c\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:shopping_agent\", \"timestamp\": \"2025-11-02T00:23:20.785850Z\", \"nonce\": \"b3315e18b5fe7b0db5b5a3034515aca1054e01baa0fc5573b4c1720a1019e322\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"transaction_id\": \"txn_74086acc7a82\", \"status\": \"captured\", \"receipt_url\": \"http://localhost:8004/receipts/txn_74086acc7a82.pdf\"}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | [2025-11-02 00:23:20,789] INFO in v2.common.base_agent: [Merchant Agent] A2Aレスポンス返却: type=ap2.responses.PaymentResult, to=did:ap2:agent:shopping_agent
ap2_merchant_agent         | INFO:     172.18.0.10:36538 - "POST /a2a/message HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:20.793270Z", "level": "INFO", "logger": "agent", "message": "HTTP Response: 200 (1505.71ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:20.793343Z", "level": "DEBUG", "logger": "agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 00:23:18 GMT\", \"server\": \"uvicorn\", \"content-length\": \"873\", \"content-type\": \"application/json\"}, \"body\": {\"header\": {\"message_id\": \"8595efff-32d0-4741-b842-b5ecbf42d36c\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:shopping_agent\", \"timestamp\": \"2025-11-02T00:23:20.785850Z\", \"nonce\": \"b3315e18b5fe7b0db5b5a3034515aca1054e01baa0fc5573b4c1720a1019e322\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"4a3AnPyvWhQQ2++CKrUjD+YgE+ocuE4Nce7Ytp7T09UmYepVgiECjQjn3ECInioO802+r6HH/4n7sB9Djim/Bg==\", \"publicKeyMultibase\": \"z6Mko44YAnz8G71TocDDKoBqg86BJTxnqLN86UvGcpjxP47t\", \"kid\": \"did:ap2:agent:merchant_agent#key-2\", \"created\": \"2025-11-02T00:23:20.785850Z\", \"proofPurpose\": \"authentication\"}}, \"dataPart\": {\"@type\": \"ap2.responses.PaymentResult\", \"id\": \"495a8137-7673-4701-b1cd-1912604e4ee4\", \"payload\": {\"transaction_id\": \"txn_74086acc7a82\", \"status\": \"captured\", \"receipt_url\": \"http://localhost:8004/receipts/txn_74086acc7a82.pdf\"}, \"kind\": null, \"artifact\": null}}, \"duration_ms\": 1505.7082176208496}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-02 00:23:20,793] INFO in services.shopping_agent.utils.merchant_integration:
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [ShoppingAgent ← MerchantAgent] A2Aレスポンス受信
ap2_shopping_agent         |   Status: 200
ap2_shopping_agent         |   Response Type: ap2.responses.PaymentResult
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [2025-11-02 00:23:20,793] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Payment processing completed: status=captured
ap2_shopping_agent         | [2025-11-02 00:23:20,794] INFO in services.shopping_agent.langgraph_shopping_flow: [execute_payment_node] Payment successful: status=captured, transaction_id=txn_74086acc7a82
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:20.845165Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=completed", "module": "agent", "function": "_update_session", "line": 2022}
ap2_shopping_agent         | {"timestamp": "2025-11-02T00:23:20.858200Z", "level": "DEBUG", "logger": "agent", "message": "[ShoppingAgent] Updated session in DB: session_1762042681770_6b8nz, step=completed", "module": "agent", "function": "_update_session", "line": 2022}