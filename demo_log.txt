Attaching to ap2_credential_provider, ap2_credential_provider_2, ap2_frontend, ap2_init_keys, ap2_init_seeds, ap2_jaeger, ap2_meilisearch, ap2_merchant, ap2_merchant_agent, ap2_merchant_agent_mcp, ap2_payment_network, ap2_payment_processor, ap2_redis, ap2_shopping_agent, ap2_shopping_agent_mcp
ap2_redis  | 1:C 02 Nov 2025 22:34:48.039 * oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
ap2_redis  | 1:C 02 Nov 2025 22:34:48.039 * Redis version=7.4.6, bits=64, commit=00000000, modified=0, pid=1, just started
ap2_redis  | 1:C 02 Nov 2025 22:34:48.039 * Configuration loaded
ap2_redis  | 1:M 02 Nov 2025 22:34:48.039 * monotonic clock: POSIX clock_gettime
ap2_redis  | 1:M 02 Nov 2025 22:34:48.044 * Running mode=standalone, port=6379.
ap2_redis  | 1:M 02 Nov 2025 22:34:48.045 * Server initialized
ap2_redis  | 1:M 02 Nov 2025 22:34:48.054 * Reading RDB base file on AOF loading...
ap2_redis  | 1:M 02 Nov 2025 22:34:48.054 * Loading RDB produced by version 7.4.6
ap2_redis  | 1:M 02 Nov 2025 22:34:48.054 * RDB age 253835 seconds
ap2_redis  | 1:M 02 Nov 2025 22:34:48.054 * RDB memory usage when created 0.94 Mb
ap2_redis  | 1:M 02 Nov 2025 22:34:48.054 * RDB is base AOF
ap2_redis  | 1:M 02 Nov 2025 22:34:48.054 * Done loading RDB, keys loaded: 0, keys expired: 0.
ap2_redis  | 1:M 02 Nov 2025 22:34:48.055 * DB loaded from base file appendonly.aof.1.base.rdb: 0.004 seconds
ap2_redis  | 1:M 02 Nov 2025 22:34:48.062 * DB loaded from incr file appendonly.aof.1.incr.aof: 0.007 seconds
ap2_redis  | 1:M 02 Nov 2025 22:34:48.062 * DB loaded from append only file: 0.014 seconds
ap2_redis  | 1:M 02 Nov 2025 22:34:48.064 * Opening AOF incr file appendonly.aof.1.incr.aof on server start
ap2_redis  | 1:M 02 Nov 2025 22:34:48.064 * Ready to accept connections tcp
ap2_meilisearch  |
ap2_meilisearch  | 888b     d888          d8b 888 d8b                                            888
ap2_meilisearch  | 8888b   d8888          Y8P 888 Y8P                                            888
ap2_meilisearch  | 88888b.d88888              888                                                888
ap2_meilisearch  | 888Y88888P888  .d88b.  888 888 888 .d8888b   .d88b.   8888b.  888d888 .d8888b 88888b.
ap2_meilisearch  | 888 Y888P 888 d8P  Y8b 888 888 888 88K      d8P  Y8b     "88b 888P"  d88P"    888 "88b
ap2_meilisearch  | 888  Y8P  888 88888888 888 888 888 "Y8888b. 88888888 .d888888 888    888      888  888
ap2_meilisearch  | 888   "   888 Y8b.     888 888 888      X88 Y8b.     888  888 888    Y88b.    888  888
ap2_meilisearch  | 888       888  "Y8888  888 888 888  88888P'  "Y8888  "Y888888 888     "Y8888P 888  888
ap2_meilisearch  |
ap2_meilisearch  | Config file path:    "none"
ap2_meilisearch  | Database path:               "./data.ms"
ap2_meilisearch  | Server listening on: "http://0.0.0.0:7700"
ap2_meilisearch  | Environment:         "development"
ap2_meilisearch  | Commit SHA:          "cfaac6f7ca55e91ec3cf40f8682f528cd8743562"


ap2_jaeger       | 2025/11/02 22:34:48 maxprocs: Leaving GOMAXPROCS=8: CPU quota undefined
ap2_meilisearch  | Commit date:         "2024-11-14T15:55:14Z"
ap2_meilisearch  | Package version:onfig"1.11.3"ble Watch
ap2_meilisearch  | Anonymous telemetry: "Disabled"
ap2_meilisearch  |
ap2_meilisearch  | A master key has been set. Requests to Meilisearch won't be authorized unless you provide an authentication key.
ap2_meilisearch  |
ap2_meilisearch  |
ap2_meilisearch  |  Meilisearch started with a master key considered unsafe for use in a production environment.
ap2_meilisearch  |
ap2_meilisearch  |  A master key of at least 16 bytes will be required when switching to a production environment.
ap2_meilisearch  |
ap2_meilisearch  |
ap2_meilisearch  | We generated a new secure master key for you (you can safely use this token):
ap2_meilisearch  |
ap2_meilisearch  | >> --master-key IuTl6gG3uknkvha1oVJZF4R5JTxiSnuAdG03OLH_hk0 <<
ap2_meilisearch  |
ap2_meilisearch  | Restart Meilisearch with the argument above to use this new and secure master key.
ap2_meilisearch  |
ap2_meilisearch  | Check out Meilisearch Cloud! https://www.meilisearch.com/cloud?utm_campaign=oss&utm_source=engine&utm_medium=cli
ap2_meilisearch  | Documentation:                       https://www.meilisearch.com/docs
ap2_meilisearch  | Source code:                 https://github.com/meilisearch/meilisearch
ap2_meilisearch  | Discord:                     https://discord.meilisearch.com
ap2_meilisearch  |
ap2_meilisearch  | 2025-11-02T22:34:48.060432Z  INFO actix_server::builder: starting 8 workers
ap2_meilisearch  | 2025-11-02T22:34:48.061251Z  INFO actix_server::server: Actix runtime found; starting in Actix runtime
ap2_jaeger       |
ap2_jaeger       | *******************************************************************************
ap2_jaeger       |
ap2_jaeger       | ðŸ›‘  WARNING: End-of-life Notice for Jaeger v1
ap2_jaeger       |
ap2_jaeger       | You are currently running a v1 version of Jaeger, which is deprecated and will
ap2_jaeger       | reach end-of-life on December 31st, 2025. This means there will be no further
ap2_jaeger       | development, bug fixes, or security patches for v1 after this date.
ap2_jaeger       |
ap2_jaeger       | We strongly recommend migrating to Jaeger v2 for continued support and access
ap2_jaeger       | to new features.
ap2_jaeger       |
ap2_jaeger       | For detailed migration instructions, please refer to the official Jaeger
ap2_jaeger       | documentation:  https://www.jaegertracing.io/docs/latest/migration/
ap2_jaeger       |
ap2_jaeger       | Tracking issue: https://github.com/jaegertracing/jaeger/issues/6321
ap2_jaeger       |
ap2_jaeger       | ðŸ›‘  WARNING: End-of-life Notice for Jaeger v1
ap2_jaeger       |
ap2_jaeger       | *******************************************************************************
ap2_jaeger       | 2025/11/02 22:34:48 application version: git-commit=a204929483c734da6c54eaa75f3f7c322b3e886b, git-version=v1.74.0, build-date=2025-10-03T02:41:46Z
ap2_jaeger       | {"level":"info","ts":1762122888.1918066,"caller":"flags/service.go:124","msg":"Mounting metrics handler on admin server","route":"/metrics"}
ap2_jaeger       | {"level":"info","ts":1762122888.1933298,"caller":"flags/service.go:130","msg":"Mounting expvar handler on admin server","route":"/debug/vars"}
ap2_jaeger       | {"level":"info","ts":1762122888.2298207,"caller":"flags/admin.go:106","msg":"Mounting health check on admin server","route":"/"}
ap2_jaeger       | {"level":"info","ts":1762122888.230023,"caller":"flags/admin.go:123","msg":"Starting admin HTTP server"}
ap2_jaeger       | {"level":"info","ts":1762122888.234748,"caller":"flags/admin.go:137","msg":"Admin server started","http.host-port":"[::]:14269","health-status":"unavailable"}
ap2_jaeger       | {"level":"info","ts":1762122888.237717,"caller":"grpc@v1.75.0/clientconn.go:176","msg":"[core] original dial target is: \"localhost:4317\""}
ap2_jaeger       | {"level":"info","ts":1762122888.237829,"caller":"grpc@v1.75.0/clientconn.go:459","msg":"[core] [Channel #1]Channel created"}
ap2_jaeger       | {"level":"info","ts":1762122888.2392375,"caller":"grpc@v1.75.0/clientconn.go:207","msg":"[core] [Channel #1]parsed dial target is: resolver.Target{URL:url.URL{Scheme:\"dns\", Opaque:\"\", User:(*url.Userinfo)(nil), Host:\"\", Path:\"/localhost:4317\", RawPath:\"\", OmitHost:false, ForceQuery:false, RawQuery:\"\", Fragment:\"\", RawFragment:\"\"}}"}
ap2_jaeger       | {"level":"info","ts":1762122888.239307,"caller":"grpc@v1.75.0/clientconn.go:208","msg":"[core] [Channel #1]Channel authority set to \"localhost:4317\""}
ap2_jaeger       | {"level":"info","ts":1762122888.2438035,"caller":"memory/factory.go:75","msg":"Memory storage initialized","configuration":{"MaxTraces":0}}
ap2_jaeger       | {"level":"info","ts":1762122888.3051045,"caller":"grpc@v1.75.0/server.go:715","msg":"[core] [Server #2]Server created"}
ap2_jaeger       | {"level":"info","ts":1762122888.3057494,"caller":"server/grpc.go:75","msg":"Starting jaeger-collector gRPC server","grpc.host-port":"[::]:14250"}
ap2_jaeger       | {"level":"info","ts":1762122888.3057914,"caller":"server/http.go:37","msg":"Starting jaeger-collector HTTP server","host-port":":14268"}
ap2_jaeger       | {"level":"info","ts":1762122888.3098,"caller":"grpc@v1.75.0/server.go:911","msg":"[core] [Server #2 ListenSocket #3]ListenSocket created"}
ap2_jaeger       | {"level":"info","ts":1762122888.3115325,"caller":"app/collector.go:128","msg":"Not listening for Zipkin HTTP traffic, port not configured"}
ap2_jaeger       | {"level":"info","ts":1762122888.3161972,"caller":"handler/otlp_receiver.go:75","msg":"OTLP receiver status change","status":"StatusStarting"}
ap2_jaeger       | {"level":"info","ts":1762122888.3163013,"caller":"grpc@v1.75.0/server.go:715","msg":"[core] [Server #4]Server created"}
ap2_jaeger       | {"level":"info","ts":1762122888.3166313,"caller":"otlpreceiver@v0.132.0/otlp.go:117","msg":"Starting GRPC server","endpoint":":4317"}
ap2_jaeger       | {"level":"info","ts":1762122888.3175588,"caller":"otlpreceiver@v0.132.0/otlp.go:175","msg":"Starting HTTP server","endpoint":":4318"}
ap2_jaeger       | {"level":"info","ts":1762122888.318012,"caller":"grpc@v1.75.0/server.go:911","msg":"[core] [Server #4 ListenSocket #5]ListenSocket created"}
ap2_jaeger       | {"level":"info","ts":1762122888.3176298,"caller":"app/flags.go:168","msg":"Archive storage not initialized"}
ap2_jaeger       | {"level":"info","ts":1762122888.3189151,"caller":"grpc@v1.75.0/server.go:715","msg":"[core] [Server #6]Server created"}
ap2_jaeger       | {"level":"info","ts":1762122888.3237529,"caller":"app/static_handler.go:92","msg":"Using UI configuration","path":""}
ap2_jaeger       | {"level":"info","ts":1762122888.3241892,"caller":"app/server.go:258","msg":"Query server started","http_addr":"[::]:16686","grpc_addr":"[::]:16685"}
ap2_jaeger       | {"level":"info","ts":1762122888.324338,"caller":"healthcheck/handler.go:117","msg":"Health Check state change","status":"ready"}
ap2_jaeger       | {"level":"info","ts":1762122888.3246932,"caller":"app/server.go:286","msg":"Starting HTTP server","port":16686,"addr":":16686"}
ap2_jaeger       | {"level":"info","ts":1762122888.3253274,"caller":"app/server.go:300","msg":"Starting GRPC server","port":16685,"addr":":16685"}
ap2_jaeger       | {"level":"info","ts":1762122888.3261127,"caller":"grpc@v1.75.0/server.go:911","msg":"[core] [Server #6 ListenSocket #7]ListenSocket created"}
ap2_init_keys    | ================================================================================
ap2_init_keys    | AP2 ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ ã‚­ãƒ¼ãƒšã‚¢åˆæœŸåŒ–
ap2_init_keys    | ================================================================================
ap2_init_keys    |
ap2_init_keys    | ã‚­ãƒ¼ä¿å­˜å…ˆ: /app/v2/keys
ap2_init_keys    | DID Documentä¿å­˜å…ˆ: /app/v2/data/did_documents
ap2_init_keys    |
ap2_init_keys    | [Shopping Agent]
ap2_init_keys    |   ðŸ”‘ ECDSA SECP256R1ã‚­ãƒ¼ãƒšã‚¢ã‚’ç”Ÿæˆä¸­ï¼ˆJWTç”¨ï¼‰...
ap2_init_keys    |   ðŸ”’ ECDSAç§˜å¯†éµã‚’AES-256-CBCã§æš—å·åŒ–ä¸­...
ap2_init_keys    |   âœ“ ç§˜å¯†éµã‚’ä¿å­˜: /app/v2/keys/shopping_agent_private.pem
ap2_init_keys    |   âœ“ å…¬é–‹éµã‚’ä¿å­˜: /app/v2/keys/shopping_agent_public.pem
ap2_init_keys    |   ðŸ”‘ Ed25519ã‚­ãƒ¼ãƒšã‚¢ã‚’ç”Ÿæˆä¸­ï¼ˆA2Aé€šä¿¡ç”¨ï¼‰...
ap2_init_keys    |   ðŸ”’ Ed25519ç§˜å¯†éµã‚’AES-256-CBCã§æš—å·åŒ–ä¸­...
ap2_init_keys    |   âœ“ Ed25519ç§˜å¯†éµã‚’ä¿å­˜: /app/v2/keys/shopping_agent_ed25519_private.pem
ap2_init_keys    |   âœ“ å…¬é–‹éµã‚’ä¿å­˜: /app/v2/keys/shopping_agent_ed25519_public.pem
ap2_init_keys    |   ðŸ“„ W3Cæº–æ‹ ã®DID Documentã‚’ç”Ÿæˆä¸­ï¼ˆECDSA + Ed25519ï¼‰...
ap2_init_keys    |   âœ“ publicKeyMultibaseç”Ÿæˆ: ECDSA=z2oAtm2Xo3qTUY14EoJo..., Ed25519=z6MkoFNMsaGbcfVV1B6A...
ap2_init_keys    |   âœ“ DID Documentã‚’ä¿å­˜: /app/v2/data/did_documents/shopping_agent_did.json
ap2_init_keys    |   âœ… åˆæœŸåŒ–å®Œäº†: DID = did:ap2:agent:shopping_agent
ap2_init_keys    |
ap2_init_keys    | [Merchant Agent]
ap2_init_keys    |   ðŸ”‘ ECDSA SECP256R1ã‚­ãƒ¼ãƒšã‚¢ã‚’ç”Ÿæˆä¸­ï¼ˆJWTç”¨ï¼‰...
ap2_init_keys    |   ðŸ”’ ECDSAç§˜å¯†éµã‚’AES-256-CBCã§æš—å·åŒ–ä¸­...
ap2_init_keys    |   âœ“ ç§˜å¯†éµã‚’ä¿å­˜: /app/v2/keys/merchant_agent_private.pem
ap2_init_keys    |   âœ“ å…¬é–‹éµã‚’ä¿å­˜: /app/v2/keys/merchant_agent_public.pem
ap2_init_keys    |   ðŸ”‘ Ed25519ã‚­ãƒ¼ãƒšã‚¢ã‚’ç”Ÿæˆä¸­ï¼ˆA2Aé€šä¿¡ç”¨ï¼‰...
ap2_init_keys    |   ðŸ”’ Ed25519ç§˜å¯†éµã‚’AES-256-CBCã§æš—å·åŒ–ä¸­...
ap2_init_keys    |   âœ“ Ed25519ç§˜å¯†éµã‚’ä¿å­˜: /app/v2/keys/merchant_agent_ed25519_private.pem
ap2_init_keys    |   âœ“ å…¬é–‹éµã‚’ä¿å­˜: /app/v2/keys/merchant_agent_ed25519_public.pem
ap2_init_keys    |   ðŸ“„ W3Cæº–æ‹ ã®DID Documentã‚’ç”Ÿæˆä¸­ï¼ˆECDSA + Ed25519ï¼‰...
ap2_init_keys    |   âœ“ publicKeyMultibaseç”Ÿæˆ: ECDSA=z2oAtptZyzpm53hnjMYV..., Ed25519=z6MkqDUqEerx4ZQKMQFd...
ap2_init_keys    |   âœ“ DID Documentã‚’ä¿å­˜: /app/v2/data/did_documents/merchant_agent_did.json
ap2_init_keys    |   âœ… åˆæœŸåŒ–å®Œäº†: DID = did:ap2:agent:merchant_agent
ap2_init_keys    |
ap2_init_keys    | [Merchant]
ap2_init_keys    |   ðŸ”‘ ECDSA SECP256R1ã‚­ãƒ¼ãƒšã‚¢ã‚’ç”Ÿæˆä¸­ï¼ˆJWTç”¨ï¼‰...
ap2_init_keys    |   ðŸ”’ ECDSAç§˜å¯†éµã‚’AES-256-CBCã§æš—å·åŒ–ä¸­...
ap2_init_keys    |   âœ“ ç§˜å¯†éµã‚’ä¿å­˜: /app/v2/keys/merchant_private.pem
ap2_init_keys    |   âœ“ å…¬é–‹éµã‚’ä¿å­˜: /app/v2/keys/merchant_public.pem
ap2_init_keys    |   ðŸ”‘ Ed25519ã‚­ãƒ¼ãƒšã‚¢ã‚’ç”Ÿæˆä¸­ï¼ˆA2Aé€šä¿¡ç”¨ï¼‰...
ap2_init_keys    |   ðŸ”’ Ed25519ç§˜å¯†éµã‚’AES-256-CBCã§æš—å·åŒ–ä¸­...
ap2_init_keys    |   âœ“ Ed25519ç§˜å¯†éµã‚’ä¿å­˜: /app/v2/keys/merchant_ed25519_private.pem
ap2_init_keys    |   âœ“ å…¬é–‹éµã‚’ä¿å­˜: /app/v2/keys/merchant_ed25519_public.pem
ap2_init_keys    |   ðŸ“„ W3Cæº–æ‹ ã®DID Documentã‚’ç”Ÿæˆä¸­ï¼ˆECDSA + Ed25519ï¼‰...
ap2_init_keys    |   âœ“ publicKeyMultibaseç”Ÿæˆ: ECDSA=z2oAtobRREHhZvtZzQLk..., Ed25519=z6MkhzAJE98Jxi98Buec...
ap2_init_keys    |   âœ“ DID Documentã‚’ä¿å­˜: /app/v2/data/did_documents/merchant_did.json
ap2_init_keys    |   âœ… åˆæœŸåŒ–å®Œäº†: DID = did:ap2:merchant:mugibo_merchant
ap2_init_keys    |
ap2_init_keys    | [Credential Provider]
ap2_init_keys    |   ðŸ”‘ ECDSA SECP256R1ã‚­ãƒ¼ãƒšã‚¢ã‚’ç”Ÿæˆä¸­ï¼ˆJWTç”¨ï¼‰...
ap2_init_keys    |   ðŸ”’ ECDSAç§˜å¯†éµã‚’AES-256-CBCã§æš—å·åŒ–ä¸­...
ap2_init_keys    |   âœ“ ç§˜å¯†éµã‚’ä¿å­˜: /app/v2/keys/credential_provider_private.pem
ap2_init_keys    |   âœ“ å…¬é–‹éµã‚’ä¿å­˜: /app/v2/keys/credential_provider_public.pem
ap2_init_keys    |   ðŸ”‘ Ed25519ã‚­ãƒ¼ãƒšã‚¢ã‚’ç”Ÿæˆä¸­ï¼ˆA2Aé€šä¿¡ç”¨ï¼‰...
ap2_init_keys    |   ðŸ”’ Ed25519ç§˜å¯†éµã‚’AES-256-CBCã§æš—å·åŒ–ä¸­...
ap2_init_keys    |   âœ“ Ed25519ç§˜å¯†éµã‚’ä¿å­˜: /app/v2/keys/credential_provider_ed25519_private.pem
ap2_init_keys    |   âœ“ å…¬é–‹éµã‚’ä¿å­˜: /app/v2/keys/credential_provider_ed25519_public.pem
ap2_init_keys    |   ðŸ“„ W3Cæº–æ‹ ã®DID Documentã‚’ç”Ÿæˆä¸­ï¼ˆECDSA + Ed25519ï¼‰...
ap2_init_keys    |   âœ“ publicKeyMultibaseç”Ÿæˆ: ECDSA=z2oAtMnSaYGx3YDXy9n1..., Ed25519=z6MkiUjqwnhQV11oS98q...
ap2_init_keys    |   âœ“ DID Documentã‚’ä¿å­˜: /app/v2/data/did_documents/credential_provider_did.json
ap2_init_keys    |   âœ… åˆæœŸåŒ–å®Œäº†: DID = did:ap2:cp:demo_cp
ap2_init_keys    |
ap2_init_keys    | [Credential Provider 2]
ap2_init_keys    |   ðŸ”‘ ECDSA SECP256R1ã‚­ãƒ¼ãƒšã‚¢ã‚’ç”Ÿæˆä¸­ï¼ˆJWTç”¨ï¼‰...
ap2_init_keys    |   ðŸ”’ ECDSAç§˜å¯†éµã‚’AES-256-CBCã§æš—å·åŒ–ä¸­...
ap2_init_keys    |   âœ“ ç§˜å¯†éµã‚’ä¿å­˜: /app/v2/keys/credential_provider_2_private.pem
ap2_init_keys    |   âœ“ å…¬é–‹éµã‚’ä¿å­˜: /app/v2/keys/credential_provider_2_public.pem
ap2_init_keys    |   ðŸ”‘ Ed25519ã‚­ãƒ¼ãƒšã‚¢ã‚’ç”Ÿæˆä¸­ï¼ˆA2Aé€šä¿¡ç”¨ï¼‰...
ap2_init_keys    |   ðŸ”’ Ed25519ç§˜å¯†éµã‚’AES-256-CBCã§æš—å·åŒ–ä¸­...
ap2_init_keys    |   âœ“ Ed25519ç§˜å¯†éµã‚’ä¿å­˜: /app/v2/keys/credential_provider_2_ed25519_private.pem
ap2_init_keys    |   âœ“ å…¬é–‹éµã‚’ä¿å­˜: /app/v2/keys/credential_provider_2_ed25519_public.pem
ap2_init_keys    |   ðŸ“„ W3Cæº–æ‹ ã®DID Documentã‚’ç”Ÿæˆä¸­ï¼ˆECDSA + Ed25519ï¼‰...
ap2_init_keys    |   âœ“ publicKeyMultibaseç”Ÿæˆ: ECDSA=z2oAtLnJTbf1wMwpFSn8..., Ed25519=z6MkqDgAfQ1AdaccGA3Y...
ap2_init_keys    |   âœ“ DID Documentã‚’ä¿å­˜: /app/v2/data/did_documents/credential_provider_2_did.json
ap2_init_keys    |   âœ… åˆæœŸåŒ–å®Œäº†: DID = did:ap2:cp:demo_cp_2
ap2_init_keys    |
ap2_init_keys    | [Payment Processor]
ap2_init_keys    |   ðŸ”‘ ECDSA SECP256R1ã‚­ãƒ¼ãƒšã‚¢ã‚’ç”Ÿæˆä¸­ï¼ˆJWTç”¨ï¼‰...
ap2_init_keys    |   ðŸ”’ ECDSAç§˜å¯†éµã‚’AES-256-CBCã§æš—å·åŒ–ä¸­...
ap2_init_keys    |   âœ“ ç§˜å¯†éµã‚’ä¿å­˜: /app/v2/keys/payment_processor_private.pem
ap2_init_keys    |   âœ“ å…¬é–‹éµã‚’ä¿å­˜: /app/v2/keys/payment_processor_public.pem
ap2_init_keys    |   ðŸ”‘ Ed25519ã‚­ãƒ¼ãƒšã‚¢ã‚’ç”Ÿæˆä¸­ï¼ˆA2Aé€šä¿¡ç”¨ï¼‰...
ap2_init_keys    |   ðŸ”’ Ed25519ç§˜å¯†éµã‚’AES-256-CBCã§æš—å·åŒ–ä¸­...
ap2_init_keys    |   âœ“ Ed25519ç§˜å¯†éµã‚’ä¿å­˜: /app/v2/keys/payment_processor_ed25519_private.pem
ap2_init_keys    |   âœ“ å…¬é–‹éµã‚’ä¿å­˜: /app/v2/keys/payment_processor_ed25519_public.pem
ap2_init_keys    |   ðŸ“„ W3Cæº–æ‹ ã®DID Documentã‚’ç”Ÿæˆä¸­ï¼ˆECDSA + Ed25519ï¼‰...
ap2_init_keys    |   âœ“ publicKeyMultibaseç”Ÿæˆ: ECDSA=z2oAtYsFJdgdAy67xwLx..., Ed25519=z6Mkk4fHxpBooR7fZhwE...
ap2_init_keys    |   âœ“ DID Documentã‚’ä¿å­˜: /app/v2/data/did_documents/payment_processor_did.json
ap2_init_keys    |   âœ… åˆæœŸåŒ–å®Œäº†: DID = did:ap2:agent:payment_processor
ap2_init_keys    |
ap2_init_keys    | ================================================================================
ap2_init_keys    | âœ… å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸ
ap2_init_keys    | ================================================================================
ap2_init_keys    |
ap2_init_keys    | æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:
ap2_init_keys    |   1. docker-compose up -d ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•
ap2_init_keys    |   2. å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ã‚­ãƒ¼ã‚’æ°¸ç¶šåŒ–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿ã¾ã™
ap2_init_keys    |   3. DIDã¯å†èµ·å‹•å¾Œã‚‚ä¸€è²«ã—ã¦ç¶­æŒã•ã‚Œã¾ã™
ap2_init_keys    |
ap2_init_keys exited with code 0
ap2_init_seeds   | ================================================================================
ap2_init_seeds   | AP2 ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ (AP2å®Œå…¨æº–æ‹ )
ap2_init_seeds   | ================================================================================
ap2_init_seeds   |
ap2_init_seeds   | ãƒ‡ãƒ¼ã‚¿ä¿å­˜å…ˆ: /app/v2/data
ap2_init_seeds   |
ap2_init_seeds   | AP2å®Œå…¨æº–æ‹ ã®ãŸã‚ã€ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿æŠ•å…¥ã—ã¾ã™ï¼š
ap2_init_seeds   |   âœ… å•†å“ãƒ‡ãƒ¼ã‚¿: MerchantãŒç®¡ç†
ap2_init_seeds   |   âš ï¸  ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿: Passkeyç™»éŒ²æ™‚ã«è‡ªå‹•ä½œæˆï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰
ap2_init_seeds   |   âš ï¸  æ”¯æ‰•ã„æ–¹æ³•: Passkeyç™»éŒ²å¾Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ï¼‰
ap2_init_seeds   |
ap2_init_seeds   | [å•†å“ãƒ‡ãƒ¼ã‚¿æŠ•å…¥]
ap2_init_seeds   | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: sqlite+aiosqlite:////app/v2/data/merchant_agent.db
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ (Â¥800)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ (Â¥3500)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ (Â¥1500)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ— (Â¥1200)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ (Â¥500)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼Tã‚·ãƒ£ãƒ„ (Â¥2800)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ãƒˆãƒ¼ãƒˆãƒãƒƒã‚° (Â¥1800)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ (Â¥950)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ã¬ã„ãã‚‹ã¿ï¼ˆSï¼‰ (Â¥2200)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ã¬ã„ãã‚‹ã¿ï¼ˆLï¼‰ (Â¥4800)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ã‚­ãƒ£ãƒƒãƒ— (Â¥2000)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ã‚¯ãƒƒã‚·ãƒ§ãƒ³ (Â¥2500)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ãƒŽãƒ¼ãƒˆ (Â¥700)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ãƒœãƒ¼ãƒ«ãƒšãƒ³ (Â¥600)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒœãƒˆãƒ« (Â¥2400)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼é´ä¸‹ (Â¥850)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ãƒžã‚¦ã‚¹ãƒ‘ãƒƒãƒ‰ (Â¥900)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ã‚¹ãƒžãƒ›ã‚±ãƒ¼ã‚¹ (Â¥1800)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼æŠ˜ã‚ŠãŸãŸã¿å‚˜ (Â¥2600)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ã‚¨ã‚³ãƒãƒƒã‚° (Â¥1200)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ãƒ–ãƒ©ãƒ³ã‚±ãƒƒãƒˆ (Â¥3200)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ (Â¥1900)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ãƒ‘ãƒ¼ã‚«ãƒ¼ (Â¥4500)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚¿ã‚ªãƒ« (Â¥1300)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ã‚¢ãƒ­ãƒžã‚­ãƒ£ãƒ³ãƒ‰ãƒ« (Â¥2100)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼æŠ±ãæž• (Â¥5500)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ãƒã‚¹ã‚¿ãƒ¼ (Â¥900)
ap2_init_seeds   |   âœ… ä½œæˆ: ã‚€ãŽã¼ãƒ¼ãƒ‹ãƒƒãƒˆå¸½ (Â¥1800)
ap2_init_seeds   |   âœ… å•†å“ãƒ‡ãƒ¼ã‚¿æŠ•å…¥å®Œäº† (28ä»¶)
ap2_init_seeds   |
ap2_init_seeds   | ================================================================================
ap2_init_seeds   | âœ… å•†å“ãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥ãŒå®Œäº†ã—ã¾ã—ãŸ (AP2å®Œå…¨æº–æ‹ )
ap2_init_seeds   | ================================================================================
ap2_init_seeds   |
ap2_init_seeds   | æŠ•å…¥ãƒ‡ãƒ¼ã‚¿ã‚µãƒžãƒª:
ap2_init_seeds   |   - å•†å“: 28ä»¶ (merchant_agent.db)
ap2_init_seeds   |
ap2_init_seeds   | æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:
ap2_init_seeds   |   1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (http://localhost:3000) ã«ã‚¢ã‚¯ã‚»ã‚¹
ap2_init_seeds   |   2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ² (/auth/register)
ap2_init_seeds   |   3. Passkeyç™»éŒ² (/auth/register-passkey)
ap2_init_seeds   |   4. æ”¯æ‰•ã„æ–¹æ³•ç™»éŒ²ï¼ˆPasskeyç™»éŒ²å¾Œã«è‡ªå‹•è¡¨ç¤ºï¼‰
ap2_init_seeds   |
ap2_init_seeds exited with code 0
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-02T22:34:51.642383Z", "level": "INFO", "logger": "common.search_engine", "message": "[MeilisearchClient] Initialized: http://meilisearch:7700, index=products", "module": "search_engine", "function": "__init__", "line": 38}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-02T22:34:51.642972Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Initialized: merchant_agent_mcp v1.0.0", "module": "mcp_server", "function": "__init__", "line": 90}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-02T22:34:51.643050Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: search_products", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-02T22:34:51.643071Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: check_inventory", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | {"timestamp": "2025-11-02T22:34:51.643087Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_cart_mandates", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_merchant_agent_mcp  | INFO:     Started server process [1]
ap2_merchant_agent_mcp  | INFO:     Waiting for application startup.
ap2_merchant_agent_mcp  | INFO:     Application startup complete.
ap2_merchant_agent_mcp  | INFO:     Uvicorn running on http://0.0.0.0:8011 (Press CTRL+C to quit)
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:51.983382Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Initialized: shopping_agent_mcp v1.0.0", "module": "mcp_server", "function": "__init__", "line": 90}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:51.983507Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_intent_mandate", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:51.983549Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: request_cart_candidates", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:51.983589Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: select_and_sign_cart", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:51.983619Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: assess_payment_risk", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:51.983654Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: build_payment_mandate", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:51.983687Z", "level": "INFO", "logger": "common.mcp_server", "message": "[MCPServer] Registered tool: execute_payment", "module": "mcp_server", "function": "decorator", "line": 412}
ap2_shopping_agent_mcp  | INFO:     Started server process [1]
ap2_shopping_agent_mcp  | INFO:     Waiting for application startup.
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:52.008637Z", "level": "INFO", "logger": "services.shopping_agent_mcp.main", "message": "[Shopping Agent MCP] Starting up...", "module": "main", "function": "lifespan", "line": 400}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:52.023640Z", "level": "INFO", "logger": "services.shopping_agent_mcp.main", "message": "[Shopping Agent MCP] Database initialized", "module": "main", "function": "lifespan", "line": 404}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:52.032116Z", "level": "INFO", "logger": "services.shopping_agent_mcp.main", "message": "[Startup] KeyManager initialized with keys_directory=/app/keys", "module": "main", "function": "lifespan", "line": 411}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:52.032159Z", "level": "INFO", "logger": "services.shopping_agent_mcp.main", "message": "[Startup] Extracted key_id=shopping_agent from AGENT_ID=did:ap2:agent:shopping_agent", "module": "main", "function": "lifespan", "line": 415}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:52.032185Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:52.047400Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:52.047507Z", "level": "INFO", "logger": "services.shopping_agent_mcp.main", "message": "[Startup] ED25519 private key loaded for shopping_agent", "module": "main", "function": "lifespan", "line": 421}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:52.047540Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:52.050731Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:52.051019Z", "level": "INFO", "logger": "services.shopping_agent_mcp.main", "message": "[Startup] ECDSA private key loaded for shopping_agent", "module": "main", "function": "lifespan", "line": 429}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:52.051481Z", "level": "INFO", "logger": "services.shopping_agent_mcp.main", "message": "[Startup] SignatureManager initialized", "module": "main", "function": "lifespan", "line": 439}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:52.058617Z", "level": "INFO", "logger": "services.shopping_agent_mcp.main", "message": "[Startup] A2AMessageHandler initialized with key_id: shopping_agent", "module": "main", "function": "lifespan", "line": 447}
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:52.058701Z", "level": "INFO", "logger": "services.shopping_agent_mcp.main", "message": "[Startup] RiskAssessmentEngine initialized", "module": "main", "function": "lifespan", "line": 451}
ap2_shopping_agent_mcp  | INFO:     Application startup complete.
ap2_shopping_agent_mcp  | {"timestamp": "2025-11-02T22:34:52.058736Z", "level": "INFO", "logger": "services.shopping_agent_mcp.main", "message": "[Shopping Agent MCP] Startup complete", "module": "main", "function": "lifespan", "line": 453}
ap2_shopping_agent_mcp  | INFO:     Uvicorn running on http://0.0.0.0:8010 (Press CTRL+C to quit)
ap2_shopping_agent      | [2025-11-02 22:34:54,659] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_shopping_agent      | [2025-11-02 22:34:54,659] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_shopping_agent      |   Service Name: shopping_agent
ap2_shopping_agent      |   OTLP Endpoint: http://jaeger:4317
ap2_shopping_agent      |   Insecure: True
ap2_shopping_agent      | [2025-11-02 22:34:54,679] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: shopping_agent
ap2_shopping_agent      | [2025-11-02 22:34:54,679] INFO in common.base_agent: [Shopping Agent] OpenTelemetry distributed tracing enabled (service: shopping_agent, manual instrumentation only)
ap2_shopping_agent      | {"timestamp": "2025-11-02T22:34:54.694777Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_shopping_agent      | {"timestamp": "2025-11-02T22:34:54.702585Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_shopping_agent      | [2025-11-02 22:34:54,702] INFO in common.base_agent: [Shopping Agent] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: shopping_agent
ap2_shopping_agent      | {"timestamp": "2025-11-02T22:34:54.702853Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: shopping_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_shopping_agent      | {"timestamp": "2025-11-02T22:34:54.704208Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_shopping_agent      | [2025-11-02 22:34:54,704] INFO in common.base_agent: [Shopping Agent] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: shopping_agent
ap2_shopping_agent      | [2025-11-02 22:34:54,704] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/shopping_agent_did.json
ap2_shopping_agent      | [2025-11-02 22:34:54,705] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_shopping_agent      | [2025-11-02 22:34:54,705] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/merchant_agent_did.json
ap2_shopping_agent      | [2025-11-02 22:34:54,705] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_shopping_agent      | [2025-11-02 22:34:54,705] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/merchant_did.json
ap2_shopping_agent      | [2025-11-02 22:34:54,706] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_shopping_agent      | [2025-11-02 22:34:54,706] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/credential_provider_did.json
ap2_shopping_agent      | [2025-11-02 22:34:54,706] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp
ap2_shopping_agent      | [2025-11-02 22:34:54,706] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/credential_provider_2_did.json
ap2_shopping_agent      | [2025-11-02 22:34:54,706] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2
ap2_shopping_agent      | [2025-11-02 22:34:54,706] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/payment_processor_did.json
ap2_shopping_agent      | [2025-11-02 22:34:54,707] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor
ap2_shopping_agent      | {"timestamp": "2025-11-02T22:34:54.707316Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.CartMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | {"timestamp": "2025-11-02T22:34:54.707344Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.responses.ProductList", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | {"timestamp": "2025-11-02T22:34:54.707355Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.responses.SignatureResponse", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_shopping_agent      | [2025-11-02 22:34:54,715] INFO in common.base_agent: [Shopping Agent] Initialized: did:ap2:agent:shopping_agent
ap2_merchant            | [2025-11-02 22:34:54,792] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_merchant            | [2025-11-02 22:34:54,793] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_merchant            |   Service Name: merchant
ap2_merchant            |   OTLP Endpoint: http://jaeger:4317
ap2_merchant            |   Insecure: True
ap2_shopping_agent      | [2025-11-02 22:34:54,794] INFO in common.risk_assessment: [RiskAssessmentEngine] Initialized (database_mode=enabled)
ap2_merchant            | [2025-11-02 22:34:54,826] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: merchant
ap2_merchant            | [2025-11-02 22:34:54,826] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant            | [2025-11-02 22:34:54,826] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant'. Adding OTLP exporter to existing provider.
ap2_merchant            | [2025-11-02 22:34:54,828] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant            | [2025-11-02 22:34:54,828] INFO in common.base_agent: [Merchant] OpenTelemetry distributed tracing enabled (service: merchant, manual instrumentation only)
ap2_merchant            | {"timestamp": "2025-11-02T22:34:54.844527Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_merchant            | [2025-11-02 22:34:54,855] INFO in common.base_agent: [Merchant] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: merchant
ap2_merchant            | {"timestamp": "2025-11-02T22:34:54.855258Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_merchant            | {"timestamp": "2025-11-02T22:34:54.855391Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_merchant            | {"timestamp": "2025-11-02T22:34:54.857979Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_merchant            | [2025-11-02 22:34:54,858] INFO in common.base_agent: [Merchant] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: merchant
ap2_merchant            | [2025-11-02 22:34:54,859] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­: /app/data/did_documents/shopping_agent_did.json
ap2_merchant            | [2025-11-02 22:34:54,860] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_merchant            | [2025-11-02 22:34:54,861] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/merchant_agent_did.json
ap2_merchant            | [2025-11-02 22:34:54,862] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_merchant            | [2025-11-02 22:34:54,863] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/merchant_did.json
ap2_merchant            | [2025-11-02 22:34:54,866] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_merchant            | [2025-11-02 22:34:54,867] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/credential_provider_did.json
ap2_merchant            | [2025-11-02 22:34:54,867] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp
ap2_merchant            | [2025-11-02 22:34:54,867] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/credential_provider_2_did.json
ap2_merchant            | [2025-11-02 22:34:54,870] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2
ap2_merchant            | [2025-11-02 22:34:54,870] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/payment_processor_did.json
ap2_merchant            | [2025-11-02 22:34:54,871] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor
ap2_merchant            | {"timestamp": "2025-11-02T22:34:54.871309Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.CartMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant            | [2025-11-02 22:34:54,878] INFO in common.base_agent: [Merchant] Initialized: did:ap2:merchant
ap2_payment_processor   | [2025-11-02 22:34:54,880] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_payment_processor   | [2025-11-02 22:34:54,881] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_payment_processor   |   Service Name: payment_processor
ap2_payment_processor   |   OTLP Endpoint: http://jaeger:4317
ap2_payment_processor   |   Insecure: True
ap2_payment_processor   | [2025-11-02 22:34:54,908] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: payment_processor
ap2_payment_processor   | [2025-11-02 22:34:54,909] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_payment_processor   | [2025-11-02 22:34:54,909] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='payment_processor'. Adding OTLP exporter to existing provider.
ap2_payment_processor   | [2025-11-02 22:34:54,910] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_payment_processor   | [2025-11-02 22:34:54,910] INFO in common.base_agent: [Payment Processor] OpenTelemetry distributed tracing enabled (service: payment_processor, manual instrumentation only)
ap2_payment_processor   | {"timestamp": "2025-11-02T22:34:54.920795Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: payment_processor (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_payment_processor   | [2025-11-02 22:34:54,928] INFO in common.base_agent: [Payment Processor] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: payment_processor
ap2_payment_processor   | {"timestamp": "2025-11-02T22:34:54.928136Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_payment_processor   | {"timestamp": "2025-11-02T22:34:54.928260Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: payment_processor (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_payment_processor   | {"timestamp": "2025-11-02T22:34:54.930102Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_payment_processor   | [2025-11-02 22:34:54,930] INFO in common.base_agent: [Payment Processor] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: payment_processor
ap2_payment_processor   | [2025-11-02 22:34:54,930] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/shopping_agent_did.json
ap2_payment_processor   | [2025-11-02 22:34:54,932] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_payment_processor   | [2025-11-02 22:34:54,932] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/merchant_agent_did.json
ap2_payment_processor   | [2025-11-02 22:34:54,932] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_payment_processor   | [2025-11-02 22:34:54,932] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/merchant_did.json
ap2_payment_processor   | [2025-11-02 22:34:54,936] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_payment_processor   | [2025-11-02 22:34:54,936] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/credential_provider_did.json
ap2_payment_processor   | [2025-11-02 22:34:54,937] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp
ap2_payment_processor   | [2025-11-02 22:34:54,937] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/credential_provider_2_did.json
ap2_payment_processor   | [2025-11-02 22:34:54,941] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2
ap2_payment_processor   | [2025-11-02 22:34:54,941] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/payment_processor_did.json
ap2_payment_processor   | [2025-11-02 22:34:54,942] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor
ap2_payment_processor   | {"timestamp": "2025-11-02T22:34:54.942642Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_payment_processor   | [2025-11-02 22:34:54,946] INFO in common.base_agent: [Payment Processor] Initialized: did:ap2:agent:payment_processor
ap2_merchant            | [2025-11-02 22:34:54,982] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_merchant            | INFO:     Started server process [1]
ap2_merchant            | INFO:     Waiting for application startup.
ap2_merchant            | {"timestamp": "2025-11-02T22:34:54.982610Z", "level": "INFO", "logger": "services.merchant.service", "message": "[Merchant] Initialized", "module": "service", "function": "__init__", "line": 114}
ap2_merchant            | {"timestamp": "2025-11-02T22:34:54.983449Z", "level": "INFO", "logger": "services.merchant.service", "message": "[Merchant] Running startup tasks...", "module": "service", "function": "startup_event", "line": 98}
ap2_merchant            | {"timestamp": "2025-11-02T22:34:55.004485Z", "level": "INFO", "logger": "services.merchant.service", "message": "[Merchant] Database initialized", "module": "service", "function": "startup_event", "line": 102}
ap2_merchant            |
ap2_merchant            | ============================================================
ap2_merchant            | å•†å“ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ä¸­...
ap2_merchant            | ============================================================
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ— (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼Tã‚·ãƒ£ãƒ„ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒˆãƒ¼ãƒˆãƒãƒƒã‚° (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã¬ã„ãã‚‹ã¿ï¼ˆSï¼‰ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã¬ã„ãã‚‹ã¿ï¼ˆLï¼‰ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚­ãƒ£ãƒƒãƒ— (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¯ãƒƒã‚·ãƒ§ãƒ³ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒŽãƒ¼ãƒˆ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒœãƒ¼ãƒ«ãƒšãƒ³ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒœãƒˆãƒ« (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼é´ä¸‹ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒžã‚¦ã‚¹ãƒ‘ãƒƒãƒ‰ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¹ãƒžãƒ›ã‚±ãƒ¼ã‚¹ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼æŠ˜ã‚ŠãŸãŸã¿å‚˜ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¨ã‚³ãƒãƒƒã‚° (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ–ãƒ©ãƒ³ã‚±ãƒƒãƒˆ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ‘ãƒ¼ã‚«ãƒ¼ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚¿ã‚ªãƒ« (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¢ãƒ­ãƒžã‚­ãƒ£ãƒ³ãƒ‰ãƒ« (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼æŠ±ãæž• (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒã‚¹ã‚¿ãƒ¼ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ‹ãƒƒãƒˆå¸½ (æ—¢å­˜)
ap2_merchant            |
ap2_merchant            | âœ… å•†å“ãƒ‡ãƒ¼ã‚¿æŠ•å…¥å®Œäº† (28ä»¶)
ap2_merchant            |
ap2_merchant            | ============================================================
ap2_merchant            | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ä¸­...
ap2_merchant            | ============================================================
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: å±±ç”°å¤ªéƒŽ (æ—¢å­˜)
ap2_merchant            |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ä½è—¤èŠ±å­ (æ—¢å­˜)
ap2_merchant            |
ap2_merchant            | âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿æŠ•å…¥å®Œäº† (2ä»¶)
ap2_merchant            | {"timestamp": "2025-11-02T22:34:55.069197Z", "level": "INFO", "logger": "services.merchant.service", "message": "[Merchant] Sample data seeded successfully", "module": "service", "function": "startup_event", "line": 110}
ap2_merchant            | INFO:     Application startup complete.
ap2_merchant            | INFO:     Uvicorn running on http://0.0.0.0:8002 (Press CTRL+C to quit)
ap2_payment_processor   | {"timestamp": "2025-11-02T22:34:55.112513Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[Payment Processor] Initialized", "module": "processor", "function": "__init__", "line": 98}
ap2_payment_processor   | [2025-11-02 22:34:55,112] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_payment_processor   | INFO:     Started server process [1]
ap2_payment_processor   | INFO:     Waiting for application startup.
ap2_payment_processor   | {"timestamp": "2025-11-02T22:34:55.113859Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[Payment Processor] Running startup tasks...", "module": "processor", "function": "startup_event", "line": 92}
ap2_payment_processor   | INFO:     Application startup complete.
ap2_payment_processor   | {"timestamp": "2025-11-02T22:34:55.123099Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[Payment Processor] Database initialized", "module": "processor", "function": "startup_event", "line": 96}
ap2_payment_processor   | INFO:     Uvicorn running on http://0.0.0.0:8004 (Press CTRL+C to quit)
ap2_shopping_agent      | [2025-11-02 22:34:56,329] INFO in services.shopping_agent.langgraph_shopping_flow: [Langfuse] Shopping Agent tracing enabled
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.371771Z", "level": "INFO", "logger": "services.merchant_agent.langgraph_merchant", "message": "[Langfuse] Tracing enabled", "module": "langgraph_merchant", "function": "<module>", "line": 81}
ap2_merchant_agent      | [2025-11-02 22:34:56,384] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_merchant_agent      | [2025-11-02 22:34:56,384] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='merchant_agent'. Adding OTLP exporter to existing provider.
ap2_merchant_agent      | [2025-11-02 22:34:56,413] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_merchant_agent      | [2025-11-02 22:34:56,413] INFO in common.base_agent: [Merchant Agent] OpenTelemetry distributed tracing enabled (service: merchant_agent, manual instrumentation only)
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.420054Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant_agent (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_merchant_agent      | [2025-11-02 22:34:56,426] INFO in common.base_agent: [Merchant Agent] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: merchant_agent
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.426544Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.426676Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: merchant_agent (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_merchant_agent      | [2025-11-02 22:34:56,428] INFO in common.base_agent: [Merchant Agent] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: merchant_agent
ap2_merchant_agent      | [2025-11-02 22:34:56,428] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/shopping_agent_did.json
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.428278Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_merchant_agent      | [2025-11-02 22:34:56,429] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_merchant_agent      | [2025-11-02 22:34:56,429] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/merchant_agent_did.json
ap2_merchant_agent      | [2025-11-02 22:34:56,429] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_merchant_agent      | [2025-11-02 22:34:56,429] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/merchant_did.json
ap2_merchant_agent      | [2025-11-02 22:34:56,430] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_merchant_agent      | [2025-11-02 22:34:56,430] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/credential_provider_did.json
ap2_merchant_agent      | [2025-11-02 22:34:56,430] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp
ap2_merchant_agent      | [2025-11-02 22:34:56,430] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/credential_provider_2_did.json
ap2_merchant_agent      | [2025-11-02 22:34:56,431] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2
ap2_merchant_agent      | [2025-11-02 22:34:56,431] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼
ã¿ä¸­: /app/data/did_documents/payment_processor_did.json
ap2_merchant_agent      | [2025-11-02 22:34:56,431] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.431747Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.IntentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.431774Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.ProductSearch", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.431787Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.CartRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.431802Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.CartSelection", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.431811Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_merchant_agent      | [2025-11-02 22:34:56,434] INFO in common.base_agent: [Merchant Agent] Initialized: did:ap2:agent:merchant_agent
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.535356Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "[Merchant Agent] Initialized (AI Mode: True)", "module": "agent", "function": "__init__", "line": 159}
ap2_merchant_agent      | INFO:     Started server process [1]
ap2_merchant_agent      | INFO:     Waiting for application startup.
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.535885Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "[Merchant Agent] Running startup tasks...", "module": "agent", "function": "startup_event", "line": 107}
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.547826Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "[Merchant Agent] Database initialized", "module": "agent", "function": "startup_event", "line": 111}
ap2_merchant_agent      |
ap2_merchant_agent      | ============================================================
ap2_merchant_agent      | å•†å“ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ä¸­...
ap2_merchant_agent      | ============================================================
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ— (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼Tã‚·ãƒ£ãƒ„ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒˆãƒ¼ãƒˆãƒãƒƒã‚° (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã¬ã„ãã‚‹ã¿ï¼ˆSï¼‰ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã¬ã„ãã‚‹ã¿ï¼ˆLï¼‰ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚­ãƒ£ãƒƒãƒ— (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¯ãƒƒã‚·ãƒ§ãƒ³ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒŽãƒ¼ãƒˆ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒœãƒ¼ãƒ«ãƒšãƒ³ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒœãƒˆãƒ« (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼é´ä¸‹ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒžã‚¦ã‚¹ãƒ‘ãƒƒãƒ‰ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¹ãƒžãƒ›ã‚±ãƒ¼ã‚¹ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼æŠ˜ã‚ŠãŸãŸã¿å‚˜ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¨ã‚³ãƒãƒƒã‚° (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ–ãƒ©ãƒ³ã‚±ãƒƒãƒˆ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ‘ãƒ¼ã‚«ãƒ¼ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚¿ã‚ªãƒ« (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ã‚¢ãƒ­ãƒžã‚­ãƒ£ãƒ³ãƒ‰ãƒ« (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼æŠ±ãæž• (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒã‚¹ã‚¿ãƒ¼ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ã‚€ãŽã¼ãƒ¼ãƒ‹ãƒƒãƒˆå¸½ (æ—¢å­˜)
ap2_merchant_agent      |
ap2_merchant_agent      | âœ… å•†å“ãƒ‡ãƒ¼ã‚¿æŠ•å…¥å®Œäº† (28ä»¶)
ap2_merchant_agent      |
ap2_merchant_agent      | ============================================================
ap2_merchant_agent      | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ä¸­...
ap2_merchant_agent      | ============================================================
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: å±±ç”°å¤ªéƒŽ (æ—¢å­˜)
ap2_merchant_agent      |   â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: ä½è—¤èŠ±å­ (æ—¢å­˜)
ap2_merchant_agent      |
ap2_merchant_agent      | âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿æŠ•å…¥å®Œäº† (2ä»¶)
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.643372Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "[Merchant Agent] Sample data seeded successfully", "module": "agent", "function": "startup_event", "line": 117}
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.643538Z", "level": "INFO", "logger": "common.search_engine", "message": "[MeilisearchClient] Initialized: http://meilisearch:7700, index=products", "module": "search_engine", "function": "__init__", "line": 38}
ap2_shopping_agent      | [2025-11-02 22:34:56,685] INFO in services.shopping_agent.langgraph_shopping_flow: [LangGraph Shopping Flow] LLM initialized: ai/qwen3 at http://host.docker.internal:12434/engines/llama.cpp/v1
ap2_shopping_agent      | [2025-11-02 22:34:56,690] INFO in services.shopping_agent.langgraph_shopping_flow: [create_shopping_flow_graph] LangGraph shopping flow compiled successfully (14 nodes, AP2 compliant, with checkpointer for trace continuity)
ap2_shopping_agent      | {"timestamp": "2025-11-02T22:34:56.690559Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[Shopping Agent] LangGraph shopping flow graph initialized successfully (12 nodes)", "module": "agent", "function": "__init__", "line": 237}
ap2_shopping_agent      | {"timestamp": "2025-11-02T22:34:56.690636Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[Shopping Agent] Initialized with database-backed risk assessment", "module": "agent", "function": "__init__", "line": 264}
ap2_shopping_agent      | INFO:     Started server process [1]
ap2_shopping_agent      | INFO:     Waiting for application startup.
ap2_shopping_agent      | {"timestamp": "2025-11-02T22:34:56.691006Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[Shopping Agent] Running startup tasks...", "module": "agent", "function": "startup_event", "line": 258}
ap2_shopping_agent      | INFO:     Application startup complete.
ap2_shopping_agent      | {"timestamp": "2025-11-02T22:34:56.700981Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[Shopping Agent] Database initialized", "module": "agent", "function": "startup_event", "line": 262}
ap2_shopping_agent      | INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
ap2_meilisearch         | 2025-11-02T22:34:56.730316Z  INFO HTTP request{method=POST host="meilisearch:7700" route=/indexes query_parameters= user_agent=python-httpx/0.28.1 status_code=202}: meilisearch: close time.busy=11.0ms time.idle=6.46ms
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.731922Z", "level": "INFO", "logger": "common.search_engine", "message": "[MeilisearchClient] Index already exists: products", "module": "search_engine", "function": "create_index", "line": 65}
ap2_meilisearch         | 2025-11-02T22:34:56.742289Z ERROR index_scheduler: Batch failed Index `products` already exists.
ap2_meilisearch         | 2025-11-02T22:34:56.750781Z  INFO HTTP request{method=PATCH host="meilisearch:7700" route=/indexes/products/settings query_parameters= user_agent=python-httpx/0.28.1 status_code=202}: meilisearch: close time.busy=4.96ms time.idle=7.15ms
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.751738Z", "level": "INFO", "logger": "common.search_engine", "message": "[MeilisearchClient] Index configured: products", "module": "search_engine", "function": "configure_index", "line": 115}
ap2_meilisearch         | 2025-11-02T22:34:56.764389Z  INFO HTTP request{method=DELETE host="meilisearch:7700" route=/indexes/products/documents query_parameters= user_agent=python-httpx/0.28.1 status_code=202}: meilisearch: close time.busy=1.22ms time.idle=1.11ms
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.765176Z", "level": "INFO", "logger": "common.search_engine", "message": "[MeilisearchClient] Cleared index: products", "module": "search_engine", "function": "clear_index", "line": 239}
ap2_meilisearch         | 2025-11-02T22:34:56.776554Z  INFO index_scheduler: A batch of tasks was successfully completed with 1 successful tasks and 0 failed tasks.
ap2_meilisearch         | 2025-11-02T22:34:56.785985Z  INFO index_scheduler: A batch of tasks was successfully completed with 1 successful tasks and 0 failed tasks.
ap2_meilisearch         | 2025-11-02T22:34:56.787028Z  INFO HTTP request{method=POST host="meilisearch:7700" route=/indexes/products/documents query_parameters= user_agent=python-httpx/0.28.1 status_code=202}: meilisearch: close time.busy=7.01ms time.idle=7.21ms
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.787936Z", "level": "INFO", "logger": "common.search_engine", "message": "[MeilisearchClient] Added 28 documents, taskUid=31", "module": "search_engine", "function": "add_documents", "line": 144}
ap2_merchant_agent      | [2025-11-02 22:34:56,788] INFO in services.merchant_agent.utils.product_helpers: [_sync_products_to_meilisearch] Synced 28 products to Meilisearch
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:56.788774Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "[Merchant Agent] Meilisearch synchronized", "module": "agent", "function": "startup_event", "line": 125}
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:57.064414Z", "level": "INFO", "logger": "services.merchant_agent.langgraph_merchant", "message": "[MerchantLangGraphAgent] LLM initialized with DMR: http://host.docker.internal:12434/engines/llama.cpp/v1, model: ai/qwen3", "module": "langgraph_merchant", "function": "__init__", "line": 178}
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:57.065612Z", "level": "INFO", "logger": "common.mcp_client", "message": "[MCPClient] Initialized: http://merchant_agent_mcp:8011", "module": "mcp_client", "function": "__init__", "line": 65}
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:57.067442Z", "level": "INFO", "logger": "services.merchant_agent.langgraph_merchant", "message": "[MerchantLangGraphAgent] Initialized with LLM: ai/qwen3, MCP: http://merchant_agent_mcp:8011", "module": "langgraph_merchant", "function": "__init__", "line": 196}
ap2_merchant_agent      | {"timestamp": "2025-11-02T22:34:57.067474Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "[Merchant Agent] LangGraph AI engine initialized", "module": "agent", "function": "startup_event", "line": 139}
ap2_merchant_agent      | INFO:     Application startup complete.
ap2_merchant_agent      | INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
ap2_meilisearch         | 2025-11-02T22:34:58.600821Z  INFO index_scheduler::batch: document indexing done indexing_result=DocumentAdditionResult { indexed_documents: 28, number_of_documents: 28 } processed_in=1.810634084s
ap2_meilisearch         | 2025-11-02T22:34:58.601871Z  INFO index_scheduler: A batch of tasks was successfully completed with 1 successful tasks and 0 failed tasks.
ap2_payment_network     | [2025-11-02 22:35:01,000] INFO in services.payment_network.network: [DemoPaymentNetwork] Payment Network Service initialized
ap2_payment_network     |   Redis URL: redis://redis:6379/2
ap2_payment_network     |   Token Store: Redisãƒ™ãƒ¼ã‚¹ã®KVã‚¹ãƒˆã‚¢ï¼ˆTTLç®¡ç†å¯¾å¿œï¼‰
ap2_payment_network     | INFO:     Started server process [1]
ap2_payment_network     | INFO:     Waiting for application startup.
ap2_payment_network     | INFO:     Application startup complete.
ap2_payment_network     | INFO:     Uvicorn running on http://0.0.0.0:8005 (Press CTRL+C to quit)
ap2_frontend            |    â–² Next.js 15.5.5
ap2_frontend            |    - Local:        http://localhost:3000
ap2_frontend            |    - Network:      http://0.0.0.0:3000
ap2_frontend            |
ap2_frontend            |  âœ“ Starting...
ap2_frontend            |  âœ“ Ready in 98ms
ap2_credential_provider_2  | [2025-11-02 22:35:03,186] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_credential_provider_2  | [2025-11-02 22:35:03,186] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_credential_provider_2  |   Service Name: credential_provider_2
ap2_credential_provider_2  |   OTLP Endpoint: http://jaeger:4317
ap2_credential_provider_2  |   Insecure: True
ap2_credential_provider_2  | [2025-11-02 22:35:03,204] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: credential_provider_2
ap2_credential_provider_2  | [2025-11-02 22:35:03,204] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider_2  | [2025-11-02 22:35:03,204] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider_2'. Adding OTLP exporter to existing provider.
ap2_credential_provider_2  | [2025-11-02 22:35:03,205] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider_2  | [2025-11-02 22:35:03,205] INFO in common.base_agent: [Credential Provider] OpenTelemetry distributed tracing enabled (service: credential_provider_2, manual instrumentation only)
ap2_credential_provider_2  | {"timestamp": "2025-11-02T22:35:03.213208Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_credential_provider_2  | {"timestamp": "2025-11-02T22:35:03.218258Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_credential_provider_2  | {"timestamp": "2025-11-02T22:35:03.218323Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_credential_provider_2  | [2025-11-02 22:35:03,218] INFO in common.base_agent: [Credential Provider] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: credential_provider
ap2_credential_provider_2  | {"timestamp": "2025-11-02T22:35:03.219748Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_credential_provider_2  | [2025-11-02 22:35:03,219] INFO in common.base_agent: [Credential Provider] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾ã—
ãŸ: credential_provider
ap2_credential_provider_2  | [2025-11-02 22:35:03,219] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/data/did_documents/shopping_agent_did.json
ap2_credential_provider_2  | [2025-11-02 22:35:03,220] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_credential_provider_2  | [2025-11-02 22:35:03,220] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/data/did_documents/merchant_agent_did.json
ap2_credential_provider_2  | [2025-11-02 22:35:03,220] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_credential_provider_2  | [2025-11-02 22:35:03,220] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/data/did_documents/merchant_did.json
ap2_credential_provider_2  | [2025-11-02 22:35:03,220] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_credential_provider_2  | [2025-11-02 22:35:03,220] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/data/did_documents/credential_provider_did.json
ap2_credential_provider_2  | [2025-11-02 22:35:03,221] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp
ap2_credential_provider_2  | [2025-11-02 22:35:03,221] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/data/did_documents/credential_provider_2_did.json
ap2_credential_provider_2  | [2025-11-02 22:35:03,221] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2
ap2_credential_provider_2  | [2025-11-02 22:35:03,221] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/data/did_documents/payment_processor_did.json
ap2_credential_provider_2  | [2025-11-02 22:35:03,221] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor
ap2_credential_provider_2  | {"timestamp": "2025-11-02T22:35:03.221513Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider_2  | {"timestamp": "2025-11-02T22:35:03.221531Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.AttestationRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider_2  | [2025-11-02 22:35:03,226] INFO in common.base_agent: [Credential Provider] Initialized: did:ap2:agent:credential_provider
ap2_credential_provider    | [2025-11-02 22:35:03,307] INFO in common.telemetry: [Telemetry] Current TracerProvider type: ProxyTracerProvider
ap2_credential_provider    | [2025-11-02 22:35:03,307] INFO in common.telemetry: [Telemetry] Initializing OpenTelemetry:
ap2_credential_provider    |   Service Name: credential_provider
ap2_credential_provider    |   OTLP Endpoint: http://jaeger:4317
ap2_credential_provider    |   Insecure: True
ap2_credential_provider    | [2025-11-02 22:35:03,319] INFO in common.telemetry: [Telemetry] OpenTelemetry initialized successfully for service: credential_provider
ap2_credential_provider    | [2025-11-02 22:35:03,320] INFO in common.telemetry: [Telemetry] Current TracerProvider type: TracerProvider
ap2_credential_provider    | [2025-11-02 22:35:03,320] INFO in common.telemetry: [Telemetry] TracerProvider already exists (TracerProvider) with service_name='credential_provider'. Adding OTLP exporter to existing provider.
ap2_credential_provider    | [2025-11-02 22:35:03,320] INFO in common.telemetry: [Telemetry] OTLP exporter added successfully to existing TracerProvider (endpoint: http://jaeger:4317)
ap2_credential_provider    | [2025-11-02 22:35:03,320] INFO in common.base_agent: [Credential Provider] OpenTelemetry distributed tracing enabled (service: credential_provider, manual instrumentation only)
ap2_credential_provider    | {"timestamp": "2025-11-02T22:35:03.327518Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ECDSA)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:35:03.329719Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_credential_provider    | [2025-11-02 22:35:03,329] INFO in common.base_agent: [Credential Provider] âœ“ ECDSAéµã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ
: credential_provider
ap2_credential_provider    | {"timestamp": "2025-11-02T22:35:03.329798Z", "level": "INFO", "logger": "common.crypto", "message": "Loading private key: credential_provider (algorithm: ED25519)", "module": "crypto", "function": "load_private_key_encrypted", "line": 353}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:35:03.330523Z", "level": "INFO", "logger": "common.crypto", "message": "Private key loaded successfully", "module": "crypto", "function": "load_private_key_encrypted", "line": 375}
ap2_credential_provider    | [2025-11-02 22:35:03,330] INFO in common.base_agent: [Credential Provider] âœ“ Ed25519éµã‚’èª­ã¿è¾¼ã¿ã¾ã—
ãŸ: credential_provider
ap2_credential_provider    | [2025-11-02 22:35:03,330] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/data/did_documents/shopping_agent_did.json
ap2_credential_provider    | [2025-11-02 22:35:03,331] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_credential_provider    | [2025-11-02 22:35:03,331] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/data/did_documents/merchant_agent_did.json
ap2_credential_provider    | [2025-11-02 22:35:03,331] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_credential_provider    | [2025-11-02 22:35:03,331] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/data/did_documents/merchant_did.json
ap2_credential_provider    | [2025-11-02 22:35:03,331] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant


ap2_credential_provider_2  | {"timestamp": "2025-11-02T22:35:03.336171Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[Credential Provider] Initialized", "module": "provider", "function": "__init__", "line": 147}
ap2_credential_provider    | [2025-11-02 22:35:03,331] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/data/did_documents/credential_provider_did.json


ap2_credential_provider    | [2025-11-02 22:35:03,332] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp
ap2_credential_provider_2  | INFO:     Started server process [1]


ap2_credential_provider    | [2025-11-02 22:35:03,332] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/data/did_documents/credential_provider_2_did.json

ap2_credential_provider_2  | INFO:     Waiting for application startup.
ap2_credential_provider_2  | {"timestamp": "2025-11-02T22:35:03.337305Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[Credential Provider] Running startup tasks...", "module": "provider", "function": "startup_event", "line": 141}
ap2_credential_provider    | [2025-11-02 22:35:03,332] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2
ap2_credential_provider    | [2025-11-02 22:35:03,332] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ap2_credential_provider    | [2025-11-02 22:35:03,332] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²:
ap2_credential_provider_2  | {"timestamp": "2025-11-02T22:35:03.350660Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[Credential Provider] Database initialized", "module": "provider", "function": "startup_event", "line": 145}
ap2_credential_provider_2  | INFO:     Application startup complete.
ap2_credential_provider    | {"timestamp": "2025-11-02T22:35:03.332728Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.mandates.PaymentMandate", "module": "a2a_handler", "function": "register_handler", "line": 72}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:35:03.332757Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] Registered handler for @type: ap2.requests.AttestationRequest", "module": "a2a_handler", "function": "register_handler", "line": 72}


ap2_credential_provider    | [2025-11-02 22:35:03,338] INFO in common.base_agent: [Credential Provider] Initialized: did:ap2:agent:credential_provider
ap2_credential_provider_2  | INFO:     Uvicorn running on http://0.0.0.0:8003 (Press CTRL+C to quit)
ap2_credential_provider    | {"timestamp": "2025-11-02T22:35:03.432722Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[Credential Provider] Initialized", "module": "provider", "function": "__init__", "line": 147}
ap2_credential_provider    | [2025-11-02 22:35:03,432] INFO in common.telemetry: [Telemetry] FastAPI app instrumented successfully (with request/response body tracking)
ap2_credential_provider    | INFO:     Started server process [1]
ap2_credential_provider    | INFO:     Waiting for application startup.
ap2_credential_provider    | {"timestamp": "2025-11-02T22:35:03.433594Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[Credential Provider] Running startup tasks...", "module": "provider", "function": "startup_event", "line": 141}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:35:03.441583Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[Credential Provider] Database initialized", "module": "provider", "function": "startup_event", "line": 145}
ap2_credential_provider    | INFO:     Application startup complete.
ap2_credential_provider    | INFO:     Uvicorn running on http://0.0.0.0:8003 (Press CTRL+C to quit)
ap2_shopping_agent         | INFO:     172.67.69.85:31269 - "OPTIONS /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:35:11.035742Z", "level": "DEBUG", "logger": "common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:35:11.036624Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[chat_stream] Received request\n  session_id: session_1762122909017_4xjhsk\n  user_id: usr_cdb4ec851bcf4f73\n  user_input: ã‚\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1098}
ap2_shopping_agent         | INFO:     172.67.69.85:31269 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:35:11.071530Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Created new session in DB: session_1762122909017_4xjhsk", "module": "agent", "function": "_get_or_create_session", "line": 2005}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:35:11.071899Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1762122909017_4xjhsk)", "module": "agent", "function": "event_generator", "line": 1113}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:35:11.072477Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[Langfuse] Created new handler for session: session_1762122909017_4xjhsk", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1683}
ap2_shopping_agent         | [2025-11-02 22:35:11,083] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: initial
ap2_shopping_agent         |   user_input: ã‚
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:35:13.615489Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=ask_intent", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:35:13.627301Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=ask_intent", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:35:16.043543Z", "level": "DEBUG", "logger": "common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:35:16.044024Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[chat_stream] Received request\n  session_id: session_1762122909017_4xjhsk\n  user_id: usr_cdb4ec851bcf4f73\n  user_input: ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºãŒã»ã—ã„ã€‚5000å††ä»¥å†…\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1098}
ap2_shopping_agent         | INFO:     172.67.69.85:31269 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:35:16.056044Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Loaded session from DB: session_1762122909017_4xjhsk, step=ask_intent", "module": "agent", "function": "_get_or_create_session", "line": 1983}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:35:16.057918Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1762122909017_4xjhsk)", "module": "agent", "function": "event_generator", "line": 1113}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:35:16.057982Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[Langfuse] Reusing existing handler for session: session_1762122909017_4xjhsk", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1686}
ap2_shopping_agent         | [2025-11-02 22:35:16,060] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: ask_intent
ap2_shopping_agent         |   user_input: ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºãŒã»ã—ã„ã€‚5000å††ä»¥å†…
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-02 22:37:15,183] INFO in services.shopping_agent.langgraph_shopping_flow: [collect_intent_node] LLM result: {'intent': 'ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„', 'max_amount': 5000, 'keywords': ['ã‹ã‚ã„ã„', 'ã‚°ãƒƒã‚º', 'ãŠã—ã‚ƒã‚Œ']}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:37:15.184982Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[_create_intent_mandate] Reconstructed intent: ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„ã€‚5000å††ä»¥å†…", "module": "agent", "function": "_create_intent_mandate", "line": 1773}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:37:15.185322Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[_build_intent_mandate_from_session] Constructed natural_language_description: ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„ã€‚5000å††ä»¥å†…", "module": "agent", "function": "_build_intent_mandate_from_session", "line": 1852}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:37:15.185470Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] IntentMandate created (AP2-compliant): intent='ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„...', expiry=2025-11-02T23:37:15.184355Z", "module": "agent", "function": "_build_intent_mandate_from_session", "line": 1864}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:37:21.832913Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=intent_complete_ask_shipping", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:37:21.837411Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=intent_complete_ask_shipping", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:38:57.789604Z", "level": "DEBUG", "logger": "common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:38:57.792379Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[chat_stream] Received request\n  session_id: session_1762122909017_4xjhsk\n  user_id: usr_cdb4ec851bcf4f73\n  user_input: {\"recipient\":\"ã‚\",\"postal_code\":\"ã‚\",\"city\":\"ã‚\",\"region\":\"ã‚\",\"address_line1\":\"ã‚\",\"country\":\"ã‚\"}\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1098}
ap2_shopping_agent         | INFO:     172.67.69.85:53545 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:38:57.797163Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Loaded session from DB: session_1762122909017_4xjhsk, step=intent_complete_ask_shipping", "module": "agent", "function": "_get_or_create_session", "line": 1983}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:38:57.797454Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1762122909017_4xjhsk)", "module": "agent", "function": "event_generator", "line": 1113}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:38:57.797615Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[Langfuse] Reusing existing handler for session: session_1762122909017_4xjhsk", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1686}
ap2_shopping_agent         | [2025-11-02 22:38:57,813] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: intent_complete_ask_shipping
ap2_shopping_agent         |   user_input: {"recipient":"ã‚","postal_code":"ã‚","city":"ã‚","region":"ã‚","address_line1":"ã‚","country":"ã‚"}
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-02 22:38:58,119] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] DEBUG: user_input='{"recipient":"ã‚","postal_code":"ã‚","city":"ã‚","region":"ã‚","address_line1":"ã‚","country":"ã‚"}', session['step']='select_cp', is_digit=False
ap2_shopping_agent         | [2025-11-02 22:38:58,119] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] Resolved CP from DID: did=did:ap2:cp:demo_cp, name=AP2 Demo Credential Provider, url=http://credential_provider:8003
ap2_shopping_agent         | [2025-11-02 22:38:58,120] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] Resolved CP from DID: did=did:ap2:cp:demo_cp_2, name=AP2 Demo Credential Provider 2, url=http://credential_provider_2:8003
ap2_shopping_agent         | [2025-11-02 22:38:58,120] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] AP2 Step 4: Presenting 2 Credential Providers to user
ap2_shopping_agent         |   User ID: usr_cdb4ec851bcf4f73
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:38:59.343453Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=select_cp", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:38:59.349860Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=select_cp", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.063692Z", "level": "DEBUG", "logger": "common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.065864Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[chat_stream] Received request\n  session_id: session_1762122909017_4xjhsk\n  user_id: usr_cdb4ec851bcf4f73\n  user_input: 1\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1098}
ap2_shopping_agent         | INFO:     172.67.69.85:53545 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.092406Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Loaded session from DB: session_1762122909017_4xjhsk, step=select_cp", "module": "agent", "function": "_get_or_create_session", "line": 1983}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.092914Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1762122909017_4xjhsk)", "module": "agent", "function": "event_generator", "line": 1113}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.092964Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[Langfuse] Reusing existing handler for session: session_1762122909017_4xjhsk", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1686}
ap2_shopping_agent         | [2025-11-02 22:39:00,098] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: select_cp
ap2_shopping_agent         |   user_input: 1
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-02 22:39:00,100] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] DEBUG: user_input='1', session['step']='select_cp', is_digit=True
ap2_shopping_agent         | [2025-11-02 22:39:00,100] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] Resolved CP from DID: did=did:ap2:cp:demo_cp, name=AP2 Demo Credential Provider, url=http://credential_provider:8003
ap2_shopping_agent         | [2025-11-02 22:39:00,100] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] Resolved CP from DID: did=did:ap2:cp:demo_cp_2, name=AP2 Demo Credential Provider 2, url=http://credential_provider_2:8003
ap2_shopping_agent         | [2025-11-02 22:39:00,100] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cp_node] AP2 Step 4: User selected Credential Provider
ap2_shopping_agent         |   User ID: usr_cdb4ec851bcf4f73
ap2_shopping_agent         |   CP ID: did:ap2:cp:demo_cp
ap2_shopping_agent         |   CP Name: AP2 Demo Credential Provider
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.311707Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Requesting payment methods from Credential Provider (http://credential_provider:8003) for user: usr_cdb4ec851bcf4f73", "module": "agent", "function": "_get_payment_methods_from_cp", "line": 2356}
ap2_shopping_agent         | [2025-11-02 22:39:00,311] INFO in services.shopping_agent.langgraph_shopping_flow: [get_payment_methods_node] AP2 Step 6-7: Requesting payment methods from CP
ap2_shopping_agent         |   User ID: usr_cdb4ec851bcf4f73
ap2_shopping_agent         |   CP ID: did:ap2:cp:demo_cp
ap2_shopping_agent         |   CP URL: http://credential_provider:8003
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.312576Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "HTTP Request: GET http://credential_provider:8003/payment-methods", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.312778Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"GET\", \"url\": \"http://credential_provider:8003/payment-methods\", \"headers\": {}, \"body\": null}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:39:00.604972Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[get_payment_methods] Retrieved 1 payment methods for user: usr_cdb4ec851bcf4f73", "module": "provider", "function": "get_payment_methods", "line": 671}
ap2_credential_provider    | INFO:     172.18.0.9:43012 - "GET /payment-methods?user_id=usr_cdb4ec851bcf4f73 HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.608670Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "HTTP Response: 200 (296.34ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.608758Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:38:59 GMT\", \"server\": \"uvicorn\", \"content-length\": \"252\", \"content-type\": \"application/json\"}, \"body\": {\"user_id\": \"usr_cdb4ec851bcf4f73\", \"payment_methods\": [{\"id\": \"pm_f4745ec2\", \"type\": \"basic-card\", \"display_name\": \"Visaã‚«ãƒ¼ãƒ‰ (****1111)\", \"brand\": \"Visa\", \"last4\": \"1111\", \"requires_step_up\": false, \"billing_address\": {\"country\": \"JP\", \"postal_code\": \"111-1111\"}}]}, \"duration_ms\": 296.3428497314453}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.608828Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Retrieved 1 payment methods from Credential Provider", "module": "agent", "function": "_get_payment_methods_from_cp", "line": 2374}
ap2_shopping_agent         | [2025-11-02 22:39:00,608] INFO in services.shopping_agent.langgraph_shopping_flow: [get_payment_methods_node] AP2 Step 7: Received 1 payment methods from CP
ap2_shopping_agent         |   Payment Methods: ['pm_f4745ec2']
ap2_shopping_agent         | [2025-11-02 22:39:00,816] INFO in services.shopping_agent.langgraph_shopping_flow: [fetch_carts_node] AP2 Step 8-12: Fetching cart candidates from Merchant Agent
ap2_shopping_agent         | [2025-11-02 22:39:00,816] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Requesting cart candidates from Merchant Agent for IntentMandate: intent_f7c34046
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.817252Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 995}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.827510Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 797, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.IntentMandate\",\"id\":\"intent_f7c34046\",\"payload\":{\"intent_mandate\":{\"created_at\":\"2025-11-02T22:37:15.184355Z\",\"id\":\"intent_f7c34046\",\"intent_expiry\":\"2025-11-02T23:3", "module": "crypto", "function": "sign_a2a_message", "line": 999}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.827570Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 794}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.835910Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: shopping_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.836443Z", "level": "INFO", "logger": "common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:merchant_agent: ap2.mandates.IntentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_shopping_agent         | [2025-11-02 22:39:00,836] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Intent A2A message created: message_id=da235fcc-448a-483a-98a7-af77ab3a3d11, intent_mandate_id=intent_f7c34046
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.836541Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.mandates.IntentMandate\", \"peer\": \"did:ap2:agent:merchant_agent\", \"headers\": {\"message_id\": \"da235fcc-448a-483a-98a7-af77ab3a3d11\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-02T22:39:00.816645Z\", \"nonce\": \"dd374ed5a7877b6ba1a165a8eceab5fb2de13065ea2522df394e9760acd9aad4\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"intent_mandate\": {\"id\": \"intent_f7c34046\", \"type\": \"IntentMandate\", \"user_id\": \"usr_cdb4ec851bcf4f73\", \"user_cart_confirmation_required\": true, \"natural_language_description\": \"ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„ã€‚5000å††ä»¥å†…\", \"requires_refundability\": false, \"intent_expiry\": \"2025-11-02T23:37:15.184355Z\", \"created_at\": \"2025-11-02T22:37:15.184355Z\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_shopping_agent         | [2025-11-02 22:39:00,836] INFO in services.shopping_agent.utils.merchant_integration:
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [ShoppingAgent â†’ MerchantAgent] A2Aãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
ap2_shopping_agent         |   URL: http://merchant_agent:8001/a2a/message
ap2_shopping_agent         |   ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID: da235fcc-448a-483a-98a7-af77ab3a3d11
ap2_shopping_agent         |   ã‚¿ã‚¤ãƒ—: ap2.mandates.IntentMandate
ap2_shopping_agent         |   ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰: {
ap2_shopping_agent         |   "id": "intent_f7c34046",
ap2_shopping_agent         |   "type": "IntentMandate",
ap2_shopping_agent         |   "user_id": "usr_cdb4ec851bcf4f73",
ap2_shopping_agent         |   "user_cart_confirmation_required": true,
ap2_shopping_agent         |   "natural_language_description": "ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„ã€‚5000å††ä»¥å†…",
ap2_shopping_agent         |   "requires_refundability": false,
ap2_shopping_agent         |   "intent_expiry": "2025-11-02T23:37:15.184355Z",
ap2_shopping_agent         |   "created_at": "2025-11-02T22:37:15.184355Z"
ap2_shopping_agent         | }
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.837856Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "HTTP Request: POST http://merchant_agent:8001/a2a/message", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:39:00.837910Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent:8001/a2a/message\", \"headers\": {}, \"body\": {\"header\": {\"message_id\": \"da235fcc-448a-483a-98a7-af77ab3a3d11\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-02T22:39:00.816645Z\", \"nonce\": \"dd374ed5a7877b6ba1a165a8eceab5fb2de13065ea2522df394e9760acd9aad4\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"/ayHJ7u2PqSads8V677T7uYkEMlJw6nnJUBmJG9qJf+KofdSNeRN+LkV9Ry8SeYZ61eptY5YdC9hY9dhJiRbBg==\", \"publicKeyMultibase\": \"z6MkpL5YFLHxAcp6LSJboXQ3nBnNGrQ4TiZRmWBZamPo7t8x\", \"kid\": \"did:ap2:agent:shopping_agent#key-2\", \"created\": \"2025-11-02T22:39:00.816645Z\", \"proofPurpose\": \"authentication\"}}, \"dataPart\": {\"@type\": \"ap2.mandates.IntentMandate\", \"id\": \"intent_f7c34046\", \"payload\": {\"intent_mandate\": {\"id\": \"intent_f7c34046\", \"type\": \"IntentMandate\", \"user_id\": \"usr_cdb4ec851bcf4f73\", \"user_cart_confirmation_required\": true, \"natural_language_description\": \"ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„ã€‚5000å††ä»¥å†…\", \"requires_refundability\": false, \"intent_expiry\": \"2025-11-02T23:37:15.184355Z\", \"created_at\": \"2025-11-02T22:37:15.184355Z\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"kind\": null, \"artifact\": null}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | [2025-11-02 22:39:00,893] INFO in common.base_agent:
ap2_merchant_agent         | ================================================================================
ap2_merchant_agent         | [Merchant Agent] A2Aã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: POST /a2a/message
ap2_merchant_agent         |   å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ID=da235fcc-448a-483a-98a7-af77ab3a3d11
ap2_merchant_agent         |   é€ä¿¡å…ƒ: did:ap2:agent:shopping_agent
ap2_merchant_agent         |   ã‚¿ã‚¤ãƒ—: ap2.mandates.IntentMandate
ap2_merchant_agent         | ================================================================================
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.896396Z", "level": "INFO", "logger": "common.a2a_handler", "message": "A2A Message received to/from did:ap2:agent:shopping_agent: ap2.mandates.IntentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.897087Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"received\", \"message_type\": \"ap2.mandates.IntentMandate\", \"peer\": \"did:ap2:agent:shopping_agent\", \"headers\": {\"message_id\": \"da235fcc-448a-483a-98a7-af77ab3a3d11\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-02T22:39:00.816645Z\", \"nonce\": \"dd374ed5a7877b6ba1a165a8eceab5fb2de13065ea2522df394e9760acd9aad4\", \"schema_version\": \"0.2\"}, \"payload\": {\"intent_mandate\": {\"id\": \"intent_f7c34046\", \"type\": \"IntentMandate\", \"user_id\": \"usr_cdb4ec851bcf4f73\", \"user_cart_confirmation_required\": true, \"natural_language_description\": \"ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„ã€‚5000å††ä»¥å†…\", \"requires_refundability\": false, \"intent_expiry\": \"2025-11-02T23:37:15.184355Z\", \"created_at\": \"2025-11-02T22:37:15.184355Z\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.897569Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "[A2AHandler] Nonce validation successful: nonce=dd374ed5a7877b6b...", "module": "a2a_handler", "function": "verify_message_signature", "line": 156}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.902341Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "[A2AHandler] Using DID-resolved public key for verification: kid=did:ap2:agent:shopping_agent#key-2", "module": "a2a_handler", "function": "verify_message_signature", "line": 190}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.903463Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying A2A message signature", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1023}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.910084Z", "level": "DEBUG", "logger": "common.crypto", "message": "[VERIFY] Canonical JSON length: 797, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.IntentMandate\",\"id\":\"intent_f7c34046\",\"payload\":{\"intent_mandate\":{\"created_at\":\"2025-11-02T22:37:15.184355Z\",\"id\":\"intent_f7c34046\",\"intent_expiry\":\"2025-11-02T23:3", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1027}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.910156Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying signature (algorithm: ED25519)", "module": "crypto", "function": "verify_signature", "line": 857}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.912658Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto VERIFY: ED25519 (key: did:ap2:agent:shopping_agent#key-2) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.913122Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] proofç½²åæ¤œè¨¼æˆåŠŸ: sender=did:ap2:agent:shopping_agent, alg=ed25519, kid=did:ap2:agent:shopping_agent#key-2, public_key_source=DID-resolved", "module": "a2a_handler", "function": "verify_message_signature", "line": 221}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.913170Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2Aå‡¦ç†] ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè¡Œä¸­: type=ap2.mandates.IntentMandate, from=did:ap2:agent:shopping_agent", "module": "a2a_handler", "function": "handle_message", "line": 299}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.913865Z", "level": "INFO", "logger": "services.merchant_agent.handlers.intent_handler", "message": "[MerchantAgent] Received IntentMandate", "module": "intent_handler", "function": "handle_intent_mandate", "line": 32}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.914161Z", "level": "INFO", "logger": "services.merchant_agent.handlers.intent_handler", "message": "[MerchantAgent] Received IntentMandate with shipping_address (AP2 v0.1 compliant)", "module": "intent_handler", "function": "handle_intent_mandate", "line": 50}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.914314Z", "level": "INFO", "logger": "services.merchant_agent.handlers.intent_handler", "message": "[MerchantAgent] Searching products with intent: 'ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’è³¼å…¥ã—ãŸã„ã€‚5000å††ä»¥å†…'", "module": "intent_handler", "function": "handle_intent_mandate", "line": 54}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.914358Z", "level": "INFO", "logger": "services.merchant_agent.handlers.intent_handler", "message": "[MerchantAgent] Using provided shipping address: ã‚", "module": "intent_handler", "function": "handle_intent_mandate", "line": 71}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.914389Z", "level": "INFO", "logger": "services.merchant_agent.handlers.intent_handler", "message": "[MerchantAgent] Using LangGraph AI engine for cart generation", "module": "intent_handler", "function": "handle_intent_mandate", "line": 76}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.918333Z", "level": "INFO", "logger": "services.merchant_agent.langgraph_merchant", "message": "[Langfuse] Created new handler for session: 94ae3500-e856-4433-96e0-26432f0b78cd", "module": "langgraph_merchant", "function": "create_cart_candidates", "line": 292}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.937921Z", "level": "INFO", "logger": "common.mcp_client", "message": "MCP Request: initialize", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.937974Z", "level": "DEBUG", "logger": "common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"initialize\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\"}, \"arguments\": {\"protocolVersion\": \"2025-03-26\", \"clientInfo\": {\"name\": \"ap2_langgraph_client\", \"version\": \"1.0.0\"}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.938729Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:00.938772Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"initialize\", \"params\": {\"protocolVersion\": \"2025-03-26\", \"clientInfo\": {\"name\": \"ap2_langgraph_client\", \"version\": \"1.0.0\"}}, \"id\": 584954}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:01.093371Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Response: 200 (154.80ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent_mcp     | INFO:     172.18.0.8:35958 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:01.093480Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:39:00 GMT\", \"server\": \"uvicorn\", \"mcp-session-id\": \"3b05aeef-c0de-4f41-b185-1b18b3222391\", \"content-length\": \"1231\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 584954, \"result\": {\"protocolVersion\": \"2025-03-26\", \"serverInfo\": {\"name\": \"merchant_agent_mcp\", \"version\": \"1.0.0\"}, \"capabilities\": {\"tools\": {\"search_products\": {\"description\": \"ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å•†å“ã‚’æ¤œç´¢\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"keywords\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ\"}, \"limit\": {\"type\": \"integer\", \"description\": \"æœ€å¤§æ¤œç´¢çµæžœæ•°\", \"default\": 20}}, \"required\": [\"keywords\"]}}, \"check_inventory\": {\"description\": \"åœ¨åº«çŠ¶æ³ã‚’ç¢ºèª\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"product_ids\": {\"type\": \"array\", \"items\": {\"type\": \"integer\"}, \"description\": \"å•†å“IDãƒªã‚¹ãƒˆ\"}}, \"required\": [\"product_ids\"]}}, \"build_cart_mandates\": {\"description\": \"AP2æº–æ‹ ã®CartMandateã‚’æ§‹ç¯‰ï¼ˆæœªç½²åï¼‰\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"cart_plan\": {\"type\": \"object\", \"description\": \"ã‚«ãƒ¼ãƒˆãƒ—ãƒ©ãƒ³ï¼ˆoptimize_cartã®çµæžœï¼‰\"}, \"products\": {\"type\": \"array\", \"items\": {\"type\": \"object\"}, \"description\": \"å•†å“æƒ…å ±ãƒªã‚¹ãƒˆ\"}, \"shipping_address\": {\"type\": \"object\", \"description\": \"AP2æº–æ‹ ã®ContactAddress\"}, \"intent_mandate_id\": {\"type\": \"string\", \"description\": \"IntentMandate IDï¼ˆAP2æº–æ‹ ï¼‰\"}}, \"required\": [\"cart_plan\", \"products\"]}}}}}}, \"duration_ms\": 154.7994613647461}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:01.099229Z", "level": "INFO", "logger": "common.mcp_client", "message": "MCP Response: initialize - SUCCESS (161.18ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:01.099297Z", "level": "DEBUG", "logger": "common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"initialize\", \"result\": {\"protocolVersion\": \"2025-03-26\", \"serverInfo\": {\"name\": \"merchant_agent_mcp\", \"version\": \"1.0.0\"}, \"capabilities\": {\"tools\": {\"search_products\": {\"description\": \"ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å•†å“ã‚’æ¤œç´¢\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"keywords\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ\"}, \"limit\": {\"type\": \"integer\", \"description\": \"æœ€å¤§æ¤œç´¢çµæžœæ•°\", \"default\": 20}}, \"required\": [\"keywords\"]}}, \"check_inventory\": {\"description\": \"åœ¨åº«çŠ¶æ³ã‚’ç¢ºèª\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"product_ids\": {\"type\": \"array\", \"items\": {\"type\": \"integer\"}, \"description\": \"å•†å“IDãƒªã‚¹ãƒˆ\"}}, \"required\": [\"product_ids\"]}}, \"build_cart_mandates\": {\"description\": \"AP2æº–æ‹ ã®CartMandateã‚’æ§‹ç¯‰ï¼ˆæœªç½²åï¼‰\", \"inputSchema\": {\"type\": \"object\", \"properties\": {\"cart_plan\": {\"type\": \"object\", \"description\": \"ã‚«ãƒ¼ãƒˆãƒ—ãƒ©ãƒ³ï¼ˆoptimize_cartã®çµæžœï¼‰\"}, \"products\": {\"type\": \"array\", \"items\": {\"type\": \"object\"}, \"description\": \"å•†å“æƒ…å ±ãƒªã‚¹ãƒˆ\"}, \"shipping_address\": {\"type\": \"object\", \"description\": \"AP2æº–æ‹ ã®ContactAddress\"}, \"intent_mandate_id\": {\"type\": \"string\", \"description\": \"IntentMandate IDï¼ˆAP2æº–æ‹ ï¼‰\"}}, \"required\": [\"cart_plan\", \"products\"]}}}}}, \"error\": null, \"duration_ms\": 161.18168830871582}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:01.099326Z", "level": "INFO", "logger": "common.mcp_client", "message": "[MCPClient] Initialized session: 3b05aeef-c0de-4f41-b185-1b18b3222391", "module": "mcp_client", "function": "initialize", "line": 88}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:01.099682Z", "level": "INFO", "logger": "common.mcp_client", "message": "[MCPClient] Server capabilities: {'tools': {'search_products': {'description': 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å•†å“ã‚’æ¤œç´¢', 'inputSchema': {'type': 'object', 'properties': {'keywords': {'type': 'array', 'items': {'type': 'string'}, 'description': 'æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ
'}, 'limit': {'type': 'integer', 'description': 'æœ€å¤§æ¤œç´¢çµæžœæ•°', 'default': 20}}, 'required': ['keywords']}}, 'check_inventory': {'description': 'åœ¨åº«çŠ¶æ³ã‚’ç¢ºèª', 'inputSchema': {'type': 'object', 'properties': {'product_ids': {'type': 'array', 'items': {'type': 'integer'}, 'description': 'å•†å“IDãƒªã‚¹ãƒˆ'}}, 'required': ['product_ids']}}, 'build_cart_mandates': {'description': 'AP2æº–æ‹ ã®CartMandateã‚’æ§‹ç¯‰ï¼ˆæœªç½²åï¼‰', 'inputSchema': {'type': 'object', 'properties': {'cart_plan': {'type': 'object', 'description': 'ã‚«ãƒ¼ãƒˆãƒ—ãƒ©ãƒ³ï¼ˆoptimize_cartã®çµæžœï¼‰'}, 'products': {'type': 'array', 'items': {'type': 'object'}, 'description': 'å•†å“æƒ…å ±ãƒªã‚¹ãƒˆ'}, 'shipping_address': {'type': 'object', 'description': 'AP2æº–æ‹ ã®ContactAddress'}, 'intent_mandate_id': {'type': 'string', 'description': 'IntentMandate IDï¼ˆAP2æº–æ‹ ï¼‰'}}, 'required': ['cart_plan', 'products']}}}}", "module": "mcp_client", "function": "initialize", "line": 89}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:01.099775Z", "level": "INFO", "logger": "services.merchant_agent.nodes.intent_node", "message": "[analyze_intent] MCP client initialized", "module": "intent_node", "function": "analyze_intent", "line": 35}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:26.890228Z", "level": "INFO", "logger": "services.merchant_agent.nodes.intent_node", "message": "[analyze_intent] LLM result: {'primary_need': 'ã‹ã‚ã„ã„ã‚°ãƒƒã‚ºã‚’5000å††ä»¥å†…ã§è³¼å…¥ã—ãŸã„', 'budget_strategy': 'low', 'key_factors': ['ã‹ã‚ã„ã•', 'ä¾¡æ ¼'], 'search_keywords': ['ã‹ã‚ã„ã„', 'ã‚°ãƒƒã‚º', 'é›‘è²¨', 'å°ç‰©']}", "module": "intent_node", "function": "analyze_intent", "line": 124}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:26.896406Z", "level": "INFO", "logger": "common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:26.896480Z", "level": "DEBUG", "logger": "common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"3b05aeef-c0de-4f41-b185-1b18b3222391\"}, \"arguments\": {\"name\": \"search_products\", \"arguments\": {\"keywords\": [\"ã‹ã‚ã„ã„\", \"ã‚°ãƒƒã‚º\", \"é›‘è²¨\", \"å°ç‰©\"], \"limit\": 20}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:26.896714Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:26.896762Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"3b05aeef-c0de-4f41-b185-1b18b3222391\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"search_products\", \"arguments\": {\"keywords\": [\"ã‹ã‚ã„ã„\", \"ã‚°ãƒƒã‚º\", \"é›‘è²¨\", \"å°ç‰©\"], \"limit\": 20}}, \"id\": 231776}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent_mcp     | {"timestamp": "2025-11-02T22:39:26.928572Z", "level": "INFO", "logger": "services.merchant_agent_mcp.main", "message": "[search_products] Searching with query: 'ã‹ã‚ã„ã„ ã‚°ãƒƒã‚º é›‘è²¨ å°ç‰©'", "module": "main", "function": "search_products", "line": 152}
ap2_meilisearch            | 2025-11-02T22:39:27.176838Z  INFO HTTP request{method=POST host="meilisearch:7700" route=/indexes/products/search query_parameters= user_agent=python-httpx/0.28.1 status_code=200}: meilisearch: close time.busy=21.2ms time.idle=24.5ms
ap2_merchant_agent_mcp     | {"timestamp": "2025-11-02T22:39:27.179271Z", "level": "INFO", "logger": "common.search_engine", "message": "[MeilisearchClient] Search 'ã‹ã‚ã„ã„ ã‚°ãƒƒã‚º é›‘è²¨ å°ç‰©' returned 6 products", "module": "search_engine", "function": "search", "line": 187}
ap2_merchant_agent_mcp     | {"timestamp": "2025-11-02T22:39:27.253015Z", "level": "INFO", "logger": "services.merchant_agent_mcp.main", "message": "[search_products] Returned 6 products for keywords: ['ã‹ã‚ã„ã„', 'ã‚°ãƒƒã‚º', 'é›‘è²¨', 'å°ç‰©']", "module": "main", "function": "search_products", "line": 177}
ap2_merchant_agent_mcp     | INFO:     172.18.0.8:42552 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:27.255626Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Response: 200 (358.86ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:27.255710Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:39:26 GMT\", \"server\": \"uvicorn\", \"content-length\": \"3086\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 231776, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"products\\\": [\\n    {\\n      \\\"id\\\": \\\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\\\",\\n      \\\"sku\\\": \\\"MUGI-KEYCHAIN-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\\\",\\n      \\\"description\\\": \\\"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\\\",\\n      \\\"price_cents\\\": 80000,\\n      \\\"price_jpy\\\": 800.0,\\n      \\\"inventory_count\\\": 100,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"9f58d67c-5c45-4cd4-bf10-73f06647c234\\\",\\n      \\\"sku\\\": \\\"MUGI-CLOCK-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\\\",\\n      \\\"price_cents\\\": 350000,\\n      \\\"price_jpy\\\": 3500.0,\\n      \\\"inventory_count\\\": 30,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"2faf8370-ada4-45d4-812c-ef5818d526b5\\\",\\n      \\\"sku\\\": \\\"MUGI-POUCH-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\\\",\\n      \\\"price_cents\\\": 95000,\\n      \\\"price_jpy\\\": 950.0,\\n      \\\"inventory_count\\\": 120,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"1d9f08d9-51a9-491e-810b-f0e225ef4f59\\\",\\n      \\\"sku\\\": \\\"MUGI-MUG-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\\\",\\n      \\\"price_cents\\\": 120000,\\n      \\\"price_jpy\\\": 1200.0,\\n      \\\"inventory_count\\\": 80,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"c688d6ef-615f-43f7-87ce-05568ae4e63c\\\",\\n      \\\"sku\\\": \\\"MUGI-SOCKS-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\\\",\\n      \\\"price_cents\\\": 85000,\\n      \\\"price_jpy\\\": 850.0,\\n      \\\"inventory_count\\\": 100,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n  \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"6a169d3a-ca5a-4575-a08b-3fb659c628ed\\\",\\n      \\\"sku\\\": \\\"MUGI-PLATE-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\\\",\\n      \\\"price_cents\\\": 190000,\\n      \\\"price_jpy\\\": 1900.0,\\n      \\\"inventory_count\\\": 70,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    }\\n  ]\\n}\"}], \"isError\": false}}, \"duration_ms\": 358.8593006134033}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:27.255991Z", "level": "INFO", "logger": "common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (359.47ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:27.256041Z", "level": "DEBUG", "logger": "common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"products\\\": [\\n    {\\n      \\\"id\\\": \\\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\\\",\\n      \\\"sku\\\": \\\"MUGI-KEYCHAIN-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\\\",\\n      \\\"description\\\": \\\"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\\\",\\n      \\\"price_cents\\\": 80000,\\n      \\\"price_jpy\\\": 800.0,\\n      \\\"inventory_count\\\": 100,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"9f58d67c-5c45-4cd4-bf10-73f06647c234\\\",\\n      \\\"sku\\\": \\\"MUGI-CLOCK-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\\\",\\n      \\\"price_cents\\\": 350000,\\n      \\\"price_jpy\\\": 3500.0,\\n      \\\"inventory_count\\\": 30,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"2faf8370-ada4-45d4-812c-ef5818d526b5\\\",\\n      \\\"sku\\\": \\\"MUGI-POUCH-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\\\",\\n      \\\"price_cents\\\": 95000,\\n      \\\"price_jpy\\\": 950.0,\\n      \\\"inventory_count\\\": 120,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"1d9f08d9-51a9-491e-810b-f0e225ef4f59\\\",\\n      \\\"sku\\\": \\\"MUGI-MUG-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\\\",\\n      \\\"price_cents\\\": 120000,\\n      \\\"price_jpy\\\": 1200.0,\\n      \\\"inventory_count\\\": 80,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"c688d6ef-615f-43f7-87ce-05568ae4e63c\\\",\\n      \\\"sku\\\": \\\"MUGI-SOCKS-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\\\",\\n      \\\"price_cents\\\": 85000,\\n      \\\"price_jpy\\\": 850.0,\\n      \\\"inventory_count\\\": 100,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    },\\n    {\\n      \\\"id\\\": \\\"6a169d3a-ca5a-4575-a08b-3fb659c628ed\\\",\\n      \\\"sku\\\": \\\"MUGI-PLATE-001\\\",\\n      \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\\\",\\n      \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\\\",\\n      \\\"price_cents\\\": 190000,\\n      \\\"price_jpy\\\": 1900.0,\\n      \\\"inventory_count\\\": 70,\\n      \\\"category\\\": null,\\n      \\\"brand\\\": null,\\n      \\\"image_url\\\": null,\\n      \\\"refund_period_days\\\": 30\\n    }\\n  ]\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 359.4663143157959}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:27.256097Z", "level": "INFO", "logger": "common.mcp_client", "message": "[MCPClient] Tool search_products executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}


ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:27.256142Z", "level": "INFO", "logger": "services.merchant_agent.nodes.search_node", "message": "[search_products] MCP returned 6 products", "module": "search_node", "function": "search_products", "line": 69}
ap2_merchant_agent_mcp     | {"timestamp": "2025-11-02T22:39:27.261379Z", "level": "INFO", "logger": "services.merchant_agent_mcp.main", "message": "[check_inventory] Inventory: {'286acdd4-d1c1-4860-b06a-f87d2f916a8d': 100, '9f58d67c-5c45-4cd4-bf10-73f06647c234': 30, '2faf8370-ada4-45d4-812c-ef5818d526b5': 120, '1d9f08d9-51a9-491e-810b-f0e225ef4f59': 80, 'c688d6ef-615f-43f7-87ce-05568ae4e63c': 100, '6a169d3a-ca5a-4575-a08b-3fb659c628ed': 70}", "module": "main", "function": "check_inventory", "line": 231}


ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:27.257861Z", "level": "INFO", "logger": "common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent_mcp     | INFO:     172.18.0.8:42552 - "POST / HTTP/1.1" 200 OK

ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:27.257887Z", "level": "DEBUG", "logger": "common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"3b05aeef-c0de-4f41-b185-1b18b3222391\"}, \"arguments\": {\"name\": \"check_inventory\", \"arguments\": {\"product_ids\": [\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\"]}}}", "module": "logger", "function": "log_mcp_request", "line": 294}


ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:27.257967Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:27.258005Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"3b05aeef-c0de-4f41-b185-1b18b3222391\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"check_inventory\", \"arguments\": {\"product_ids\": [\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\"]}}, \"id\": 155182}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:27.262108Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Response: 200 (4.12ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:27.262146Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:39:26 GMT\", \"server\": \"uvicorn\", \"content-length\": \"431\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 155182, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"inventory\\\": {\\n    \\\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\\\": 100,\\n    \\\"9f58d67c-5c45-4cd4-bf10-73f06647c234\\\": 30,\\n    \\\"2faf8370-ada4-45d4-812c-ef5818d526b5\\\": 120,\\n    \\\"1d9f08d9-51a9-491e-810b-f0e225ef4f59\\\": 80,\\n    \\\"c688d6ef-615f-43f7-87ce-05568ae4e63c\\\": 100,\\n    \\\"6a169d3a-ca5a-4575-a08b-3fb659c628ed\\\": 70\\n  }\\n}\"}], \"isError\": false}}, \"duration_ms\": 4.121065139770508}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:27.262317Z", "level": "INFO", "logger": "common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (4.40ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:27.262343Z", "level": "DEBUG", "logger": "common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"inventory\\\": {\\n    \\\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\\\": 100,\\n    \\\"9f58d67c-5c45-4cd4-bf10-73f06647c234\\\": 30,\\n    \\\"2faf8370-ada4-45d4-812c-ef5818d526b5\\\": 120,\\n    \\\"1d9f08d9-51a9-491e-810b-f0e225ef4f59\\\": 80,\\n    \\\"c688d6ef-615f-43f7-87ce-05568ae4e63c\\\": 100,\\n    \\\"6a169d3a-ca5a-4575-a08b-3fb659c628ed\\\": 70\\n  }\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 4.403591156005859}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:27.262364Z", "level": "INFO", "logger": "common.mcp_client", "message": "[MCPClient] Tool check_inventory executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:39:27.262383Z", "level": "INFO", "logger": "services.merchant_agent.nodes.inventory_node", "message": "[check_inventory] MCP checked 6 products", "module": "inventory_node", "function": "check_inventory", "line": 62}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.539208Z", "level": "INFO", "logger": "services.merchant_agent.nodes.optimization_node", "message": "[optimize_cart] LLM generated 3 cart plans", "module": "optimization_node", "function": "optimize_cart", "line": 173}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.543526Z", "level": "INFO", "logger": "services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Creating 3 unsigned CartMandates...", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 68}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.543858Z", "level": "INFO", "logger": "common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.543938Z", "level": "DEBUG", "logger": "common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"3b05aeef-c0de-4f41-b185-1b18b3222391\"}, \"arguments\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\", \"description\": \"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚ã—ã¾ã—ãŸã€‚\", \"items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"quantity\": 1}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"quantity\": 1}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"quantity\": 1}, {\"product_id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"quantity\": 1}]}, \"products\": [{\"id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"sku\": \"MUGI-MUG-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}, \"intent_mandate_id\": \"intent_f7c34046\"}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.544251Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.544330Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"3b05aeef-c0de-4f41-b185-1b18b3222391\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\", \"description\": \"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚ã—ã¾ã—ãŸã€‚\", \"items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"quantity\": 1}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"quantity\": 1}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"quantity\": 1}, {\"product_id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"quantity\": 1}]}, \"products\": [{\"id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"sku\": \"MUGI-MUG-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}, \"intent_mandate_id\": \"intent_f7c34046\"}}, \"id\": 455993}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent_mcp     | INFO:     172.18.0.8:50026 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.563484Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Response: 200 (19.18ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.563566Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:41:00 GMT\", \"server\": \"uvicorn\", \"content-length\": \"6347\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 455993, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_a457c43c\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [\\n          {\\n            \\\"supported_methods\\\": \\\"basic-card\\\",\\n            \\\"data\\\": {\\n              \\\"supportedNetworks\\\": [\\n                \\\"visa\\\",\\n                \\\"mastercard\\\",\\n                \\\"jcb\\\",\\n                \\\"amex\\\"\\n              ],\\n              \\\"supportedTypes\\\": [\\n                \\\"credit\\\",\\n                \\\"debit\\\"\\n              ]\\n            }\\n          },\\n          {\\n            \\\"supported_methods\\\": \\\"https://a2a-protocol.org/payment-methods/ap2-payment\\\",\\n            \\\"data\\\": {\\n              \\\"version\\\": \\\"0.2\\\",\\n              \\\"processor\\\": \\\"did:ap2:agent:payment_processor\\\",\\n              \\\"supportedMethods\\\": [\\n                \\\"credential-based\\\",\\n                \\\"attestation-based\\\"\\n              ]\\n            }\\n          }\\n        ],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_a457c43c\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 800.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 1200.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 850.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 1900.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 475.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"é€æ–™\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"åˆè¨ˆ\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 5725.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"options\\\": {\\n          \\\"request_payer_name\\\": true,\\n          \\\"request_payer_email\\\": true,\\n          \\\"request_payer_phone\\\": false,\\n          \\\"request_shipping\\\": true,\\n          \\\"shipping_type\\\": \\\"shipping\\\"\\n        },\\n        \\\"shipping_address\\\": {\\n          \\\"recipient\\\": \\\"ã‚\\\",\\n          \\\"postal_code\\\": \\\"ã‚\\\",\\n          \\\"city\\\": \\\"ã‚\\\",\\n          \\\"region\\\": \\\"ã‚\\\",\\n     \\\"address_line1\\\": \\\"ã‚\\\",\\n          \\\"country\\\": \\\"ã‚\\\"\\n        }\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-02T23:41:01.560661Z\\\",\\n      \\\"merchant_name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": \\\"intent_f7c34046\\\",\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-02T22:41:01.560767Z\\\",\\n      \\\"cart_name\\\": \\\"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\\\",\\n      \\\"cart_description\\\": \\\"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚ã—ã¾ã—ãŸã€‚\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\\\",\\n          \\\"description\\\": \\\"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒ
ã¡æ­©ã‘ã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"1d9f08d9-51a9-491e-810b-f0e225ef4f59\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"c688d6ef-615f-43f7-87ce-05568ae4e63c\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"6a169d3a-ca5a-4575-a08b-3fb659c628ed\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 1900.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 1900.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}}, \"duration_ms\": 19.181489944458008}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent_mcp     | INFO:     172.18.0.8:50026 - "POST / HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.563852Z", "level": "INFO", "logger": "common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (19.83ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.563902Z", "level": "DEBUG", "logger": "common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_a457c43c\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [\\n          {\\n            \\\"supported_methods\\\": \\\"basic-card\\\",\\n            \\\"data\\\": {\\n              \\\"supportedNetworks\\\": [\\n                \\\"visa\\\",\\n                \\\"mastercard\\\",\\n                \\\"jcb\\\",\\n                \\\"amex\\\"\\n              ],\\n              \\\"supportedTypes\\\": [\\n                \\\"credit\\\",\\n                \\\"debit\\\"\\n              ]\\n            }\\n          },\\n          {\\n            \\\"supported_methods\\\": \\\"https://a2a-protocol.org/payment-methods/ap2-payment\\\",\\n            \\\"data\\\": {\\n              \\\"version\\\": \\\"0.2\\\",\\n              \\\"processor\\\": \\\"did:ap2:agent:payment_processor\\\",\\n              \\\"supportedMethods\\\": [\\n                \\\"credential-based\\\",\\n                \\\"attestation-based\\\"\\n              ]\\n            }\\n          }\\n        ],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_a457c43c\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 800.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 1200.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 850.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 1900.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 475.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"é€æ–™\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"åˆè¨ˆ\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 5725.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"options\\\": {\\n          \\\"request_payer_name\\\": true,\\n          \\\"request_payer_email\\\": true,\\n          \\\"request_payer_phone\\\": false,\\n          \\\"request_shipping\\\": true,\\n          \\\"shipping_type\\\": \\\"shipping\\\"\\n        },\\n        \\\"shipping_address\\\": {\\n          \\\"recipient\\\": \\\"ã‚\\\",\\n          \\\"postal_code\\\": \\\"ã‚\\\",\\n          \\\"city\\\": \\\"ã‚\\\",\\n          \\\"region\\\": \\\"ã‚\\\",\\n          \\\"address_line1\\\": \\\"ã‚\\\",\\n          \\\"country\\\": \\\"ã‚\\\"\\n        }\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-02T23:41:01.560661Z\\\",\\n      \\\"merchant_name\\\": \\\"ã‚€ãŽã¼
ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": \\\"intent_f7c34046\\\",\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-02T22:41:01.560767Z\\\",\\n      \\\"cart_name\\\": \\\"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\\\",\\n      \\\"cart_description\\\": \\\"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚ã—ã¾ã—ãŸã€‚\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"286acdd4-d1c1-4860-b06a-f87d2f916a8d\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\\\",\\n          \\\"description\\\": \\\"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 800.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"1d9f08d9-51a9-491e-810b-f0e225ef4f59\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 1200.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"c688d6ef-615f-43f7-87ce-05568ae4e63c\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"6a169d3a-ca5a-4575-a08b-3fb659c628ed\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 1900.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 1900.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 19.834280014038086}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.563997Z", "level": "INFO", "logger": "common.mcp_client", "message": "[MCPClient] Tool build_cart_mandates executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.564033Z", "level": "INFO", "logger": "services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Created unsigned CartMandate: cart_a457c43c, plan=ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 97}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.564198Z", "level": "INFO", "logger": "common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.564241Z", "level": "DEBUG", "logger": "common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"3b05aeef-c0de-4f41-b185-1b18b3222391\"}, \"arguments\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,300å††)\", \"description\": \"ã‹ã‚ã„ã„æ™‚è¨ˆã‚’å«ã‚€é«˜å“è³ªãª3ç‚¹ã‚»ãƒƒãƒˆã€‚æ™‚è¨ˆã®ãƒ‡ã‚¶ã‚¤ãƒ³ã«åŠ ãˆã€ãƒãƒ¼ãƒã¨é´ä¸‹ã§å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ã•ã‚’é«˜ã‚ã¾ã—ãŸã€‚\", \"items\": [{\"product_id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"quantity\": 1}, {\"product_id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"quantity\": 1}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"quantity\": 1}]}, \"products\": [{\"id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"sku\": \"MUGI-MUG-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}, \"intent_mandate_id\": \"intent_f7c34046\"}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.564332Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.564383Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"3b05aeef-c0de-4f41-b185-1b18b3222391\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,300å††)\", \"description\": \"ã‹ã‚ã„ã„æ™‚è¨ˆã‚’å«ã‚€é«˜å“è³ªãª3ç‚¹ã‚»ãƒƒãƒˆã€‚æ™‚è¨ˆã®ãƒ‡ã‚¶ã‚¤ãƒ³ã«åŠ ãˆã€ãƒãƒ¼ãƒã¨é´ä¸‹ã§å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ã•ã‚’é«˜ã‚ã¾ã—ãŸã€‚\", \"items\": [{\"product_id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"quantity\": 1}, {\"product_id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"quantity\": 1}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"quantity\": 1}]}, \"products\": [{\"id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"sku\": \"MUGI-KEYCHAIN-001\",\"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"sku\": \"MUGI-MUG-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}, \"intent_mandate_id\": \"intent_f7c34046\"}}, \"id\": 27462}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent_mcp     | INFO:     172.18.0.8:50026 - "POST / HTTP/1.1" 200 OK


ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.566021Z", "level": "INFO", "logger": "services.merchant_agent.ageap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.566065Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:41:00 GMT\", \"server\": \"uvicorn\", \"content-length\": \"5160\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 27462, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_49e4b94f\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [\\n          {\\n            \\\"supported_methods\\\": \\\"basic-card\\\",\\n            \\\"data\\\": {\\n              \\\"supportedNetworks\\\": [\\n                \\\"visa\\\",\\n\\\"mastercard\\\",\\n                \\\"jcb\\\",\\n                \\\"amex\\\"\\n              ],\\n              \\\"supportedTypes\\\": [\\n                \\\"credit\\\",\\n                \\\"debit\\\"\\n              ]\\n            }\\n          },\\n          {\\n            \\\"supported_methods\\\": \\\"https://a2a-protocol.org/payment-methods/ap2-payment\\\",\\n            \\\"data\\\": {\\n              \\\"version\\\": \\\"0.2\\\",\\n              \\\"processor\\\": \\\"did:ap2:agent:payment_processor\\\",\\n              \\\"supportedMethods\\\": [\\n                \\\"credential-based\\\",\\n                \\\"attestation-based\\\"\\n              ]\\n            }\\n          }\\n        ],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_49e4b94f\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 3500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n         },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 950.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 850.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 530.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"åˆè¨ˆ\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 5830.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"options\\\": {\\n          \\\"request_payer_name\\\": true,\\n          \\\"request_payer_email\\\": true,\\n          \\\"request_payer_phone\\\": false,\\n          \\\"request_shipping\\\": true,\\n          \\\"shipping_type\\\": \\\"shipping\\\"\\n        },\\n        \\\"shipping_address\\\": {\\n          \\\"recipient\\\": \\\"ã‚\\\",\\n          \\\"postal_code\\\": \\\"ã‚\\\",\\n          \\\"city\\\": \\\"ã‚\\\",\\n          \\\"region\\\": \\\"ã‚\\\",\\n          \\\"address_line1\\\": \\\"ã‚\\\",\\n          \\\"country\\\": \\\"ã‚\\\"\\n        }\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-02T23:41:01.565344Z\\\",\\n      \\\"merchant_name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": \\\"intent_f7c34046\\\",\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-02T22:41:01.565357Z\\\",\\n      \\\"cart_name\\\": \\\"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,300å††)\\\",\\n      \\\"cart_description\\\": \\\"ã‹ã‚ã„ã„æ™‚è¨ˆã‚’å«ã‚€é«˜å“è³ªãª3ç‚¹ã‚»ãƒƒãƒˆã€‚æ™‚è¨ˆã®ãƒ‡ã‚¶ã‚¤ãƒ³ã«åŠ ãˆã€ãƒãƒ¼ãƒã¨é´ä¸‹ã§å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥
ã•ã‚’é«˜ã‚ã¾ã—ãŸã€‚\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"9f58d67c-5c45-4cd4-bf10-73f06647c234\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"2faf8370-ada4-45d4-812c-ef5818d526b5\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 950.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 950.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"c688d6ef-615f-43f7-87ce-05568ae4e63c\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}}, \"duration_ms\": 1.6460418701171875}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.566522Z", "level": "INFO", "logger": "common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (2.25ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.566559Z", "level": "DEBUG", "logger": "common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_49e4b94f\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [\\n          {\\n            \\\"supported_methods\\\": \\\"basic-card\\\",\\n            \\\"data\\\": {\\n              \\\"supportedNetworks\\\": [\\n                \\\"visa\\\",\\n                \\\"mastercard\\\",\\n                \\\"jcb\\\",\\n                \\\"amex\\\"\\n              ],\\n              \\\"supportedTypes\\\": [\\n                \\\"credit\\\",\\n                \\\"debit\\\"\\n              ]\\n            }\\n          },\\n          {\\n            \\\"supported_methods\\\": \\\"https://a2a-protocol.org/payment-methods/ap2-payment\\\",\\n            \\\"data\\\": {\\n              \\\"version\\\": \\\"0.2\\\",\\n              \\\"processor\\\": \\\"did:ap2:agent:payment_processor\\\",\\n              \\\"supportedMethods\\\": [\\n                \\\"credential-based\\\",\\n                \\\"attestation-based\\\"\\n              ]\\n            }\\n          }\\n        ],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_49e4b94f\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 3500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 950.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 850.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 530.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"åˆè¨ˆ\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 5830.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"options\\\": {\\n          \\\"request_payer_name\\\": true,\\n          \\\"request_payer_email\\\": true,\\n          \\\"request_payer_phone\\\": false,\\n          \\\"request_shipping\\\": true,\\n          \\\"shipping_type\\\": \\\"shipping\\\"\\n        },\\n        \\\"shipping_address\\\": {\\n          \\\"recipient\\\": \\\"ã‚\\\",\\n          \\\"postal_code\\\": \\\"ã‚\\\",\\n          \\\"city\\\": \\\"ã‚\\\",\\n          \\\"region\\\": \\\"ã‚\\\",\\n          \\\"address_line1\\\": \\\"ã‚\\\",\\n          \\\"country\\\": \\\"ã‚\\\"\\n        }\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-02T23:41:01.565344Z\\\",\\n      \\\"merchant_name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": \\\"intent_f7c34046\\\",\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-02T22:41:01.565357Z\\\",\\n      \\\"cart_name\\\": \\\"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,300å††)\\\",\\n      \\\"cart_description\\\": \\\"ã‹ã‚ã„ã„æ™‚è¨ˆã‚’å«ã‚€é«˜å“è³ªãª3ç‚¹ã‚»ãƒƒãƒˆã€‚æ™‚è¨ˆã®ãƒ‡ã‚¶ã‚¤ãƒ³ã«åŠ ãˆã€ãƒãƒ¼ãƒã¨é´ä¸‹ã§å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ã•ã‚’é«˜ã‚ã¾ã—ãŸã€‚\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"9f58d67c-5c45-4cd4-bf10-73f06647c234\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"2faf8370-ada4-45d4-812c-ef5818d526b5\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 950.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 950.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        },\\n        {\\n          \\\"product_id\\\": \\\"c688d6ef-615f-43f7-87ce-05568ae4e63c\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼é´ä¸‹\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 850.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 2.2482872009277344}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.566610Z", "level": "INFO", "logger": "common.mcp_client", "message": "[MCPClient] Tool build_cart_mandates executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.566626Z", "level": "INFO", "logger": "services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Created unsigned CartMandate: cart_49e4b94f, plan=é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,300å††)", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 97}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.566976Z", "level": "INFO", "logger": "common.mcp_client", "message": "MCP Request: tools/call", "module": "logger", "function": "log_mcp_request", "line": 283}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.567018Z", "level": "DEBUG", "logger": "common.mcp_client", "message": "MCP_REQUEST_RAW: {\"type\": \"MCP_REQUEST\", \"tool_name\": \"tools/call\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"3b05aeef-c0de-4f41-b185-1b18b3222391\"}, \"arguments\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (3,500å††)\", \"description\": \"æ™‚è¨ˆ1ç‚¹ã®ã¿ã®ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ—ãƒ©ãƒ³ã€‚é«˜å“è³ªã§ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ãŒç‰¹å¾´ã§ã€äºˆç®—å†…ã§æœ€ã‚‚ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ãªé¸æŠžè‚¢ã§ã™ã€‚\", \"items\": [{\"product_id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"quantity\": 1}]}, \"products\": [{\"id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"sku\": \"MUGI-MUG-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"price_cents\": 120000,\"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}, \"intent_mandate_id\": \"intent_f7c34046\"}}}", "module": "logger", "function": "log_mcp_request", "line": 294}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.567113Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Request: POST http://merchant_agent_mcp:8011/", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.567154Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent_mcp:8011/\", \"headers\": {\"Content-Type\": \"application/json\", \"Mcp-Session-Id\": \"3b05aeef-c0de-4f41-b185-1b18b3222391\"}, \"body\": {\"jsonrpc\": \"2.0\", \"method\": \"tools/call\", \"params\": {\"name\": \"build_cart_mandates\", \"arguments\": {\"cart_plan\": {\"name\": \"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (3,500å††)\", \"description\": \"æ™‚è¨ˆ1ç‚¹ã®ã¿ã®ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ—ãƒ©ãƒ³ã€‚é«˜å“è³ªã§ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ãŒç‰¹å¾´ã§ã€äºˆç®—å†…ã§æœ€ã‚‚ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ãªé¸æŠžè‚¢ã§ã™ã€‚\", \"items\": [{\"product_id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"quantity\": 1}]}, \"products\": [{\"id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"sku\": \"MUGI-KEYCHAIN-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"price_cents\": 80000, \"price_jpy\": 800.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"sku\": \"MUGI-CLOCK-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"price_cents\": 350000, \"price_jpy\": 3500.0, \"inventory_count\": 30, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"sku\": \"MUGI-POUCH-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"price_cents\": 95000, \"price_jpy\": 950.0, \"inventory_count\": 120, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"sku\": \"MUGI-MUG-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥
ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"price_cents\": 120000, \"price_jpy\": 1200.0, \"inventory_count\": 80, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"sku\": \"MUGI-SOCKS-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"price_cents\": 85000, \"price_jpy\": 850.0, \"inventory_count\": 100, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}, {\"id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"sku\": \"MUGI-PLATE-001\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"price_cents\": 190000, \"price_jpy\": 1900.0, \"inventory_count\": 70, \"category\": null, \"brand\": null, \"image_url\": null, \"refund_period_days\": 30}], \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}, \"intent_mandate_id\": \"intent_f7c34046\"}}, \"id\": 350856}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.568716Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Response: 200 (1.57ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.568768Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:41:00 GMT\", \"server\": \"uvicorn\", \"content-length\": \"3800\", \"content-type\": \"application/json\"}, \"body\": {\"jsonrpc\": \"2.0\", \"id\": 350856, \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_5fe4b671\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [\\n          {\\n            \\\"supported_methods\\\": \\\"basic-card\\\",\\n            \\\"data\\\": {\\n              \\\"supportedNetworks\\\": [\\n                \\\"visa\\\",\\n                \\\"mastercard\\\",\\n                \\\"jcb\\\",\\n                \\\"amex\\\"\\n              ],\\n              \\\"supportedTypes\\\": [\\n                \\\"credit\\\",\\n                \\\"debit\\\"\\n              ]\\n            }\\n          },\\n          {\\n            \\\"supported_methods\\\": \\\"https://a2a-protocol.org/payment-methods/ap2-payment\\\",\\n            \\\"data\\\": {\\n              \\\"version\\\": \\\"0.2\\\",\\n              \\\"processor\\\": \\\"did:ap2:agent:payment_processor\\\",\\n              \\\"supportedMethods\\\": [\\n                \\\"credential-based\\\",\\n                \\\"attestation-based\\\"\\n              ]\\n            }\\n          }\\n        ],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_5fe4b671\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 3500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"æ¶ˆ
è²»ç¨Žï¼ˆ10%ï¼‰\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 350.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            },\\n            {\\n              \\\"label\\\": \\\"é€æ–™\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"åˆè¨ˆ\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 4350.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"options\\\": {\\n          \\\"request_payer_name\\\": true,\\n          \\\"request_payer_email\\\": true,\\n          \\\"request_payer_phone\\\": false,\\n          \\\"request_shipping\\\": true,\\n          \\\"shipping_type\\\": \\\"shipping\\\"\\n        },\\n        \\\"shipping_address\\\": {\\n          \\\"recipient\\\": \\\"ã‚\\\",\\n          \\\"postal_code\\\": \\\"ã‚\\\",\\n          \\\"city\\\": \\\"ã‚\\\",\\n          \\\"region\\\": \\\"ã‚\\\",\\n          \\\"address_line1\\\": \\\"ã‚\\\",\\n          \\\"country\\\": \\\"ã‚\\\"\\n        }\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-02T23:41:01.568076Z\\\",\\n      \\\"merchant_name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": \\\"intent_f7c34046\\\",\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-02T22:41:01.568089Z\\\",\\n      \\\"cart_name\\\": \\\"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (3,500å††)\\\",\\n      \\\"cart_description\\\": \\\"æ™‚è¨ˆ1ç‚¹ã®ã¿ã®ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ—ãƒ©ãƒ³ã€‚é«˜å“è³ªã§ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ãŒç‰¹å¾´ã§ã€äºˆç®—å†…ã§æœ€ã‚‚ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ãªé¸æŠžè‚¢ã§ã™ã€‚\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"9f58d67c-5c45-4cd4-bf10-73f06647c234\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}}, \"duration_ms\": 1.5704631805419922}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.568933Z", "level": "INFO", "logger": "common.mcp_client", "message": "MCP Response: tools/call - SUCCESS (1.87ms)", "module": "logger", "function": "log_mcp_response", "line": 317}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.568969Z", "level": "DEBUG", "logger": "common.mcp_client", "message": "MCP_RESPONSE_RAW: {\"type\": \"MCP_RESPONSE\", \"tool_name\": \"tools/call\", \"result\": {\"content\": [{\"type\": \"text\", \"text\": \"{\\n  \\\"cart_mandate\\\": {\\n    \\\"contents\\\": {\\n      \\\"id\\\": \\\"cart_5fe4b671\\\",\\n      \\\"user_cart_confirmation_required\\\": true,\\n      \\\"payment_request\\\": {\\n        \\\"method_data\\\": [\\n          {\\n            \\\"supported_methods\\\": \\\"basic-card\\\",\\n            \\\"data\\\": {\\n              \\\"supportedNetworks\\\": [\\n                \\\"visa\\\",\\n                \\\"mastercard\\\",\\n                \\\"jcb\\\",\\n                \\\"amex\\\"\\n              ],\\n              \\\"supportedTypes\\\": [\\n                \\\"credit\\\",\\n                \\\"debit\\\"\\n              ]\\n            }\\n          },\\n          {\\n            \\\"supported_methods\\\": \\\"https://a2a-protocol.org/payment-methods/ap2-payment\\\",\\n            \\\"data\\\": {\\n              \\\"version\\\": \\\"0.2\\\",\\n              \\\"processor\\\": \\\"did:ap2:agent:payment_processor\\\",\\n              \\\"supportedMethods\\\": [\\n                \\\"credential-based\\\",\\n                \\\"attestation-based\\\"\\n              ]\\n            }\\n          }\\n        ],\\n        \\\"details\\\": {\\n          \\\"id\\\": \\\"cart_5fe4b671\\\",\\n          \\\"display_items\\\": [\\n            {\\n              \\\"label\\\": \\\"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 3500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 2592000\\n            },\\n            {\\n              \\\"label\\\": \\\"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 350.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n     },\\n            {\\n              \\\"label\\\": \\\"é€æ–™\\\",\\n              \\\"amount\\\": {\\n                \\\"value\\\": 500.0,\\n                \\\"currency\\\": \\\"JPY\\\"\\n              },\\n              \\\"refund_period\\\": 0\\n            }\\n          ],\\n          \\\"total\\\": {\\n            \\\"label\\\": \\\"åˆè¨ˆ\\\",\\n            \\\"amount\\\": {\\n              \\\"value\\\": 4350.0,\\n              \\\"currency\\\": \\\"JPY\\\"\\n            }\\n          }\\n        },\\n        \\\"options\\\": {\\n          \\\"request_payer_name\\\": true,\\n          \\\"request_payer_email\\\": true,\\n          \\\"request_payer_phone\\\": false,\\n          \\\"request_shipping\\\": true,\\n          \\\"shipping_type\\\": \\\"shipping\\\"\\n        },\\n        \\\"shipping_address\\\": {\\n          \\\"recipient\\\": \\\"ã‚\\\",\\n          \\\"postal_code\\\": \\\"ã‚\\\",\\n          \\\"city\\\": \\\"ã‚\\\",\\n          \\\"region\\\": \\\"ã‚\\\",\\n          \\\"address_line1\\\":\\\"ã‚\\\",\\n          \\\"country\\\": \\\"ã‚\\\"\\n        }\\n      },\\n      \\\"cart_expiry\\\": \\\"2025-11-02T23:41:01.568076Z\\\",\\n      \\\"merchant_name\\\": \\\"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\\\"\\n    },\\n    \\\"merchant_authorization\\\": null,\\n    \\\"_metadata\\\": {\\n      \\\"intent_mandate_id\\\": \\\"intent_f7c34046\\\",\\n      \\\"merchant_id\\\": \\\"did:ap2:merchant:mugibo_merchant\\\",\\n      \\\"created_at\\\": \\\"2025-11-02T22:41:01.568089Z\\\",\\n      \\\"cart_name\\\": \\\"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (3,500å††)\\\",\\n      \\\"cart_description\\\": \\\"æ™‚è¨ˆ1ç‚¹ã®ã¿ã®ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ—ãƒ©ãƒ³ã€‚é«˜å“è³ªã§ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ãŒç‰¹å¾´ã§ã€äºˆç®—å†…ã§æœ€ã‚‚ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ãªé¸æŠžè‚¢ã§ã™ã€‚\\\",\\n      \\\"raw_items\\\": [\\n        {\\n          \\\"product_id\\\": \\\"9f58d67c-5c45-4cd4-bf10-73f06647c234\\\",\\n          \\\"name\\\": \\\"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\\\",\\n          \\\"description\\\": \\\"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\\\",\\n          \\\"quantity\\\": 1,\\n          \\\"unit_price\\\": {\\n    \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"total_price\\\": {\\n            \\\"value\\\": 3500.0,\\n            \\\"currency\\\": \\\"JPY\\\"\\n          },\\n          \\\"image_url\\\": null\\n        }\\n      ]\\n    }\\n  }\\n}\"}], \"isError\": false}, \"error\": null, \"duration_ms\": 1.8734931945800781}", "module": "logger", "function": "log_mcp_response", "line": 328}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.569071Z", "level": "INFO", "logger": "common.mcp_client", "message": "[MCPClient] Tool build_cart_mandates executed successfully", "module": "mcp_client", "function": "call_tool", "line": 139}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.569095Z", "level": "INFO", "logger": "services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Created unsigned CartMandate: cart_5fe4b671, plan=ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (3,500å††)", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 97}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.569131Z", "level": "INFO", "logger": "services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Created 3 unsigned CartMandates, sending to Merchant for signature...", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 119}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.569359Z", "level": "INFO", "logger": "services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Processing 3 CartMandates in parallel...", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 333}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.569491Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Request: POST http://merchant:8002/sign/cart", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.569554Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant:8002/sign/cart\", \"headers\": {}, \"body\": {\"cart_mandate\": {\"contents\": {\"id\": \"cart_a457c43c\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_a457c43c\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 475.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.560661Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": null, \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.560767Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\", \"cart_description\": \"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚ã—ã¾ã—ãŸã€‚\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.569817Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Request: POST http://merchant:8002/sign/cart", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.569862Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant:8002/sign/cart\", \"headers\": {}, \"body\": {\"cart_mandate\": {\"contents\": {\"id\": \"cart_49e4b94f\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_49e4b94f\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€
ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 530.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 5830.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.565344Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": null, \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.565357Z\", \"cart_name\": \"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,300å††)\", \"cart_description\": \"ã‹ã‚ã„ã„æ™‚è¨ˆã‚’å«ã‚€é«˜å“è³ªãª3ç‚¹ã‚»ãƒƒãƒˆã€‚æ™‚è¨ˆã®ãƒ‡ã‚¶ã‚¤ãƒ³ã«åŠ ãˆã€ãƒãƒ¼ãƒã¨é´ä¸‹ã§å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ã•ã‚’é«˜ã‚ã¾ã—ãŸã€‚\", \"raw_items\": [{\"product_id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚
\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.570047Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Request: POST http://merchant:8002/sign/cart", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.570081Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant:8002/sign/cart\", \"headers\": {}, \"body\": {\"cart_mandate\": {\"contents\": {\"id\": \"cart_5fe4b671\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_5fe4b671\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆ
è²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 350.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 4350.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.568076Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": null, \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.568089Z\", \"cart_name\": \"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (3,500å††)\", \"cart_description\": \"æ™‚è¨ˆ1ç‚¹ã®ã¿ã®ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ—ãƒ©ãƒ³ã€‚é«˜å“è³ªã§ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ãŒç‰¹å¾´
ã§ã€äºˆç®—å†…ã§æœ€ã‚‚ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ãªé¸æŠžè‚¢ã§ã™ã€‚\", \"raw_items\": [{\"product_id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant               | [2025-11-02 22:41:01,702] INFO in services.merchant.utils.validation_helpers: [Merchant] CartMandate validation passed: cart_a457c43c
ap2_merchant               | [2025-11-02 22:41:01,709] INFO in services.merchant.utils.validation_helpers: [Merchant] CartMandate validation passed: cart_49e4b94f
ap2_merchant               | [2025-11-02 22:41:01,709] INFO in services.merchant.utils.validation_helpers: [Merchant] CartMandate validation passed: cart_5fe4b671
ap2_merchant               | [2025-11-02 22:41:01,709] INFO in services.merchant.utils.inventory_helpers: [Merchant] Inventory check passed for CartMandate: cart_a457c43c
ap2_merchant               | {"timestamp": "2025-11-02T22:41:01.736402Z", "level": "INFO", "logger": "services.merchant.service", "message": "[_generate_merchant_authorization_jwt] Generated signed JWT for CartMandate: cart_id=None, alg=ES256, merchant_id=did:ap2:merchant:mugibo_merchant", "module": "service", "function": "_generate_merchant_authorization_jwt", "line": 852}
ap2_merchant               | [2025-11-02 22:41:01,769] INFO in services.merchant.utils.inventory_helpers: [Merchant] Inventory check passed for CartMandate: cart_49e4b94f
ap2_merchant               | {"timestamp": "2025-11-02T22:41:01.769532Z", "level": "INFO", "logger": "services.merchant.service", "message": "[_generate_merchant_authorization_jwt] Generated signed JWT for CartMandate: cart_id=None, alg=ES256, merchant_id=did:ap2:merchant:mugibo_merchant", "module": "service", "function": "_generate_merchant_authorization_jwt", "line": 852}
ap2_merchant               | [2025-11-02 22:41:01,770] INFO in services.merchant.utils.inventory_helpers: [Merchant] Inventory check passed for CartMandate: cart_5fe4b671
ap2_merchant               | {"timestamp": "2025-11-02T22:41:01.771092Z", "level": "INFO", "logger": "services.merchant.service", "message": "[_generate_merchant_authorization_jwt] Generated signed JWT for CartMandate: cart_id=None, alg=ES256, merchant_id=did:ap2:merchant:mugibo_merchant", "module": "service", "function": "_generate_merchant_authorization_jwt", "line": 852}
ap2_merchant               | {"timestamp": "2025-11-02T22:41:01.793490Z", "level": "INFO", "logger": "services.merchant.service", "message": "[Merchant] Created new CartMandate: cart_a457c43c", "module": "service", "function": "sign_cart_mandate", "line": 258}
ap2_merchant               | {"timestamp": "2025-11-02T22:41:01.793700Z", "level": "INFO", "logger": "services.merchant.service", "message": "[Merchant] Auto-signed CartMandate: cart_a457c43c (with merchant_authorization JWT)", "module": "service", "function": "sign_cart_mandate", "line": 260}
ap2_merchant               | INFO:     172.18.0.8:55784 - "POST /sign/cart HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.797521Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Response: 200 (227.95ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.797623Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:41:01 GMT\", \"server\": \"uvicorn\", \"content-length\": \"4528\", \"content-type\": \"application/json\"}, \"body\": {\"signed_cart_mandate\": {\"contents\": {\"id\": \"cart_a457c43c\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_a457c43c\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«
ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 475.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.560661Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMDA0OWZmOGMxOTI1N2JlZGQ3NTQ2NGYxMDljMWRkZWMxYTliMDRkY2MyOGYxNjFhM2I2MDU5YzNjODczY2FlZSIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRiYjc1ODMxLWQ5ZmItNDAzOS05MGFjLWU4YWI4ZmE5MzdmMiIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.1hkLWLSt_EfhaJLlXyJwt2jVgG2Nyq1FZ0shwyJNMBrj061HC4RZOggyVmIZyhnu4Kw5A0XKqMqI6El5vVTKig\", \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.560767Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\", \"cart_description\": \"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚ã—ã¾ã—ãŸã€‚\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›
ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨
ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMDA0OWZmOGMxOTI1N2JlZGQ3NTQ2NGYxMDljMWRkZWMxYTliMDRkY2MyOGYxNjFhM2I2MDU5YzNjODczY2FlZSIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRiYjc1ODMxLWQ5ZmItNDAzOS05MGFjLWU4YWI4ZmE5MzdmMiIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.1hkLWLSt_EfhaJLlXyJwt2jVgG2Nyq1FZ0shwyJNMBrj061HC4RZOggyVmIZyhnu4Kw5A0XKqMqI6El5vVTKig\"}, \"duration_ms\": 227.94580459594727}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.797975Z", "level": "INFO", "logger": "services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] CartMandate auto-signed: cart_a457c43c, plan=ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 176}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.798052Z", "level": "INFO", "logger": "services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Built signed CartMandate for plan: ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 309}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.799591Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Response: 200 (229.71ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.799653Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:41:01 GMT\", \"server\": \"uvicorn\", \"content-length\": \"3863\", \"content-type\": \"application/json\"}, \"body\": {\"signed_cart_mandate\": {\"contents\": {\"id\": \"cart_49e4b94f\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_49e4b94f\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 530.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 5830.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.565344Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMGY2MzM3MjI2MzZjZWQ4YmMwNWFkMGYyYThjMGZjNjRlODJiYmEwNTM2OGZhNTg1OTQ0YzUyZGE3YzM4YTdmOCIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjdlMWE2YjEyLWUzODEtNDcxYi04NDcyLTgwOWMzMDEyZTE3ZCIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.PypEOZdrVSbBBff55rqVT8Iq4l7ZhCKcSn3wBbw0-xEpbNcni0R3ksh135x0bAQz2Es-7q67T4janOrNpPL9ww\", \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.565357Z\", \"cart_name\": \"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,300å††)\", \"cart_description\": \"ã‹ã‚ã„ã„æ™‚è¨ˆã‚’å«ã‚€é«˜å“è³ªãª3ç‚¹ã‚»ãƒƒãƒˆã€‚æ™‚è¨ˆã®ãƒ‡ã‚¶ã‚¤ãƒ³ã«åŠ ãˆã€ãƒãƒ¼ãƒã¨é´ä¸‹ã§å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ã•ã‚’é«˜ã‚ã¾ã—ãŸã€‚\", \"raw_items\": [{\"product_id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\",\"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMGY2MzM3MjI2MzZjZWQ4YmMwNWFkMGYyYThjMGZjNjRlODJiYmEwNTM2OGZhNTg1OTQ0YzUyZGE3YzM4YTdmOCIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjdlMWE2YjEyLWUzODEtNDcxYi04NDcyLTgwOWMzMDEyZTE3ZCIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.PypEOZdrVSbBBff55rqVT8Iq4l7ZhCKcSn3wBbw0-xEpbNcni0R3ksh135x0bAQz2Es-7q67T4janOrNpPL9ww\"}, \"duration_ms\": 229.71153259277344}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.799800Z", "level": "INFO", "logger": "services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] CartMandate auto-signed: cart_49e4b94f, plan=é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,300å††)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 176}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.799829Z", "level": "INFO", "logger": "services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Built signed CartMandate for plan: é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,300å††)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 309}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.802149Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Response: 200 (232.07ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.802288Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:41:01 GMT\", \"server\": \"uvicorn\", \"content-length\": \"3103\", \"content-type\": \"application/json\"}, \"body\": {\"signed_cart_mandate\": {\"contents\": {\"id\": \"cart_5fe4b671\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_5fe4b671\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 350.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 4350.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.568076Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNzc2YTBlMWViYTUzYTM5NDc5NjgwZTAyNGYxNzZkN2I0NDg5NTQ2YjViNjY4NDYwOGQ0YmQ0MWIyOWEzZmI3NCIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImZiNjZkZGE1LWIxODQtNGZkOC04MjUzLTg5YWNkYWU3N2Q4NiIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.qd_TGLKN-rFTCB9PmkmSBBr2fpWx0Ip5w_OJqVjoyevHoJu2Pe8RcqkboLPH72Ns6QN0jyFvfhnlJvpncxsEvg\", \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.568089Z\", \"cart_name\": \"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (3,500å††)\", \"cart_description\": \"æ™‚è¨ˆ1ç‚¹ã®ã¿ã®ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ—ãƒ©ãƒ³ã€‚é«˜å“è³ªã§ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ãŒç‰¹å¾´ã§ã€äºˆç®—å†…ã§æœ€ã‚‚ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ãªé¸æŠžè‚¢ã§ã™ã€‚\", \"raw_items\": [{\"product_id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNzc2YTBlMWViYTUzYTM5NDc5NjgwZTAyNGYxNzZkN2I0NDg5NTQ2YjViNjY4NDYwOGQ0YmQ0MWIyOWEzZmI3NCIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImZiNjZkZGE1LWIxODQtNGZkOC04MjUzLTg5YWNkYWU3N2Q4NiIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.qd_TGLKN-rFTCB9PmkmSBBr2fpWx0Ip5w_OJqVjoyevHoJu2Pe8RcqkboLPH72Ns6QN0jyFvfhnlJvpncxsEvg\"}, \"duration_ms\": 232.0687770843506}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.802601Z", "level": "INFO", "logger": "services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] CartMandate auto-signed: cart_5fe4b671, plan=ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (3,500å††)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 176}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.802636Z", "level": "INFO", "logger": "services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Built signed CartMandate for plan: ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (3,500å††)", "module": "cart_mandate_node", "function": "process_single_cart_mandate", "line": 309}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.802822Z", "level": "INFO", "logger": "services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Parallel processing complete: 3 signed, 0 pending, 0 timeout, 0 rejected", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 356}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.802842Z", "level": "INFO", "logger": "services.merchant_agent.nodes.cart_mandate_node", "message": "[build_cart_mandates] Built 3 signed CartMandates (pending: 0, timeout: 0)", "module": "cart_mandate_node", "function": "build_cart_mandates", "line": 376}
ap2_merchant               | {"timestamp": "2025-11-02T22:41:01.798509Z", "level": "INFO", "logger": "services.merchant.service", "message": "[Merchant] Created new CartMandate: cart_49e4b94f", "module": "service", "function": "sign_cart_mandate", "line": 258}




ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.805583Z", "level": "INFO", "logger": "services.merchant_agent.nodes.ranking_node", "message": "[rank_and_select] Selected top 3 carts", "module": "ranking_node", "function": "rank_and_select", "line": 31}
ap2_merchant               | {"timestamp": "2025-11-02T22:41:01.798743Z", "level": "INFO", "logger": "services.merchant.service", "message": "[Merchant] Auto-signed CartMandate: cart_49e4b94f (with merchant_authorization JWT)", "module": "service", "function": "sign_cart_mandate", "line": 260}
ap2_merchant               | INFO:     172.18.0.8:55788 - "POST /sign/cart HTTP/1.1" 200 OK
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.807824Z", "level": "INFO", "logger": "services.merchant_agent.langgraph_merchant", "message": "[create_cart_candidates] 3 carts ready (pre-signed via MCP)", "module": "langgraph_merchant", "function": "create_cart_candidates", "line": 316}


ap2_merchant               | {"timestamp": "2025-11-02T22:41:01.801338Z", "level": "INFO", "logger": "services.merchant.service", "message": "[Merchant] Created new CartMandate: cart_5fe4b671", "module": "service", "function": "sign_cart_mandate", "line": 258}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.807883Z", "level": "INFO", "logger": "services.merchant_agent.handlers.intent_handler", "message": "[MerchantAgent] Generated 3 cart candidates", "module": "intent_handler", "function": "handle_intent_mandate", "line": 103}


ap2_merchant               | {"timestamp": "2025-11-02T22:41:01.801510Z", "level": "INFO", "logger": "services.merchant.service", "message": "[Merchant] Auto-signed CartMandate: cart_5fe4b671 (with merchant_authorization JWT)", "module": "service", "function": "sign_cart_mandate", "line": 260}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.807995Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2Aå‡¦ç†] ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Œäº†: type=ap2.mandates.IntentMandate, result_type=ap2.responses.CartCandidates", "module": "a2a_handler", "function": "handle_message", "line": 307}
ap2_merchant               | INFO:     172.18.0.8:55794 - "POST /sign/cart HTTP/1.1" 200 OK

ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.808674Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 995}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.809234Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 9174, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.responses.CartCandidates\",\"id\":\"8b8cfd9b-5e27-405e-8c19-f9979011032d\",\"payload\":{\"cart_candidates\":[{\"artifactId\":\"artifact_b6ff232a\",\"name\":\"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—
ãƒ©ãƒ³ (4,750å††)\",\"parts\":[{\"d", "module": "crypto", "function": "sign_a2a_message", "line": 999}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.809283Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 794}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.810283Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: merchant_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.810698Z", "level": "INFO", "logger": "common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:shopping_agent: ap2.responses.CartCandidates", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | [2025-11-02 22:41:01,810] INFO in common.base_agent: [Merchant Agent] A2Aãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´: type=ap2.responses.CartCandidates, to=did:ap2:agent:shopping_agent
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:01.810840Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.responses.CartCandidates\", \"peer\": \"did:ap2:agent:shopping_agent\", \"headers\": {\"message_id\": \"01e71ba1-5117-4901-b0d8-e5ab98421e8b\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:shopping_agent\", \"timestamp\": \"2025-11-02T22:41:01.808335Z\", \"nonce\": \"4adc863c05a72938c2238a26c42eec80c7bc457c4d7d6ff7d253167b932c29a9\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"intent_mandate_id\": \"intent_f7c34046\", \"cart_candidates\": [{\"artifactId\": \"artifact_b6ff232a\", \"name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_a457c43c\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_a457c43c\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 475.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.560661Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMDA0OWZmOGMxOTI1N2JlZGQ3NTQ2NGYxMDljMWRkZWMxYTliMDRkY2MyOGYxNjFhM2I2MDU5YzNjODczY2FlZSIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRiYjc1ODMxLWQ5ZmItNDAzOS05MGFjLWU4YWI4ZmE5MzdmMiIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.1hkLWLSt_EfhaJLlXyJwt2jVgG2Nyq1FZ0shwyJNMBrj061HC4RZOggyVmIZyhnu4Kw5A0XKqMqI6El5vVTKig\", \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.560767Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\", \"cart_description\": \"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚ã—ã¾ã—ãŸã€‚\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}, {\"artifactId\": \"artifact_5c673316\", \"name\": \"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,300å††)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_49e4b94f\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_49e4b94f\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 530.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 5830.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.565344Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMGY2MzM3MjI2MzZjZWQ4YmMwNWFkMGYyYThjMGZjNjRlODJiYmEwNTM2OGZhNTg1OTQ0YzUyZGE3YzM4YTdmOCIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjdlMWE2YjEyLWUzODEtNDcxYi04NDcyLTgwOWMzMDEyZTE3ZCIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.PypEOZdrVSbBBff55rqVT8Iq4l7ZhCKcSn3wBbw0-xEpbNcni0R3ksh135x0bAQz2Es-7q67T4janOrNpPL9ww\", \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.565357Z\", \"cart_name\": \"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,300å††)\", \"cart_description\": \"ã‹ã‚ã„ã„æ™‚è¨ˆã‚’å«ã‚€é«˜å“è³ªãª3ç‚¹ã‚»ãƒƒãƒˆã€‚æ™‚è¨ˆã®ãƒ‡ã‚¶ã‚¤ãƒ³ã«åŠ ãˆã€ãƒãƒ¼ãƒã¨é´ä¸‹ã§å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ã•ã‚’é«˜ã‚ã¾ã—ãŸã€‚\", \"raw_items\": [{\"product_id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1,\"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}, {\"artifactId\": \"artifact_0af406e1\", \"name\": \"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (3,500å††)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_5fe4b671\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_5fe4b671\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 350.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 4350.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.568076Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNzc2YTBlMWViYTUzYTM5NDc5NjgwZTAyNGYxNzZkN2I0NDg5NTQ2YjViNjY4NDYwOGQ0YmQ0MWIyOWEzZmI3NCIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImZiNjZkZGE1LWIxODQtNGZkOC04MjUzLTg5YWNkYWU3N2Q4NiIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.qd_TGLKN-rFTCB9PmkmSBBr2fpWx0Ip5w_OJqVjoyevHoJu2Pe8RcqkboLPH72Ns6QN0jyFvfhnlJvpncxsEvg\", \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.568089Z\", \"cart_name\": \"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (3,500å††)\", \"cart_description\": \"æ™‚è¨ˆ1ç‚¹ã®ã¿ã®ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ—ãƒ©ãƒ³ã€‚é«˜å“è³ªã§ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ãŒç‰¹å¾´ã§ã€äºˆç®—å†…ã§æœ€ã‚‚ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ãªé¸æŠžè‚¢ã§ã™ã€‚\", \"raw_items\": [{\"product_id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"name\": \"ã‚€ãŽã¼ãƒ¼
æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}], \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | INFO:     172.18.0.9:39618 - "POST /a2a/message HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:01.829084Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "HTTP Response: 200 (120986.34ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:01.830153Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:38:59 GMT\", \"server\": \"uvicorn\", \"content-length\": \"10975\", \"content-type\": \"application/json\"}, \"body\": {\"header\": {\"message_id\": \"01e71ba1-5117-4901-b0d8-e5ab98421e8b\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:shopping_agent\", \"timestamp\": \"2025-11-02T22:41:01.808335Z\", \"nonce\": \"4adc863c05a72938c2238a26c42eec80c7bc457c4d7d6ff7d253167b932c29a9\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"/uwuPcbRJIJlJNDrgsYXZmtMYhxIFMdiZU+XYcOn6Mw9ywhTSe/OBd+mCQokOD60AmFfm8paFSyRDucHkhtmCQ==\", \"publicKeyMultibase\": \"z6Mko44YAnz8G71TocDDKoBqg86BJTxnqLN86UvGcpjxP47t\", \"kid\": \"did:ap2:agent:merchant_agent#key-2\", \"created\": \"2025-11-02T22:41:01.808335Z\", \"proofPurpose\": \"authentication\"}}, \"dataPart\": {\"@type\": \"ap2.responses.CartCandidates\", \"id\": \"8b8cfd9b-5e27-405e-8c19-f9979011032d\", \"payload\": {\"intent_mandate_id\": \"intent_f7c34046\", \"cart_candidates\": [{\"artifactId\": \"artifact_b6ff232a\", \"name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_a457c43c\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_a457c43c\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\",\"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 475.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.560661Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMDA0OWZmOGMxOTI1N2JlZGQ3NTQ2NGYxMDljMWRkZWMxYTliMDRkY2MyOGYxNjFhM2I2MDU5YzNjODczY2FlZSIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRiYjc1ODMxLWQ5ZmItNDAzOS05MGFjLWU4YWI4ZmE5MzdmMiIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.1hkLWLSt_EfhaJLlXyJwt2jVgG2Nyq1FZ0shwyJNMBrj061HC4RZOggyVmIZyhnu4Kw5A0XKqMqI6El5vVTKig\", \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.560767Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\", \"cart_description\": \"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»
é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚ã—ã¾ã—ãŸã€‚\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}, {\"artifactId\": \"artifact_5c673316\", \"name\": \"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,300å††)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_49e4b94f\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_49e4b94f\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"amount\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 530.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 5830.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.565344Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMGY2MzM3MjI2MzZjZWQ4YmMwNWFkMGYyYThjMGZjNjRlODJiYmEwNTM2OGZhNTg1OTQ0YzUyZGE3YzM4YTdmOCIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6IjdlMWE2YjEyLWUzODEtNDcxYi04NDcyLTgwOWMzMDEyZTE3ZCIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.PypEOZdrVSbBBff55rqVT8Iq4l7ZhCKcSn3wBbw0-xEpbNcni0R3ksh135x0bAQz2Es-7q67T4janOrNpPL9ww\", \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.565357Z\", \"cart_name\": \"é«˜å“è³ªãƒ—ãƒ©ãƒ³ (5,300å††)\", \"cart_description\": \"ã‹ã‚ã„ã„æ™‚è¨ˆã‚’å«ã‚€é«˜å“è³ªãª3ç‚¹ã‚»ãƒƒãƒˆã€‚æ™‚è¨ˆã®ãƒ‡ã‚¶ã‚¤ãƒ³ã«åŠ ãˆã€ãƒãƒ¼ãƒã¨é´ä¸‹ã§å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ã•ã‚’é«˜ã‚ã¾ã—ãŸã€‚\", \"raw_items\": [{\"product_id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"2faf8370-ada4-45d4-812c-ef5818d526b5\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒãƒ¼ãƒ\", \"description\": \"ã‚€ãŽã¼ãƒ¼æŸ„ã®ã‹ã‚ã„ã„ãƒãƒ¼ãƒã€‚å°ç‰©å…¥ã‚Œã‚„ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 950.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}, {\"artifactId\": \"artifact_0af406e1\", \"name\": \"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (3,500å††)\", \"parts\": [{\"kind\": \"data\", \"data\": {\"ap2.mandates.CartMandate\": {\"contents\": {\"id\": \"cart_5fe4b671\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_5fe4b671\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"amount\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 350.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 4350.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.568076Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiNzc2YTBlMWViYTUzYTM5NDc5NjgwZTAyNGYxNzZkN2I0NDg5NTQ2YjViNjY4NDYwOGQ0YmQ0MWIyOWEzZmI3NCIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImZiNjZkZGE1LWIxODQtNGZkOC04MjUzLTg5YWNkYWU3N2Q4NiIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.qd_TGLKN-rFTCB9PmkmSBBr2fpWx0Ip5w_OJqVjoyevHoJu2Pe8RcqkboLPH72Ns6QN0jyFvfhnlJvpncxsEvg\", \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.568089Z\", \"cart_name\": \"ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³ (3,500å††)\", \"cart_description\": \"æ™‚è¨ˆ1ç‚¹ã®ã¿ã®ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ—ãƒ©ãƒ³ã€‚é«˜å“è³ªã§ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ãŒç‰¹å¾´ã§ã€äºˆç®—å†…ã§æœ€ã‚‚ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ãªé¸æŠžè‚¢ã§ã™ã€‚\", \"raw_items\": [{\"product_id\": \"9f58d67c-5c45-4cd4-bf10-73f06647c234\", \"name\": \"ã‚€ãŽã¼ãƒ¼æ™‚è¨ˆ\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‹ã‚ã„ã„å£æŽ›ã‘æ™‚è¨ˆã€‚ãŠéƒ¨å±‹ã‚’æ˜Žã‚‹ãå½©ã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 3500.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}]}], \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"kind\": null, \"artifact\": null}}, \"duration_ms\": 120986.34052276611}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-02 22:41:01,833] INFO in services.shopping_agent.utils.merchant_integration:
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [ShoppingAgent â† MerchantAgent] A2Aãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡
ap2_shopping_agent         |   Status: 200
ap2_shopping_agent         |   Response Body: {
ap2_shopping_agent         |   "header": {
ap2_shopping_agent         |     "message_id": "01e71ba1-5117-4901-b0d8-e5ab98421e8b",
ap2_shopping_agent         |     "sender": "did:ap2:agent:merchant_agent",
ap2_shopping_agent         |     "recipient": "did:ap2:agent:shopping_agent",
ap2_shopping_agent         |     "timestamp": "2025-11-02T22:41:01.808335Z",
ap2_shopping_agent         |     "nonce": "4adc863c05a72938c2238a26c42eec80c7bc457c4d7d6ff7d253167b932c29a9",
ap2_shopping_agent         |     "schema_version": "0.2",
ap2_shopping_agent         |     "proof": {
ap2_shopping_agent         |       "algorithm": "ed25519",
ap2_shopping_agent         |       "signatureValue": "/uwuPcbRJIJlJNDrgsYXZmtMYhxIFMdiZU+XYcOn6Mw9ywhTSe/OBd+mCQokOD60AmFfm8paFSyRDucHkhtmCQ==",
ap2_shopping_agent         |       "publicKeyMultibase": "z6Mko44YAnz8G71TocDDKoBqg86BJTxnqLN86UvGcpjxP47t",
ap2_shopping_agent         |       "kid": "did:ap2:agent:merchant_agent#key-2",
ap2_shopping_agent         |       "created": "2025-11-02T22:41:01.808335Z",
ap2_shopping_agent         |       "proofPurpose": "authentication"
ap2_shopping_agent         |     }
ap2_shopping_agent         |   },
ap2_shopping_agent         |   "dataPart": {
ap2_shopping_agent         |     "@type": "ap2.responses.CartCandidates",
ap2_shopping_agent         |     "id": "8b8cfd9b-5e27-405e-8c19-f9979011032d",
ap2_shopping_agent         |     "payload": {
ap2_shopping_agent         |       "intent_mandate_id": "intent_f7c34046",
ap2_shopping_agent         |       "cart_candidates": [
ap2_shopping_agent         |         {
ap2_shopping_agent         |           "artifactId": "artifact_b6ff232a",
ap2_shopping_agent         |           "name": "ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©...
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:01.834359Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "[A2AHandler] Nonce validation successful: nonce=4adc863c05a72938...", "module": "a2a_handler", "function": "verify_message_signature", "line": 156}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:01.837659Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "[A2AHandler] Using DID-resolved public key for verification: kid=did:ap2:agent:merchant_agent#key-2", "module": "a2a_handler", "function": "verify_message_signature", "line": 190}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:01.838158Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying A2A message signature", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1023}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:01.839811Z", "level": "DEBUG", "logger": "common.crypto", "message": "[VERIFY] Canonical JSON length: 9174, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.responses.CartCandidates\",\"id\":\"8b8cfd9b-5e27-405e-8c19-f9979011032d\",\"payload\":{\"cart_candidates\":[{\"artifactId\":\"artifact_b6ff232a\",\"name\":\"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆ
ãƒ—ãƒ©ãƒ³ (4,750å††)\",\"parts\":[{\"d", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1027}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:01.839865Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying signature (algorithm: ED25519)", "module": "crypto", "function": "verify_signature", "line": 857}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:01.840693Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto VERIFY: ED25519 (key: did:ap2:agent:merchant_agent#key-2) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:01.840759Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] proofç½²åæ¤œè¨¼æˆåŠŸ: sender=did:ap2:agent:merchant_agent, alg=ed25519, kid=did:ap2:agent:merchant_agent#key-2, public_key_source=DID-resolved", "module": "a2a_handler", "function": "verify_message_signature", "line": 221}
ap2_shopping_agent         | [2025-11-02 22:41:01,840] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] âœ“ Signature verified for Merchant Agent response (sender=did:ap2:agent:merchant_agent, message_id=01e71ba1-5117-4901-b0d8-e5ab98421e8b)
ap2_shopping_agent         | [2025-11-02 22:41:01,840] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Received 3 cart candidates from Merchant Agent
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:02.563340Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=cart_selection", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:02.566972Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=cart_selection", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:15.931851Z", "level": "DEBUG", "logger": "common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:15.933104Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[chat_stream] Received request\n  session_id: session_1762122909017_4xjhsk\n  user_id: usr_cdb4ec851bcf4f73\n  user_input: cart_a457c43c\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1098}
ap2_shopping_agent         | INFO:     172.67.69.85:28463 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:15.937368Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Loaded session from DB: session_1762122909017_4xjhsk, step=cart_selection", "module": "agent", "function": "_get_or_create_session", "line": 1983}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:15.938340Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1762122909017_4xjhsk)", "module": "agent", "function": "event_generator", "line": 1113}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:15.939384Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[Langfuse] Reusing existing handler for session: session_1762122909017_4xjhsk", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1686}
ap2_shopping_agent         | [2025-11-02 22:41:15,964] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: cart_selection
ap2_shopping_agent         |   user_input: cart_a457c43c
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-02 22:41:15,996] INFO in services.shopping_agent.langgraph_shopping_flow: [select_cart_node] Merchant authorization JWT verified: merchant=did:ap2:merchant:mugibo_merchant, cart_hash=0049ff8c19257bed...
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:16.027520Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=cart_signature_pending", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:16.036772Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=cart_signature_pending", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | INFO:     172.67.69.85:17192 - "OPTIONS /cart/submit-signature HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:22.722525Z", "level": "DEBUG", "logger": "common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:22.725669Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Loaded session from DB: session_1762122909017_4xjhsk, step=cart_signature_pending", "module": "agent", "function": "_get_or_create_session", "line": 1983}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:22.726093Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[submit_cart_signature] Received CartMandate signature: cart_id=None, session_id=session_1762122909017_4xjhsk", "module": "agent", "function": "submit_cart_signature", "line": 1315}
ap2_shopping_agent         | [2025-11-02 22:41:22,726] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Verifying CartMandate WebAuthn signature: user_id=usr_cdb4ec851bcf4f73
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:22.727062Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "HTTP Request: POST http://credential_provider:8003/verify/attestation", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:22.727256Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/verify/attestation\", \"headers\": {}, \"body\": {\"payment_mandate\": {\"contents\": {\"id\": \"cart_a457c43c\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_a457c43c\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"amount\": {\"value\": 1900, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 475, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 5725, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.560661Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMDA0OWZmOGMxOTI1N2JlZGQ3NTQ2NGYxMDljMWRkZWMxYTliMDRkY2MyOGYxNjFhM2I2MDU5YzNjODczY2FlZSIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRiYjc1ODMxLWQ5ZmItNDAzOS05MGFjLWU4YWI4ZmE5MzdmMiIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.1hkLWLSt_EfhaJLlXyJwt2jVgG2Nyq1FZ0shwyJNMBrj061HC4RZOggyVmIZyhnu4Kw5A0XKqMqI6El5vVTKig\", \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.560767Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\", \"cart_description\": \"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚ã—ã¾ã—ãŸã€‚\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1900, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900, \"currency\": \"JPY\"}, \"image_url\": null}]}}, \"attestation\": {\"id\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"rawId\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"response\": {\"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlbmdlIjoiZXlKdFlXNWtZWFJsWDJsa0lqb2lZMkZ5ZEY5aE5EVTNZelF6WXlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTWpFeU16STNOekEzTW4wIiwib3JpZ2luIjoiaHR0cDovL2xvY2FsaG9zdDozMDAwIiwiY3Jvc3NPcmlnaW4iOmZhbHNlfQ\", \"authenticatorData\": \"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2MdAAAAAA\", \"signature\": \"MEYCIQChSJWukxcdL6V9ET2ozYz3NAXFvGdNwwSkW2P8bbmZYAIhAPbeazcabyFe3_6z5HPDRuc9wciD5H16N2k9RHk8CSQE\", \"userHandle\": \"usr_cdb4ec851bcf4f73\"}, \"type\": \"public-key\", \"attestation_type\": \"passkey\", \"challenge\": \"eyJtYW5kYXRlX2lkIjoiY2FydF9hNDU3YzQzYyIsInRpbWVzdGFtcCI6MTc2MjEyMzI3NzA3Mn0\"}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:22.795338Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[verify_attestation] Found passkey: dCDQdGlqx50G-UFW...", "module": "provider", "function": "verify_attestation", "line": 571}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:22.796346Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "  User: usr_cdb4ec851bcf4f73", "module": "provider", "function": "verify_attestation", "line": 572}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:22.796375Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "  Counter: 0", "module": "provider", "function": "verify_attestation", "line": 573}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:22.797805Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying WebAuthn authentication result", "module": "crypto", "function": "verify_webauthn_signature", "line": 1400}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:22.798622Z", "level": "DEBUG", "logger": "common.crypto", "message": "Client Data Type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1421}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:22.798646Z", "level": "DEBUG", "logger": "common.crypto", "message": "Origin: http://localhost:3000", "module": "crypto", "function": "verify_webauthn_signature", "line": 1422}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:22.798669Z", "level": "DEBUG", "logger": "common.crypto", "message": "Challenge matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1434}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:22.798685Z", "level": "DEBUG", "logger": "common.crypto", "message": "Authentication type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1441}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:22.798847Z", "level": "DEBUG", "logger": "common.crypto", "message": "AuthenticatorData parsed: counter=0", "module": "crypto", "function": "verify_webauthn_signature", "line": 1454}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:22.798880Z", "level": "INFO", "logger": "common.crypto", "message": "Signature counter: 0 (AP2 compliant: replay attacks prevented by user_authorization nonce)", "module": "crypto", "function": "verify_webauthn_signature", "line": 1460}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:22.800790Z", "level": "DEBUG", "logger": "common.crypto", "message": "RP ID Hash matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1473}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:22.817689Z", "level": "INFO", "logger": "common.crypto", "message": "WebAuthn signature verified successfully", "module": "crypto", "function": "verify_webauthn_signature", "line": 1525}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:22.829998Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[verify_attestation] Signature counter: 0 â†’ 0 (AP2æº–æ‹ : AuthenticatorãŒcounterã‚’å®Ÿè£…ã—ã¦ã„ãªã„å ´åˆã§ã‚‚ã€user_authorizationã®nonceã«ã‚ˆã‚Šãƒªãƒ—ãƒ¬ã‚¤æ”»æ’ƒã¯é˜²æ­¢ã•ã‚Œã¾ã™)", "module": "provider", "function": "verify_attestation", "line": 591}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:22.833455Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[verify_attestation] No payment_method.token in mandate (likely IntentMandate signature), skipping Payment Network call", "module": "provider", "function": "verify_attestation", "line": 619}
ap2_credential_provider    | [2025-11-02 22:41:22,831] INFO in services.credential_provider.utils.token_helpers: [CredentialProvider] Generated attestation token for user: None
ap2_credential_provider    | [2025-11-02 22:41:22,847] INFO in services.credential_provider.utils.token_helpers: [CredentialProvider] Saved attestation: user=unknown, verified=True, agent_token=None...
ap2_credential_provider    | INFO:     172.18.0.9:44790 - "POST /verify/attestation HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:22.861416Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "HTTP Response: 200 (134.22ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | [2025-11-02 22:41:22,861] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Sent WebAuthn verification request to Credential Provider: user_id=usr_cdb4ec851bcf4f73
ap2_shopping_agent         | [2025-11-02 22:41:22,861] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] âœ… WebAuthn signature verified successfully: counter=0, attestation_type=passkey
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:22.861498Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:41:21 GMT\", \"server\": \"uvicorn\", \"content-length\": \"191\", \"content-type\": \"application/json\"}, \"body\": {\"verified\": true, \"token\": \"cred_token_ec434f87_kHBK-RAom53lKWp1mI2WbiKY\", \"details\": {\"attestation_type\": \"passkey\", \"timestamp\": \"2025-11-02T22:41:22.847218+00:00\", \"counter\": 0, \"agent_token\": null}}, \"duration_ms\": 134.22298431396484}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:22.874782Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=cart_signature_pending", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:22.875073Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[submit_cart_signature] CartMandate signed by user: cart_id=None, webauthn_assertion saved", "module": "agent", "function": "submit_cart_signature", "line": 1355}
ap2_shopping_agent         | INFO:     172.67.69.85:17192 - "POST /cart/submit-signature HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:22.889696Z", "level": "DEBUG", "logger": "common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:22.889942Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[chat_stream] Received request\n  session_id: session_1762122909017_4xjhsk\n  user_id: usr_cdb4ec851bcf4f73\n  user_input: _cart_signature_completed\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1098}
ap2_shopping_agent         | INFO:     172.67.69.85:17192 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:22.900448Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Loaded session from DB: session_1762122909017_4xjhsk, step=cart_signature_pending", "module": "agent", "function": "_get_or_create_session", "line": 1983}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:22.902766Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1762122909017_4xjhsk)", "module": "agent", "function": "event_generator", "line": 1113}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:22.902966Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[Langfuse] Reusing existing handler for session: session_1762122909017_4xjhsk", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1686}
ap2_shopping_agent         | [2025-11-02 22:41:22,932] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: cart_signature_pending
ap2_shopping_agent         |   user_input: _cart_signature_completed
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-02 22:41:23,145] INFO in services.shopping_agent.langgraph_shopping_flow: [select_payment_method_node] AP2 Step 13-14: Presenting payment methods to user
ap2_shopping_agent         |   Available Methods: 1
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:23.743508Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=payment_method_selection", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:23.752296Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=payment_method_selection", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.172882Z", "level": "DEBUG", "logger": "common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.173620Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[chat_stream] Received request\n  session_id: session_1762122909017_4xjhsk\n  user_id: usr_cdb4ec851bcf4f73\n  user_input: 1\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1098}
ap2_shopping_agent         | INFO:     172.67.69.85:17192 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.178635Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Loaded session from DB: session_1762122909017_4xjhsk, step=payment_method_selection", "module": "agent", "function": "_get_or_create_session", "line": 1983}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.179111Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1762122909017_4xjhsk)", "module": "agent", "function": "event_generator", "line": 1113}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.179222Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[Langfuse] Reusing existing handler for session: session_1762122909017_4xjhsk", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1686}
ap2_shopping_agent         | [2025-11-02 22:41:25,193] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: payment_method_selection
ap2_shopping_agent         |   user_input: 1
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-02 22:41:25,200] INFO in services.shopping_agent.langgraph_shopping_flow: [select_payment_method_node] AP2 Step 15-18: Tokenizing payment method
ap2_shopping_agent         |   User ID: usr_cdb4ec851bcf4f73
ap2_shopping_agent         |   Payment Method ID: pm_f4745ec2
ap2_shopping_agent         |   CP URL: http://credential_provider:8003
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.200697Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Requesting payment method tokenization for: pm_f4745ec2", "module": "agent", "function": "_tokenize_payment_method", "line": 2392}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.201033Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "\n================================================================================\n[ShoppingAgent â†’ CredentialProvider] ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡\n  URL: http://credential_provider:8003/payment-methods/tokenize\n  User ID: usr_cdb4ec851bcf4f73\n  Payment Method ID: pm_f4745ec2\n================================================================================", "module": "agent", "function": "_tokenize_payment_method", "line": 2396}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.201093Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "HTTP Request: POST http://credential_provider:8003/payment-methods/tokenize", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.201123Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/payment-methods/tokenize\", \"headers\": {}, \"body\": {\"user_id\": \"usr_cdb4ec851bcf4f73\", \"payment_method_id\": \"pm_f4745ec2\"}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | [2025-11-02 22:41:25,210] INFO in common.redis_client: [RedisClient] Connected to Redis: redis://redis:6379/0
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:25.231418Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[tokenize_payment_method] Generated secure token for payment method: pm_f4745ec2", "module": "provider", "function": "tokenize_payment_method", "line": 814}
ap2_credential_provider    | INFO:     172.18.0.9:44790 - "POST /payment-methods/tokenize HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.233966Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "HTTP Response: 200 (32.79ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.234041Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:41:25 GMT\", \"server\": \"uvicorn\", \"content-length\": \"176\", \"content-type\": \"application/json\"}, \"body\": {\"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"payment_method_id\": \"pm_f4745ec2\", \"brand\": \"Visa\", \"last4\": \"1111\", \"type\": \"basic-card\", \"expires_at\": \"2025-11-02T22:56:25.205727Z\"}, \"duration_ms\": 32.78923034667969}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.234098Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent â† CredentialProvider] ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡: status=200", "module": "agent", "function": "_tokenize_payment_method", "line": 2416}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.234188Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Payment method tokenized: pm_f4745ec2 â†’ tok_630bfc60_KIFXWcg...", "module": "agent", "function": "_tokenize_payment_method", "line": 2426}
ap2_shopping_agent         | [2025-11-02 22:41:25,234] INFO in services.shopping_agent.langgraph_shopping_flow: [select_payment_method_node] AP2 Step 17-18: Received tokenized payment method
ap2_shopping_agent         |   Token: tok_630bfc60_KIFXWcg...
ap2_shopping_agent         | [2025-11-02 22:41:25,234] INFO in services.shopping_agent.utils.payment_helpers: [_extract_payment_amount_from_cart] CartMandate structure: has_contents=True, has_payment_request=True, has_details=True, has_total=True, total_amount={'value': 5725.0, 'currency': 'JPY'}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.235011Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "HTTP Request: POST http://credential_provider:8003/passkey/get-public-key", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.235032Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/passkey/get-public-key\", \"headers\": {}, \"body\": {\"credential_id\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"user_id\": \"usr_cdb4ec851bcf4f73\"}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_shopping_agent         | [2025-11-02 22:41:25,234] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Retrieving public key from Credential Provider: credential_id=dCDQdGlqx50G-UFW..., user_id=usr_cdb4ec851bcf4f73
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:25.238842Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[get_passkey_public_key] Public key retrieved: credential_id=dCDQdGlqx50G-UFW..., user_id=usr_cdb4ec851bcf4f73", "module": "provider", "function": "get_passkey_public_key", "line": 1537}
ap2_credential_provider    | INFO:     172.18.0.9:44790 - "POST /passkey/get-public-key HTTP/1.1" 200 OK
ap2_shopping_agent         | [2025-11-02 22:41:25,242] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] âœ… Public key retrieved: credential_id=dCDQdGlqx50G-UFW...
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.242352Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "HTTP Response: 200 (7.22ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.242416Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:41:25 GMT\", \"server\": \"uvicorn\", \"content-length\": \"212\", \"content-type\": \"application/json\"}, \"body\": {\"credential_id\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"public_key_cose\": \"pQECAyYgASFYIOnePT967mopshGl7tTo53MmMkE/bY6/WZuuZLHSWZYrIlggJj7UcPfh0MaQpNxA5bgmtZPTWi8YVP4x4C8ivq8RFDQ=\", \"user_id\": \"usr_cdb4ec851bcf4f73\"}, \"duration_ms\": 7.216453552246094}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-02 22:41:25,243] INFO in common.user_authorization: [create_user_authorization_vp] WebAuthn challenge from assertion: eyJtYW5kYXRlX2lk...
ap2_shopping_agent         | [2025-11-02 22:41:25,243] INFO in common.user_authorization: [create_user_authorization_vp] cart_hash: 0049ff8c19257bed...
ap2_shopping_agent         | [2025-11-02 22:41:25,243] INFO in common.user_authorization: [create_user_authorization_vp] payment_hash: e216ccfa6331273e...
ap2_shopping_agent         | [2025-11-02 22:41:25,245] INFO in common.user_authorization: [create_user_authorization_vp] Restored public key from COSE format (DB)
ap2_shopping_agent         | [2025-11-02 22:41:25,245] INFO in common.user_authorization: [create_user_authorization_vp] cnf claim with JWK added to Issuer JWT
ap2_shopping_agent         | [2025-11-02 22:41:25,246] INFO in common.user_authorization: [create_user_authorization_vp] Generated user_authorization VP: length=2428, cart_hash=0049ff8c19257bed..., payment_hash=e216ccfa6331273e...
ap2_shopping_agent         | [2025-11-02 22:41:25,246] INFO in services.shopping_agent.utils.payment_helpers: [_generate_user_authorization_for_payment] Generated user_authorization VP: length=2428
ap2_shopping_agent         | [2025-11-02 22:41:25,246] INFO in services.shopping_agent.utils.payment_helpers: [ShoppingAgent] transaction_type=human_present (WebAuthn assertion completed)
ap2_shopping_agent         | [2025-11-02 22:41:25,246] INFO in services.shopping_agent.utils.payment_helpers: [ShoppingAgent] Performing risk assessment...
ap2_shopping_agent         | [2025-11-02 22:41:25,247] WARNING in common.risk_assessment: [RiskAssessmentEngine] Invalid amount value: 5725.0
ap2_shopping_agent         | [2025-11-02 22:41:25,247] WARNING in common.risk_assessment: [RiskAssessmentEngine] Failed to parse amounts for constraint check
ap2_shopping_agent         | [2025-11-02 22:41:25,248] INFO in common.risk_assessment: [RiskAssessmentEngine] Assessment completed: risk_score=2, recommendation=approve, fraud_indicators=[]
ap2_shopping_agent         | [2025-11-02 22:41:25,249] INFO in services.shopping_agent.utils.payment_helpers: [ShoppingAgent] Risk assessment completed: score=2, recommendation=approve, indicators=[]
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.250522Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] PaymentMandate created with user_authorization: has_user_auth=True", "module": "agent", "function": "_create_payment_mandate", "line": 2161}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.250619Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] PaymentMandate created: amount=5725.0 JPY, payment_method=Visa ****1111, token=tok_630bfc60_KIFXWcg..., risk_score=2", "module": "agent", "function": "_create_payment_mandate", "line": 2166}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.293410Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=webauthn_signature_requested", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:25.302053Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=webauthn_signature_requested", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | INFO:     172.67.69.85:20497 - "OPTIONS /payment/submit-attestation HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:28.902227Z", "level": "DEBUG", "logger": "common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:28.907335Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[submit_payment_attestation] Verifying attestation for PaymentMandate: payment_b0f4ae77", "module": "agent", "function": "submit_payment_attestation", "line": 1467}
ap2_shopping_agent         | [2025-11-02 22:41:28,908] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Verifying PaymentMandate attestation: payment_id=payment_b0f4ae77
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:28.908380Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "HTTP Request: POST http://credential_provider:8003/verify/attestation", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:28.908507Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/verify/attestation\", \"headers\": {}, \"body\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_b0f4ae77\", \"payment_details_id\": \"order_16c9c348\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-02T22:41:25.234885Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJOa1lqUmxZemcxTVdKalpqUm1Oek1pTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMk5rWWpSbFl6ZzFNV0pqWmpSbU56TWlMQ0pwWVhRaU9qRTNOakl4TWpNeU9EVXNJbVY0Y0NJNk1UYzJNakV5TXpVNE5Td2libUptSWpveE56WXlNVEl6TWpnMUxDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaU5tUTBPVkF6Y25WaGFXMTVSV0ZZZFRGUGFtNWplVmw1VVZRNWRHcHlPVnB0TmpWcmMyUktXbXhwY3lJc0lua2lPaUpLYWpkVlkxQm1hREJOWVZGd1RuaEJOV0puYlhSYVVGUlhhVGhaVmxBMGVEUkRPR2wyY1RoU1JrUlJJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpHT1dsZkxVUjZlRlJCUWtWZlUwMUhWelI2ZUY5eE9HSnZjMFoyU0ZNeU9YcHVjbEZGV2s5dE5sQm5JaXdpYVdGMElqb3hOell5TVRJek1qZzFMQ0p6WkY5b1lYTm9Jam9pTWpGaU5qVm1aamsyTnpJNE5qZGhNelk0TmpKbE9Ua3lORE5pWXpJMVltTmxOV1l3T1dOallqYzNaREptWkRZeU5EZzVNV0pqWWpBek1EZzNOR1V4TWlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lNREEwT1dabU9HTXhPVEkxTjJKbFpHUTNOVFEyTkdZeE1EbGpNV1JrWldNeFlUbGlNRFJrWTJNeU9HWXhOakZoTTJJMk1EVTVZek5qT0RjelkyRmxaU0lzSW1VeU1UWmpZMlpoTmpNek1USTNNMlZrTTJaa1pqaGhPRFEzTURFM056TmhNVGs0WXpWaVlUZGtNek0yTkRCaE1qRXlORFU0TURVM05qVmxPRFV4WVRBaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyYXdJZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybFpNa1o1WkVZNWFFNUVWVE5aZWxGNldYbEpjMGx1VW5CaVYxWjZaRWRHZEdORFNUWk5WR015VFdwRmVVMTZTVE5PZWtFelRXNHdJaXdpYjNKcFoybHVJam9pYUhSMGNEb3ZMMnh2WTJGc2FHOXpkRG96TURBd0lpd2lZM0p2YzNOUGNtbG5hVzRpT21aaGJITmxmUSIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVlDSVFDaFNKV3VreGNkTDZWOUVUMm96WXozTkFYRnZHZE53d1NrVzJQOGJibVpZQUloQVBiZWF6Y2FieUZlM182ejVIUERSdWM5d2NpRDVIMTZOMms5UkhrOENTUUUiLCJ1c2VySGFuZGxlIjoidXNyX2NkYjRlYzg1MWJjZjRmNzMifSwidHlwZSI6InB1YmxpYy1rZXkiLCJhdHRlc3RhdGlvbl90eXBlIjoicGFzc2tleSIsImNoYWxsZW5nZSI6ImV5SnRZVzVrWVhSbFgybGtJam9pWTJGeWRGOWhORFUzWXpRell5SXNJblJwYldWemRHRnRjQ0k2TVRjMk1qRXlNekkzTnpBM01uMCJ9LCJjYXJ0X2hhc2giOiIwMDQ5ZmY4YzE5MjU3YmVkZDc1NDY0ZjEwOWMxZGRlYzFhOWIwNGRjYzI4ZjE2MWEzYjYwNTljM2M4NzNjYWVlIiwicGF5bWVudF9oYXNoIjoiZTIxNmNjZmE2MzMxMjczZWQzZmRmOGE4NDcwMTc3M2ExOThjNWJhN2QzMzY0MGEyMTI0NTgwNTc2NWU4NTFhMCJ9\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_b0f4ae77\", \"cart_mandate_id\": \"cart_a457c43c\", \"intent_mandate_id\": \"intent_f7c34046\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"attestation\": {\"id\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"rawId\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"response\": {\"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlbmdlIjoiZXlKdFlXNWtZWFJsWDJsa0lqb2ljR0Y1YldWdWRGOWlNR1kwWVdVM055SXNJblJwYldWemRHRnRjQ0k2TVRjMk1qRXlNekk0TnpBMU1YMCIsIm9yaWdpbiI6Imh0dHA6Ly9sb2NhbGhvc3Q6MzAwMCIsImNyb3NzT3JpZ2luIjpmYWxzZX0\", \"authenticatorData\": \"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2MdAAAAAA\", \"signature\": \"MEUCIQC21fyM7gr8M5q7eg3dQoj8oLUL3azJ-IFX4eIymfQg6AIgHzNJhs8R9bv-_62H-phyOgGc-dicBtuGTNjN4IDUcrQ\", \"userHandle\": \"usr_cdb4ec851bcf4f73\"}, \"type\": \"public-key\", \"attestation_type\": \"passkey\", \"challenge\": \"eyJtYW5kYXRlX2lkIjoicGF5bWVudF9iMGY0YWU3NyIsInRpbWVzdGFtcCI6MTc2MjEyMzI4NzA1MX0\"}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.915249Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[verify_attestation] Found passkey: dCDQdGlqx50G-UFW...", "module": "provider", "function": "verify_attestation", "line": 571}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.915304Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "  User: usr_cdb4ec851bcf4f73", "module": "provider", "function": "verify_attestation", "line": 572}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.915328Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "  Counter: 0", "module": "provider", "function": "verify_attestation", "line": 573}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.915395Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying WebAuthn authentication result", "module": "crypto", "function": "verify_webauthn_signature", "line": 1400}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.915450Z", "level": "DEBUG", "logger": "common.crypto", "message": "Client Data Type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1421}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.915468Z", "level": "DEBUG", "logger": "common.crypto", "message": "Origin: http://localhost:3000", "module": "crypto", "function": "verify_webauthn_signature", "line": 1422}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.915484Z", "level": "DEBUG", "logger": "common.crypto", "message": "Challenge matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1434}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.915494Z", "level": "DEBUG", "logger": "common.crypto", "message": "Authentication type: webauthn.get", "module": "crypto", "function": "verify_webauthn_signature", "line": 1441}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.915531Z", "level": "DEBUG", "logger": "common.crypto", "message": "AuthenticatorData parsed: counter=0", "module": "crypto", "function": "verify_webauthn_signature", "line": 1454}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.915543Z", "level": "INFO", "logger": "common.crypto", "message": "Signature counter: 0 (AP2 compliant: replay attacks prevented by user_authorization nonce)", "module": "crypto", "function": "verify_webauthn_signature", "line": 1460}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.915596Z", "level": "DEBUG", "logger": "common.crypto", "message": "RP ID Hash matched", "module": "crypto", "function": "verify_webauthn_signature", "line": 1473}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.917014Z", "level": "INFO", "logger": "common.crypto", "message": "WebAuthn signature verified successfully", "module": "crypto", "function": "verify_webauthn_signature", "line": 1525}
ap2_credential_provider    | [2025-11-02 22:41:28,919] INFO in services.credential_provider.utils.token_helpers: [CredentialProvider] Generated attestation token for user: usr_cdb4ec851bcf4f73
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.918772Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[verify_attestation] Signature counter: 0 â†’ 0 (AP2æº–æ‹ : AuthenticatorãŒcounterã‚’å®Ÿè£…ã—ã¦ã„ãªã„å ´åˆã§ã‚‚ã€user_authorizationã®nonceã«ã‚ˆã‚Šãƒªãƒ—ãƒ¬ã‚¤æ”»æ’ƒã¯é˜²æ­¢ã•ã‚Œã¾ã™)", "module": "provider", "function": "verify_attestation", "line": 591}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.919447Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[verify_attestation] PaymentMandate contains payment_method.token, calling Payment Network (Step 23)", "module": "provider", "function": "verify_attestation", "line": 610}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.919761Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[CredentialProvider] Requesting Agent Token from Payment Network: payment_mandate_id=payment_b0f4ae77", "module": "provider", "function": "_request_agent_token_from_network", "line": 1848}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.921037Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "HTTP Request: POST http://payment_network:8005/network/tokenize", "module": "logger", "function": "log_http_request", "line": 182}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:28.921145Z", "level": "DEBUG", "logger": "services.credential_provider.provider", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://payment_network:8005/network/tokenize\", \"headers\": {}, \"body\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_b0f4ae77\", \"payment_details_id\": \"order_16c9c348\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-02T22:41:25.234885Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJOa1lqUmxZemcxTVdKalpqUm1Oek1pTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMk5rWWpSbFl6ZzFNV0pqWmpSbU56TWlMQ0pwWVhRaU9qRTNOakl4TWpNeU9EVXNJbVY0Y0NJNk1UYzJNakV5TXpVNE5Td2libUptSWpveE56WXlNVEl6TWpnMUxDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaU5tUTBPVkF6Y25WaGFXMTVSV0ZZZFRGUGFtNWplVmw1VVZRNWRHcHlPVnB0TmpWcmMyUktXbXhwY3lJc0lua2lPaUpLYWpkVlkxQm1hREJOWVZGd1RuaEJOV0puYlhSYVVGUlhhVGhaVmxBMGVEUkRPR2wyY1RoU1JrUlJJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUpHT1dsZkxVUjZlRlJCUWtWZlUwMUhWelI2ZUY5eE9HSnZjMFoyU0ZNeU9YcHVjbEZGV2s5dE5sQm5JaXdpYVdGMElqb3hOell5TVRJek1qZzFMQ0p6WkY5b1lYTm9Jam9pTWpGaU5qVm1aamsyTnpJNE5qZGhNelk0TmpKbE9Ua3lORE5pWXpJMVltTmxOV1l3T1dOallqYzNaREptWkRZeU5EZzVNV0pqWWpBek1EZzNOR1V4TWlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lNREEwT1dabU9HTXhPVEkxTjJKbFpHUTNOVFEyTkdZeE1EbGpNV1JrWldNeFlUbGlNRFJrWTJNeU9HWXhOakZoTTJJMk1EVTVZek5qT0RjelkyRmxaU0lzSW1VeU1UWmpZMlpoTmpNek1USTNNMlZrTTJaa1pqaGhPRFEzTURFM056TmhNVGs0WXpWaVlUZGtNek0yTkRCaE1qRXlORFU0TURVM05qVmxPRFV4WVRBaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyYXdJZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybFpNa1o1WkVZNWFFNUVWVE5aZWxGNldYbEpjMGx1VW5CaVYxWjZaRWRHZEdORFNUWk5WR015VFdwRmVVMTZTVE5PZWtFelRXNHdJaXdpYjNKcFoybHVJam9pYUhSMGNEb3ZMMnh2WTJGc2FHOXpkRG96TURBd0lpd2lZM0p2YzNOUGNtbG5hVzRpT21aaGJITmxmUSIsImF1dGhlbnRpY2F0b3JEYXRhIjoiU1pZTjVZZ09qR2gwTkJjUFpIWmdXNF9rcnJtaWhqTEhtVnp6dW9NZGwyTWRBQUFBQUEiLCJzaWduYXR1cmUiOiJNRVlDSVFDaFNKV3VreGNkTDZWOUVUMm96WXozTkFYRnZHZE53d1NrVzJQOGJibVpZQUloQVBiZWF6Y2FieUZlM182ejVIUERSdWM5d2NpRDVIMTZOMms5UkhrOENTUUUiLCJ1c2VySGFuZGxlIjoidXNyX2NkYjRlYzg1MWJjZjRmNzMifSwidHlwZSI6InB1YmxpYy1rZXkiLCJhdHRlc3RhdGlvbl90eXBlIjoicGFzc2tleSIsImNoYWxsZW5nZSI6ImV5SnRZVzVrWVhSbFgybGtJam9pWTJGeWRGOWhORFUzWXpRell5SXNJblJwYldWemRHRnRjQ0k2TVRjMk1qRXlNekkzTnpBM01uMCJ9LCJjYXJ0X2hhc2giOiIwMDQ5ZmY4YzE5MjU3YmVkZDc1NDY0ZjEwOWMxZGRlYzFhOWIwNGRjYzI4ZjE2MWEzYjYwNTljM2M4NzNjYWVlIiwicGF5bWVudF9oYXNoIjoiZTIxNmNjZmE2MzMxMjczZWQzZmRmOGE4NDcwMTc3M2ExOThjNWJhN2QzMzY0MGEyMTI0NTgwNTc2NWU4NTFhMCJ9\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_b0f4ae77\", \"cart_mandate_id\": \"cart_a457c43c\", \"intent_mandate_id\": \"intent_f7c34046\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"attestation\": {\"id\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"rawId\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"response\": {\"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlbmdlIjoiZXlKdFlXNWtZWFJsWDJsa0lqb2ljR0Y1YldWdWRGOWlNR1kwWVdVM055SXNJblJwYldWemRHRnRjQ0k2TVRjMk1qRXlNekk0TnpBMU1YMCIsIm9yaWdpbiI6Imh0dHA6Ly9sb2NhbGhvc3Q6MzAwMCIsImNyb3NzT3JpZ2luIjpmYWxzZX0\", \"authenticatorData\": \"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2MdAAAAAA\", \"signature\": \"MEUCIQC21fyM7gr8M5q7eg3dQoj8oLUL3azJ-IFX4eIymfQg6AIgHzNJhs8R9bv-_62H-phyOgGc-dicBtuGTNjN4IDUcrQ\", \"userHandle\": \"usr_cdb4ec851bcf4f73\"}, \"type\": \"public-key\", \"attestation_type\": \"passkey\", \"challenge\": \"eyJtYW5kYXRlX2lkIjoicGF5bWVudF9iMGY0YWU3NyIsInRpbWVzdGFtcCI6MTc2MjEyMzI4NzA1MX0\"}, \"payment_method_token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"transaction_context\": {\"credential_provider_id\": \"did:ap2:agent:credential_provider\", \"timestamp\": \"2025-11-02T22:41:28.919925+00:00\"}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_payment_network        | [2025-11-02 22:41:28,974] INFO in services.payment_network.network: [DemoPaymentNetwork] Received tokenization request: payment_mandate_id=payment_b0f4ae77, payment_method_token=tok_630bfc60_KIFXWcg...
ap2_payment_network        | [2025-11-02 22:41:28,984] INFO in common.redis_client: [RedisClient] Connected to Redis: redis://redis:6379/2
ap2_payment_network        | [2025-11-02 22:41:28,996] INFO in services.payment_network.utils.token_helpers: [DemoPaymentNetwork] Issued Agent Token (Redis): agent_tok_demopaymentnetwork_26c..., expires_at=2025-11-02T23:41:28.975394+00:00, ttl=3600s
ap2_payment_network        | INFO:     172.18.0.13:46492 - "POST /network/tokenize HTTP/1.1" 200 OK
ap2_credential_provider    | [2025-11-02 22:41:29,001] INFO in httpx: HTTP Request: POST http://payment_network:8005/network/tokenize "HTTP/1.1 200 OK"
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:29.001981Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "HTTP Response: 200 (81.25ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:29.002053Z", "level": "DEBUG", "logger": "services.credential_provider.provider", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:41:28 GMT\", \"server\": \"uvicorn\", \"content-length\": \"186\", \"content-type\": \"application/json\"}, \"body\": {\"agent_token\": \"agent_tok_demopaymentnetwork_26c743ff_grQoXMiVffCzrTW0xbectuH1\", \"expires_at\": \"2025-11-02T23:41:28.975394Z\", \"network_name\": \"DemoPaymentNetwork\", \"token_type\": \"agent_token\"}, \"duration_ms\": 81.24613761901855}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:29.002105Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[CredentialProvider] Received Agent Token from Payment Network: agent_tok_demopaymentnetwork_26c..., network_name=DemoPaymentNetwork", "module": "provider", "function": "_request_agent_token_from_network", "line": 1872}
ap2_credential_provider    | [2025-11-02 22:41:29,006] INFO in services.credential_provider.utils.token_helpers: [CredentialProvider] Saved attestation: user=usr_cdb4ec851bcf4f73, verified=True, agent_token=agent_tok_demopaymentnetwork_26c...
ap2_credential_provider    | INFO:     172.18.0.9:44790 - "POST /verify/attestation HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.008361Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "HTTP Response: 200 (99.96ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.008413Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:41:28 GMT\", \"server\": \"uvicorn\", \"content-length\": \"251\", \"content-type\": \"application/json\"}, \"body\": {\"verified\": true, \"token\": \"cred_token_a99cf0d7_yy0NOKHS_Fd-kQHZmEKFXVbh\", \"details\": {\"attestation_type\": \"passkey\", \"timestamp\": \"2025-11-02T22:41:29.006960+00:00\", \"counter\": 0, \"agent_token\": \"agent_tok_demopaymentnetwork_26c743ff_grQoXMiVffCzrTW0xbectuH1\"}}, \"duration_ms\": 99.95698928833008}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-02 22:41:29,008] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] âœ… PaymentMandate attestation verified: payment_id=payment_b0f4ae77
ap2_shopping_agent         | [2025-11-02 22:41:29,008] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] Retrieving public key from Credential Provider: credential_id=dCDQdGlqx50G-UFW..., user_id=usr_cdb4ec851bcf4f73
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.008542Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[submit_payment_attestation] Attestation verified, processing payment...", "module": "agent", "function": "submit_payment_attestation", "line": 1487}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.008590Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "HTTP Request: POST http://credential_provider:8003/passkey/get-public-key", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.008639Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/passkey/get-public-key\", \"headers\": {}, \"body\": {\"credential_id\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"user_id\": \"usr_cdb4ec851bcf4f73\"}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.011877Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "HTTP Response: 200 (3.24ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.011918Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:41:28 GMT\", \"server\": \"uvicorn\", \"content-length\": \"212\", \"content-type\": \"application/json\"}, \"body\": {\"credential_id\": \"dCDQdGlqx50G-UFWp0ORsF5Y7mzWSAkYow\", \"public_key_cose\": \"pQECAyYgASFYIOnePT967mopshGl7tTo53MmMkE/bY6/WZuuZLHSWZYrIlggJj7UcPfh0MaQpNxA5bgmtZPTWi8YVP4x4C8ivq8RFDQ=\", \"user_id\": \"usr_cdb4ec851bcf4f73\"}, \"duration_ms\": 3.2439231872558594}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | [2025-11-02 22:41:29,011] INFO in services.shopping_agent.utils.signature_handlers: [SignatureHandlers] âœ… Public key retrieved: credential_id=dCDQdGlqx50G-UFW...
ap2_shopping_agent         | [2025-11-02 22:41:29,012] INFO in common.user_authorization: [create_user_authorization_vp] WebAuthn challenge from assertion: eyJtYW5kYXRlX2lk...
ap2_shopping_agent         | [2025-11-02 22:41:29,012] INFO in common.user_authorization: [create_user_authorization_vp] cart_hash: 0049ff8c19257bed...
ap2_shopping_agent         | [2025-11-02 22:41:29,012] INFO in common.user_authorization: [create_user_authorization_vp] payment_hash: ea5a71ef9aeb0ffe...
ap2_shopping_agent         | [2025-11-02 22:41:29,012] INFO in common.user_authorization: [create_user_authorization_vp] Restored public key from COSE format (DB)
ap2_shopping_agent         | [2025-11-02 22:41:29,012] INFO in common.user_authorization: [create_user_authorization_vp] cnf claim with JWK added to Issuer JWT
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.012965Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[submit_payment_attestation] SD-JWT-VC user_authorization generated: user_id=usr_cdb4ec851bcf4f73, vp_length=2439", "module": "agent", "function": "submit_payment_attestation", "line": 1531}
ap2_shopping_agent         | [2025-11-02 22:41:29,012] INFO in common.user_authorization: [create_user_authorization_vp] Generated user_authorization VP: length=2439, cart_hash=0049ff8c19257bed..., payment_hash=ea5a71ef9aeb0ffe...
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:29.010500Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[get_passkey_public_key] Public key retrieved: credential_id=dCDQdGlqx50G-UFW..., user_id=usr_cdb4ec851bcf4f73", "module": "provider", "function": "get_passkey_public_key", "line": 1537}
ap2_credential_provider    | INFO:     172.18.0.9:44790 - "POST /passkey/get-public-key HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.023043Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=webauthn_signature_requested", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.023540Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[submit_payment_attestation] PaymentMandate signed by user: payment_id=payment_b0f4ae77, next_step=payment_execution", "module": "agent", "function": "submit_payment_attestation", "line": 1552}
ap2_shopping_agent         | INFO:     172.67.69.85:20497 - "POST /payment/submit-attestation HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.031306Z", "level": "DEBUG", "logger": "common.auth", "message": "[Auth] Authenticated user: tubone24@example.com", "module": "auth", "function": "get_current_user", "line": 284}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.031409Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[chat_stream] Received request\n  session_id: session_1762122909017_4xjhsk\n  user_id: usr_cdb4ec851bcf4f73\n  user_input: _payment_signature_completed\n  is_step_up_completion: False", "module": "agent", "function": "chat_stream", "line": 1098}
ap2_shopping_agent         | INFO:     172.67.69.85:20497 - "POST /chat/stream HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.033135Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Loaded session from DB: session_1762122909017_4xjhsk, step=webauthn_signature_requested", "module": "agent", "function": "_get_or_create_session", "line": 1983}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.033579Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "[chat_stream] Using LangGraph shopping flow (session_id=session_1762122909017_4xjhsk)", "module": "agent", "function": "event_generator", "line": 1113}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.033613Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[Langfuse] Reusing existing handler for session: session_1762122909017_4xjhsk", "module": "agent", "function": "_generate_fixed_response_langgraph", "line": 1686}
ap2_shopping_agent         | [2025-11-02 22:41:29,046] INFO in services.shopping_agent.langgraph_shopping_flow: [route_by_step] Routing decision
ap2_shopping_agent         |   current_step: webauthn_signature_requested
ap2_shopping_agent         |   user_input: _payment_signature_completed
ap2_shopping_agent         |   is_step_up_completion: False
ap2_shopping_agent         | [2025-11-02 22:41:29,060] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Requesting payment processing via Merchant Agent for PaymentMandate: payment_b0f4ae77
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.060559Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 995}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.061225Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 7027, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_b0f4ae77\",\"payload\":{\"cart_mandate\":{\"_metadata\":{\"cart_description\":\"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼
ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚", "module": "crypto", "function": "sign_a2a_message", "line": 999}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.061267Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: shopping_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 794}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.062366Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: shopping_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.062495Z", "level": "INFO", "logger": "common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:merchant_agent: ap2.mandates.PaymentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.062620Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.mandates.PaymentMandate\", \"peer\": \"did:ap2:agent:merchant_agent\", \"headers\": {\"message_id\": \"fb1807bb-5420-47fc-9809-120fddcaa49d\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-02T22:41:29.060250Z\", \"nonce\": \"521de0111082e1070ff0b73b93a38f6c7f4100b5baa1f26a2217c50715de1a46\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_b0f4ae77\", \"payment_details_id\": \"order_16c9c348\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-02T22:41:25.234885Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJOa1lqUmxZemcxTVdKalpqUm1Oek1pTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMk5rWWpSbFl6ZzFNV0pqWmpSbU56TWlMQ0pwWVhRaU9qRTNOakl4TWpNeU9Ea3NJbVY0Y0NJNk1UYzJNakV5TXpVNE9Td2libUptSWpveE56WXlNVEl6TWpnNUxDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaU5tUTBPVkF6Y25WaGFXMTVSV0ZZZFRGUGFtNWplVmw1VVZRNWRHcHlPVnB0TmpWcmMyUktXbXhwY3lJc0lua2lPaUpLYWpkVlkxQm1hREJOWVZGd1RuaEJOV0puYlhSYVVGUlhhVGhaVmxBMGVEUkRPR2wyY1RoU1JrUlJJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUp4VmtGUlpWOU9UblIyWVZKc1FXSlhjVGN5YW1SV2JGYzBOa2hRVTBRNVNVSklhMnh6Y0ZwSExWOXpJaXdpYVdGMElqb3hOell5TVRJek1qZzVMQ0p6WkY5b1lYTm9Jam9pTmpGa04yWm1PVE14T1RkbFpUTXdORFJsWmpnNU56WTROVEE0WkdWaFpXVXlOVFU1WTJZNE5qTXdZbVZoWlRjd09UaGhPR1k1WVRjMFltUTBNMkk1TnlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lNREEwT1dabU9HTXhPVEkxTjJKbFpHUTNOVFEyTkdZeE1EbGpNV1JrWldNeFlUbGlNRFJrWTJNeU9HWXhOakZoTTJJMk1EVTVZek5qT0RjelkyRmxaU0lzSW1WaE5XRTNNV1ZtT1dGbFlqQm1abVV3WWpBd1pURXhOVGhrWWpobE5UYzVZMk00TVdJM1lqQmxOemt5WWpFelpXWTVZamczTVRaa1ptSXhNemM1TkdJaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyYXdJZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybGpSMFkxWWxkV2RXUkdPV2xOUjFrd1dWZFZNMDU1U1hOSmJsSndZbGRXZW1SSFJuUmpRMGsyVFZSak1rMXFSWGxOZWtrMFRucEJNVTFZTUNJc0ltOXlhV2RwYmlJNkltaDBkSEE2THk5c2IyTmhiR2h2YzNRNk16QXdNQ0lzSW1OeWIzTnpUM0pwWjJsdUlqcG1ZV3h6WlgwIiwiYXV0aGVudGljYXRvckRhdGEiOiJTWllONVlnT2pHaDBOQmNQWkhaZ1c0X2tycm1paGpMSG1Wenp1b01kbDJNZEFBQUFBQSIsInNpZ25hdHVyZSI6Ik1FVUNJUUMyMWZ5TTdncjhNNXE3ZWczZFFvajhvTFVMM2F6Si1JRlg0ZUl5bWZRZzZBSWdIek5KaHM4Ujlidi1fNjJILXBoeU9nR2MtZGljQnR1R1ROak40SURVY3JRIiwidXNlckhhbmRsZSI6InVzcl9jZGI0ZWM4NTFiY2Y0ZjczIn0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY5aU1HWTBZV1UzTnlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTWpFeU16STROekExTVgwIn0sImNhcnRfaGFzaCI6IjAwNDlmZjhjMTkyNTdiZWRkNzU0NjRmMTA5YzFkZGVjMWE5YjA0ZGNjMjhmMTYxYTNiNjA1OWMzYzg3M2NhZWUiLCJwYXltZW50X2hhc2giOiJlYTVhNzFlZjlhZWIwZmZlMGIwMGUxMTU4ZGI4ZTU3OWNjODFiN2IwZTc5MmIxM2VmOWI4NzE2ZGZiMTM3OTRiIn0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_b0f4ae77\", \"cart_mandate_id\": \"cart_a457c43c\", \"intent_mandate_id\": \"intent_f7c34046\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_a457c43c\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_a457c43c\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0,\"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 475.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.560661Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMDA0OWZmOGMxOTI1N2JlZGQ3NTQ2NGYxMDljMWRkZWMxYTliMDRkY2MyOGYxNjFhM2I2MDU5YzNjODczY2FlZSIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRiYjc1ODMxLWQ5ZmItNDAzOS05MGFjLWU4YWI4ZmE5MzdmMiIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.1hkLWLSt_EfhaJLlXyJwt2jVgG2Nyq1FZ0shwyJNMBrj061HC4RZOggyVmIZyhnu4Kw5A0XKqMqI6El5vVTKig\", \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.560767Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\", \"cart_description\": \"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚ã—ã¾ã—ãŸã€‚\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«
ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ã
æ¼”å‡ºã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_shopping_agent         | [2025-11-02 22:41:29,062] INFO in services.shopping_agent.utils.merchant_integration:
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | [ShoppingAgent â†’ MerchantAgent] A2Aãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼ˆPaymentRequestï¼‰
ap2_shopping_agent         |   URL: http://merchant_agent:8001/a2a/message
ap2_shopping_agent         |   ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID: fb1807bb-5420-47fc-9809-120fddcaa49d
ap2_shopping_agent         |   ã‚¿ã‚¤ãƒ—: ap2.mandates.PaymentMandate
ap2_shopping_agent         |   PaymentMandate ID: payment_b0f4ae77
ap2_shopping_agent         | ================================================================================
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.063347Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "HTTP Request: POST http://merchant_agent:8001/a2a/message", "module": "logger", "function": "log_http_request", "line": 182}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.063430Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://merchant_agent:8001/a2a/message\", \"headers\": {}, \"body\": {\"header\": {\"message_id\": \"fb1807bb-5420-47fc-9809-120fddcaa49d\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-02T22:41:29.060250Z\", \"nonce\": \"521de0111082e1070ff0b73b93a38f6c7f4100b5baa1f26a2217c50715de1a46\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"0j7DSIunuGjROd7FCXCeWFOQi4drB+jZN53aKog8J0YCKLRcR6TT+n0QyWokNE9T4j+MYPmL+UJmKGJO9sqRDg==\", \"publicKeyMultibase\": \"z6MkpL5YFLHxAcp6LSJboXQ3nBnNGrQ4TiZRmWBZamPo7t8x\", \"kid\": \"did:ap2:agent:shopping_agent#key-2\", \"created\": \"2025-11-02T22:41:29.060250Z\", \"proofPurpose\": \"authentication\"}}, \"dataPart\": {\"@type\": \"ap2.mandates.PaymentMandate\", \"id\": \"payment_b0f4ae77\", \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_b0f4ae77\", \"payment_details_id\": \"order_16c9c348\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-02T22:41:25.234885Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJOa1lqUmxZemcxTVdKalpqUm1Oek1pTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMk5rWWpSbFl6ZzFNV0pqWmpSbU56TWlMQ0pwWVhRaU9qRTNOakl4TWpNeU9Ea3NJbVY0Y0NJNk1UYzJNakV5TXpVNE9Td2libUptSWpveE56WXlNVEl6TWpnNUxDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaU5tUTBPVkF6Y25WaGFXMTVSV0ZZZFRGUGFtNWplVmw1VVZRNWRHcHlPVnB0TmpWcmMyUktXbXhwY3lJc0lua2lPaUpLYWpkVlkxQm1hREJOWVZGd1RuaEJOV0puYlhSYVVGUlhhVGhaVmxBMGVEUkRPR2wyY1RoU1JrUlJJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUp4VmtGUlpWOU9UblIyWVZKc1FXSlhjVGN5YW1SV2JGYzBOa2hRVTBRNVNVSklhMnh6Y0ZwSExWOXpJaXdpYVdGMElqb3hOell5TVRJek1qZzVMQ0p6WkY5b1lYTm9Jam9pTmpGa04yWm1PVE14T1RkbFpUTXdORFJsWmpnNU56WTROVEE0WkdWaFpXVXlOVFU1WTJZNE5qTXdZbVZoWlRjd09UaGhPR1k1WVRjMFltUTBNMkk1TnlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lNREEwT1dabU9HTXhPVEkxTjJKbFpHUTNOVFEyTkdZeE1EbGpNV1JrWldNeFlUbGlNRFJrWTJNeU9HWXhOakZoTTJJMk1EVTVZek5qT0RjelkyRmxaU0lzSW1WaE5XRTNNV1ZtT1dGbFlqQm1abVV3WWpBd1pURXhOVGhrWWpobE5UYzVZMk00TVdJM1lqQmxOemt5WWpFelpXWTVZamczTVRaa1ptSXhNemM1TkdJaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyYXdJZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybGpSMFkxWWxkV2RXUkdPV2xOUjFrd1dWZFZNMDU1U1hOSmJsSndZbGRXZW1SSFJuUmpRMGsyVFZSak1rMXFSWGxOZWtrMFRucEJNVTFZTUNJc0ltOXlhV2RwYmlJNkltaDBkSEE2THk5c2IyTmhiR2h2YzNRNk16QXdNQ0lzSW1OeWIzTnpUM0pwWjJsdUlqcG1ZV3h6WlgwIiwiYXV0aGVudGljYXRvckRhdGEiOiJTWllONVlnT2pHaDBOQmNQWkhaZ1c0X2tycm1paGpMSG1Wenp1b01kbDJNZEFBQUFBQSIsInNpZ25hdHVyZSI6Ik1FVUNJUUMyMWZ5TTdncjhNNXE3ZWczZFFvajhvTFVMM2F6Si1JRlg0ZUl5bWZRZzZBSWdIek5KaHM4Ujlidi1fNjJILXBoeU9nR2MtZGljQnR1R1ROak40SURVY3JRIiwidXNlckhhbmRsZSI6InVzcl9jZGI0ZWM4NTFiY2Y0ZjczIn0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY5aU1HWTBZV1UzTnlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTWpFeU16STROekExTVgwIn0sImNhcnRfaGFzaCI6IjAwNDlmZjhjMTkyNTdiZWRkNzU0NjRmMTA5YzFkZGVjMWE5YjA0ZGNjMjhmMTYxYTNiNjA1OWMzYzg3M2NhZWUiLCJwYXltZW50X2hhc2giOiJlYTVhNzFlZjlhZWIwZmZlMGIwMGUxMTU4ZGI4ZTU3OWNjODFiN2IwZTc5MmIxM2VmOWI4NzE2ZGZiMTM3OTRiIn0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_b0f4ae77\", \"cart_mandate_id\": \"cart_a457c43c\", \"intent_mandate_id\": \"intent_f7c34046\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_a457c43c\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_a457c43c\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 475.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.560661Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMDA0OWZmOGMxOTI1N2JlZGQ3NTQ2NGYxMDljMWRkZWMxYTliMDRkY2MyOGYxNjFhM2I2MDU5YzNjODczY2FlZSIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRiYjc1ODMxLWQ5ZmItNDAzOS05MGFjLWU4YWI4ZmE5MzdmMiIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.1hkLWLSt_EfhaJLlXyJwt2jVgG2Nyq1FZ0shwyJNMBrj061HC4RZOggyVmIZyhnu4Kw5A0XKqMqI6El5vVTKig\", \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.560767Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\", \"cart_description\": \"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚ã—ã¾ã—ãŸã€‚\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}, \"kind\": null, \"artifact\": null}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_merchant_agent         | [2025-11-02 22:41:29,079] INFO in common.base_agent:
ap2_merchant_agent         | ================================================================================
ap2_merchant_agent         | [Merchant Agent] A2Aã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: POST /a2a/message
ap2_merchant_agent         |   å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ID=fb1807bb-5420-47fc-9809-120fddcaa49d
ap2_merchant_agent         |   é€ä¿¡å…ƒ: did:ap2:agent:shopping_agent
ap2_merchant_agent         |   ã‚¿ã‚¤ãƒ—: ap2.mandates.PaymentMandate
ap2_merchant_agent         | ================================================================================
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.080699Z", "level": "INFO", "logger": "common.a2a_handler", "message": "A2A Message received to/from did:ap2:agent:shopping_agent: ap2.mandates.PaymentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.081329Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"received\", \"message_type\": \"ap2.mandates.PaymentMandate\", \"peer\": \"did:ap2:agent:shopping_agent\", \"headers\": {\"message_id\": \"fb1807bb-5420-47fc-9809-120fddcaa49d\", \"sender\": \"did:ap2:agent:shopping_agent\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-02T22:41:29.060250Z\", \"nonce\": \"521de0111082e1070ff0b73b93a38f6c7f4100b5baa1f26a2217c50715de1a46\", \"schema_version\": \"0.2\"}, \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_b0f4ae77\", \"payment_details_id\": \"order_16c9c348\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-02T22:41:25.234885Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJOa1lqUmxZemcxTVdKalpqUm1Oek1pTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMk5rWWpSbFl6ZzFNV0pqWmpSbU56TWlMQ0pwWVhRaU9qRTNOakl4TWpNeU9Ea3NJbVY0Y0NJNk1UYzJNakV5TXpVNE9Td2libUptSWpveE56WXlNVEl6TWpnNUxDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaU5tUTBPVkF6Y25WaGFXMTVSV0ZZZFRGUGFtNWplVmw1VVZRNWRHcHlPVnB0TmpWcmMyUktXbXhwY3lJc0lua2lPaUpLYWpkVlkxQm1hREJOWVZGd1RuaEJOV0puYlhSYVVGUlhhVGhaVmxBMGVEUkRPR2wyY1RoU1JrUlJJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUp4VmtGUlpWOU9UblIyWVZKc1FXSlhjVGN5YW1SV2JGYzBOa2hRVTBRNVNVSklhMnh6Y0ZwSExWOXpJaXdpYVdGMElqb3hOell5TVRJek1qZzVMQ0p6WkY5b1lYTm9Jam9pTmpGa04yWm1PVE14T1RkbFpUTXdORFJsWmpnNU56WTROVEE0WkdWaFpXVXlOVFU1WTJZNE5qTXdZbVZoWlRjd09UaGhPR1k1WVRjMFltUTBNMkk1TnlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lNREEwT1dabU9HTXhPVEkxTjJKbFpHUTNOVFEyTkdZeE1EbGpNV1JrWldNeFlUbGlNRFJrWTJNeU9HWXhOakZoTTJJMk1EVTVZek5qT0RjelkyRmxaU0lzSW1WaE5XRTNNV1ZtT1dGbFlqQm1abVV3WWpBd1pURXhOVGhrWWpobE5UYzVZMk00TVdJM1lqQmxOemt5WWpFelpXWTVZamczTVRaa1ptSXhNemM1TkdJaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyYXdJZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybGpSMFkxWWxkV2RXUkdPV2xOUjFrd1dWZFZNMDU1U1hOSmJsSndZbGRXZW1SSFJuUmpRMGsyVFZSak1rMXFSWGxOZWtrMFRucEJNVTFZTUNJc0ltOXlhV2RwYmlJNkltaDBkSEE2THk5c2IyTmhiR2h2YzNRNk16QXdNQ0lzSW1OeWIzTnpUM0pwWjJsdUlqcG1ZV3h6WlgwIiwiYXV0aGVudGljYXRvckRhdGEiOiJTWllONVlnT2pHaDBOQmNQWkhaZ1c0X2tycm1paGpMSG1Wenp1b01kbDJNZEFBQUFBQSIsInNpZ25hdHVyZSI6Ik1FVUNJUUMyMWZ5TTdncjhNNXE3ZWczZFFvajhvTFVMM2F6Si1JRlg0ZUl5bWZRZzZBSWdIek5KaHM4Ujlidi1fNjJILXBoeU9nR2MtZGljQnR1R1ROak40SURVY3JRIiwidXNlckhhbmRsZSI6InVzcl9jZGI0ZWM4NTFiY2Y0ZjczIn0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY5aU1HWTBZV1UzTnlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTWpFeU16STROekExTVgwIn0sImNhcnRfaGFzaCI6IjAwNDlmZjhjMTkyNTdiZWRkNzU0NjRmMTA5YzFkZGVjMWE5YjA0ZGNjMjhmMTYxYTNiNjA1OWMzYzg3M2NhZWUiLCJwYXltZW50X2hhc2giOiJlYTVhNzFlZjlhZWIwZmZlMGIwMGUxMTU4ZGI4ZTU3OWNjODFiN2IwZTc5MmIxM2VmOWI4NzE2ZGZiMTM3OTRiIn0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_b0f4ae77\", \"cart_mandate_id\": \"cart_a457c43c\", \"intent_mandate_id\": \"intent_f7c34046\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_a457c43c\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_a457c43c\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\":\"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 475.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.560661Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMDA0OWZmOGMxOTI1N2JlZGQ3NTQ2NGYxMDljMWRkZWMxYTliMDRkY2MyOGYxNjFhM2I2MDU5YzNjODczY2FlZSIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRiYjc1ODMxLWQ5ZmItNDAzOS05MGFjLWU4YWI4ZmE5MzdmMiIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.1hkLWLSt_EfhaJLlXyJwt2jVgG2Nyq1FZ0shwyJNMBrj061HC4RZOggyVmIZyhnu4Kw5A0XKqMqI6El5vVTKig\", \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.560767Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\", \"cart_description\": \"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚ã—ã¾ã—ãŸã€‚\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘
ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.085672Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "[A2AHandler] Nonce validation successful: nonce=521de0111082e107...", "module": "a2a_handler", "function": "verify_message_signature", "line": 156}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.088453Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "[A2AHandler] Using DID-resolved public key for verification: kid=did:ap2:agent:shopping_agent#key-2", "module": "a2a_handler", "function": "verify_message_signature", "line": 190}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.089102Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying A2A message signature", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1023}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.089815Z", "level": "DEBUG", "logger": "common.crypto", "message": "[VERIFY] Canonical JSON length: 7027, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_b0f4ae77\",\"payload\":{\"cart_mandate\":{\"_metadata\":{\"cart_description\":\"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­
ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1027}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.089855Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying signature (algorithm: ED25519)", "module": "crypto", "function": "verify_signature", "line": 857}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.090547Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto VERIFY: ED25519 (key: did:ap2:agent:shopping_agent#key-2) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.090761Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] proofç½²åæ¤œè¨¼æˆåŠŸ: sender=did:ap2:agent:shopping_agent, alg=ed25519, kid=did:ap2:agent:shopping_agent#key-2, public_key_source=DID-resolved", "module": "a2a_handler", "function": "verify_message_signature", "line": 221}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.091236Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2Aå‡¦ç†] ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè¡Œä¸­: type=ap2.mandates.PaymentMandate, from=did:ap2:agent:shopping_agent", "module": "a2a_handler", "function": "handle_message", "line": 299}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.091751Z", "level": "INFO", "logger": "services.merchant_agent.handlers.payment_handler", "message": "[MerchantAgent] Received PaymentRequest from Shopping Agent", "module": "payment_handler", "function": "handle_payment_request", "line": 32}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.091813Z", "level": "INFO", "logger": "services.merchant_agent.handlers.payment_handler", "message": "[MerchantAgent] Forwarding PaymentMandate to Payment Processor: payment_mandate_id=payment_b0f4ae77", "module": "payment_handler", "function": "handle_payment_request", "line": 51}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.092276Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 995}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.092706Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 7030, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_b0f4ae77\",\"payload\":{\"cart_mandate\":{\"_metadata\":{\"cart_description\":\"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼
ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚", "module": "crypto", "function": "sign_a2a_message", "line": 999}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.092745Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 794}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.093029Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: merchant_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.093113Z", "level": "INFO", "logger": "common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:payment_processor: ap2.mandates.PaymentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.093383Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.mandates.PaymentMandate\", \"peer\": \"did:ap2:agent:payment_processor\", \"headers\": {\"message_id\": \"240f4ba6-c3c5-4879-b140-709dfc1e6280\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:payment_processor\", \"timestamp\": \"2025-11-02T22:41:29.091873Z\", \"nonce\": \"bcf2560abbf3e3f39056559ea399d1452331b9ba9e52f28873ef257e42bcd5a7\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_b0f4ae77\", \"payment_details_id\": \"order_16c9c348\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-02T22:41:25.234885Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJOa1lqUmxZemcxTVdKalpqUm1Oek1pTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMk5rWWpSbFl6ZzFNV0pqWmpSbU56TWlMQ0pwWVhRaU9qRTNOakl4TWpNeU9Ea3NJbVY0Y0NJNk1UYzJNakV5TXpVNE9Td2libUptSWpveE56WXlNVEl6TWpnNUxDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaU5tUTBPVkF6Y25WaGFXMTVSV0ZZZFRGUGFtNWplVmw1VVZRNWRHcHlPVnB0TmpWcmMyUktXbXhwY3lJc0lua2lPaUpLYWpkVlkxQm1hREJOWVZGd1RuaEJOV0puYlhSYVVGUlhhVGhaVmxBMGVEUkRPR2wyY1RoU1JrUlJJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUp4VmtGUlpWOU9UblIyWVZKc1FXSlhjVGN5YW1SV2JGYzBOa2hRVTBRNVNVSklhMnh6Y0ZwSExWOXpJaXdpYVdGMElqb3hOell5TVRJek1qZzVMQ0p6WkY5b1lYTm9Jam9pTmpGa04yWm1PVE14T1RkbFpUTXdORFJsWmpnNU56WTROVEE0WkdWaFpXVXlOVFU1WTJZNE5qTXdZbVZoWlRjd09UaGhPR1k1WVRjMFltUTBNMkk1TnlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lNREEwT1dabU9HTXhPVEkxTjJKbFpHUTNOVFEyTkdZeE1EbGpNV1JrWldNeFlUbGlNRFJrWTJNeU9HWXhOakZoTTJJMk1EVTVZek5qT0RjelkyRmxaU0lzSW1WaE5XRTNNV1ZtT1dGbFlqQm1abVV3WWpBd1pURXhOVGhrWWpobE5UYzVZMk00TVdJM1lqQmxOemt5WWpFelpXWTVZamczTVRaa1ptSXhNemM1TkdJaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyYXdJZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybGpSMFkxWWxkV2RXUkdPV2xOUjFrd1dWZFZNMDU1U1hOSmJsSndZbGRXZW1SSFJuUmpRMGsyVFZSak1rMXFSWGxOZWtrMFRucEJNVTFZTUNJc0ltOXlhV2RwYmlJNkltaDBkSEE2THk5c2IyTmhiR2h2YzNRNk16QXdNQ0lzSW1OeWIzTnpUM0pwWjJsdUlqcG1ZV3h6WlgwIiwiYXV0aGVudGljYXRvckRhdGEiOiJTWllONVlnT2pHaDBOQmNQWkhaZ1c0X2tycm1paGpMSG1Wenp1b01kbDJNZEFBQUFBQSIsInNpZ25hdHVyZSI6Ik1FVUNJUUMyMWZ5TTdncjhNNXE3ZWczZFFvajhvTFVMM2F6Si1JRlg0ZUl5bWZRZzZBSWdIek5KaHM4Ujlidi1fNjJILXBoeU9nR2MtZGljQnR1R1ROak40SURVY3JRIiwidXNlckhhbmRsZSI6InVzcl9jZGI0ZWM4NTFiY2Y0ZjczIn0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY5aU1HWTBZV1UzTnlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTWpFeU16STROekExTVgwIn0sImNhcnRfaGFzaCI6IjAwNDlmZjhjMTkyNTdiZWRkNzU0NjRmMTA5YzFkZGVjMWE5YjA0ZGNjMjhmMTYxYTNiNjA1OWMzYzg3M2NhZWUiLCJwYXltZW50X2hhc2giOiJlYTVhNzFlZjlhZWIwZmZlMGIwMGUxMTU4ZGI4ZTU3OWNjODFiN2IwZTc5MmIxM2VmOWI4NzE2ZGZiMTM3OTRiIn0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_b0f4ae77\", \"cart_mandate_id\": \"cart_a457c43c\", \"intent_mandate_id\": \"intent_f7c34046\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_a457c43c\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_a457c43c\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 475.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.560661Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMDA0OWZmOGMxOTI1N2JlZGQ3NTQ2NGYxMDljMWRkZWMxYTliMDRkY2MyOGYxNjFhM2I2MDU5YzNjODczY2FlZSIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRiYjc1ODMxLWQ5ZmItNDAzOS05MGFjLWU4YWI4ZmE5MzdmMiIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.1hkLWLSt_EfhaJLlXyJwt2jVgG2Nyq1FZ0shwyJNMBrj061HC4RZOggyVmIZyhnu4Kw5A0XKqMqI6El5vVTKig\", \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.560767Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\", \"cart_description\": \"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚ã—ã¾ã—ãŸã€‚\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒ
ãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’
ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.093499Z", "level": "INFO", "logger": "services.merchant_agent.handlers.payment_handler", "message": "\n================================================================================\n[MerchantAgent â†’ PaymentProcessor] A2Aãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è»¢é€\n  URL: http://payment_processor:8004/a2a/message\n  ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID: 240f4ba6-c3c5-4879-b140-709dfc1e6280\n  ã‚¿ã‚¤ãƒ—: ap2.mandates.PaymentMandate\n================================================================================", "module": "payment_handler", "function": "handle_payment_request", "line": 69}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.094158Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Request: POST http://payment_processor:8004/a2a/message", "module": "logger", "function": "log_http_request", "line": 182}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.094567Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://payment_processor:8004/a2a/message\", \"headers\": {}, \"body\": {\"header\": {\"message_id\": \"240f4ba6-c3c5-4879-b140-709dfc1e6280\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:payment_processor\", \"timestamp\": \"2025-11-02T22:41:29.091873Z\", \"nonce\": \"bcf2560abbf3e3f39056559ea399d1452331b9ba9e52f28873ef257e42bcd5a7\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"XZajMtwSRmdIZH0Yc8POG0rCgaemxDVGGwoxQNXuQ/YGHdN0U30AXXeNLZJJzQY9tojLTO6Psbb+oABexFtKDQ==\", \"publicKeyMultibase\": \"z6Mko44YAnz8G71TocDDKoBqg86BJTxnqLN86UvGcpjxP47t\", \"kid\": \"did:ap2:agent:merchant_agent#key-2\", \"created\": \"2025-11-02T22:41:29.091873Z\", \"proofPurpose\": \"authentication\"}}, \"dataPart\": {\"@type\": \"ap2.mandates.PaymentMandate\", \"id\": \"payment_b0f4ae77\", \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_b0f4ae77\", \"payment_details_id\": \"order_16c9c348\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-02T22:41:25.234885Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJOa1lqUmxZemcxTVdKalpqUm1Oek1pTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMk5rWWpSbFl6ZzFNV0pqWmpSbU56TWlMQ0pwWVhRaU9qRTNOakl4TWpNeU9Ea3NJbVY0Y0NJNk1UYzJNakV5TXpVNE9Td2libUptSWpveE56WXlNVEl6TWpnNUxDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaU5tUTBPVkF6Y25WaGFXMTVSV0ZZZFRGUGFtNWplVmw1VVZRNWRHcHlPVnB0TmpWcmMyUktXbXhwY3lJc0lua2lPaUpLYWpkVlkxQm1hREJOWVZGd1RuaEJOV0puYlhSYVVGUlhhVGhaVmxBMGVEUkRPR2wyY1RoU1JrUlJJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUp4VmtGUlpWOU9UblIyWVZKc1FXSlhjVGN5YW1SV2JGYzBOa2hRVTBRNVNVSklhMnh6Y0ZwSExWOXpJaXdpYVdGMElqb3hOell5TVRJek1qZzVMQ0p6WkY5b1lYTm9Jam9pTmpGa04yWm1PVE14T1RkbFpUTXdORFJsWmpnNU56WTROVEE0WkdWaFpXVXlOVFU1WTJZNE5qTXdZbVZoWlRjd09UaGhPR1k1WVRjMFltUTBNMkk1TnlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lNREEwT1dabU9HTXhPVEkxTjJKbFpHUTNOVFEyTkdZeE1EbGpNV1JrWldNeFlUbGlNRFJrWTJNeU9HWXhOakZoTTJJMk1EVTVZek5qT0RjelkyRmxaU0lzSW1WaE5XRTNNV1ZtT1dGbFlqQm1abVV3WWpBd1pURXhOVGhrWWpobE5UYzVZMk00TVdJM1lqQmxOemt5WWpFelpXWTVZamczTVRaa1ptSXhNemM1TkdJaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyYXdJZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybGpSMFkxWWxkV2RXUkdPV2xOUjFrd1dWZFZNMDU1U1hOSmJsSndZbGRXZW1SSFJuUmpRMGsyVFZSak1rMXFSWGxOZWtrMFRucEJNVTFZTUNJc0ltOXlhV2RwYmlJNkltaDBkSEE2THk5c2IyTmhiR2h2YzNRNk16QXdNQ0lzSW1OeWIzTnpUM0pwWjJsdUlqcG1ZV3h6WlgwIiwiYXV0aGVudGljYXRvckRhdGEiOiJTWllONVlnT2pHaDBOQmNQWkhaZ1c0X2tycm1paGpMSG1Wenp1b01kbDJNZEFBQUFBQSIsInNpZ25hdHVyZSI6Ik1FVUNJUUMyMWZ5TTdncjhNNXE3ZWczZFFvajhvTFVMM2F6Si1JRlg0ZUl5bWZRZzZBSWdIek5KaHM4Ujlidi1fNjJILXBoeU9nR2MtZGljQnR1R1ROak40SURVY3JRIiwidXNlckhhbmRsZSI6InVzcl9jZGI0ZWM4NTFiY2Y0ZjczIn0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY5aU1HWTBZV1UzTnlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTWpFeU16STROekExTVgwIn0sImNhcnRfaGFzaCI6IjAwNDlmZjhjMTkyNTdiZWRkNzU0NjRmMTA5YzFkZGVjMWE5YjA0ZGNjMjhmMTYxYTNiNjA1OWMzYzg3M2NhZWUiLCJwYXltZW50X2hhc2giOiJlYTVhNzFlZjlhZWIwZmZlMGIwMGUxMTU4ZGI4ZTU3OWNjODFiN2IwZTc5MmIxM2VmOWI4NzE2ZGZiMTM3OTRiIn0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_b0f4ae77\", \"cart_mandate_id\": \"cart_a457c43c\", \"intent_mandate_id\": \"intent_f7c34046\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_a457c43c\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_a457c43c\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 475.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.560661Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMDA0OWZmOGMxOTI1N2JlZGQ3NTQ2NGYxMDljMWRkZWMxYTliMDRkY2MyOGYxNjFhM2I2MDU5YzNjODczY2FlZSIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRiYjc1ODMxLWQ5ZmItNDAzOS05MGFjLWU4YWI4ZmE5MzdmMiIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.1hkLWLSt_EfhaJLlXyJwt2jVgG2Nyq1FZ0shwyJNMBrj061HC4RZOggyVmIZyhnu4Kw5A0XKqMqI6El5vVTKig\", \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.560767Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\", \"cart_description\": \"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚ã—ã¾ã—ãŸã€‚\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}, \"kind\": null, \"artifact\": null}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_payment_processor      | [2025-11-02 22:41:29,225] INFO in common.base_agent:
ap2_payment_processor      | ================================================================================
ap2_payment_processor      | [Payment Processor] A2Aã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: POST /a2a/message
ap2_payment_processor      |   å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ID=240f4ba6-c3c5-4879-b140-709dfc1e6280
ap2_payment_processor      |   é€ä¿¡å…ƒ: did:ap2:agent:merchant_agent
ap2_payment_processor      |   ã‚¿ã‚¤ãƒ—: ap2.mandates.PaymentMandate
ap2_payment_processor      | ================================================================================
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.225881Z", "level": "INFO", "logger": "common.a2a_handler", "message": "A2A Message received to/from did:ap2:agent:merchant_agent: ap2.mandates.PaymentMandate", "module": "logger", "function": "log_a2a_message", "line": 250}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.226112Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"received\", \"message_type\": \"ap2.mandates.PaymentMandate\", \"peer\": \"did:ap2:agent:merchant_agent\", \"headers\": {\"message_id\": \"240f4ba6-c3c5-4879-b140-709dfc1e6280\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:payment_processor\", \"timestamp\": \"2025-11-02T22:41:29.091873Z\", \"nonce\": \"bcf2560abbf3e3f39056559ea399d1452331b9ba9e52f28873ef257e42bcd5a7\", \"schema_version\": \"0.2\"}, \"payload\": {\"payment_mandate\": {\"payment_mandate_contents\": {\"payment_mandate_id\": \"payment_b0f4ae77\", \"payment_details_id\": \"order_16c9c348\", \"payment_details_total\": {\"label\": \"Total\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}, \"payment_response\": {\"methodName\": \"basic-card\", \"details\": {\"cardNumber\": \"****1111\", \"cardSecurityCode\": \"***\", \"cardBrand\": \"Visa\", \"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"tokenized\": true}}, \"merchant_agent\": \"did:ap2:merchant:mugibo_merchant\", \"timestamp\": \"2025-11-02T22:41:25.234885Z\"}, \"user_authorization\": \"eyJpc3N1ZXJfand0IjoiZXlKaGJHY2lPaUpGVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKa2FXUTZZWEF5T25WelpYSTZkWE55WDJOa1lqUmxZemcxTVdKalpqUm1Oek1pTENKemRXSWlPaUprYVdRNllYQXlPblZ6WlhJNmRYTnlYMk5rWWpSbFl6ZzFNV0pqWmpSbU56TWlMQ0pwWVhRaU9qRTNOakl4TWpNeU9Ea3NJbVY0Y0NJNk1UYzJNakV5TXpVNE9Td2libUptSWpveE56WXlNVEl6TWpnNUxDSmpibVlpT25zaWFuZHJJanA3SW10MGVTSTZJa1ZESWl3aVkzSjJJam9pVUMweU5UWWlMQ0o0SWpvaU5tUTBPVkF6Y25WaGFXMTVSV0ZZZFRGUGFtNWplVmw1VVZRNWRHcHlPVnB0TmpWcmMyUktXbXhwY3lJc0lua2lPaUpLYWpkVlkxQm1hREJOWVZGd1RuaEJOV0puYlhSYVVGUlhhVGhaVmxBMGVEUkRPR2wyY1RoU1JrUlJJbjE5ZlEiLCJrYl9qd3QiOiJleUpoYkdjaU9pSkZVekkxTmlJc0luUjVjQ0k2SW10aUsycDNkQ0o5LmV5SmhkV1FpT2lKa2FXUTZZWEF5T21GblpXNTBPbkJoZVcxbGJuUmZjSEp2WTJWemMyOXlJaXdpYm05dVkyVWlPaUp4VmtGUlpWOU9UblIyWVZKc1FXSlhjVGN5YW1SV2JGYzBOa2hRVTBRNVNVSklhMnh6Y0ZwSExWOXpJaXdpYVdGMElqb3hOell5TVRJek1qZzVMQ0p6WkY5b1lYTm9Jam9pTmpGa04yWm1PVE14T1RkbFpUTXdORFJsWmpnNU56WTROVEE0WkdWaFpXVXlOVFU1WTJZNE5qTXdZbVZoWlRjd09UaGhPR1k1WVRjMFltUTBNMkk1TnlJc0luUnlZVzV6WVdOMGFXOXVYMlJoZEdFaU9sc2lNREEwT1dabU9HTXhPVEkxTjJKbFpHUTNOVFEyTkdZeE1EbGpNV1JrWldNeFlUbGlNRFJrWTJNeU9HWXhOakZoTTJJMk1EVTVZek5qT0RjelkyRmxaU0lzSW1WaE5XRTNNV1ZtT1dGbFlqQm1abVV3WWpBd1pURXhOVGhrWWpobE5UYzVZMk00TVdJM1lqQmxOemt5WWpFelpXWTVZamczTVRaa1ptSXhNemM1TkdJaVhYMCIsIndlYmF1dGhuX2Fzc2VydGlvbiI6eyJpZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyYXdJZCI6ImRDRFFkR2xxeDUwRy1VRldwME9Sc0Y1WTdteldTQWtZb3ciLCJyZXNwb25zZSI6eyJjbGllbnREYXRhSlNPTiI6ImV5SjBlWEJsSWpvaWQyVmlZWFYwYUc0dVoyVjBJaXdpWTJoaGJHeGxibWRsSWpvaVpYbEtkRmxYTld0WldGSnNXREpzYTBscWIybGpSMFkxWWxkV2RXUkdPV2xOUjFrd1dWZFZNMDU1U1hOSmJsSndZbGRXZW1SSFJuUmpRMGsyVFZSak1rMXFSWGxOZWtrMFRucEJNVTFZTUNJc0ltOXlhV2RwYmlJNkltaDBkSEE2THk5c2IyTmhiR2h2YzNRNk16QXdNQ0lzSW1OeWIzTnpUM0pwWjJsdUlqcG1ZV3h6WlgwIiwiYXV0aGVudGljYXRvckRhdGEiOiJTWllONVlnT2pHaDBOQmNQWkhaZ1c0X2tycm1paGpMSG1Wenp1b01kbDJNZEFBQUFBQSIsInNpZ25hdHVyZSI6Ik1FVUNJUUMyMWZ5TTdncjhNNXE3ZWczZFFvajhvTFVMM2F6Si1JRlg0ZUl5bWZRZzZBSWdIek5KaHM4Ujlidi1fNjJILXBoeU9nR2MtZGljQnR1R1ROak40SURVY3JRIiwidXNlckhhbmRsZSI6InVzcl9jZGI0ZWM4NTFiY2Y0ZjczIn0sInR5cGUiOiJwdWJsaWMta2V5IiwiYXR0ZXN0YXRpb25fdHlwZSI6InBhc3NrZXkiLCJjaGFsbGVuZ2UiOiJleUp0WVc1a1lYUmxYMmxrSWpvaWNHRjViV1Z1ZEY5aU1HWTBZV1UzTnlJc0luUnBiV1Z6ZEdGdGNDSTZNVGMyTWpFeU16STROekExTVgwIn0sImNhcnRfaGFzaCI6IjAwNDlmZjhjMTkyNTdiZWRkNzU0NjRmMTA5YzFkZGVjMWE5YjA0ZGNjMjhmMTYxYTNiNjA1OWMzYzg3M2NhZWUiLCJwYXltZW50X2hhc2giOiJlYTVhNzFlZjlhZWIwZmZlMGIwMGUxMTU4ZGI4ZTU3OWNjODFiN2IwZTc5MmIxM2VmOWI4NzE2ZGZiMTM3OTRiIn0\", \"agent_involved\": true, \"transaction_type\": \"human_present\", \"id\": \"payment_b0f4ae77\", \"cart_mandate_id\": \"cart_a457c43c\", \"intent_mandate_id\": \"intent_f7c34046\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"payee_id\": \"did:ap2:merchant:mugibo_merchant\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}, \"payment_method\": {\"type\": \"basic-card\", \"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"last4\": \"1111\", \"brand\": \"Visa\"}, \"risk_score\": 2, \"fraud_indicators\": []}, \"cart_mandate\": {\"contents\": {\"id\": \"cart_a457c43c\", \"user_cart_confirmation_required\": true, \"payment_request\": {\"method_data\": [{\"supported_methods\": \"basic-card\", \"data\": {\"supportedNetworks\": [\"visa\", \"mastercard\", \"jcb\", \"amex\"], \"supportedTypes\": [\"credit\", \"debit\"]}}, {\"supported_methods\": \"https://a2a-protocol.org/payment-methods/ap2-payment\", \"data\": {\"version\": \"0.2\", \"processor\": \"did:ap2:agent:payment_processor\", \"supportedMethods\": [\"credential-based\", \"attestation-based\"]}}], \"details\": {\"id\": \"cart_a457c43c\", \"display_items\": [{\"label\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"amount\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"amount\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"amount\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"amount\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"refund_period\": 2592000}, {\"label\": \"æ¶ˆè²»ç¨Žï¼ˆ10%ï¼‰\", \"amount\": {\"value\": 475.0, \"currency\": \"JPY\"}, \"refund_period\": 0}, {\"label\": \"é€æ–™\", \"amount\": {\"value\": 500.0, \"currency\": \"JPY\"}, \"refund_period\": 0}], \"total\": {\"label\": \"åˆè¨ˆ\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}}, \"options\": {\"request_payer_name\": true, \"request_payer_email\": true, \"request_payer_phone\": false, \"request_shipping\": true, \"shipping_type\": \"shipping\"}, \"shipping_address\": {\"recipient\": \"ã‚\", \"postal_code\": \"ã‚\", \"city\": \"ã‚\", \"region\": \"ã‚\", \"address_line1\": \"ã‚\", \"country\": \"ã‚\"}}, \"cart_expiry\": \"2025-11-02T23:41:01.560661Z\", \"merchant_name\": \"ã‚€ãŽã¼ãƒ¼ã‚·ãƒ§ãƒƒãƒ—\"}, \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50I2tleS0xIiwidHlwIjoiSldUIn0.eyJhdWQiOiJkaWQ6YXAyOmFnZW50OnBheW1lbnRfcHJvY2Vzc29yIiwiY2FydF9oYXNoIjoiMDA0OWZmOGMxOTI1N2JlZGQ3NTQ2NGYxMDljMWRkZWMxYTliMDRkY2MyOGYxNjFhM2I2MDU5YzNjODczY2FlZSIsImV4cCI6MTc2MjEyNjg2MSwiaWF0IjoxNzYyMTIzMjYxLCJpc3MiOiJkaWQ6YXAyOm1lcmNoYW50Om11Z2lib19tZXJjaGFudCIsImp0aSI6ImRiYjc1ODMxLWQ5ZmItNDAzOS05MGFjLWU4YWI4ZmE5MzdmMiIsInN1YiI6ImRpZDphcDI6bWVyY2hhbnQ6bXVnaWJvX21lcmNoYW50In0.1hkLWLSt_EfhaJLlXyJwt2jVgG2Nyq1FZ0shwyJNMBrj061HC4RZOggyVmIZyhnu4Kw5A0XKqMqI6El5vVTKig\", \"_metadata\": {\"intent_mandate_id\": \"intent_f7c34046\", \"merchant_id\": \"did:ap2:merchant:mugibo_merchant\", \"created_at\": \"2025-11-02T22:41:01.560767Z\", \"cart_name\": \"ã‚³ã‚¹ãƒ‘æœ€å„ªå…ˆãƒ—ãƒ©ãƒ³ (4,750å††)\", \"cart_description\": \"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚ã—ã¾ã—ãŸã€‚\", \"raw_items\": [{\"product_id\": \"286acdd4-d1c1-4860-b06a-f87d2f916a8d\", \"name\": \"ã‚€ãŽã¼ãƒ¼ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼\", \"description\": \"ã‹ã‚ã„ã„ã‚€ãŽã¼ãƒ¼ã®ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚ãƒãƒƒã‚°ã‚„ãƒãƒ¼ãƒã«ä»˜ã‘ã¦æŒã¡
æ­©ã‘ã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 800.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"1d9f08d9-51a9-491e-810b-f0e225ef4f59\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒžã‚°ã‚«ãƒƒãƒ—\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚ŒãŸã‹ã‚ã„ã„ãƒžã‚°ã‚«ãƒƒãƒ—ã€‚æ¯Žæ—¥ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ãŒæ¥½ã—ããªã‚Šã¾ã™ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1200.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"c688d6ef-615f-43f7-87ce-05568ae4e63c\", \"name\": \"ã‚€ãŽã¼ãƒ¼é´ä¸‹\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã§å…¥ã£ãŸã‹ã‚ã„ã„é´ä¸‹ã€‚ã‚„ã‚ã‚‰ã‹ã„å±¥ãå¿ƒåœ°ã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 850.0, \"currency\": \"JPY\"}, \"image_url\": null}, {\"product_id\": \"6a169d3a-ca5a-4575-a08b-3fb659c628ed\", \"name\": \"ã‚€ãŽã¼ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿\", \"description\": \"ã‚€ãŽã¼ãƒ¼ãŒä¸­å¤®ã«æã‹ã‚ŒãŸé™¶å™¨ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚é£Ÿå“ã‚’ã‹ã‚ã„ãæ¼”å‡ºã€‚\", \"quantity\": 1, \"unit_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"total_price\": {\"value\": 1900.0, \"currency\": \"JPY\"}, \"image_url\": null}]}}}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.226489Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "[A2AHandler] Nonce validation successful: nonce=bcf2560abbf3e3f3...", "module": "a2a_handler", "function": "verify_message_signature", "line": 156}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.232062Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "[A2AHandler] Using DID-resolved public key for verification: kid=did:ap2:agent:merchant_agent#key-2", "module": "a2a_handler", "function": "verify_message_signature", "line": 190}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.234035Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying A2A message signature", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1023}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.236695Z", "level": "DEBUG", "logger": "common.crypto", "message": "[VERIFY] Canonical JSON length: 7030, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.mandates.PaymentMandate\",\"id\":\"payment_b0f4ae77\",\"payload\":{\"cart_mandate\":{\"_metadata\":{\"cart_description\":\"ä¾¡æ ¼ã¨ã‹ã‚ã„ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸ4ç‚¹ã‚»ãƒƒãƒˆã€‚ã‚­
ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ»ãƒžã‚°ã‚«ãƒƒãƒ—ãƒ»é´ä¸‹ãƒ»ãƒ—ãƒ¬ãƒ¼ãƒˆçš¿ã‚’çµ„ã¿åˆã‚ã›ã¦ã€äºˆç®—å†…ã§æœ€å¤§ã®æº€è¶³åº¦ã‚’è¿½æ±‚", "module": "crypto", "function": "verify_a2a_message_signature", "line": 1027}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.236781Z", "level": "DEBUG", "logger": "common.crypto", "message": "Verifying signature (algorithm: ED25519)", "module": "crypto", "function": "verify_signature", "line": 857}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.242660Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto VERIFY: ED25519 (key: did:ap2:agent:merchant_agent#key-2) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.242775Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2AHandler] proofç½²åæ¤œè¨¼æˆåŠŸ: sender=did:ap2:agent:merchant_agent, alg=ed25519, kid=did:ap2:agent:merchant_agent#key-2, public_key_source=DID-resolved", "module": "a2a_handler", "function": "verify_message_signature", "line": 221}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.242838Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2Aå‡¦ç†] ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè¡Œä¸­: type=ap2.mandates.PaymentMandate, from=did:ap2:agent:merchant_agent", "module": "a2a_handler", "function": "handle_message", "line": 299}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.242985Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] Received PaymentMandate", "module": "processor", "function": "handle_payment_mandate", "line": 406}
ap2_payment_processor      | [2025-11-02 22:41:29,243] INFO in services.payment_processor.utils.mandate_helpers: [PaymentProcessor] PaymentMandate validation passed: payment_b0f4ae77, user_authorization present: eyJpc3N1ZXJfand0Ijoi...
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.243377Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] Mandate chain validation: PaymentMandate(payment_b0f4ae77) â†’ CartMandate(cart_a457c43c)", "module": "processor", "function": "_validate_mandate_chain", "line": 671}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.244116Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] Verifying SD-JWT-VC user_authorization: cart_hash=0049ff8c19257bed..., payment_hash=ea5a71ef9aeb0ffe...", "module": "processor", "function": "_validate_mandate_chain", "line": 688}
ap2_payment_processor      | [2025-11-02 22:41:29,244] INFO in common.user_authorization: [verify_user_authorization_vp] Decoded VP successfully
ap2_payment_processor      | [2025-11-02 22:41:29,244] INFO in common.user_authorization: [verify_user_authorization_vp] Hash verification passed: cart_hash=0049ff8c19257bed..., payment_hash=ea5a71ef9aeb0ffe...
ap2_payment_processor      | [2025-11-02 22:41:29,247] INFO in common.user_authorization: [verify_user_authorization_vp] âœ“ WebAuthn signature verified successfully
ap2_payment_processor      | [2025-11-02 22:41:29,248] INFO in common.user_authorization: [verify_user_authorization_vp] Key-binding JWT payload verified
ap2_payment_processor      | [2025-11-02 22:41:29,248] INFO in common.user_authorization: [verify_user_authorization_vp] âœ“ VP verification passed
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.248128Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] âœ“ SD-JWT-VC user_authorization verified: cart_hash_match=True, payment_hash_match=True, webauthn_signature_verified=True", "module": "processor", "function": "_validate_mandate_chain", "line": 701}
ap2_payment_processor      | [2025-11-02 22:41:29,248] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­: /app/data/did_documents/shopping_agent_did.json
ap2_payment_processor      | [2025-11-02 22:41:29,249] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:shopping_agent
ap2_payment_processor      | [2025-11-02 22:41:29,250] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/data/did_documents/merchant_agent_did.json
ap2_payment_processor      | [2025-11-02 22:41:29,250] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:merchant_agent
ap2_payment_processor      | [2025-11-02 22:41:29,250] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/data/did_documents/merchant_did.json
ap2_payment_processor      | [2025-11-02 22:41:29,251] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:merchant:mugibo_merchant
ap2_payment_processor      | [2025-11-02 22:41:29,251] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/data/did_documents/credential_provider_did.json
ap2_payment_processor      | [2025-11-02 22:41:29,251] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp
ap2_payment_processor      | [2025-11-02 22:41:29,251] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/data/did_documents/credential_provider_2_did.json
ap2_payment_processor      | [2025-11-02 22:41:29,252] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:cp:demo_cp_2
ap2_payment_processor      | [2025-11-02 22:41:29,252] INFO in common.did_resolver: [DIDResolver] æ°¸ç¶šåŒ–ã•ã‚ŒãŸDIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­
ã¿è¾¼ã¿ä¸­: /app/data/did_documents/payment_processor_did.json
ap2_payment_processor      | [2025-11-02 22:41:29,252] INFO in common.did_resolver: [DIDResolver] âœ“ æ°¸ç¶šåŒ–DIDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç™»éŒ²: did:ap2:agent:payment_processor
ap2_payment_processor      | [2025-11-02 22:41:29,253] INFO in services.payment_processor.utils.jwt_helpers: [_verify_jwt_signature] âœ“ JWT signature verified successfully (RFC 7515 compliant)
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.253579Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[_verify_merchant_authorization_jwt] JWT validation passed: iss=did:ap2:merchant:mugibo_merchant, exp=1762126861, jti=dbb75831-d9fb-40..., cart_hash=0049ff8c19257bed...", "module": "processor", "function": "_verify_merchant_authorization_jwt", "line": 613}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.253634Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] merchant_authorization JWT verified: iss=did:ap2:merchant:mugibo_merchant", "module": "processor", "function": "_validate_mandate_chain", "line": 725}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.253645Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] CartMandate hash in merchant_authorization: 0049ff8c19257bed...", "module": "processor", "function": "_validate_mandate_chain", "line": 733}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.253851Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] âœ“ CartMandate hash verified (merchant_authorization): 0049ff8c19257bed...", "module": "processor", "function": "_validate_mandate_chain", "line": 750}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.254085Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] Mandate chain validation passed", "module": "processor", "function": "_validate_mandate_chain", "line": 782}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.254235Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] Processing payment (mock): txn_eef27435727f", "module": "processor", "function": "_process_payment_mock", "line": 801}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.254267Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] Verifying credential with Credential Provider: token=tok_630bfc60_KIFXWcg...", "module": "processor", "function": "_verify_credential_with_cp", "line": 916}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.254883Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "HTTP Request: POST http://credential_provider:8003/credentials/verify", "module": "logger", "function": "log_http_request", "line": 182}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.254914Z", "level": "DEBUG", "logger": "services.payment_processor.processor", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/credentials/verify\", \"headers\": {}, \"body\": {\"token\": \"tok_630bfc60_KIFXWcgI9cgAzkwFQfHTZT-M\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:29.276841Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[verify_credentials] Verifying token for payer: usr_cdb4ec851bcf4f73", "module": "provider", "function": "verify_credentials", "line": 1612}
ap2_credential_provider    | {"timestamp": "2025-11-02T22:41:29.279411Z", "level": "INFO", "logger": "services.credential_provider.provider", "message": "[verify_credentials] Token verified: payment_method_id=pm_f4745ec2, user_id=usr_cdb4ec851bcf4f73", "module": "provider", "function": "verify_credentials", "line": 1649}
ap2_credential_provider    | INFO:     172.18.0.10:34278 - "POST /credentials/verify HTTP/1.1" 200 OK
ap2_payment_processor      | [2025-11-02 22:41:29,283] INFO in httpx: HTTP Request: POST http://credential_provider:8003/credentials/verify "HTTP/1.1 200 OK"
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.284256Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "HTTP Response: 200 (29.31ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.284325Z", "level": "DEBUG", "logger": "services.payment_processor.processor", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:41:29 GMT\", \"server\": \"uvicorn\", \"content-length\": \"186\", \"content-type\": \"application/json\"}, \"body\": {\"verified\": true, \"credential_info\": {\"payment_method_id\": \"pm_f4745ec2\", \"type\": \"basic-card\", \"brand\": \"Visa\", \"last4\": \"1111\", \"holder_name\": \"Unknown\", \"expiry_month\": \"02\", \"expiry_year\": \"2028\"}}, \"duration_ms\": 29.308795928955078}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.284410Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] Credential verification succeeded: payment_method_id=pm_f4745ec2", "module": "processor", "function": "_verify_credential_with_cp", "line": 951}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.284437Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] Credential verified: pm_f4745ec2", "module": "processor", "function": "_process_payment_mock", "line": 824}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.284450Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] Risk assessment: score=2, indicators=[]", "module": "processor", "function": "_process_payment_mock", "line": 839}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.284610Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] Payment succeeded: txn_eef27435727f, amount={'value': 5725.0, 'currency': 'JPY'}, risk_score=2", "module": "processor", "function": "_process_payment_mock", "line": 873}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.329352Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] Transaction saved: txn_eef27435727f", "module": "processor", "function": "_save_transaction", "line": 900}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.481666Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] Generated user name for receipt: User usr_cdb4 (payer_id: usr_cdb4ec851bcf4f73)", "module": "processor", "function": "_generate_receipt", "line": 1101}
ap2_payment_processor      | [2025-11-02 22:41:29,481] INFO in common.receipt_generator: [ReceiptGenerator] Generating PDF receipt for transaction: txn_eef27435727f
ap2_payment_processor      | [2025-11-02 22:41:29,484] INFO in common.receipt_generator: [ReceiptGenerator] PDF receipt generated successfully
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.486287Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] Generated receipt PDF: /app/v2/data/receipts/txn_eef27435727f.pdf", "module": "processor", "function": "_generate_receipt", "line": 1120}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.491988Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] Receipt record saved to database: txn_eef27435727f", "module": "processor", "function": "_generate_receipt", "line": 1139}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.492201Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] Sending receipt notification to Credential Provider: transaction_id=txn_eef27435727f, payer_id=usr_cdb4ec851bcf4f73", "module": "processor", "function": "_send_receipt_to_credential_provider", "line": 980}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.492361Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "HTTP Request: POST http://credential_provider:8003/receipts", "module": "logger", "function": "log_http_request", "line": 182}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.492398Z", "level": "DEBUG", "logger": "services.payment_processor.processor", "message": "HTTP_REQUEST_RAW: {\"type\": \"HTTP_REQUEST\", \"method\": \"POST\", \"url\": \"http://credential_provider:8003/receipts\", \"headers\": {}, \"body\": {\"transaction_id\": \"txn_eef27435727f\", \"receipt_url\": \"http://localhost:8004/receipts/txn_eef27435727f.pdf\", \"payer_id\": \"usr_cdb4ec851bcf4f73\", \"amount\": {\"value\": 5725.0, \"currency\": \"JPY\"}, \"timestamp\": \"2025-11-02T22:41:29.492333Z\"}}", "module": "logger", "function": "log_http_request", "line": 193}
ap2_credential_provider    | [2025-11-02 22:41:29,504] INFO in services.credential_provider.utils.receipt_helpers: [CredentialProvider] Receipt received and stored to DB: transaction_id=txn_eef27435727f, payer_id=usr_cdb4ec851bcf4f73, receipt_url=http://localhost:8004/receipts/txn_eef27435727f.pdf
ap2_credential_provider    | INFO:     172.18.0.10:34278 - "POST /receipts HTTP/1.1" 200 OK
ap2_payment_processor      | [2025-11-02 22:41:29,504] INFO in httpx: HTTP Request: POST http://credential_provider:8003/receipts "HTTP/1.1 200 OK"
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.505186Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "HTTP Response: 200 (12.80ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.505224Z", "level": "DEBUG", "logger": "services.payment_processor.processor", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:41:29 GMT\", \"server\": \"uvicorn\", \"content-length\": \"97\", \"content-type\": \"application/json\"}, \"body\": {\"status\": \"received\", \"message\": \"Receipt stored successfully\", \"transaction_id\": \"txn_eef27435727f\"}, \"duration_ms\": 12.80069351196289}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.505296Z", "level": "INFO", "logger": "services.payment_processor.processor", "message": "[PaymentProcessor] Receipt notification sent successfully: transaction_id=txn_eef27435727f, status=200", "module": "processor", "function": "_send_receipt_to_credential_provider", "line": 1011}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.505342Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2Aå‡¦ç†] ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Œäº†: type=ap2.mandates.PaymentMandate, result_type=ap2.responses.PaymentResult", "module": "a2a_handler", "function": "handle_message", "line": 307}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.505489Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: payment_processor, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 995}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.505561Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 521, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.responses.PaymentResult\",\"id\":\"43087989-f9c4-4ea0-ae5e-7f2889f80ac2\",\"payload\":{\"receipt_url\":\"http://localhost:8004/receipts/txn_eef27435727f.pdf\",\"status\":\"captured\",\"trans", "module": "crypto", "function": "sign_a2a_message", "line": 999}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.505584Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: payment_processor, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 794}


ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.505753Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: payment_processor) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.508392Z", "level": "INFO", "logger": "services.merchant_agent.agent", "message": "HTTP Response: 200 (414.27ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.511979Z", "level": "INFO", "logger": "services.shopping_agent.agent", "message": "HTTP Response: 200 (448.42ms)", "module": "logger", "function": "log_http_response", "line": 215}
ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.505881Z", "level": "INFO", "logger": "common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:merchant_agent: ap2.responses.PaymentResult", "module": "logger", "function": "log_a2a_message", "line": 250}




ap2_payment_processor      | {"timestamp": "2025-11-02T22:41:29.505905Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.responses.PaymentResult\", \"peer\": \"did:ap2:agent:merchant_agent\", \"headers\": {\"message_id\": \"93e1fe53-964c-4977-b277-3aeaaab6d8f1\", \"sender\": \"did:ap2:agent:payment_processor\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-02T22:41:29.505373Z\", \"nonce\": \"28bc1bd28880d8487a5c241cd35f6391b2ed074b44bc262503b9ac6026e6f598\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"transaction_id\": \"txn_eef27435727f\", \"status\": \"captured\", \"receipt_url\": \"http://localhost:8004/receipts/txn_eef27435727f.pdf\"}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.508447Z", "level": "DEBUG", "logger": "services.merchant_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:41:28 GMT\", \"server\": \"uvicorn\", \"content-length\": \"879\", \"content-type\": \"application/json\"}, \"body\": {\"header\": {\"message_id\": \"93e1fe53-964c-4977-b277-3aeaaab6d8f1\", \"sender\": \"did:ap2:agent:payment_processor\", \"recipient\": \"did:ap2:agent:merchant_agent\", \"timestamp\": \"2025-11-02T22:41:29.505373Z\", \"nonce\": \"28bc1bd28880d8487a5c241cd35f6391b2ed074b44bc262503b9ac6026e6f598\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"l4PeE9yhPo682Sl5fOd3KxyJo9siUC6yiPfWKteBPHiSJZucWqciHayTSz+hFRpm0n2g50iMdgDwswEF6X0kDA==\", \"publicKeyMultibase\": \"z6Mkrp3WoDtv4hEohzavLc3A1Dt1aD1HtSCkpQR3ay98ZLYv\", \"kid\": \"did:ap2:agent:payment_processor#key-2\", \"created\": \"2025-11-02T22:41:29.505373Z\", \"proofPurpose\": \"authentication\"}}, \"dataPart\": {\"@type\": \"ap2.responses.PaymentResult\", \"id\": \"43087989-f9c4-4ea0-ae5e-7f2889f80ac2\", \"payload\": {\"transaction_id\": \"txn_eef27435727f\", \"status\": \"captured\", \"receipt_url\": \"http://localhost:8004/receipts/txn_eef27435727f.pdf\"}, \"kind\": null, \"artifact\": null}}, \"duration_ms\": 414.27040100097656}", "module": "logger", "function": "log_http_response", "line": 226}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.512078Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "HTTP_RESPONSE_RAW: {\"type\": \"HTTP_RESPONSE\", \"status_code\": 200, \"headers\": {\"date\": \"Sun, 02 Nov 2025 22:41:28 GMT\", \"server\": \"uvicorn\", \"content-length\": \"873\", \"content-type\": \"application/json\"}, \"body\": {\"header\": {\"message_id\": \"c554915e-3c39-4e9e-bfee-6772e6a1800e\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:shopping_agent\", \"timestamp\": \"2025-11-02T22:41:29.508712Z\", \"nonce\": \"ba33b36e674bbfdb65734117984e70d1b3ea115bab0617d1d7a0cb4ed22fed21\", \"schema_version\": \"0.2\", \"proof\": {\"algorithm\": \"ed25519\", \"signatureValue\": \"S3ot9WDGfgsPr81GmhaNpudMcptuz7Sf5F6EgyjNOU01tBNfBnpAFNDm7eB/XXFlkO76teYoFJ5EX4FgITeeBA==\", \"publicKeyMultibase\": \"z6Mko44YAnz8G71TocDDKoBqg86BJTxnqLN86UvGcpjxP47t\", \"kid\": \"did:ap2:agent:merchant_agent#key-2\", \"created\": \"2025-11-02T22:41:29.508712Z\", \"proofPurpose\": \"authentication\"}}, \"dataPart\": {\"@type\": \"ap2.responses.PaymentResult\", \"id\": \"43087989-f9c4-4ea0-ae5e-7f2889f80ac2\", \"payload\": {\"transaction_id\": \"txn_eef27435727f\", \"status\": \"captured\", \"receipt_url\": \"http://localhost:8004/receipts/txn_eef27435727f.pdf\"}, \"kind\": null, \"artifact\": null}}, \"duration_ms\": 448.42028617858887}", "module": "logger", "function": "log_http_response", "line": 226}




ap2_payment_processor      | [2025-11-02 22:41:29,505] INFO in common.base_agent: [Payment Processor] A2Aãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´: type=ap2.responses.PaymentResult, to=did:ap2:agent:merchant_agent


ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.508580Z", "level": "INFO", "logger": "services.merchant_agent.handlers.payment_handler", "message": "\n================================================================================\n[MerchantAgent â† PaymentProcessor] A2Aãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡\n  Status: 200\n  Response Body: {\n  \"header\": {\n    \"message_id\": \"93e1fe53-964c-4977-b277-3aeaaab6d8f1\",\n    \"sender\": \"did:ap2:agent:payment_processor\",\n    \"recipient\": \"did:ap2:agent:merchant_agent\",\n    \"timestamp\": \"2025-11-02T22:41:29.505373Z\",\n    \"nonce\": \"28bc1bd28880d8487a5c241cd35f6391b2ed074b44bc262503b9ac6026e6f598\",\n    \"schema_version\": \"0.2\",\n    \"proof\": {\n      \"algorithm\": \"ed25519\",\n      \"signatureValue\": \"l4PeE9yhPo682Sl5fOd3KxyJo9siUC6yiPfWKteBPHiSJZucWqciHayTSz+hFRpm0n2g50iMdgDwswEF6X0kDA==\",\n      \"publicKeyMultibase\": \"z6Mkrp3WoDtv4hEohzavLc3A1Dt1aD1HtSCkpQR3ay98ZLYv\",\n      \"kid\": \"did:ap2:agent:payment_processor#key-2\",\n      \"created\": \"2025-11-02T22:41:29.505373Z\",\n      \"proofPurpose\": \"authentication\"\n    }\n  },\n  \"dataPart\": {\n    \"@type\": \"ap2.responses.PaymentResult\",\n    \"id\": \"43087989-f9c4-4ea0-ae5e-7f2889f80ac2\",\n    \"payload\": {\n      \"transaction_id\": \"txn_eef27435727f\",\n      \"status\": \"captured\",\n      \"receipt_url\": \"http://localhost:8004/receipts/txn_eef27435727f.pdf\"\n    },\n    \"kind\": null,\n    \"artifact\": null\n  }\n}\n================================================================================", "module": "payment_handler", "function": "handle_payment_request", "line": 86}
ap2_payment_processor      | INFO:     172.18.0.8:44058 - "POST /a2a/message HTTP/1.1" 200 OK


ap2_shopping_agent         | [2025-11-02 22:41:29,512] INFO in services.shopping_agent.utils.merchant_integration:
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.508629Z", "level": "INFO", "logger": "services.merchant_agent.handlers.payment_handler", "message": "[MerchantAgent] Payment processing completed, forwarding result to Shopping Agent", "module": "payment_handler", "function": "handle_payment_request", "line": 101}




ap2_shopping_agent         | ================================================================================
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.508688Z", "level": "INFO", "logger": "common.a2a_handler", "message": "[A2Aå‡¦ç†] ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Œäº†: type=ap2.mandates.PaymentMandate, result_type=ap2.responses.PaymentResult", "module": "a2a_handler", "function": "handle_message", "line": 307}




ap2_shopping_agent         | [ShoppingAgent â† MerchantAgent] A2Aãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.508864Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing A2A message (sender: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_a2a_message", "line": 995}
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.508925Z", "level": "DEBUG", "logger": "common.crypto", "message": "[SIGN] Canonical JSON length: 518, first 200 chars: {\"dataPart\":{\"@type\":\"ap2.responses.PaymentResult\",\"id\":\"43087989-f9c4-4ea0-ae5e-7f2889f80ac2\",\"payload\":{\"receipt_url\":\"http://localhost:8004/receipts/txn_eef27435727f.pdf\",\"status\":\"captured\",\"trans", "module": "crypto", "function": "sign_a2a_message", "line": 999}

ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.508943Z", "level": "DEBUG", "logger": "common.crypto", "message": "Signing data (key_id: merchant_agent, algorithm: ED25519)", "module": "crypto", "function": "sign_data", "line": 794}
ap2_shopping_agent         |   Status: 200


ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.509128Z", "level": "INFO", "logger": "common.crypto", "message": "Crypto SIGN: ED25519 (key: merchant_agent) - SUCCESS", "module": "logger", "function": "log_crypto_operation", "line": 350}


ap2_shopping_agent         | ================================================================================


ap2_shopping_agent         | [2025-11-02 22:41:29,512] INFO in services.shopping_agent.utils.merchant_integration: [MerchantIntegration] Payment processing completed: status=captured
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.509155Z", "level": "INFO", "logger": "common.a2a_handler", "message": "A2A Message sent to/from did:ap2:agent:shopping_agent: ap2.responses.PaymentResult", "module": "logger", "function": "log_a2a_message", "line": 250}

ap2_shopping_agent         | [2025-11-02 22:41:29,512] INFO in services.shopping_agent.langgraph_shopping_flow: [execute_payment_node] Payment successful: status=captured, transaction_id=txn_eef27435727f
ap2_merchant_agent         | {"timestamp": "2025-11-02T22:41:29.509176Z", "level": "DEBUG", "logger": "common.a2a_handler", "message": "A2A_MESSAGE_RAW: {\"type\": \"A2A_MESSAGE\", \"direction\": \"sent\", \"message_type\": \"ap2.responses.PaymentResult\", \"peer\": \"did:ap2:agent:shopping_agent\", \"headers\": {\"message_id\": \"c554915e-3c39-4e9e-bfee-6772e6a1800e\", \"sender\": \"did:ap2:agent:merchant_agent\", \"recipient\": \"did:ap2:agent:shopping_agent\", \"timestamp\": \"2025-11-02T22:41:29.508712Z\", \"nonce\": \"ba33b36e674bbfdb65734117984e70d1b3ea115bab0617d1d7a0cb4ed22fed21\", \"schema_version\": \"0.2\", \"signed\": true}, \"payload\": {\"transaction_id\": \"txn_eef27435727f\", \"status\": \"captured\", \"receipt_url\": \"http://localhost:8004/receipts/txn_eef27435727f.pdf\"}}", "module": "logger", "function": "log_a2a_message", "line": 262}
ap2_merchant_agent         | [2025-11-02 22:41:29,509] INFO in common.base_agent: [Merchant Agent] A2Aãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´: type=ap2.responses.PaymentResult, to=did:ap2:agent:shopping_agent
ap2_merchant_agent         | INFO:     172.18.0.9:56442 - "POST /a2a/message HTTP/1.1" 200 OK
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.561269Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=completed", "module": "agent", "function": "_update_session", "line": 2018}
ap2_shopping_agent         | {"timestamp": "2025-11-02T22:41:29.564131Z", "level": "DEBUG", "logger": "services.shopping_agent.agent", "message": "[ShoppingAgent] Updated session in DB: session_1762122909017_4xjhsk, step=completed", "module": "agent", "function": "_update_session", "line": 2018}